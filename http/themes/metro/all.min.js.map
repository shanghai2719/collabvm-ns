{"version":3,"sources":["all.js"],"names":["root","common","DEBUG","DEBUG_NO_TIMEOUT","DEBUG_NO_NSFW","DEBUG_NO_CONNECT","DEBUG_VM_LIST","debugLog","this","console","log","apply","arguments","rootDir","chatSound","serverAddress","window","location","host","additionalNodes","en_us_qwerty_keyboard","language","type","width","keys","Back","Tab","Enter","Esc","Home","PgUp","PgDn","End","Ins","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","Del","Space","Left","title","keysym","Up","Right","Down","Menu","modifier","LShift","RShift","LCtrl","RCtrl","Caps","LAlt","RAlt","Super","`","requires","1","2","3","4","5","6","7","8","9","0","-","=",",",".","/","[","]","\\",";","'","q","w","e","r","t","y","u","i","o","p","a","s","d","f","g","h","j","k","l","z","x","c","v","b","n","m","layout","main","alpha","movement","keyWidths","JSON","Date","prototype","toJSON","key","isFinite","valueOf","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","String","Number","Boolean","cx","escapable","gap","indent","meta","\b","\t","\n","\f","\r","\"","rep","quote","string","lastIndex","test","replace","charCodeAt","toString","slice","str","holder","length","partial","mind","value","call","Object","join","push","hasOwnProperty","stringify","replacer","space","Error","","parse","text","reviver","walk","undefined","eval","SyntaxError","History","GetGuacamole","Guacamole","Display","guac_display","displayWidth","displayHeight","displayScale","display","document","createElement","style","position","height","transformOrigin","webkitTransformOrigin","MozTransformOrigin","OTransformOrigin","msTransformOrigin","default_layer","VisibleLayer","cursor","setChannelMask","Layer","SRC","appendChild","getElement","bounds","cursorHotspotX","cursorHotspotY","cursorX","cursorY","onresize","oncursor","tasks","frames","__flush_frames","rendered_frames","frame","isReady","flush","splice","Frame","callback","blocked","execute","Task","taskHandler","task","unblock","scheduleTask","handler","getWidth","getHeight","getDefaultLayer","getCursorLayer","createLayer","layer","move","createBuffer","buffer","autosize","setCursor","hotspotX","hotspotY","srcx","srcy","srcw","srch","resize","copy","moveCursor","getCanvas","showCursor","shown","element","parent","parentNode","removeChild","translate","drawImage","image","draw","url","Image","onload","src","play","mimetype","duration","video","addEventListener","render_callback","ended","setTimeout","transfer","srcLayer","dstLayer","transferFunction","put","moveTo","lineTo","arc","radius","startAngle","endAngle","negative","curveTo","cp1x","cp1y","cp2x","cp2y","close","rect","clip","strokeColor","cap","thickness","fillColor","strokeLayer","fillLayer","pop","reset","setTransform","transform","mask","setMiterLimit","limit","scale","WebkitTransform","MozTransform","OTransform","msTransform","getScale","flatten","canvas","context","getContext","draw_layer","initial_alpha","globalAlpha","children","index","sort","diff","a_element","compareDocumentPosition","Node","DOCUMENT_POSITION_PRECEDING","DOCUMENT_POSITION_FOLLOWING","get_children","child","__unique_id","__next_id","matrix","left","top","div","overflow","__super_resize","zIndex","shade","opacity","dispose","distort","Parser","parser","element_buffer","element_end","start_index","receive","packet","substring","terminator","opcode","shift","oninstruction","length_end","indexOf","parseInt","isNaN","Client","tunnel","guac_client","STATE_WAITING","STATE_CONNECTED","currentState","lineCap","lineJoin","layers","parsers","audio_channels","streams","stream_indices","IntegerPool","output_streams","setState","state","onstatechange","isConnected","getLayer","getDisplay","sendSize","sendMessage","sendKeyEvent","pressed","sendMouseState","mouseState","Math","floor","buttonMask","middle","right","up","down","setClipboard","data","stream","createClipboardStream","writer","StringWriter","sendText","sendEnd","createFileStream","filename","next","OutputStream","old_end","free","createPipeStream","name","sendAck","message","code","sendBlob","endStream","onname","onerror","onclipboard","onfile","onpipe","onsync","onturn","onchat","onrename","onadduser","onremuser","onconnect","onlist","onvote","onaction","layerPropertyHandlers","miter-limit","parseFloat","instructionHandlers","turn","parameters","rename","chat","admin","onadmin","adduser","remuser","connect","list","vote","action","file","nop","ack","stream_index","reason","onack","Status","audio","audio_channel","channel","AudioChannel","InputStream","blob_reader","BlobReader","onend","getBlob","blob","onblob","cfill","channelMask","clipboard","srcL","srcX","srcY","srcWidth","srcHeight","dstL","dstX","dstY","cstroke","curve","layer_index","error","disconnect","end","identity","lfill","line","lstroke","parent_index","nest","getParser","pipe","png","set","size","start","sync","timestamp","function_index","DefaultTransferFunction","reader","FileReader","binary","bytes","Uint8Array","result","byteLength","fromCharCode","btoa","readAsArrayBuffer","status","dst","red","green","blue","15","12","10","14","13","11","OnScreenKeyboard","osk","modifierKeysyms","scaledElements","addClass","classname","classList","add","className","removeClass","remove","match","testClassname","ignoreMouse","ScaledElement","scaleFont","pixels","lineHeight","fontSize","modifiersPressed","names","getActiveKey","keyName","candidate","press","keyElement","disabled","modifierClass","getCSSName","originalKeysym","keyboard","onkeyup","onkeydown","release","onselectstart","onmousemove","onmouseup","onmousedown","stopPropagation","touchMouseThreshold","Layout","unit","asKeyArray","object","Array","Key","keyArrays","getKeys","toLowerCase","appendElements","capElement","textContent","requirement","mouseRelease","preventDefault","template","charCode","ArrayBufferReader","guac_reader","atob","arrayBuffer","ArrayBuffer","bufferView","ondata","client","guac_stream","blob_builder","BlobBuilder","WebKitBlobBuilder","MozBlobBuilder","blobs","append","Blob","onprogress","getLength","StringReader","array_reader","bytes_remaining","codepoint","__decode_utf8","ontext","Mouse","guac_mouse","scrollThreshold","PIXELS_PER_LINE","PIXELS_PER_PAGE","State","onmouseout","ignore_mouse","scroll_delta","cancelEvent","returnValue","ignorePendingMouseEvents","mousewheel_handler","delta","deltaY","wheelDeltaY","wheelDelta","deltaMode","detail","fromClientPosition","clientX","clientY","button","event","target","relatedTarget","toElement","CSS3_CURSOR_SUPPORTED","dataURL","toDataURL","guac_state","offsetLeft","offsetTop","offsetParent","body","scrollLeft","scrollTop","documentScrollLeft","documentElement","documentScrollTop","Touchpad","guac_touchpad","devicePixelRatio","clickTimingThreshold","clickMoveThreshold","touch_count","last_touch_x","last_touch_y","last_touch_time","pixels_moved","touch_buttons","gesture_in_progress","click_release_timeout","touches","time","getTime","clearTimeout","min","starting_touch","touch","delta_x","delta_y","abs","offsetWidth","offsetHeight","Touchscreen","guac_touchscreen","gesture_start_x","gesture_start_y","long_press_timeout","press_button","release_button","move_mouse","finger_moved","changedTouches","sqrt","end_gesture","longPressThreshold","begin_gesture","Tunnel","elements","CONNECTING","receiveTimeout","OPEN","CLOSED","HTTPTunnel","tunnelURL","tunnel_uuid","TUNNEL_CONNECT","TUNNEL_READ","TUNNEL_WRITE","POLLING_ENABLED","POLLING_DISABLED","pollingMode","sendingMessages","outputMessageBuffer","close_tunnel","Code","SUCCESS","RESOURCE_NOT_FOUND","sendPendingMessages","message_xmlhttprequest","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","handleHTTPTunnelError","send","xmlhttprequest","getResponseHeader","request_id","makeRequest","connect_xmlhttprequest","responseText","handleResponse","interval","nextRequest","dataUpdateEvents","elementEnd","startIndex","parseResponse","clearInterval","setInterval","current","lengthEnd","abort","WebSocketTunnel","socket","protocol","http:","https:","slash","pathname","lastIndexOf","path","sendRawMessage","WebSocket","onopen","onclose","SERVER_ERROR","onmessage","ChainedTunnel","tunnel_chain","connect_data","chained_tunnel","tunnels","attach","fail_tunnel","next_tunnel","commit_tunnel","next_packet_time","Packet","now","getTimestamp","AudioContext","webkitAudioContext","currentTime","performance","webkitNow","when","readyBuffer","handleReady","decodeAudioData","play_when","source","createBufferSource","playDelayed","destination","noteOn","play_on_load","Audio","delay","guac_pool","pool","next_int","integer","Keyboard","guac_keyboard","KeyEvent","key_event","defaultPrevented","reliable","getAge","KeydownEvent","keyCode","keyIdentifier","keysym_from_key_identifier","keysym_from_keycode","unicodePrefixLocation","key_identifier_sane","modifiers","prevent_alt","ctrl","navigator","platform","alt","hyper","recentKeysym","KeypressEvent","keysym_from_charcode","KeyupEvent","eventLog","keycodeKeysyms","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","91","92","93","112","113","114","115","116","117","118","119","120","121","122","123","144","145","225","keyidentifier_keysym","Again","AllCandidates","Alphanumeric","Alt","Attn","AltGraph","ArrowDown","ArrowLeft","ArrowRight","ArrowUp","Backspace","CapsLock","Cancel","Clear","Convert","Copy","Crsel","CrSel","CodeInput","Compose","Control","ContextMenu","DeadGrave","DeadAcute","DeadCircumflex","DeadTilde","DeadMacron","DeadBreve","DeadAboveDot","DeadUmlaut","DeadAboveRing","DeadDoubleacute","DeadCaron","DeadCedilla","DeadOgonek","DeadIota","DeadVoicedSound","DeadSemivoicedSound","Delete","EraseEof","Escape","Execute","Exsel","ExSel","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","Find","GroupFirst","GroupLast","GroupNext","GroupPrevious","FullWidth","HalfWidth","HangulMode","Hankaku","HanjaMode","Help","Hiragana","HiraganaKatakana","Hyper","Insert","JapaneseHiragana","JapaneseKatakana","JapaneseRomaji","JunjaMode","KanaMode","KanjiMode","Katakana","Meta","ModeChange","NumLock","PageDown","PageUp","Pause","Play","PreviousCandidate","PrintScreen","Redo","RomanCharacters","Scroll","Select","Separator","Shift","SingleCandidate","Undo","Win","Zenkaku","ZenkakuHankaku","no_repeat","65027","65505","65506","65507","65508","65511","65512","65513","65514","65515","65516","ModifierState","last_keydown_result","key_repeat_timeout","key_repeat_interval","get_keysym","keysyms","identifier","shifted","typedCharacter","hex","toUpperCase","isControlCharacter","update_modifier_state","fromKeyboardEvent","interpret_events","last_event","handled_event","interpret_event","first","accepted_events","release_simulated_altgr","getEventLocation","keyLocation","which","keydownEvent","keypressEvent","keyupEvent","shiftKey","ctrlKey","altKey","metaKey","getModifierState","guac_status","isError","UNSUPPORTED","SERVER_BUSY","UPSTREAM_TIMEOUT","UPSTREAM_ERROR","RESOURCE_CONFLICT","CLIENT_BAD_REQUEST","CLIENT_UNAUTHORIZED","CLIENT_FORBIDDEN","CLIENT_TIMEOUT","CLIENT_OVERRUN","CLIENT_BAD_TYPE","CLIENT_TOO_MANY","ArrayBufferWriter","guac_writer","__send_blob","sendData","offset","subarray","save","pathClosed","stackSize","compositeOperation","fitRect","resizeWidth","resizeHeight","opBoundX","opBoundY","newWidth","newHeight","oldData","oldCompositeOperation","globalCompositeOperation","srcCanvas","getImageData","src_pixel","Pixel","dst_pixel","putImageData","beginPath","bezierCurveTo","closePath","lineWidth","strokeStyle","stroke","fillStyle","fill","createPattern","restore","miterLimit","ROUT","ATOP","XOR","ROVER","OVER","PLUS","RIN","IN","OUT","RATOP","array_writer","__append_utf8","new_buffer","__expand","out_buffer","__encode_utf8","API_VERSION","jQuery","Adapter","bind","el","trigger","extra","extractEventData","originalEvent","onDomLoad","init","initHtml4","initialized","enabled","savedHashes","isLastHash","newHash","getHashByIndex","isHashEqual","oldHash","encodeURIComponent","saveHash","discardedHashes","discardedStates","discardState","discardedState","forwardState","backState","discardObject","discardedStateHash","getHashByState","discardHash","discardedHash","StateHash","hash","recycleState","emulated","hashChange","hashChangeInit","checkerFunction","iframe","lastIframeHash","checkerRunning","lastDocumentHash","startedWithHash","getHash","isInternetExplorer","setAttribute","contentWindow","documentHash","iframeHash","escapeHash","back","setHash","intervalList","options","hashChangeInterval","pushState","onHashChange","currentUrl","newURL","getLocationHref","currentHash","getHashByUrl","busy","doubleCheckComplete","isTraditionalAnchor","extractState","getFullUrl","isLastSavedState","forward","encodeURI","queue","pushQueue","scope","args","newState","createStateObject","newStateHash","oldState","getState","oldStateHash","html4Hash","wasExpected","expectedStateId","id","storeState","setTitle","saveState","getShortUrl","replaceState","previousState","getStateByIndex","sessionStorage","alert","history","setItem","removeItem","encode","decode","initCore","safariPollInterval","doubleCheckInterval","disableSuid","storeInterval","busyDelay","debug","initialTitle","html4Mode","delayInit","clearAllIntervals","il","arg","consoleExists","textarea","getElementById","Exception","scrollHeight","clientHeight","getInternetExplorerMajorVersion","cached","all","getElementsByTagName","innerHTML","userAgent","bugs","vendor","safariPoll","ieDoubleCheck","hashEscape","isEmptyObject","obj","cloneObject","newObj","getRootUrl","rootUrl","hostname","port","getBaseHref","baseElements","baseHref","href","getBaseUrl","getBasePageUrl","getPageUrl","part","allowBaseHref","fullUrl","firstChar","shortUrl","baseUrl","doc","URL","decodeURIComponent","store","idToState","stateToId","urlToId","storedStates","savedStates","normalizeStore","friendly","create","getLastSavedState","cleanUrl","getIdByState","extractId","getStateString","random","normalizeState","dataNotEmpty","normalized","hashedUrl","hasUrlDuplicate","getStateById","passedState","cleanedState","getStateId","url_or_hash","parts","tmp","split","exec","getIdByUrl","getLastStoredState","isLast","getCurrentIndex","unescapeHash","normalizeHash","pageUrl","firstState","queues","flag","timeout","fireNext","item","fireQueueItem","clearQueue","stateChanged","doubleChecker","doubleCheckClear","doubleCheck","tryAgain","safariStatePoll","urlState","go","emptyFunction","onPopState","stateId","getItem","err","onUnload","currentStore","currentStoreString","DOMException","QUOTA_EXCEEDED_ERR","appCodeName","maxChatMsgLen","maxChatMsgHistory","hasTurn","modPerms","turnInterval","voteInterval","uploadInterval","hasVoted","focused","guac","mouse","audioSupported","fileApisSupported","blurSupported","chatSoundOn","maxUploadSize","maxUploadNameLen","nsfwWarn","users","usersWaiting","usersData","username","vmName","connected","nodeList","fileOp","BEGIN","MIDDLE","END","STOP","fileResponse","ACK","FINISHED","WAIT_TIME","FAILED","UPLOAD_IN_PROGRESS","TIMED_OUT","getRankClass","rank","loginTimesPressed","copyIP","ip","getIP","user","writeText","chatMessage","vmMonitor","output","outputBox","$","input","sendFromDialog","inputBox","val","trim","renameUser","oldName","newName","prompt","adminInstruction","unshift","addTableRow","table","userData","userHTML","displayTable","html","empty","get","chatPanel","atBottom","chatElement","prepend","chatBox","playSound","getCookie","cname","ca","cookie","charAt","setCookie","cvalue","exdays","setTime","expires","toUTCString","initSound","canPlayType","setChatSoundOn","on","attr","loop","autostart","appendTo","waitingTimer","ms","completion","dots","timerCallback","seconds","setFocus","focus","activateOSK","find","displayNsfwWarn","show","hide","css","documentMode","displayLoading","displayVMList","displayVMView","updateVMList","vmList","click","getAttribute","substr","getVMList","setVoteStats","voteStatus","updateActions","files","prop","startFileUpload","uploadId","xhr","responseType","upload","lengthComputable","progress","loaded","total","round","displayUploadWaitTime","waitTime","InitalizeGuacamoleClient","keypress","passwd","num","inArray","oldUsername","multicollab","connTunnel","listGuac","vmlist","thisnode","link","checkforcnewbss","onclick","elem","srcElement","parentElement","node","firstChild","warnText","kbd","is","newUsername","modal","keydown","Text","File","FileList","fileUpload","change","msg","CONNECTED","forEach","GetAdmin","onunload"],"mappings":"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","file":"all.min.js","sourcesContent":["(function () {\n\t'use strict';\n\n\t// CollabVM webapp configuration\n\n\tconst root=\"/collab-vm/\";\n\n\tvar common = {\n\t\tDEBUG: false,\n\t\tDEBUG_NO_TIMEOUT: false,\n\t\tDEBUG_NO_NSFW: false,\n\t\tDEBUG_NO_CONNECT: false, // is this used?\n\t\tDEBUG_VM_LIST: false,\n\t\tDEBUG_VM_LIST: false,\n\n\t\tdebugLog: function() {\n\t\t\tif(this.DEBUG)\n\t\t\t\tconsole.log.apply(null, arguments);\n\t\t},\n\n\t\t/** @const\n\t\t * The root directory of the collab-vm project with a\n\t\t * forward slash appended to it.\n\t\t * This is determined at runtime to allow the project to be\n\t\t * relocated without needing to recompile the javascript.\n\t\t * @type {string}\n\t\t */\n\t\trootDir: root,\n\t\tchatSound: root + \"notify\",\n\n\t\t/**\n\t\t * The main node this webapp is configured to connect to.\n\t\t * @const\n\t\t */\n\t\tserverAddress: window.location.host,\n\n\t\t/**\n\t\t * Additional nodes to connect to.\n\t\t * Uses multicollab() to do so\n\t\t * @const\n\t\t */\n\t\tadditionalNodes: [\n\t\t]\n\t};\n\n\tvar en_us_qwerty_keyboard = {\n\n\t    \"language\" : \"en_US\",\n\t    \"type\"     : \"qwerty\",\n\t    \"width\"    : 22,\n\n\t    \"keys\" : {\n\n\t        \"Back\"  : 65288,\n\t        \"Tab\"   : 65289,\n\t        \"Enter\" : 65293,\n\t        \"Esc\"   : 65307,\n\t        \"Home\"  : 65360,\n\t        \"PgUp\"  : 65365,\n\t        \"PgDn\"  : 65366,\n\t        \"End\"   : 65367,\n\t        \"Ins\"   : 65379,\n\t        \"F1\"    : 65470,\n\t        \"F2\"    : 65471,\n\t        \"F3\"    : 65472,\n\t        \"F4\"    : 65473,\n\t        \"F5\"    : 65474,\n\t        \"F6\"    : 65475,\n\t        \"F7\"    : 65476,\n\t        \"F8\"    : 65477,\n\t        \"F9\"    : 65478,\n\t        \"F10\"   : 65479,\n\t        \"F11\"   : 65480,\n\t        \"F12\"   : 65481,\n\t        \"Del\"   : 65535,\n\n\t        \"Space\" : \" \",\n\n\t        \"Left\" : [{\n\t            \"title\"  : \"\",\n\t            \"keysym\" : 65361\n\t        }],\n\t        \"Up\" : [{\n\t            \"title\"  : \"\",\n\t            \"keysym\" : 65362\n\t        }],\n\t        \"Right\" : [{\n\t            \"title\"  : \"\",\n\t            \"keysym\" : 65363\n\t        }],\n\t        \"Down\" : [{\n\t            \"title\"  : \"\",\n\t            \"keysym\" : 65364\n\t        }],\n\n\t        \"Menu\" : [{\n\t            \"title\"    : \"Menu\",\n\t            \"modifier\" : \"super\",\n\t            \"keysym\"   : 65383\n\t        }],\n\t        \"LShift\" : [{\n\t            \"title\"    : \"Shift\",\n\t            \"modifier\" : \"shift\",\n\t            \"keysym\"   : 65505\n\t        }],\n\t        \"RShift\" : [{\n\t            \"title\"    : \"Shift\",\n\t            \"modifier\" : \"shift\",\n\t            \"keysym\"   : 65506\n\t        }],\n\t        \"LCtrl\" : [{\n\t            \"title\"    : \"Ctrl\",\n\t            \"modifier\" : \"control\",\n\t            \"keysym\"   : 65507\n\t        }],\n\t        \"RCtrl\" : [{\n\t            \"title\"    : \"Ctrl\",\n\t            \"modifier\" : \"control\",\n\t            \"keysym\"   : 65508\n\t        }],\n\t        \"Caps\" : [{\n\t            \"title\"    : \"Caps\",\n\t            \"modifier\" : \"caps\",\n\t            \"keysym\"   : 65509\n\t        }],\n\t        \"LAlt\" : [{\n\t            \"title\"    : \"Alt\",\n\t            \"modifier\" : \"alt\",\n\t            \"keysym\"   : 65513\n\t        }],\n\t        \"RAlt\" : [{\n\t            \"title\"    : \"Alt\",\n\t            \"modifier\" : \"alt\",\n\t            \"keysym\"   : 65514\n\t        }],\n\t        \"Super\" : [{\n\t            \"title\"    : \"Super\",\n\t            \"modifier\" : \"super\",\n\t            \"keysym\"   : 65515\n\t        }],\n\n\t        \"`\" : [\n\t            { \"title\" : \"`\", \"requires\" : [         ] },\n\t            { \"title\" : \"~\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"1\" : [\n\t            { \"title\" : \"1\", \"requires\" : [         ] },\n\t            { \"title\" : \"!\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"2\" : [\n\t            { \"title\" : \"2\", \"requires\" : [         ] },\n\t            { \"title\" : \"@\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"3\" : [\n\t            { \"title\" : \"3\", \"requires\" : [         ] },\n\t            { \"title\" : \"#\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"4\" : [\n\t            { \"title\" : \"4\", \"requires\" : [         ] },\n\t            { \"title\" : \"$\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"5\" : [\n\t            { \"title\" : \"5\", \"requires\" : [         ] },\n\t            { \"title\" : \"%\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"6\" : [\n\t            { \"title\" : \"6\", \"requires\" : [         ] },\n\t            { \"title\" : \"^\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"7\" : [\n\t            { \"title\" : \"7\", \"requires\" : [         ] },\n\t            { \"title\" : \"&\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"8\" : [\n\t            { \"title\" : \"8\", \"requires\" : [         ] },\n\t            { \"title\" : \"*\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"9\" : [\n\t            { \"title\" : \"9\", \"requires\" : [         ] },\n\t            { \"title\" : \"(\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"0\" : [\n\t            { \"title\" : \"0\", \"requires\" : [         ] },\n\t            { \"title\" : \")\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"-\" : [\n\t            { \"title\" : \"-\", \"requires\" : [         ] },\n\t            { \"title\" : \"_\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"=\" : [\n\t            { \"title\" : \"=\", \"requires\" : [         ] },\n\t            { \"title\" : \"+\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \",\" : [\n\t            { \"title\" : \",\", \"requires\" : [         ] },\n\t            { \"title\" : \"<\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \".\" : [\n\t            { \"title\" : \".\", \"requires\" : [         ] },\n\t            { \"title\" : \">\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"/\" : [\n\t            { \"title\" : \"/\", \"requires\" : [         ] },\n\t            { \"title\" : \"?\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"[\" : [\n\t            { \"title\" : \"[\", \"requires\" : [         ] },\n\t            { \"title\" : \"{\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"]\" : [\n\t            { \"title\" : \"]\", \"requires\" : [         ] },\n\t            { \"title\" : \"}\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"\\\\\" : [\n\t            { \"title\" : \"\\\\\", \"requires\" : [         ] },\n\t            { \"title\" : \"|\",  \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \";\" : [\n\t            { \"title\" : \";\", \"requires\" : [         ] },\n\t            { \"title\" : \":\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\t        \"'\" : [\n\t            { \"title\" : \"'\",  \"requires\" : [         ] },\n\t            { \"title\" : \"\\\"\", \"requires\" : [ \"shift\" ] }\n\t        ],\n\n\t        \"q\" : [\n\t            { \"title\" : \"q\", \"requires\" : [                 ] },\n\t            { \"title\" : \"Q\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"Q\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"q\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"w\" : [\n\t            { \"title\" : \"w\", \"requires\" : [                 ] },\n\t            { \"title\" : \"W\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"W\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"w\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"e\" : [\n\t            { \"title\" : \"e\", \"requires\" : [                 ] },\n\t            { \"title\" : \"E\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"E\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"e\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"r\" : [\n\t            { \"title\" : \"r\", \"requires\" : [                 ] },\n\t            { \"title\" : \"R\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"R\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"r\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"t\" : [\n\t            { \"title\" : \"t\", \"requires\" : [                 ] },\n\t            { \"title\" : \"T\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"T\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"t\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"y\" : [\n\t            { \"title\" : \"y\", \"requires\" : [                 ] },\n\t            { \"title\" : \"Y\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"Y\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"y\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"u\" : [\n\t            { \"title\" : \"u\", \"requires\" : [                 ] },\n\t            { \"title\" : \"U\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"U\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"u\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"i\" : [\n\t            { \"title\" : \"i\", \"requires\" : [                 ] },\n\t            { \"title\" : \"I\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"I\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"i\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"o\" : [\n\t            { \"title\" : \"o\", \"requires\" : [                 ] },\n\t            { \"title\" : \"O\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"O\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"o\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"p\" : [\n\t            { \"title\" : \"p\", \"requires\" : [                 ] },\n\t            { \"title\" : \"P\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"P\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"p\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"a\" : [\n\t            { \"title\" : \"a\", \"requires\" : [                 ] },\n\t            { \"title\" : \"A\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"A\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"a\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"s\" : [\n\t            { \"title\" : \"s\", \"requires\" : [                 ] },\n\t            { \"title\" : \"S\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"S\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"s\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"d\" : [\n\t            { \"title\" : \"d\", \"requires\" : [                 ] },\n\t            { \"title\" : \"D\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"D\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"d\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"f\" : [\n\t            { \"title\" : \"f\", \"requires\" : [                 ] },\n\t            { \"title\" : \"F\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"F\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"f\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"g\" : [\n\t            { \"title\" : \"g\", \"requires\" : [                 ] },\n\t            { \"title\" : \"G\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"G\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"g\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"h\" : [\n\t            { \"title\" : \"h\", \"requires\" : [                 ] },\n\t            { \"title\" : \"H\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"H\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"h\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"j\" : [\n\t            { \"title\" : \"j\", \"requires\" : [                 ] },\n\t            { \"title\" : \"J\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"J\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"j\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"k\" : [\n\t            { \"title\" : \"k\", \"requires\" : [                 ] },\n\t            { \"title\" : \"K\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"K\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"k\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"l\" : [\n\t            { \"title\" : \"l\", \"requires\" : [                 ] },\n\t            { \"title\" : \"L\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"L\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"l\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"z\" : [\n\t            { \"title\" : \"z\", \"requires\" : [                 ] },\n\t            { \"title\" : \"Z\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"Z\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"z\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"x\" : [\n\t            { \"title\" : \"x\", \"requires\" : [                 ] },\n\t            { \"title\" : \"X\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"X\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"x\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"c\" : [\n\t            { \"title\" : \"c\", \"requires\" : [                 ] },\n\t            { \"title\" : \"C\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"C\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"c\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"v\" : [\n\t            { \"title\" : \"v\", \"requires\" : [                 ] },\n\t            { \"title\" : \"V\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"V\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"v\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"b\" : [\n\t            { \"title\" : \"b\", \"requires\" : [                 ] },\n\t            { \"title\" : \"B\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"B\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"b\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"n\" : [\n\t            { \"title\" : \"n\", \"requires\" : [                 ] },\n\t            { \"title\" : \"N\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"N\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"n\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ],\n\t        \"m\" : [\n\t            { \"title\" : \"m\", \"requires\" : [                 ] },\n\t            { \"title\" : \"M\", \"requires\" : [ \"caps\"          ] },\n\t            { \"title\" : \"M\", \"requires\" : [ \"shift\"         ] },\n\t            { \"title\" : \"m\", \"requires\" : [ \"caps\", \"shift\" ] }\n\t        ]\n\n\t    },\n\n\t    \"layout\" : [\n\n\t        [ \"Esc\", 0.7, \"F1\", \"F2\",  \"F3\",  \"F4\",\n\t                 0.7, \"F5\", \"F6\",  \"F7\",  \"F8\",\n\t                 0.7, \"F9\", \"F10\", \"F11\", \"F12\" ],\n\n\t        [ 0.1 ],\n\n\t        {\n\t            \"main\" : {\n\t                \"alpha\" : [\n\n\t                    [ \"`\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"0\", \"-\", \"=\", \"Back\" ],\n\t                    [ \"Tab\", \"q\", \"w\", \"e\", \"r\", \"t\", \"y\", \"u\", \"i\", \"o\", \"p\", \"[\", \"]\", \"\\\\\" ],\n\t                    [ \"Caps\",  \"a\", \"s\", \"d\", \"f\", \"g\", \"h\", \"j\", \"k\", \"l\", \";\", \"'\", \"Enter\" ],\n\t                    [ \"LShift\", \"z\", \"x\", \"c\", \"v\",  \"b\", \"n\",  \"m\", \",\", \".\", \"/\",  \"RShift\" ],\n\t                    [ \"LCtrl\", \"Super\", \"LAlt\",       \"Space\",        \"RAlt\", \"Menu\", \"RCtrl\" ]\n\n\t                ],\n\n\t                \"movement\" : [\n\t                    [ \"Ins\",  \"Home\", \"PgUp\"  ],\n\t                    [ \"Del\",  \"End\",  \"PgDn\"  ],\n\t                    [           1             ],\n\t                    [          \"Up\"           ],\n\t                    [ \"Left\", \"Down\", \"Right\" ]\n\t                ]\n\t            }\n\t        }\n\n\t    ],\n\n\t    \"keyWidths\" : {\n\n\t        \"Back\"   : 2,\n\t        \"Tab\"    : 1.5,\n\t        \"\\\\\"     : 1.5,\n\t        \"Caps\"   : 1.85,\n\t        \"Enter\"  : 2.25,\n\t        \"LShift\" : 2.1,\n\t        \"RShift\" : 3.1,\n\n\t        \"LCtrl\" : 1.6,\n\t        \"Super\" : 1.6,\n\t        \"LAlt\"  : 1.6,\n\t        \"Space\" : 6.1,\n\t        \"RAlt\"  : 1.6,\n\t        \"Menu\"  : 1.6,\n\t        \"RCtrl\" : 1.6,\n\n\t        \"Ins\"  : 1.6,\n\t        \"Home\" : 1.6,\n\t        \"PgUp\" : 1.6,\n\t        \"Del\"  : 1.6,\n\t        \"End\"  : 1.6,\n\t        \"PgDn\" : 1.6\n\n\t    }\n\n\t};\n\n\t/*\n\t    json2.js\n\t    2012-10-08\n\n\t    Public Domain.\n\n\t    NO WARRANTY EXPRESSED OR IMPLIED. USE AT YOUR OWN RISK.\n\n\t    See http://www.JSON.org/js.html\n\n\n\t    This code should be minified before deployment.\n\t    See http://javascript.crockford.com/jsmin.html\n\n\t    USE YOUR OWN COPY. IT IS EXTREMELY UNWISE TO LOAD CODE FROM SERVERS YOU DO\n\t    NOT CONTROL.\n\n\n\t    This file creates a global JSON object containing two methods: stringify\n\t    and parse.\n\n\t        JSON.stringify(value, replacer, space)\n\t            value       any JavaScript value, usually an object or array.\n\n\t            replacer    an optional parameter that determines how object\n\t                        values are stringified for objects. It can be a\n\t                        function or an array of strings.\n\n\t            space       an optional parameter that specifies the indentation\n\t                        of nested structures. If it is omitted, the text will\n\t                        be packed without extra whitespace. If it is a number,\n\t                        it will specify the number of spaces to indent at each\n\t                        level. If it is a string (such as '\\t' or '&nbsp;'),\n\t                        it contains the characters used to indent at each level.\n\n\t            This method produces a JSON text from a JavaScript value.\n\n\t            When an object value is found, if the object contains a toJSON\n\t            method, its toJSON method will be called and the result will be\n\t            stringified. A toJSON method does not serialize: it returns the\n\t            value represented by the name/value pair that should be serialized,\n\t            or undefined if nothing should be serialized. The toJSON method\n\t            will be passed the key associated with the value, and this will be\n\t            bound to the value\n\n\t            For example, this would serialize Dates as ISO strings.\n\n\t                Date.prototype.toJSON = function (key) {\n\t                    function f(n) {\n\t                        // Format integers to have at least two digits.\n\t                        return n < 10 ? '0' + n : n;\n\t                    }\n\n\t                    return this.getUTCFullYear()   + '-' +\n\t                         f(this.getUTCMonth() + 1) + '-' +\n\t                         f(this.getUTCDate())      + 'T' +\n\t                         f(this.getUTCHours())     + ':' +\n\t                         f(this.getUTCMinutes())   + ':' +\n\t                         f(this.getUTCSeconds())   + 'Z';\n\t                };\n\n\t            You can provide an optional replacer method. It will be passed the\n\t            key and value of each member, with this bound to the containing\n\t            object. The value that is returned from your method will be\n\t            serialized. If your method returns undefined, then the member will\n\t            be excluded from the serialization.\n\n\t            If the replacer parameter is an array of strings, then it will be\n\t            used to select the members to be serialized. It filters the results\n\t            such that only members with keys listed in the replacer array are\n\t            stringified.\n\n\t            Values that do not have JSON representations, such as undefined or\n\t            functions, will not be serialized. Such values in objects will be\n\t            dropped; in arrays they will be replaced with null. You can use\n\t            a replacer function to replace those with JSON values.\n\t            JSON.stringify(undefined) returns undefined.\n\n\t            The optional space parameter produces a stringification of the\n\t            value that is filled with line breaks and indentation to make it\n\t            easier to read.\n\n\t            If the space parameter is a non-empty string, then that string will\n\t            be used for indentation. If the space parameter is a number, then\n\t            the indentation will be that many spaces.\n\n\t            Example:\n\n\t            text = JSON.stringify(['e', {pluribus: 'unum'}]);\n\t            // text is '[\"e\",{\"pluribus\":\"unum\"}]'\n\n\n\t            text = JSON.stringify(['e', {pluribus: 'unum'}], null, '\\t');\n\t            // text is '[\\n\\t\"e\",\\n\\t{\\n\\t\\t\"pluribus\": \"unum\"\\n\\t}\\n]'\n\n\t            text = JSON.stringify([new Date()], function (key, value) {\n\t                return this[key] instanceof Date ?\n\t                    'Date(' + this[key] + ')' : value;\n\t            });\n\t            // text is '[\"Date(---current time---)\"]'\n\n\n\t        JSON.parse(text, reviver)\n\t            This method parses a JSON text to produce an object or array.\n\t            It can throw a SyntaxError exception.\n\n\t            The optional reviver parameter is a function that can filter and\n\t            transform the results. It receives each of the keys and values,\n\t            and its return value is used instead of the original value.\n\t            If it returns what it received, then the structure is not modified.\n\t            If it returns undefined then the member is deleted.\n\n\t            Example:\n\n\t            // Parse the text. Values that look like ISO date strings will\n\t            // be converted to Date objects.\n\n\t            myData = JSON.parse(text, function (key, value) {\n\t                var a;\n\t                if (typeof value === 'string') {\n\t                    a =\n\t/^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2}(?:\\.\\d*)?)Z$/.exec(value);\n\t                    if (a) {\n\t                        return new Date(Date.UTC(+a[1], +a[2] - 1, +a[3], +a[4],\n\t                            +a[5], +a[6]));\n\t                    }\n\t                }\n\t                return value;\n\t            });\n\n\t            myData = JSON.parse('[\"Date(09/09/2001)\"]', function (key, value) {\n\t                var d;\n\t                if (typeof value === 'string' &&\n\t                        value.slice(0, 5) === 'Date(' &&\n\t                        value.slice(-1) === ')') {\n\t                    d = new Date(value.slice(5, -1));\n\t                    if (d) {\n\t                        return d;\n\t                    }\n\t                }\n\t                return value;\n\t            });\n\n\n\t    This is a reference implementation. You are free to copy, modify, or\n\t    redistribute.\n\t*/\n\n\t/*jslint evil: true, regexp: true */\n\n\t/*members \"\", \"\\b\", \"\\t\", \"\\n\", \"\\f\", \"\\r\", \"\\\"\", JSON, \"\\\\\", apply,\n\t    call, charCodeAt, getUTCDate, getUTCFullYear, getUTCHours,\n\t    getUTCMinutes, getUTCMonth, getUTCSeconds, hasOwnProperty, join,\n\t    lastIndex, length, parse, prototype, push, replace, slice, stringify,\n\t    test, toJSON, toString, valueOf\n\t*/\n\n\n\t// Create a JSON object only if one does not already exist. We create the\n\t// methods in a closure to avoid creating global variables.\n\n\tif (typeof JSON !== 'object') {\n\t    JSON = {};\n\t}\n\n\t(function () {\n\n\t    function f(n) {\n\t        // Format integers to have at least two digits.\n\t        return n < 10 ? '0' + n : n;\n\t    }\n\n\t    if (typeof Date.prototype.toJSON !== 'function') {\n\n\t        Date.prototype.toJSON = function (key) {\n\n\t            return isFinite(this.valueOf())\n\t                ? this.getUTCFullYear()     + '-' +\n\t                    f(this.getUTCMonth() + 1) + '-' +\n\t                    f(this.getUTCDate())      + 'T' +\n\t                    f(this.getUTCHours())     + ':' +\n\t                    f(this.getUTCMinutes())   + ':' +\n\t                    f(this.getUTCSeconds())   + 'Z'\n\t                : null;\n\t        };\n\n\t        String.prototype.toJSON      =\n\t            Number.prototype.toJSON  =\n\t            Boolean.prototype.toJSON = function (key) {\n\t                return this.valueOf();\n\t            };\n\t    }\n\n\t    var cx = /[\\u0000\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n\t        escapable = /[\\\\\\\"\\x00-\\x1f\\x7f-\\x9f\\u00ad\\u0600-\\u0604\\u070f\\u17b4\\u17b5\\u200c-\\u200f\\u2028-\\u202f\\u2060-\\u206f\\ufeff\\ufff0-\\uffff]/g,\n\t        gap,\n\t        indent,\n\t        meta = {    // table of character substitutions\n\t            '\\b': '\\\\b',\n\t            '\\t': '\\\\t',\n\t            '\\n': '\\\\n',\n\t            '\\f': '\\\\f',\n\t            '\\r': '\\\\r',\n\t            '\"' : '\\\\\"',\n\t            '\\\\': '\\\\\\\\'\n\t        },\n\t        rep;\n\n\n\t    function quote(string) {\n\n\t// If the string contains no control characters, no quote characters, and no\n\t// backslash characters, then we can safely slap some quotes around it.\n\t// Otherwise we must also replace the offending characters with safe escape\n\t// sequences.\n\n\t        escapable.lastIndex = 0;\n\t        return escapable.test(string) ? '\"' + string.replace(escapable, function (a) {\n\t            var c = meta[a];\n\t            return typeof c === 'string'\n\t                ? c\n\t                : '\\\\u' + ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n\t        }) + '\"' : '\"' + string + '\"';\n\t    }\n\n\n\t    function str(key, holder) {\n\n\t// Produce a string from holder[key].\n\n\t        var i,          // The loop counter.\n\t            k,          // The member key.\n\t            v,          // The member value.\n\t            length,\n\t            mind = gap,\n\t            partial,\n\t            value = holder[key];\n\n\t// If the value has a toJSON method, call it to obtain a replacement value.\n\n\t        if (value && typeof value === 'object' &&\n\t                typeof value.toJSON === 'function') {\n\t            value = value.toJSON(key);\n\t        }\n\n\t// If we were called with a replacer function, then call the replacer to\n\t// obtain a replacement value.\n\n\t        if (typeof rep === 'function') {\n\t            value = rep.call(holder, key, value);\n\t        }\n\n\t// What happens next depends on the value's type.\n\n\t        switch (typeof value) {\n\t        case 'string':\n\t            return quote(value);\n\n\t        case 'number':\n\n\t// JSON numbers must be finite. Encode non-finite numbers as null.\n\n\t            return isFinite(value) ? String(value) : 'null';\n\n\t        case 'boolean':\n\t        case 'null':\n\n\t// If the value is a boolean or null, convert it to a string. Note:\n\t// typeof null does not produce 'null'. The case is included here in\n\t// the remote chance that this gets fixed someday.\n\n\t            return String(value);\n\n\t// If the type is 'object', we might be dealing with an object or an array or\n\t// null.\n\n\t        case 'object':\n\n\t// Due to a specification blunder in ECMAScript, typeof null is 'object',\n\t// so watch out for that case.\n\n\t            if (!value) {\n\t                return 'null';\n\t            }\n\n\t// Make an array to hold the partial results of stringifying this object value.\n\n\t            gap += indent;\n\t            partial = [];\n\n\t// Is the value an array?\n\n\t            if (Object.prototype.toString.apply(value) === '[object Array]') {\n\n\t// The value is an array. Stringify every element. Use null as a placeholder\n\t// for non-JSON values.\n\n\t                length = value.length;\n\t                for (i = 0; i < length; i += 1) {\n\t                    partial[i] = str(i, value) || 'null';\n\t                }\n\n\t// Join all of the elements together, separated with commas, and wrap them in\n\t// brackets.\n\n\t                v = partial.length === 0\n\t                    ? '[]'\n\t                    : gap\n\t                    ? '[\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + ']'\n\t                    : '[' + partial.join(',') + ']';\n\t                gap = mind;\n\t                return v;\n\t            }\n\n\t// If the replacer is an array, use it to select the members to be stringified.\n\n\t            if (rep && typeof rep === 'object') {\n\t                length = rep.length;\n\t                for (i = 0; i < length; i += 1) {\n\t                    if (typeof rep[i] === 'string') {\n\t                        k = rep[i];\n\t                        v = str(k, value);\n\t                        if (v) {\n\t                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n\t                        }\n\t                    }\n\t                }\n\t            } else {\n\n\t// Otherwise, iterate through all of the keys in the object.\n\n\t                for (k in value) {\n\t                    if (Object.prototype.hasOwnProperty.call(value, k)) {\n\t                        v = str(k, value);\n\t                        if (v) {\n\t                            partial.push(quote(k) + (gap ? ': ' : ':') + v);\n\t                        }\n\t                    }\n\t                }\n\t            }\n\n\t// Join all of the member texts together, separated with commas,\n\t// and wrap them in braces.\n\n\t            v = partial.length === 0\n\t                ? '{}'\n\t                : gap\n\t                ? '{\\n' + gap + partial.join(',\\n' + gap) + '\\n' + mind + '}'\n\t                : '{' + partial.join(',') + '}';\n\t            gap = mind;\n\t            return v;\n\t        }\n\t    }\n\n\t// If the JSON object does not yet have a stringify method, give it one.\n\n\t    if (typeof JSON.stringify !== 'function') {\n\t        JSON.stringify = function (value, replacer, space) {\n\n\t// The stringify method takes a value and an optional replacer, and an optional\n\t// space parameter, and returns a JSON text. The replacer can be a function\n\t// that can replace values, or an array of strings that will select the keys.\n\t// A default replacer method can be provided. Use of the space parameter can\n\t// produce text that is more easily readable.\n\n\t            var i;\n\t            gap = '';\n\t            indent = '';\n\n\t// If the space parameter is a number, make an indent string containing that\n\t// many spaces.\n\n\t            if (typeof space === 'number') {\n\t                for (i = 0; i < space; i += 1) {\n\t                    indent += ' ';\n\t                }\n\n\t// If the space parameter is a string, it will be used as the indent string.\n\n\t            } else if (typeof space === 'string') {\n\t                indent = space;\n\t            }\n\n\t// If there is a replacer, it must be a function or an array.\n\t// Otherwise, throw an error.\n\n\t            rep = replacer;\n\t            if (replacer && typeof replacer !== 'function' &&\n\t                    (typeof replacer !== 'object' ||\n\t                    typeof replacer.length !== 'number')) {\n\t                throw new Error('JSON.stringify');\n\t            }\n\n\t// Make a fake root object containing our value under the key of ''.\n\t// Return the result of stringifying the value.\n\n\t            return str('', {'': value});\n\t        };\n\t    }\n\n\n\t// If the JSON object does not yet have a parse method, give it one.\n\n\t    if (typeof JSON.parse !== 'function') {\n\t        JSON.parse = function (text, reviver) {\n\n\t// The parse method takes a text and an optional reviver function, and returns\n\t// a JavaScript value if the text is a valid JSON text.\n\n\t            var j;\n\n\t            function walk(holder, key) {\n\n\t// The walk method is used to recursively walk the resulting structure so\n\t// that modifications can be made.\n\n\t                var k, v, value = holder[key];\n\t                if (value && typeof value === 'object') {\n\t                    for (k in value) {\n\t                        if (Object.prototype.hasOwnProperty.call(value, k)) {\n\t                            v = walk(value, k);\n\t                            if (v !== undefined) {\n\t                                value[k] = v;\n\t                            } else {\n\t                                delete value[k];\n\t                            }\n\t                        }\n\t                    }\n\t                }\n\t                return reviver.call(holder, key, value);\n\t            }\n\n\n\t// Parsing happens in four stages. In the first stage, we replace certain\n\t// Unicode characters with escape sequences. JavaScript handles many characters\n\t// incorrectly, either silently deleting them, or treating them as line endings.\n\n\t            text = String(text);\n\t            cx.lastIndex = 0;\n\t            if (cx.test(text)) {\n\t                text = text.replace(cx, function (a) {\n\t                    return '\\\\u' +\n\t                        ('0000' + a.charCodeAt(0).toString(16)).slice(-4);\n\t                });\n\t            }\n\n\t// In the second stage, we run the text against regular expressions that look\n\t// for non-JSON patterns. We are especially concerned with '()' and 'new'\n\t// because they can cause invocation, and '=' because it can cause mutation.\n\t// But just to be safe, we want to reject all unexpected forms.\n\n\t// We split the second stage into 4 regexp operations in order to work around\n\t// crippling inefficiencies in IE's and Safari's regexp engines. First we\n\t// replace the JSON backslash pairs with '@' (a non-JSON character). Second, we\n\t// replace all simple value tokens with ']' characters. Third, we delete all\n\t// open brackets that follow a colon or comma or that begin the text. Finally,\n\t// we look to see that the remaining characters are only whitespace or ']' or\n\t// ',' or ':' or '{' or '}'. If that is so, then the text is safe for eval.\n\n\t            if (/^[\\],:{}\\s]*$/\n\t                    .test(text.replace(/\\\\(?:[\"\\\\\\/bfnrt]|u[0-9a-fA-F]{4})/g, '@')\n\t                        .replace(/\"[^\"\\\\\\n\\r]*\"|true|false|null|-?\\d+(?:\\.\\d*)?(?:[eE][+\\-]?\\d+)?/g, ']')\n\t                        .replace(/(?:^|:|,)(?:\\s*\\[)+/g, ''))) {\n\n\t// In the third stage we use the eval function to compile the text into a\n\t// JavaScript structure. The '{' operator is subject to a syntactic ambiguity\n\t// in JavaScript: it can begin a block or an object literal. We wrap the text\n\t// in parens to eliminate the ambiguity.\n\n\t                j = eval('(' + text + ')');\n\n\t// In the optional fourth stage, we recursively walk the new structure, passing\n\t// each name/value pair to a reviver function for possible transformation.\n\n\t                return typeof reviver === 'function'\n\t                    ? walk({'': j}, '')\n\t                    : j;\n\t            }\n\n\t// If the text is not JSON parseable, then a SyntaxError is thrown.\n\n\t            throw new SyntaxError('JSON.parse');\n\t        };\n\t    }\n\t}());\n\n\t/**\n\t * History.js jQuery Adapter\n\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n\t * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n\t */\n\n\tvar History = {};\n\n\t// Closure\n\t(function(window,undefined){\n\n\t\t// Localise Globals\n\t\tvar jQuery = window.jQuery;\n\n\t\t// Check Existence\n\t\tif ( typeof History.Adapter !== 'undefined' ) {\n\t\t\tthrow new Error('History.js Adapter has already been loaded...');\n\t\t}\n\n\t\t// Add the Adapter\n\t\tHistory.Adapter = {\n\t\t\t/**\n\t\t\t * History.Adapter.bind(el,event,callback)\n\t\t\t * @param {Element|string} el\n\t\t\t * @param {string} event - custom and standard events\n\t\t\t * @param {function} callback\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\tbind: function(el,event,callback){\n\t\t\t\tjQuery(el).bind(event,callback);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * History.Adapter.trigger(el,event)\n\t\t\t * @param {Element|string} el\n\t\t\t * @param {string} event - custom and standard events\n\t\t\t * @param {Object=} extra - a object of extra event data (optional)\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\ttrigger: function(el,event,extra){\n\t\t\t\tjQuery(el).trigger(event,extra);\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * History.Adapter.extractEventData(key,event,extra)\n\t\t\t * @param {string} key - key for the event data to extract\n\t\t\t * @param {string} event - custom and standard events\n\t\t\t * @param {Object=} extra - a object of extra event data (optional)\n\t\t\t * @return {mixed}\n\t\t\t */\n\t\t\textractEventData: function(key,event,extra){\n\t\t\t\t// jQuery Native then jQuery Custom\n\t\t\t\tvar result = (event && event.originalEvent && event.originalEvent[key]) || (extra && extra[key]) || undefined;\n\n\t\t\t\t// Return\n\t\t\t\treturn result;\n\t\t\t},\n\n\t\t\t/**\n\t\t\t * History.Adapter.onDomLoad(callback)\n\t\t\t * @param {function} callback\n\t\t\t * @return {void}\n\t\t\t */\n\t\t\tonDomLoad: function(callback) {\n\t\t\t\tjQuery(callback);\n\t\t\t}\n\t\t};\n\n\t\t// Try and Initialise History\n\t\tif ( typeof History.init !== 'undefined' ) {\n\t\t\tHistory.init();\n\t\t}\n\n\t})(window);\n\n\t/**\n\t * History.js HTML4 Support\n\t * Depends on the HTML5 Support\n\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n\t * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n\t */\n\n\t(function(window,undefined){\n\n\t\t// ========================================================================\n\t\t// Initialise\n\n\t\t// Localise Globals\n\t\tvar\n\t\t\tdocument = window.document, // Make sure we are using the correct document\n\t\t\tsetTimeout = window.setTimeout||setTimeout,\n\t\t\tclearTimeout = window.clearTimeout||clearTimeout,\n\t\t\tsetInterval = window.setInterval||setInterval;\n\n\t\t// Check Existence\n\t\tif ( typeof History.initHtml4 !== 'undefined' ) {\n\t\t\tthrow new Error('History.js HTML4 Support has already been loaded...');\n\t\t}\n\n\n\t\t// ========================================================================\n\t\t// Initialise HTML4 Support\n\n\t\t// Initialise HTML4 Support\n\t\tHistory.initHtml4 = function(){\n\t\t\t// Initialise\n\t\t\tif ( typeof History.initHtml4.initialized !== 'undefined' ) {\n\t\t\t\t// Already Loaded\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tHistory.initHtml4.initialized = true;\n\t\t\t}\n\n\n\t\t\t// ====================================================================\n\t\t\t// Properties\n\n\t\t\t/**\n\t\t\t * History.enabled\n\t\t\t * Is History enabled?\n\t\t\t */\n\t\t\tHistory.enabled = true;\n\n\n\t\t\t// ====================================================================\n\t\t\t// Hash Storage\n\n\t\t\t/**\n\t\t\t * History.savedHashes\n\t\t\t * Store the hashes in an array\n\t\t\t */\n\t\t\tHistory.savedHashes = [];\n\n\t\t\t/**\n\t\t\t * History.isLastHash(newHash)\n\t\t\t * Checks if the hash is the last hash\n\t\t\t * @param {string} newHash\n\t\t\t * @return {boolean} true\n\t\t\t */\n\t\t\tHistory.isLastHash = function(newHash){\n\t\t\t\t// Prepare\n\t\t\t\tvar oldHash = History.getHashByIndex(),\n\t\t\t\t\tisLast;\n\n\t\t\t\t// Check\n\t\t\t\tisLast = newHash === oldHash;\n\n\t\t\t\t// Return isLast\n\t\t\t\treturn isLast;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.isHashEqual(newHash, oldHash)\n\t\t\t * Checks to see if two hashes are functionally equal\n\t\t\t * @param {string} newHash\n\t\t\t * @param {string} oldHash\n\t\t\t * @return {boolean} true\n\t\t\t */\n\t\t\tHistory.isHashEqual = function(newHash, oldHash){\n\t\t\t\tnewHash = encodeURIComponent(newHash).replace(/%25/g, \"%\");\n\t\t\t\toldHash = encodeURIComponent(oldHash).replace(/%25/g, \"%\");\n\t\t\t\treturn newHash === oldHash;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.saveHash(newHash)\n\t\t\t * Push a Hash\n\t\t\t * @param {string} newHash\n\t\t\t * @return {boolean} true\n\t\t\t */\n\t\t\tHistory.saveHash = function(newHash){\n\t\t\t\t// Check Hash\n\t\t\t\tif ( History.isLastHash(newHash) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Push the Hash\n\t\t\t\tHistory.savedHashes.push(newHash);\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getHashByIndex()\n\t\t\t * Gets a hash by the index\n\t\t\t * @param {integer} index\n\t\t\t * @return {string}\n\t\t\t */\n\t\t\tHistory.getHashByIndex = function(index){\n\t\t\t\t// Prepare\n\t\t\t\tvar hash = null;\n\n\t\t\t\t// Handle\n\t\t\t\tif ( typeof index === 'undefined' ) {\n\t\t\t\t\t// Get the last inserted\n\t\t\t\t\thash = History.savedHashes[History.savedHashes.length-1];\n\t\t\t\t}\n\t\t\t\telse if ( index < 0 ) {\n\t\t\t\t\t// Get from the end\n\t\t\t\t\thash = History.savedHashes[History.savedHashes.length+index];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Get from the beginning\n\t\t\t\t\thash = History.savedHashes[index];\n\t\t\t\t}\n\n\t\t\t\t// Return hash\n\t\t\t\treturn hash;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// Discarded States\n\n\t\t\t/**\n\t\t\t * History.discardedHashes\n\t\t\t * A hashed array of discarded hashes\n\t\t\t */\n\t\t\tHistory.discardedHashes = {};\n\n\t\t\t/**\n\t\t\t * History.discardedStates\n\t\t\t * A hashed array of discarded states\n\t\t\t */\n\t\t\tHistory.discardedStates = {};\n\n\t\t\t/**\n\t\t\t * History.discardState(State)\n\t\t\t * Discards the state by ignoring it through History\n\t\t\t * @param {object} State\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.discardState = function(discardedState,forwardState,backState){\n\t\t\t\t//History.debug('History.discardState', arguments);\n\t\t\t\t// Prepare\n\t\t\t\tvar discardedStateHash = History.getHashByState(discardedState),\n\t\t\t\t\tdiscardObject;\n\n\t\t\t\t// Create Discard Object\n\t\t\t\tdiscardObject = {\n\t\t\t\t\t'discardedState': discardedState,\n\t\t\t\t\t'backState': backState,\n\t\t\t\t\t'forwardState': forwardState\n\t\t\t\t};\n\n\t\t\t\t// Add to DiscardedStates\n\t\t\t\tHistory.discardedStates[discardedStateHash] = discardObject;\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.discardHash(hash)\n\t\t\t * Discards the hash by ignoring it through History\n\t\t\t * @param {string} hash\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.discardHash = function(discardedHash,forwardState,backState){\n\t\t\t\t//History.debug('History.discardState', arguments);\n\t\t\t\t// Create Discard Object\n\t\t\t\tvar discardObject = {\n\t\t\t\t\t'discardedHash': discardedHash,\n\t\t\t\t\t'backState': backState,\n\t\t\t\t\t'forwardState': forwardState\n\t\t\t\t};\n\n\t\t\t\t// Add to discardedHash\n\t\t\t\tHistory.discardedHashes[discardedHash] = discardObject;\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.discardedState(State)\n\t\t\t * Checks to see if the state is discarded\n\t\t\t * @param {object} State\n\t\t\t * @return {bool}\n\t\t\t */\n\t\t\tHistory.discardedState = function(State){\n\t\t\t\t// Prepare\n\t\t\t\tvar StateHash = History.getHashByState(State),\n\t\t\t\t\tdiscarded;\n\n\t\t\t\t// Check\n\t\t\t\tdiscarded = History.discardedStates[StateHash]||false;\n\n\t\t\t\t// Return true\n\t\t\t\treturn discarded;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.discardedHash(hash)\n\t\t\t * Checks to see if the state is discarded\n\t\t\t * @param {string} State\n\t\t\t * @return {bool}\n\t\t\t */\n\t\t\tHistory.discardedHash = function(hash){\n\t\t\t\t// Check\n\t\t\t\tvar discarded = History.discardedHashes[hash]||false;\n\n\t\t\t\t// Return true\n\t\t\t\treturn discarded;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.recycleState(State)\n\t\t\t * Allows a discarded state to be used again\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {true}\n\t\t\t */\n\t\t\tHistory.recycleState = function(State){\n\t\t\t\t//History.debug('History.recycleState', arguments);\n\t\t\t\t// Prepare\n\t\t\t\tvar StateHash = History.getHashByState(State);\n\n\t\t\t\t// Remove from DiscardedStates\n\t\t\t\tif ( History.discardedState(State) ) {\n\t\t\t\t\tdelete History.discardedStates[StateHash];\n\t\t\t\t}\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// HTML4 HashChange Support\n\n\t\t\tif ( History.emulated.hashChange ) {\n\t\t\t\t/*\n\t\t\t\t * We must emulate the HTML4 HashChange Support by manually checking for hash changes\n\t\t\t\t */\n\n\t\t\t\t/**\n\t\t\t\t * History.hashChangeInit()\n\t\t\t\t * Init the HashChange Emulation\n\t\t\t\t */\n\t\t\t\tHistory.hashChangeInit = function(){\n\t\t\t\t\t// Define our Checker Function\n\t\t\t\t\tHistory.checkerFunction = null;\n\n\t\t\t\t\t// Define some variables that will help in our checker function\n\t\t\t\t\tvar lastDocumentHash = '',\n\t\t\t\t\t\tiframeId, iframe,\n\t\t\t\t\t\tlastIframeHash, checkerRunning,\n\t\t\t\t\t\tstartedWithHash = Boolean(History.getHash());\n\n\t\t\t\t\t// Handle depending on the browser\n\t\t\t\t\tif ( History.isInternetExplorer() ) {\n\t\t\t\t\t\t// IE6 and IE7\n\t\t\t\t\t\t// We need to use an iframe to emulate the back and forward buttons\n\n\t\t\t\t\t\t// Create iFrame\n\t\t\t\t\t\tiframeId = 'historyjs-iframe';\n\t\t\t\t\t\tiframe = document.createElement('iframe');\n\n\t\t\t\t\t\t// Adjust iFarme\n\t\t\t\t\t\t// IE 6 requires iframe to have a src on HTTPS pages, otherwise it will throw a\n\t\t\t\t\t\t// \"This page contains both secure and nonsecure items\" warning.\n\t\t\t\t\t\tiframe.setAttribute('id', iframeId);\n\t\t\t\t\t\tiframe.setAttribute('src', '#');\n\t\t\t\t\t\tiframe.style.display = 'none';\n\n\t\t\t\t\t\t// Append iFrame\n\t\t\t\t\t\tdocument.body.appendChild(iframe);\n\n\t\t\t\t\t\t// Create initial history entry\n\t\t\t\t\t\tiframe.contentWindow.document.open();\n\t\t\t\t\t\tiframe.contentWindow.document.close();\n\n\t\t\t\t\t\t// Define some variables that will help in our checker function\n\t\t\t\t\t\tlastIframeHash = '';\n\t\t\t\t\t\tcheckerRunning = false;\n\n\t\t\t\t\t\t// Define the checker function\n\t\t\t\t\t\tHistory.checkerFunction = function(){\n\t\t\t\t\t\t\t// Check Running\n\t\t\t\t\t\t\tif ( checkerRunning ) {\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Update Running\n\t\t\t\t\t\t\tcheckerRunning = true;\n\n\t\t\t\t\t\t\t// Fetch\n\t\t\t\t\t\t\tvar\n\t\t\t\t\t\t\t\tdocumentHash = History.getHash(),\n\t\t\t\t\t\t\t\tiframeHash = History.getHash(iframe.contentWindow.document);\n\n\t\t\t\t\t\t\t// The Document Hash has changed (application caused)\n\t\t\t\t\t\t\tif ( documentHash !== lastDocumentHash ) {\n\t\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\t\tlastDocumentHash = documentHash;\n\n\t\t\t\t\t\t\t\t// Create a history entry in the iframe\n\t\t\t\t\t\t\t\tif ( iframeHash !== documentHash ) {\n\t\t\t\t\t\t\t\t\t//History.debug('hashchange.checker: iframe hash change', 'documentHash (new):', documentHash, 'iframeHash (old):', iframeHash);\n\n\t\t\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\t\t\tlastIframeHash = iframeHash = documentHash;\n\n\t\t\t\t\t\t\t\t\t// Create History Entry\n\t\t\t\t\t\t\t\t\tiframe.contentWindow.document.open();\n\t\t\t\t\t\t\t\t\tiframe.contentWindow.document.close();\n\n\t\t\t\t\t\t\t\t\t// Update the iframe's hash\n\t\t\t\t\t\t\t\t\tiframe.contentWindow.document.location.hash = History.escapeHash(documentHash);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Trigger Hashchange Event\n\t\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// The iFrame Hash has changed (back button caused)\n\t\t\t\t\t\t\telse if ( iframeHash !== lastIframeHash ) {\n\t\t\t\t\t\t\t\t//History.debug('hashchange.checker: iframe hash out of sync', 'iframeHash (new):', iframeHash, 'documentHash (old):', documentHash);\n\n\t\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\t\tlastIframeHash = iframeHash;\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t// If there is no iframe hash that means we're at the original\n\t\t\t\t\t\t\t\t// iframe state.\n\t\t\t\t\t\t\t\t// And if there was a hash on the original request, the original\n\t\t\t\t\t\t\t\t// iframe state was replaced instantly, so skip this state and take\n\t\t\t\t\t\t\t\t// the user back to where they came from.\n\t\t\t\t\t\t\t\tif (startedWithHash && iframeHash === '') {\n\t\t\t\t\t\t\t\t\tHistory.back();\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t// Update the Hash\n\t\t\t\t\t\t\t\t\tHistory.setHash(iframeHash,false);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Reset Running\n\t\t\t\t\t\t\tcheckerRunning = false;\n\n\t\t\t\t\t\t\t// Return true\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// We are not IE\n\t\t\t\t\t\t// Firefox 1 or 2, Opera\n\n\t\t\t\t\t\t// Define the checker function\n\t\t\t\t\t\tHistory.checkerFunction = function(){\n\t\t\t\t\t\t\t// Prepare\n\t\t\t\t\t\t\tvar documentHash = History.getHash()||'';\n\n\t\t\t\t\t\t\t// The Document Hash has changed (application caused)\n\t\t\t\t\t\t\tif ( documentHash !== lastDocumentHash ) {\n\t\t\t\t\t\t\t\t// Equalise\n\t\t\t\t\t\t\t\tlastDocumentHash = documentHash;\n\n\t\t\t\t\t\t\t\t// Trigger Hashchange Event\n\t\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Return true\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Apply the checker function\n\t\t\t\t\tHistory.intervalList.push(setInterval(History.checkerFunction, History.options.hashChangeInterval));\n\n\t\t\t\t\t// Done\n\t\t\t\t\treturn true;\n\t\t\t\t}; // History.hashChangeInit\n\n\t\t\t\t// Bind hashChangeInit\n\t\t\t\tHistory.Adapter.onDomLoad(History.hashChangeInit);\n\n\t\t\t} // History.emulated.hashChange\n\n\n\t\t\t// ====================================================================\n\t\t\t// HTML5 State Support\n\n\t\t\t// Non-Native pushState Implementation\n\t\t\tif ( History.emulated.pushState ) {\n\t\t\t\t/*\n\t\t\t\t * We must emulate the HTML5 State Management by using HTML4 HashChange\n\t\t\t\t */\n\n\t\t\t\t/**\n\t\t\t\t * History.onHashChange(event)\n\t\t\t\t * Trigger HTML5's window.onpopstate via HTML4 HashChange Support\n\t\t\t\t */\n\t\t\t\tHistory.onHashChange = function(event){\n\t\t\t\t\t//History.debug('History.onHashChange', arguments);\n\n\t\t\t\t\t// Prepare\n\t\t\t\t\tvar currentUrl = ((event && event.newURL) || History.getLocationHref()),\n\t\t\t\t\t\tcurrentHash = History.getHashByUrl(currentUrl),\n\t\t\t\t\t\tcurrentState = null,\n\t\t\t\t\t\tcurrentStateHash = null,\n\t\t\t\t\t\tdiscardObject;\n\n\t\t\t\t\t// Check if we are the same state\n\t\t\t\t\tif ( History.isLastHash(currentHash) ) {\n\t\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t\t//History.debug('History.onHashChange: no change');\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Reset the double check\n\t\t\t\t\tHistory.doubleCheckComplete();\n\n\t\t\t\t\t// Store our location for use in detecting back/forward direction\n\t\t\t\t\tHistory.saveHash(currentHash);\n\n\t\t\t\t\t// Expand Hash\n\t\t\t\t\tif ( currentHash && History.isTraditionalAnchor(currentHash) ) {\n\t\t\t\t\t\t//History.debug('History.onHashChange: traditional anchor', currentHash);\n\t\t\t\t\t\t// Traditional Anchor Hash\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'anchorchange');\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create State\n\t\t\t\t\tcurrentState = History.extractState(History.getFullUrl(currentHash||History.getLocationHref()),true);\n\n\t\t\t\t\t// Check if we are the same state\n\t\t\t\t\tif ( History.isLastSavedState(currentState) ) {\n\t\t\t\t\t\t//History.debug('History.onHashChange: no change');\n\t\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create the state Hash\n\t\t\t\t\tcurrentStateHash = History.getHashByState(currentState);\n\n\t\t\t\t\t// Check if we are DiscardedState\n\t\t\t\t\tdiscardObject = History.discardedState(currentState);\n\t\t\t\t\tif ( discardObject ) {\n\t\t\t\t\t\t// Ignore this state as it has been discarded and go back to the state before it\n\t\t\t\t\t\tif ( History.getHashByIndex(-2) === History.getHashByState(discardObject.forwardState) ) {\n\t\t\t\t\t\t\t// We are going backwards\n\t\t\t\t\t\t\t//History.debug('History.onHashChange: go backwards');\n\t\t\t\t\t\t\tHistory.back(false);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// We are going forwards\n\t\t\t\t\t\t\t//History.debug('History.onHashChange: go forwards');\n\t\t\t\t\t\t\tHistory.forward(false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Push the new HTML5 State\n\t\t\t\t\t//History.debug('History.onHashChange: success hashchange');\n\t\t\t\t\tHistory.pushState(currentState.data,currentState.title,encodeURI(currentState.url),false);\n\n\t\t\t\t\t// End onHashChange closure\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\t\t\t\tHistory.Adapter.bind(window,'hashchange',History.onHashChange);\n\n\t\t\t\t/**\n\t\t\t\t * History.pushState(data,title,url)\n\t\t\t\t * Add a new State to the history object, become it, and trigger onpopstate\n\t\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t\t * @param {object} data\n\t\t\t\t * @param {string} title\n\t\t\t\t * @param {string} url\n\t\t\t\t * @return {true}\n\t\t\t\t */\n\t\t\t\tHistory.pushState = function(data,title,url,queue){\n\t\t\t\t\t//History.debug('History.pushState: called', arguments);\n\n\t\t\t\t\t// We assume that the URL passed in is URI-encoded, but this makes\n\t\t\t\t\t// sure that it's fully URI encoded; any '%'s that are encoded are\n\t\t\t\t\t// converted back into '%'s\n\t\t\t\t\turl = encodeURI(url).replace(/%25/g, \"%\");\n\n\t\t\t\t\t// Check the State\n\t\t\t\t\tif ( History.getHashByUrl(url) ) {\n\t\t\t\t\t\tthrow new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle Queueing\n\t\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t\t//History.debug('History.pushState: we must wait', arguments);\n\t\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\t\tcallback: History.pushState,\n\t\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make Busy\n\t\t\t\t\tHistory.busy(true);\n\n\t\t\t\t\t// Fetch the State Object\n\t\t\t\t\tvar newState = History.createStateObject(data,title,url),\n\t\t\t\t\t\tnewStateHash = History.getHashByState(newState),\n\t\t\t\t\t\toldState = History.getState(false),\n\t\t\t\t\t\toldStateHash = History.getHashByState(oldState),\n\t\t\t\t\t\thtml4Hash = History.getHash(),\n\t\t\t\t\t\twasExpected = History.expectedStateId == newState.id;\n\n\t\t\t\t\t// Store the newState\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t// Recycle the State\n\t\t\t\t\tHistory.recycleState(newState);\n\n\t\t\t\t\t// Force update of the title\n\t\t\t\t\tHistory.setTitle(newState);\n\n\t\t\t\t\t// Check if we are the same State\n\t\t\t\t\tif ( newStateHash === oldStateHash ) {\n\t\t\t\t\t\t//History.debug('History.pushState: no change', newStateHash);\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update HTML5 State\n\t\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\tif(!wasExpected)\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\n\t\t\t\t\t// Update HTML4 Hash\n\t\t\t\t\tif ( !History.isHashEqual(newStateHash, html4Hash) && !History.isHashEqual(newStateHash, History.getShortUrl(History.getLocationHref())) ) {\n\t\t\t\t\t\tHistory.setHash(newStateHash,false);\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tHistory.busy(false);\n\n\t\t\t\t\t// End pushState closure\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\t/**\n\t\t\t\t * History.replaceState(data,title,url)\n\t\t\t\t * Replace the State and trigger onpopstate\n\t\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t\t * @param {object} data\n\t\t\t\t * @param {string} title\n\t\t\t\t * @param {string} url\n\t\t\t\t * @return {true}\n\t\t\t\t */\n\t\t\t\tHistory.replaceState = function(data,title,url,queue){\n\t\t\t\t\t//History.debug('History.replaceState: called', arguments);\n\n\t\t\t\t\t// We assume that the URL passed in is URI-encoded, but this makes\n\t\t\t\t\t// sure that it's fully URI encoded; any '%'s that are encoded are\n\t\t\t\t\t// converted back into '%'s\n\t\t\t\t\turl = encodeURI(url).replace(/%25/g, \"%\");\n\n\t\t\t\t\t// Check the State\n\t\t\t\t\tif ( History.getHashByUrl(url) ) {\n\t\t\t\t\t\tthrow new Error('History.js does not support states with fragment-identifiers (hashes/anchors).');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle Queueing\n\t\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t\t//History.debug('History.replaceState: we must wait', arguments);\n\t\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\t\tcallback: History.replaceState,\n\t\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make Busy\n\t\t\t\t\tHistory.busy(true);\n\n\t\t\t\t\t// Fetch the State Objects\n\t\t\t\t\tvar newState        = History.createStateObject(data,title,url),\n\t\t\t\t\t\tnewStateHash = History.getHashByState(newState),\n\t\t\t\t\t\toldState        = History.getState(false),\n\t\t\t\t\t\toldStateHash = History.getHashByState(oldState),\n\t\t\t\t\t\tpreviousState   = History.getStateByIndex(-2);\n\n\t\t\t\t\t// Discard Old State\n\t\t\t\t\tHistory.discardState(oldState,newState,previousState);\n\n\t\t\t\t\t// If the url hasn't changed, just store and save the state\n\t\t\t\t\t// and fire a statechange event to be consistent with the\n\t\t\t\t\t// html 5 api\n\t\t\t\t\tif ( newStateHash === oldStateHash ) {\n\t\t\t\t\t\t// Store the newState\n\t\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\t\tHistory.expectedStateId = newState.id;\n\t\t\n\t\t\t\t\t\t// Recycle the State\n\t\t\t\t\t\tHistory.recycleState(newState);\n\t\t\n\t\t\t\t\t\t// Force update of the title\n\t\t\t\t\t\tHistory.setTitle(newState);\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Update HTML5 State\n\t\t\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\t\t//History.debug('History.pushState: trigger popstate');\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Alias to PushState\n\t\t\t\t\t\tHistory.pushState(newState.data,newState.title,newState.url,false);\n\t\t\t\t\t}\n\n\t\t\t\t\t// End replaceState closure\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t} // History.emulated.pushState\n\n\n\n\t\t\t// ====================================================================\n\t\t\t// Initialise\n\n\t\t\t// Non-Native pushState Implementation\n\t\t\tif ( History.emulated.pushState ) {\n\t\t\t\t/**\n\t\t\t\t * Ensure initial state is handled correctly\n\t\t\t\t */\n\t\t\t\tif ( History.getHash() && !History.emulated.hashChange ) {\n\t\t\t\t\tHistory.Adapter.onDomLoad(function(){\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t} // History.emulated.pushState\n\n\t\t}; // History.initHtml4\n\n\t\t// Try to Initialise History\n\t\tif ( typeof History.init !== 'undefined' ) {\n\t\t\tHistory.init();\n\t\t}\n\n\t})(window);\n\t/**\n\t * History.js Core\n\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t * @copyright 2010-2011 Benjamin Arthur Lupton <contact@balupton.com>\n\t * @license New BSD License <http://creativecommons.org/licenses/BSD/>\n\t */\n\n\t(function(window,undefined){\n\n\t\t// ========================================================================\n\t\t// Initialise\n\n\t\t// Localise Globals\n\t\tvar\n\t\t\tconsole = window.console||undefined, // Prevent a JSLint complain\n\t\t\tdocument = window.document, // Make sure we are using the correct document\n\t\t\tnavigator = window.navigator, // Make sure we are using the correct navigator\n\t\t\tsessionStorage = false, // sessionStorage\n\t\t\tsetTimeout = window.setTimeout,\n\t\t\tclearTimeout = window.clearTimeout,\n\t\t\tsetInterval = window.setInterval,\n\t\t\tclearInterval = window.clearInterval,\n\t\t\tJSON = window.JSON,\n\t\t\talert = window.alert,\n\t\t\thistory = window.history; // Old History Object\n\n\t\ttry {\n\t\t\tsessionStorage = window.sessionStorage; // This will throw an exception in some browsers when cookies/localStorage are explicitly disabled (i.e. Chrome)\n\t\t\tsessionStorage.setItem('TEST', '1');\n\t\t\tsessionStorage.removeItem('TEST');\n\t\t} catch(e) {\n\t\t\tsessionStorage = false;\n\t\t}\n\n\t\t// MooTools Compatibility\n\t\tJSON.stringify = JSON.stringify||JSON.encode;\n\t\tJSON.parse = JSON.parse||JSON.decode;\n\n\t\t// Check Existence\n\t\tif ( typeof History.init !== 'undefined' ) {\n\t\t\tthrow new Error('History.js Core has already been loaded...');\n\t\t}\n\n\t\t// Initialise History\n\t\tHistory.init = function(options){\n\t\t\t// Check Load Status of Adapter\n\t\t\tif ( typeof History.Adapter === 'undefined' ) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Check Load Status of Core\n\t\t\tif ( typeof History.initCore !== 'undefined' ) {\n\t\t\t\tHistory.initCore();\n\t\t\t}\n\n\t\t\t// Check Load Status of HTML4 Support\n\t\t\tif ( typeof History.initHtml4 !== 'undefined' ) {\n\t\t\t\tHistory.initHtml4();\n\t\t\t}\n\n\t\t\t// Return true\n\t\t\treturn true;\n\t\t};\n\n\n\t\t// ========================================================================\n\t\t// Initialise Core\n\n\t\t// Initialise Core\n\t\tHistory.initCore = function(options){\n\t\t\t// Initialise\n\t\t\tif ( typeof History.initCore.initialized !== 'undefined' ) {\n\t\t\t\t// Already Loaded\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tHistory.initCore.initialized = true;\n\t\t\t}\n\n\n\t\t\t// ====================================================================\n\t\t\t// Options\n\n\t\t\t/**\n\t\t\t * History.options\n\t\t\t * Configurable options\n\t\t\t */\n\t\t\tHistory.options = History.options||{};\n\n\t\t\t/**\n\t\t\t * History.options.hashChangeInterval\n\t\t\t * How long should the interval be before hashchange checks\n\t\t\t */\n\t\t\tHistory.options.hashChangeInterval = History.options.hashChangeInterval || 100;\n\n\t\t\t/**\n\t\t\t * History.options.safariPollInterval\n\t\t\t * How long should the interval be before safari poll checks\n\t\t\t */\n\t\t\tHistory.options.safariPollInterval = History.options.safariPollInterval || 500;\n\n\t\t\t/**\n\t\t\t * History.options.doubleCheckInterval\n\t\t\t * How long should the interval be before we perform a double check\n\t\t\t */\n\t\t\tHistory.options.doubleCheckInterval = History.options.doubleCheckInterval || 500;\n\n\t\t\t/**\n\t\t\t * History.options.disableSuid\n\t\t\t * Force History not to append suid\n\t\t\t */\n\t\t\tHistory.options.disableSuid = History.options.disableSuid || false;\n\n\t\t\t/**\n\t\t\t * History.options.storeInterval\n\t\t\t * How long should we wait between store calls\n\t\t\t */\n\t\t\tHistory.options.storeInterval = History.options.storeInterval || 1000;\n\n\t\t\t/**\n\t\t\t * History.options.busyDelay\n\t\t\t * How long should we wait between busy events\n\t\t\t */\n\t\t\tHistory.options.busyDelay = History.options.busyDelay || 250;\n\n\t\t\t/**\n\t\t\t * History.options.debug\n\t\t\t * If true will enable debug messages to be logged\n\t\t\t */\n\t\t\tHistory.options.debug = History.options.debug || false;\n\n\t\t\t/**\n\t\t\t * History.options.initialTitle\n\t\t\t * What is the title of the initial state\n\t\t\t */\n\t\t\tHistory.options.initialTitle = History.options.initialTitle || document.title;\n\n\t\t\t/**\n\t\t\t * History.options.html4Mode\n\t\t\t * If true, will force HTMl4 mode (hashtags)\n\t\t\t */\n\t\t\tHistory.options.html4Mode = History.options.html4Mode || false;\n\n\t\t\t/**\n\t\t\t * History.options.delayInit\n\t\t\t * Want to override default options and call init manually.\n\t\t\t */\n\t\t\tHistory.options.delayInit = History.options.delayInit || false;\n\n\n\t\t\t// ====================================================================\n\t\t\t// Interval record\n\n\t\t\t/**\n\t\t\t * History.intervalList\n\t\t\t * List of intervals set, to be cleared when document is unloaded.\n\t\t\t */\n\t\t\tHistory.intervalList = [];\n\n\t\t\t/**\n\t\t\t * History.clearAllIntervals\n\t\t\t * Clears all setInterval instances.\n\t\t\t */\n\t\t\tHistory.clearAllIntervals = function(){\n\t\t\t\tvar i, il = History.intervalList;\n\t\t\t\tif (typeof il !== \"undefined\" && il !== null) {\n\t\t\t\t\tfor (i = 0; i < il.length; i++) {\n\t\t\t\t\t\tclearInterval(il[i]);\n\t\t\t\t\t}\n\t\t\t\t\tHistory.intervalList = null;\n\t\t\t\t}\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// Debug\n\n\t\t\t/**\n\t\t\t * History.debug(message,...)\n\t\t\t * Logs the passed arguments if debug enabled\n\t\t\t */\n\t\t\tHistory.debug = function(){\n\t\t\t\tif ( (History.options.debug||false) ) {\n\t\t\t\t\tHistory.log.apply(History,arguments);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.log(message,...)\n\t\t\t * Logs the passed arguments\n\t\t\t */\n\t\t\tHistory.log = function(){\n\t\t\t\t// Prepare\n\t\t\t\tvar\n\t\t\t\t\tconsoleExists = !(typeof console === 'undefined' || typeof console.log === 'undefined' || typeof console.log.apply === 'undefined'),\n\t\t\t\t\ttextarea = document.getElementById('log'),\n\t\t\t\t\tmessage,\n\t\t\t\t\ti,n,\n\t\t\t\t\targs,arg\n\t\t\t\t\t;\n\n\t\t\t\t// Write to Console\n\t\t\t\tif ( consoleExists ) {\n\t\t\t\t\targs = Array.prototype.slice.call(arguments);\n\t\t\t\t\tmessage = args.shift();\n\t\t\t\t\tif ( typeof console.debug !== 'undefined' ) {\n\t\t\t\t\t\tconsole.debug.apply(console,[message,args]);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tconsole.log.apply(console,[message,args]);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tmessage = (\"\\n\"+arguments[0]+\"\\n\");\n\t\t\t\t}\n\n\t\t\t\t// Write to log\n\t\t\t\tfor ( i=1,n=arguments.length; i<n; ++i ) {\n\t\t\t\t\targ = arguments[i];\n\t\t\t\t\tif ( typeof arg === 'object' && typeof JSON !== 'undefined' ) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\targ = JSON.stringify(arg);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch ( Exception ) {\n\t\t\t\t\t\t\t// Recursive Object\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tmessage += \"\\n\"+arg+\"\\n\";\n\t\t\t\t}\n\n\t\t\t\t// Textarea\n\t\t\t\tif ( textarea ) {\n\t\t\t\t\ttextarea.value += message+\"\\n-----\\n\";\n\t\t\t\t\ttextarea.scrollTop = textarea.scrollHeight - textarea.clientHeight;\n\t\t\t\t}\n\t\t\t\t// No Textarea, No Console\n\t\t\t\telse if ( !consoleExists ) {\n\t\t\t\t\talert(message);\n\t\t\t\t}\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// Emulated Status\n\n\t\t\t/**\n\t\t\t * History.getInternetExplorerMajorVersion()\n\t\t\t * Get's the major version of Internet Explorer\n\t\t\t * @return {integer}\n\t\t\t * @license Public Domain\n\t\t\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t\t\t * @author James Padolsey <https://gist.github.com/527683>\n\t\t\t */\n\t\t\tHistory.getInternetExplorerMajorVersion = function(){\n\t\t\t\tvar result = History.getInternetExplorerMajorVersion.cached =\n\t\t\t\t\t\t(typeof History.getInternetExplorerMajorVersion.cached !== 'undefined')\n\t\t\t\t\t?\tHistory.getInternetExplorerMajorVersion.cached\n\t\t\t\t\t:\t(function(){\n\t\t\t\t\t\t\tvar v = 3,\n\t\t\t\t\t\t\t\t\tdiv = document.createElement('div'),\n\t\t\t\t\t\t\t\t\tall = div.getElementsByTagName('i');\n\t\t\t\t\t\t\twhile ( (div.innerHTML = '<!--[if gt IE ' + (++v) + ']><i></i><![endif]-->') && all[0] ) {}\n\t\t\t\t\t\t\treturn (v > 4) ? v : false;\n\t\t\t\t\t\t})()\n\t\t\t\t\t;\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.isInternetExplorer()\n\t\t\t * Are we using Internet Explorer?\n\t\t\t * @return {boolean}\n\t\t\t * @license Public Domain\n\t\t\t * @author Benjamin Arthur Lupton <contact@balupton.com>\n\t\t\t */\n\t\t\tHistory.isInternetExplorer = function(){\n\t\t\t\tvar result =\n\t\t\t\t\tHistory.isInternetExplorer.cached =\n\t\t\t\t\t(typeof History.isInternetExplorer.cached !== 'undefined')\n\t\t\t\t\t\t?\tHistory.isInternetExplorer.cached\n\t\t\t\t\t\t:\tBoolean(History.getInternetExplorerMajorVersion())\n\t\t\t\t\t;\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.emulated\n\t\t\t * Which features require emulating?\n\t\t\t */\n\n\t\t\tif (History.options.html4Mode) {\n\t\t\t\tHistory.emulated = {\n\t\t\t\t\tpushState : true,\n\t\t\t\t\thashChange: true\n\t\t\t\t};\n\t\t\t}\n\n\t\t\telse {\n\n\t\t\t\tHistory.emulated = {\n\t\t\t\t\tpushState: !Boolean(\n\t\t\t\t\t\twindow.history && window.history.pushState && window.history.replaceState\n\t\t\t\t\t\t&& !(\n\t\t\t\t\t\t\t(/ Mobile\\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i).test(navigator.userAgent) /* disable for versions of iOS before version 4.3 (8F190) */\n\t\t\t\t\t\t\t|| (/AppleWebKit\\/5([0-2]|3[0-2])/i).test(navigator.userAgent) /* disable for the mercury iOS browser, or at least older versions of the webkit engine */\n\t\t\t\t\t\t)\n\t\t\t\t\t),\n\t\t\t\t\thashChange: Boolean(\n\t\t\t\t\t\t!(('onhashchange' in window) || ('onhashchange' in document))\n\t\t\t\t\t\t||\n\t\t\t\t\t\t(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8)\n\t\t\t\t\t)\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * History.enabled\n\t\t\t * Is History enabled?\n\t\t\t */\n\t\t\tHistory.enabled = !History.emulated.pushState;\n\n\t\t\t/**\n\t\t\t * History.bugs\n\t\t\t * Which bugs are present\n\t\t\t */\n\t\t\tHistory.bugs = {\n\t\t\t\t/**\n\t\t\t\t * Safari 5 and Safari iOS 4 fail to return to the correct state once a hash is replaced by a `replaceState` call\n\t\t\t\t * https://bugs.webkit.org/show_bug.cgi?id=56249\n\t\t\t\t */\n\t\t\t\tsetHash: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n\t\t\t\t/**\n\t\t\t\t * Safari 5 and Safari iOS 4 sometimes fail to apply the state change under busy conditions\n\t\t\t\t * https://bugs.webkit.org/show_bug.cgi?id=42940\n\t\t\t\t */\n\t\t\t\tsafariPoll: Boolean(!History.emulated.pushState && navigator.vendor === 'Apple Computer, Inc.' && /AppleWebKit\\/5([0-2]|3[0-3])/.test(navigator.userAgent)),\n\n\t\t\t\t/**\n\t\t\t\t * MSIE 6 and 7 sometimes do not apply a hash even it was told to (requiring a second call to the apply function)\n\t\t\t\t */\n\t\t\t\tieDoubleCheck: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 8),\n\n\t\t\t\t/**\n\t\t\t\t * MSIE 6 requires the entire hash to be encoded for the hashes to trigger the onHashChange event\n\t\t\t\t */\n\t\t\t\thashEscape: Boolean(History.isInternetExplorer() && History.getInternetExplorerMajorVersion() < 7)\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.isEmptyObject(obj)\n\t\t\t * Checks to see if the Object is Empty\n\t\t\t * @param {Object} obj\n\t\t\t * @return {boolean}\n\t\t\t */\n\t\t\tHistory.isEmptyObject = function(obj) {\n\t\t\t\tfor ( var name in obj ) {\n\t\t\t\t\tif ( obj.hasOwnProperty(name) ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.cloneObject(obj)\n\t\t\t * Clones a object and eliminate all references to the original contexts\n\t\t\t * @param {Object} obj\n\t\t\t * @return {Object}\n\t\t\t */\n\t\t\tHistory.cloneObject = function(obj) {\n\t\t\t\tvar hash,newObj;\n\t\t\t\tif ( obj ) {\n\t\t\t\t\thash = JSON.stringify(obj);\n\t\t\t\t\tnewObj = JSON.parse(hash);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tnewObj = {};\n\t\t\t\t}\n\t\t\t\treturn newObj;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// URL Helpers\n\n\t\t\t/**\n\t\t\t * History.getRootUrl()\n\t\t\t * Turns \"http://mysite.com/dir/page.html?asd\" into \"http://mysite.com\"\n\t\t\t * @return {String} rootUrl\n\t\t\t */\n\t\t\tHistory.getRootUrl = function(){\n\t\t\t\t// Create\n\t\t\t\tvar rootUrl = document.location.protocol+'//'+(document.location.hostname||document.location.host);\n\t\t\t\tif ( document.location.port||false ) {\n\t\t\t\t\trootUrl += ':'+document.location.port;\n\t\t\t\t}\n\t\t\t\trootUrl += '/';\n\n\t\t\t\t// Return\n\t\t\t\treturn rootUrl;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getBaseHref()\n\t\t\t * Fetches the `href` attribute of the `<base href=\"...\">` element if it exists\n\t\t\t * @return {String} baseHref\n\t\t\t */\n\t\t\tHistory.getBaseHref = function(){\n\t\t\t\t// Create\n\t\t\t\tvar\n\t\t\t\t\tbaseElements = document.getElementsByTagName('base'),\n\t\t\t\t\tbaseElement = null,\n\t\t\t\t\tbaseHref = '';\n\n\t\t\t\t// Test for Base Element\n\t\t\t\tif ( baseElements.length === 1 ) {\n\t\t\t\t\t// Prepare for Base Element\n\t\t\t\t\tbaseElement = baseElements[0];\n\t\t\t\t\tbaseHref = baseElement.href.replace(/[^\\/]+$/,'');\n\t\t\t\t}\n\n\t\t\t\t// Adjust trailing slash\n\t\t\t\tbaseHref = baseHref.replace(/\\/+$/,'');\n\t\t\t\tif ( baseHref ) baseHref += '/';\n\n\t\t\t\t// Return\n\t\t\t\treturn baseHref;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getBaseUrl()\n\t\t\t * Fetches the baseHref or basePageUrl or rootUrl (whichever one exists first)\n\t\t\t * @return {String} baseUrl\n\t\t\t */\n\t\t\tHistory.getBaseUrl = function(){\n\t\t\t\t// Create\n\t\t\t\tvar baseUrl = History.getBaseHref()||History.getBasePageUrl()||History.getRootUrl();\n\n\t\t\t\t// Return\n\t\t\t\treturn baseUrl;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getPageUrl()\n\t\t\t * Fetches the URL of the current page\n\t\t\t * @return {String} pageUrl\n\t\t\t */\n\t\t\tHistory.getPageUrl = function(){\n\t\t\t\t// Fetch\n\t\t\t\tvar\n\t\t\t\t\tState = History.getState(false,false),\n\t\t\t\t\tstateUrl = (State||{}).url||History.getLocationHref(),\n\t\t\t\t\tpageUrl;\n\n\t\t\t\t// Create\n\t\t\t\tpageUrl = stateUrl.replace(/\\/+$/,'').replace(/[^\\/]+$/,function(part,index,string){\n\t\t\t\t\treturn (/\\./).test(part) ? part : part+'/';\n\t\t\t\t});\n\n\t\t\t\t// Return\n\t\t\t\treturn pageUrl;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getBasePageUrl()\n\t\t\t * Fetches the Url of the directory of the current page\n\t\t\t * @return {String} basePageUrl\n\t\t\t */\n\t\t\tHistory.getBasePageUrl = function(){\n\t\t\t\t// Create\n\t\t\t\tvar basePageUrl = (History.getLocationHref()).replace(/[#\\?].*/,'').replace(/[^\\/]+$/,function(part,index,string){\n\t\t\t\t\treturn (/[^\\/]$/).test(part) ? '' : part;\n\t\t\t\t}).replace(/\\/+$/,'')+'/';\n\n\t\t\t\t// Return\n\t\t\t\treturn basePageUrl;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getFullUrl(url)\n\t\t\t * Ensures that we have an absolute URL and not a relative URL\n\t\t\t * @param {string} url\n\t\t\t * @param {Boolean} allowBaseHref\n\t\t\t * @return {string} fullUrl\n\t\t\t */\n\t\t\tHistory.getFullUrl = function(url,allowBaseHref){\n\t\t\t\t// Prepare\n\t\t\t\tvar fullUrl = url, firstChar = url.substring(0,1);\n\t\t\t\tallowBaseHref = (typeof allowBaseHref === 'undefined') ? true : allowBaseHref;\n\n\t\t\t\t// Check\n\t\t\t\tif ( /[a-z]+\\:\\/\\//.test(url) ) ;\n\t\t\t\telse if ( firstChar === '/' ) {\n\t\t\t\t\t// Root URL\n\t\t\t\t\tfullUrl = History.getRootUrl()+url.replace(/^\\/+/,'');\n\t\t\t\t}\n\t\t\t\telse if ( firstChar === '#' ) {\n\t\t\t\t\t// Anchor URL\n\t\t\t\t\tfullUrl = History.getPageUrl().replace(/#.*/,'')+url;\n\t\t\t\t}\n\t\t\t\telse if ( firstChar === '?' ) {\n\t\t\t\t\t// Query URL\n\t\t\t\t\tfullUrl = History.getPageUrl().replace(/[\\?#].*/,'')+url;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Relative URL\n\t\t\t\t\tif ( allowBaseHref ) {\n\t\t\t\t\t\tfullUrl = History.getBaseUrl()+url.replace(/^(\\.\\/)+/,'');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfullUrl = History.getBasePageUrl()+url.replace(/^(\\.\\/)+/,'');\n\t\t\t\t\t}\n\t\t\t\t\t// We have an if condition above as we do not want hashes\n\t\t\t\t\t// which are relative to the baseHref in our URLs\n\t\t\t\t\t// as if the baseHref changes, then all our bookmarks\n\t\t\t\t\t// would now point to different locations\n\t\t\t\t\t// whereas the basePageUrl will always stay the same\n\t\t\t\t}\n\n\t\t\t\t// Return\n\t\t\t\treturn fullUrl.replace(/\\#$/,'');\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getShortUrl(url)\n\t\t\t * Ensures that we have a relative URL and not a absolute URL\n\t\t\t * @param {string} url\n\t\t\t * @return {string} url\n\t\t\t */\n\t\t\tHistory.getShortUrl = function(url){\n\t\t\t\t// Prepare\n\t\t\t\tvar shortUrl = url, baseUrl = History.getBaseUrl(), rootUrl = History.getRootUrl();\n\n\t\t\t\t// Trim baseUrl\n\t\t\t\tif ( History.emulated.pushState ) {\n\t\t\t\t\t// We are in a if statement as when pushState is not emulated\n\t\t\t\t\t// The actual url these short urls are relative to can change\n\t\t\t\t\t// So within the same session, we the url may end up somewhere different\n\t\t\t\t\tshortUrl = shortUrl.replace(baseUrl,'');\n\t\t\t\t}\n\n\t\t\t\t// Trim rootUrl\n\t\t\t\tshortUrl = shortUrl.replace(rootUrl,'/');\n\n\t\t\t\t// Ensure we can still detect it as a state\n\t\t\t\tif ( History.isTraditionalAnchor(shortUrl) ) {\n\t\t\t\t\tshortUrl = './'+shortUrl;\n\t\t\t\t}\n\n\t\t\t\t// Clean It\n\t\t\t\tshortUrl = shortUrl.replace(/^(\\.\\/)+/g,'./').replace(/\\#$/,'');\n\n\t\t\t\t// Return\n\t\t\t\treturn shortUrl;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getLocationHref(document)\n\t\t\t * Returns a normalized version of document.location.href\n\t\t\t * accounting for browser inconsistencies, etc.\n\t\t\t *\n\t\t\t * This URL will be URI-encoded and will include the hash\n\t\t\t *\n\t\t\t * @param {object} document\n\t\t\t * @return {string} url\n\t\t\t */\n\t\t\tHistory.getLocationHref = function(doc) {\n\t\t\t\tdoc = doc || document;\n\n\t\t\t\t// most of the time, this will be true\n\t\t\t\tif (doc.URL === doc.location.href)\n\t\t\t\t\treturn doc.location.href;\n\n\t\t\t\t// some versions of webkit URI-decode document.location.href\n\t\t\t\t// but they leave document.URL in an encoded state\n\t\t\t\tif (doc.location.href === decodeURIComponent(doc.URL))\n\t\t\t\t\treturn doc.URL;\n\n\t\t\t\t// FF 3.6 only updates document.URL when a page is reloaded\n\t\t\t\t// document.location.href is updated correctly\n\t\t\t\tif (doc.location.hash && decodeURIComponent(doc.location.href.replace(/^[^#]+/, \"\")) === doc.location.hash)\n\t\t\t\t\treturn doc.location.href;\n\n\t\t\t\tif (doc.URL.indexOf('#') == -1 && doc.location.href.indexOf('#') != -1)\n\t\t\t\t\treturn doc.location.href;\n\t\t\t\t\n\t\t\t\treturn doc.URL || doc.location.href;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// State Storage\n\n\t\t\t/**\n\t\t\t * History.store\n\t\t\t * The store for all session specific data\n\t\t\t */\n\t\t\tHistory.store = {};\n\n\t\t\t/**\n\t\t\t * History.idToState\n\t\t\t * 1-1: State ID to State Object\n\t\t\t */\n\t\t\tHistory.idToState = History.idToState||{};\n\n\t\t\t/**\n\t\t\t * History.stateToId\n\t\t\t * 1-1: State String to State ID\n\t\t\t */\n\t\t\tHistory.stateToId = History.stateToId||{};\n\n\t\t\t/**\n\t\t\t * History.urlToId\n\t\t\t * 1-1: State URL to State ID\n\t\t\t */\n\t\t\tHistory.urlToId = History.urlToId||{};\n\n\t\t\t/**\n\t\t\t * History.storedStates\n\t\t\t * Store the states in an array\n\t\t\t */\n\t\t\tHistory.storedStates = History.storedStates||[];\n\n\t\t\t/**\n\t\t\t * History.savedStates\n\t\t\t * Saved the states in an array\n\t\t\t */\n\t\t\tHistory.savedStates = History.savedStates||[];\n\n\t\t\t/**\n\t\t\t * History.noramlizeStore()\n\t\t\t * Noramlize the store by adding necessary values\n\t\t\t */\n\t\t\tHistory.normalizeStore = function(){\n\t\t\t\tHistory.store.idToState = History.store.idToState||{};\n\t\t\t\tHistory.store.urlToId = History.store.urlToId||{};\n\t\t\t\tHistory.store.stateToId = History.store.stateToId||{};\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getState()\n\t\t\t * Get an object containing the data, title and url of the current state\n\t\t\t * @param {Boolean} friendly\n\t\t\t * @param {Boolean} create\n\t\t\t * @return {Object} State\n\t\t\t */\n\t\t\tHistory.getState = function(friendly,create){\n\t\t\t\t// Prepare\n\t\t\t\tif ( typeof friendly === 'undefined' ) { friendly = true; }\n\t\t\t\tif ( typeof create === 'undefined' ) { create = true; }\n\n\t\t\t\t// Fetch\n\t\t\t\tvar State = History.getLastSavedState();\n\n\t\t\t\t// Create\n\t\t\t\tif ( !State && create ) {\n\t\t\t\t\tState = History.createStateObject();\n\t\t\t\t}\n\n\t\t\t\t// Adjust\n\t\t\t\tif ( friendly ) {\n\t\t\t\t\tState = History.cloneObject(State);\n\t\t\t\t\tState.url = State.cleanUrl||State.url;\n\t\t\t\t}\n\n\t\t\t\t// Return\n\t\t\t\treturn State;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getIdByState(State)\n\t\t\t * Gets a ID for a State\n\t\t\t * @param {State} newState\n\t\t\t * @return {String} id\n\t\t\t */\n\t\t\tHistory.getIdByState = function(newState){\n\n\t\t\t\t// Fetch ID\n\t\t\t\tvar id = History.extractId(newState.url),\n\t\t\t\t\tstr;\n\n\t\t\t\tif ( !id ) {\n\t\t\t\t\t// Find ID via State String\n\t\t\t\t\tstr = History.getStateString(newState);\n\t\t\t\t\tif ( typeof History.stateToId[str] !== 'undefined' ) {\n\t\t\t\t\t\tid = History.stateToId[str];\n\t\t\t\t\t}\n\t\t\t\t\telse if ( typeof History.store.stateToId[str] !== 'undefined' ) {\n\t\t\t\t\t\tid = History.store.stateToId[str];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Generate a new ID\n\t\t\t\t\t\twhile ( true ) {\n\t\t\t\t\t\t\tid = (new Date()).getTime() + String(Math.random()).replace(/\\D/g,'');\n\t\t\t\t\t\t\tif ( typeof History.idToState[id] === 'undefined' && typeof History.store.idToState[id] === 'undefined' ) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Apply the new State to the ID\n\t\t\t\t\t\tHistory.stateToId[str] = id;\n\t\t\t\t\t\tHistory.idToState[id] = newState;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Return ID\n\t\t\t\treturn id;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.normalizeState(State)\n\t\t\t * Expands a State Object\n\t\t\t * @param {object} State\n\t\t\t * @return {object}\n\t\t\t */\n\t\t\tHistory.normalizeState = function(oldState){\n\t\t\t\t// Variables\n\t\t\t\tvar newState, dataNotEmpty;\n\n\t\t\t\t// Prepare\n\t\t\t\tif ( !oldState || (typeof oldState !== 'object') ) {\n\t\t\t\t\toldState = {};\n\t\t\t\t}\n\n\t\t\t\t// Check\n\t\t\t\tif ( typeof oldState.normalized !== 'undefined' ) {\n\t\t\t\t\treturn oldState;\n\t\t\t\t}\n\n\t\t\t\t// Adjust\n\t\t\t\tif ( !oldState.data || (typeof oldState.data !== 'object') ) {\n\t\t\t\t\toldState.data = {};\n\t\t\t\t}\n\n\t\t\t\t// ----------------------------------------------------------------\n\n\t\t\t\t// Create\n\t\t\t\tnewState = {};\n\t\t\t\tnewState.normalized = true;\n\t\t\t\tnewState.title = oldState.title||'';\n\t\t\t\tnewState.url = History.getFullUrl(oldState.url?oldState.url:(History.getLocationHref()));\n\t\t\t\tnewState.hash = History.getShortUrl(newState.url);\n\t\t\t\tnewState.data = History.cloneObject(oldState.data);\n\n\t\t\t\t// Fetch ID\n\t\t\t\tnewState.id = History.getIdByState(newState);\n\n\t\t\t\t// ----------------------------------------------------------------\n\n\t\t\t\t// Clean the URL\n\t\t\t\tnewState.cleanUrl = newState.url.replace(/\\??\\&_suid.*/,'');\n\t\t\t\tnewState.url = newState.cleanUrl;\n\n\t\t\t\t// Check to see if we have more than just a url\n\t\t\t\tdataNotEmpty = !History.isEmptyObject(newState.data);\n\n\t\t\t\t// Apply\n\t\t\t\tif ( (newState.title || dataNotEmpty) && History.options.disableSuid !== true ) {\n\t\t\t\t\t// Add ID to Hash\n\t\t\t\t\tnewState.hash = History.getShortUrl(newState.url).replace(/\\??\\&_suid.*/,'');\n\t\t\t\t\tif ( !/\\?/.test(newState.hash) ) {\n\t\t\t\t\t\tnewState.hash += '?';\n\t\t\t\t\t}\n\t\t\t\t\tnewState.hash += '&_suid='+newState.id;\n\t\t\t\t}\n\n\t\t\t\t// Create the Hashed URL\n\t\t\t\tnewState.hashedUrl = History.getFullUrl(newState.hash);\n\n\t\t\t\t// ----------------------------------------------------------------\n\n\t\t\t\t// Update the URL if we have a duplicate\n\t\t\t\tif ( (History.emulated.pushState || History.bugs.safariPoll) && History.hasUrlDuplicate(newState) ) {\n\t\t\t\t\tnewState.url = newState.hashedUrl;\n\t\t\t\t}\n\n\t\t\t\t// ----------------------------------------------------------------\n\n\t\t\t\t// Return\n\t\t\t\treturn newState;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.createStateObject(data,title,url)\n\t\t\t * Creates a object based on the data, title and url state params\n\t\t\t * @param {object} data\n\t\t\t * @param {string} title\n\t\t\t * @param {string} url\n\t\t\t * @return {object}\n\t\t\t */\n\t\t\tHistory.createStateObject = function(data,title,url){\n\t\t\t\t// Hashify\n\t\t\t\tvar State = {\n\t\t\t\t\t'data': data,\n\t\t\t\t\t'title': title,\n\t\t\t\t\t'url': url\n\t\t\t\t};\n\n\t\t\t\t// Expand the State\n\t\t\t\tState = History.normalizeState(State);\n\n\t\t\t\t// Return object\n\t\t\t\treturn State;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getStateById(id)\n\t\t\t * Get a state by it's UID\n\t\t\t * @param {String} id\n\t\t\t */\n\t\t\tHistory.getStateById = function(id){\n\t\t\t\t// Prepare\n\t\t\t\tid = String(id);\n\n\t\t\t\t// Retrieve\n\t\t\t\tvar State = History.idToState[id] || History.store.idToState[id] || undefined;\n\n\t\t\t\t// Return State\n\t\t\t\treturn State;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Get a State's String\n\t\t\t * @param {State} passedState\n\t\t\t */\n\t\t\tHistory.getStateString = function(passedState){\n\t\t\t\t// Prepare\n\t\t\t\tvar State, cleanedState, str;\n\n\t\t\t\t// Fetch\n\t\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t\t// Clean\n\t\t\t\tcleanedState = {\n\t\t\t\t\tdata: State.data,\n\t\t\t\t\ttitle: passedState.title,\n\t\t\t\t\turl: passedState.url\n\t\t\t\t};\n\n\t\t\t\t// Fetch\n\t\t\t\tstr = JSON.stringify(cleanedState);\n\n\t\t\t\t// Return\n\t\t\t\treturn str;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Get a State's ID\n\t\t\t * @param {State} passedState\n\t\t\t * @return {String} id\n\t\t\t */\n\t\t\tHistory.getStateId = function(passedState){\n\t\t\t\t// Prepare\n\t\t\t\tvar State, id;\n\n\t\t\t\t// Fetch\n\t\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t\t// Fetch\n\t\t\t\tid = State.id;\n\n\t\t\t\t// Return\n\t\t\t\treturn id;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getHashByState(State)\n\t\t\t * Creates a Hash for the State Object\n\t\t\t * @param {State} passedState\n\t\t\t * @return {String} hash\n\t\t\t */\n\t\t\tHistory.getHashByState = function(passedState){\n\t\t\t\t// Prepare\n\t\t\t\tvar State, hash;\n\n\t\t\t\t// Fetch\n\t\t\t\tState = History.normalizeState(passedState);\n\n\t\t\t\t// Hash\n\t\t\t\thash = State.hash;\n\n\t\t\t\t// Return\n\t\t\t\treturn hash;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.extractId(url_or_hash)\n\t\t\t * Get a State ID by it's URL or Hash\n\t\t\t * @param {string} url_or_hash\n\t\t\t * @return {string} id\n\t\t\t */\n\t\t\tHistory.extractId = function ( url_or_hash ) {\n\t\t\t\t// Prepare\n\t\t\t\tvar id,parts,url, tmp;\n\n\t\t\t\t// Extract\n\t\t\t\t\n\t\t\t\t// If the URL has a #, use the id from before the #\n\t\t\t\tif (url_or_hash.indexOf('#') != -1)\n\t\t\t\t{\n\t\t\t\t\ttmp = url_or_hash.split(\"#\")[0];\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttmp = url_or_hash;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tparts = /(.*)\\&_suid=([0-9]+)$/.exec(tmp);\n\t\t\t\turl = parts ? (parts[1]||url_or_hash) : url_or_hash;\n\t\t\t\tid = parts ? String(parts[2]||'') : '';\n\n\t\t\t\t// Return\n\t\t\t\treturn id||false;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.isTraditionalAnchor\n\t\t\t * Checks to see if the url is a traditional anchor or not\n\t\t\t * @param {String} url_or_hash\n\t\t\t * @return {Boolean}\n\t\t\t */\n\t\t\tHistory.isTraditionalAnchor = function(url_or_hash){\n\t\t\t\t// Check\n\t\t\t\tvar isTraditional = !(/[\\/\\?\\.]/.test(url_or_hash));\n\n\t\t\t\t// Return\n\t\t\t\treturn isTraditional;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.extractState\n\t\t\t * Get a State by it's URL or Hash\n\t\t\t * @param {String} url_or_hash\n\t\t\t * @return {State|null}\n\t\t\t */\n\t\t\tHistory.extractState = function(url_or_hash,create){\n\t\t\t\t// Prepare\n\t\t\t\tvar State = null, id, url;\n\t\t\t\tcreate = create||false;\n\n\t\t\t\t// Fetch SUID\n\t\t\t\tid = History.extractId(url_or_hash);\n\t\t\t\tif ( id ) {\n\t\t\t\t\tState = History.getStateById(id);\n\t\t\t\t}\n\n\t\t\t\t// Fetch SUID returned no State\n\t\t\t\tif ( !State ) {\n\t\t\t\t\t// Fetch URL\n\t\t\t\t\turl = History.getFullUrl(url_or_hash);\n\n\t\t\t\t\t// Check URL\n\t\t\t\t\tid = History.getIdByUrl(url)||false;\n\t\t\t\t\tif ( id ) {\n\t\t\t\t\t\tState = History.getStateById(id);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Create State\n\t\t\t\t\tif ( !State && create && !History.isTraditionalAnchor(url_or_hash) ) {\n\t\t\t\t\t\tState = History.createStateObject(null,null,url);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Return\n\t\t\t\treturn State;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getIdByUrl()\n\t\t\t * Get a State ID by a State URL\n\t\t\t */\n\t\t\tHistory.getIdByUrl = function(url){\n\t\t\t\t// Fetch\n\t\t\t\tvar id = History.urlToId[url] || History.store.urlToId[url] || undefined;\n\n\t\t\t\t// Return\n\t\t\t\treturn id;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getLastSavedState()\n\t\t\t * Get an object containing the data, title and url of the current state\n\t\t\t * @return {Object} State\n\t\t\t */\n\t\t\tHistory.getLastSavedState = function(){\n\t\t\t\treturn History.savedStates[History.savedStates.length-1]||undefined;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getLastStoredState()\n\t\t\t * Get an object containing the data, title and url of the current state\n\t\t\t * @return {Object} State\n\t\t\t */\n\t\t\tHistory.getLastStoredState = function(){\n\t\t\t\treturn History.storedStates[History.storedStates.length-1]||undefined;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.hasUrlDuplicate\n\t\t\t * Checks if a Url will have a url conflict\n\t\t\t * @param {Object} newState\n\t\t\t * @return {Boolean} hasDuplicate\n\t\t\t */\n\t\t\tHistory.hasUrlDuplicate = function(newState) {\n\t\t\t\t// Prepare\n\t\t\t\tvar hasDuplicate = false,\n\t\t\t\t\toldState;\n\n\t\t\t\t// Fetch\n\t\t\t\toldState = History.extractState(newState.url);\n\n\t\t\t\t// Check\n\t\t\t\thasDuplicate = oldState && oldState.id !== newState.id;\n\n\t\t\t\t// Return\n\t\t\t\treturn hasDuplicate;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.storeState\n\t\t\t * Store a State\n\t\t\t * @param {Object} newState\n\t\t\t * @return {Object} newState\n\t\t\t */\n\t\t\tHistory.storeState = function(newState){\n\t\t\t\t// Store the State\n\t\t\t\tHistory.urlToId[newState.url] = newState.id;\n\n\t\t\t\t// Push the State\n\t\t\t\tHistory.storedStates.push(History.cloneObject(newState));\n\n\t\t\t\t// Return newState\n\t\t\t\treturn newState;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.isLastSavedState(newState)\n\t\t\t * Tests to see if the state is the last state\n\t\t\t * @param {Object} newState\n\t\t\t * @return {boolean} isLast\n\t\t\t */\n\t\t\tHistory.isLastSavedState = function(newState){\n\t\t\t\t// Prepare\n\t\t\t\tvar isLast = false,\n\t\t\t\t\tnewId, oldState, oldId;\n\n\t\t\t\t// Check\n\t\t\t\tif ( History.savedStates.length ) {\n\t\t\t\t\tnewId = newState.id;\n\t\t\t\t\toldState = History.getLastSavedState();\n\t\t\t\t\toldId = oldState.id;\n\n\t\t\t\t\t// Check\n\t\t\t\t\tisLast = (newId === oldId);\n\t\t\t\t}\n\n\t\t\t\t// Return\n\t\t\t\treturn isLast;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.saveState\n\t\t\t * Push a State\n\t\t\t * @param {Object} newState\n\t\t\t * @return {boolean} changed\n\t\t\t */\n\t\t\tHistory.saveState = function(newState){\n\t\t\t\t// Check Hash\n\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Push the State\n\t\t\t\tHistory.savedStates.push(History.cloneObject(newState));\n\n\t\t\t\t// Return true\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getStateByIndex()\n\t\t\t * Gets a state by the index\n\t\t\t * @param {integer} index\n\t\t\t * @return {Object}\n\t\t\t */\n\t\t\tHistory.getStateByIndex = function(index){\n\t\t\t\t// Prepare\n\t\t\t\tvar State = null;\n\n\t\t\t\t// Handle\n\t\t\t\tif ( typeof index === 'undefined' ) {\n\t\t\t\t\t// Get the last inserted\n\t\t\t\t\tState = History.savedStates[History.savedStates.length-1];\n\t\t\t\t}\n\t\t\t\telse if ( index < 0 ) {\n\t\t\t\t\t// Get from the end\n\t\t\t\t\tState = History.savedStates[History.savedStates.length+index];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Get from the beginning\n\t\t\t\t\tState = History.savedStates[index];\n\t\t\t\t}\n\n\t\t\t\t// Return State\n\t\t\t\treturn State;\n\t\t\t};\n\t\t\t\n\t\t\t/**\n\t\t\t * History.getCurrentIndex()\n\t\t\t * Gets the current index\n\t\t\t * @return (integer)\n\t\t\t*/\n\t\t\tHistory.getCurrentIndex = function(){\n\t\t\t\t// Prepare\n\t\t\t\tvar index = null;\n\t\t\t\t\n\t\t\t\t// No states saved\n\t\t\t\tif(History.savedStates.length < 1) {\n\t\t\t\t\tindex = 0;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tindex = History.savedStates.length-1;\n\t\t\t\t}\n\t\t\t\treturn index;\n\t\t\t};\n\n\t\t\t// ====================================================================\n\t\t\t// Hash Helpers\n\n\t\t\t/**\n\t\t\t * History.getHash()\n\t\t\t * @param {Location=} location\n\t\t\t * Gets the current document hash\n\t\t\t * Note: unlike location.hash, this is guaranteed to return the escaped hash in all browsers\n\t\t\t * @return {string}\n\t\t\t */\n\t\t\tHistory.getHash = function(doc){\n\t\t\t\tvar url = History.getLocationHref(doc),\n\t\t\t\t\thash;\n\t\t\t\thash = History.getHashByUrl(url);\n\t\t\t\treturn hash;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.unescapeHash()\n\t\t\t * normalize and Unescape a Hash\n\t\t\t * @param {String} hash\n\t\t\t * @return {string}\n\t\t\t */\n\t\t\tHistory.unescapeHash = function(hash){\n\t\t\t\t// Prepare\n\t\t\t\tvar result = History.normalizeHash(hash);\n\n\t\t\t\t// Unescape hash\n\t\t\t\tresult = decodeURIComponent(result);\n\n\t\t\t\t// Return result\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.normalizeHash()\n\t\t\t * normalize a hash across browsers\n\t\t\t * @return {string}\n\t\t\t */\n\t\t\tHistory.normalizeHash = function(hash){\n\t\t\t\t// Prepare\n\t\t\t\tvar result = hash.replace(/[^#]*#/,'').replace(/#.*/, '');\n\n\t\t\t\t// Return result\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.setHash(hash)\n\t\t\t * Sets the document hash\n\t\t\t * @param {string} hash\n\t\t\t * @return {History}\n\t\t\t */\n\t\t\tHistory.setHash = function(hash,queue){\n\t\t\t\t// Prepare\n\t\t\t\tvar State, pageUrl;\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.setHash: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.setHash,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Log\n\t\t\t\t//History.debug('History.setHash: called',hash);\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Check if hash is a state\n\t\t\t\tState = History.extractState(hash,true);\n\t\t\t\tif ( State && !History.emulated.pushState ) {\n\t\t\t\t\t// Hash is a state so skip the setHash\n\t\t\t\t\t//History.debug('History.setHash: Hash is a state so skipping the hash set with a direct pushState call',arguments);\n\n\t\t\t\t\t// PushState\n\t\t\t\t\tHistory.pushState(State.data,State.title,State.url,false);\n\t\t\t\t}\n\t\t\t\telse if ( History.getHash() !== hash ) {\n\t\t\t\t\t// Hash is a proper hash, so apply it\n\n\t\t\t\t\t// Handle browser bugs\n\t\t\t\t\tif ( History.bugs.setHash ) {\n\t\t\t\t\t\t// Fix Safari Bug https://bugs.webkit.org/show_bug.cgi?id=56249\n\n\t\t\t\t\t\t// Fetch the base page\n\t\t\t\t\t\tpageUrl = History.getPageUrl();\n\n\t\t\t\t\t\t// Safari hash apply\n\t\t\t\t\t\tHistory.pushState(null,null,pageUrl+'#'+hash,false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Normal hash apply\n\t\t\t\t\t\tdocument.location.hash = hash;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.escape()\n\t\t\t * normalize and Escape a Hash\n\t\t\t * @return {string}\n\t\t\t */\n\t\t\tHistory.escapeHash = function(hash){\n\t\t\t\t// Prepare\n\t\t\t\tvar result = History.normalizeHash(hash);\n\n\t\t\t\t// Escape hash\n\t\t\t\tresult = window.encodeURIComponent(result);\n\n\t\t\t\t// IE6 Escape Bug\n\t\t\t\tif ( !History.bugs.hashEscape ) {\n\t\t\t\t\t// Restore common parts\n\t\t\t\t\tresult = result\n\t\t\t\t\t\t.replace(/\\%21/g,'!')\n\t\t\t\t\t\t.replace(/\\%26/g,'&')\n\t\t\t\t\t\t.replace(/\\%3D/g,'=')\n\t\t\t\t\t\t.replace(/\\%3F/g,'?');\n\t\t\t\t}\n\n\t\t\t\t// Return result\n\t\t\t\treturn result;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.getHashByUrl(url)\n\t\t\t * Extracts the Hash from a URL\n\t\t\t * @param {string} url\n\t\t\t * @return {string} url\n\t\t\t */\n\t\t\tHistory.getHashByUrl = function(url){\n\t\t\t\t// Extract the hash\n\t\t\t\tvar hash = String(url)\n\t\t\t\t\t.replace(/([^#]*)#?([^#]*)#?(.*)/, '$2')\n\t\t\t\t\t;\n\n\t\t\t\t// Unescape hash\n\t\t\t\thash = History.unescapeHash(hash);\n\n\t\t\t\t// Return hash\n\t\t\t\treturn hash;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.setTitle(title)\n\t\t\t * Applies the title to the document\n\t\t\t * @param {State} newState\n\t\t\t * @return {Boolean}\n\t\t\t */\n\t\t\tHistory.setTitle = function(newState){\n\t\t\t\t// Prepare\n\t\t\t\tvar title = newState.title,\n\t\t\t\t\tfirstState;\n\n\t\t\t\t// Initial\n\t\t\t\tif ( !title ) {\n\t\t\t\t\tfirstState = History.getStateByIndex(0);\n\t\t\t\t\tif ( firstState && firstState.url === newState.url ) {\n\t\t\t\t\t\ttitle = firstState.title||History.options.initialTitle;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Apply\n\t\t\t\ttry {\n\t\t\t\t\tdocument.getElementsByTagName('title')[0].innerHTML = title.replace('<','&lt;').replace('>','&gt;').replace(' & ',' &amp; ');\n\t\t\t\t}\n\t\t\t\tcatch ( Exception ) { }\n\t\t\t\tdocument.title = title;\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// Queueing\n\n\t\t\t/**\n\t\t\t * History.queues\n\t\t\t * The list of queues to use\n\t\t\t * First In, First Out\n\t\t\t */\n\t\t\tHistory.queues = [];\n\n\t\t\t/**\n\t\t\t * History.busy(value)\n\t\t\t * @param {boolean} value [optional]\n\t\t\t * @return {boolean} busy\n\t\t\t */\n\t\t\tHistory.busy = function(value){\n\t\t\t\t// Apply\n\t\t\t\tif ( typeof value !== 'undefined' ) {\n\t\t\t\t\t//History.debug('History.busy: changing ['+(History.busy.flag||false)+'] to ['+(value||false)+']', History.queues.length);\n\t\t\t\t\tHistory.busy.flag = value;\n\t\t\t\t}\n\t\t\t\t// Default\n\t\t\t\telse if ( typeof History.busy.flag === 'undefined' ) {\n\t\t\t\t\tHistory.busy.flag = false;\n\t\t\t\t}\n\n\t\t\t\t// Queue\n\t\t\t\tif ( !History.busy.flag ) {\n\t\t\t\t\t// Execute the next item in the queue\n\t\t\t\t\tclearTimeout(History.busy.timeout);\n\t\t\t\t\tvar fireNext = function(){\n\t\t\t\t\t\tvar i, queue, item;\n\t\t\t\t\t\tif ( History.busy.flag ) return;\n\t\t\t\t\t\tfor ( i=History.queues.length-1; i >= 0; --i ) {\n\t\t\t\t\t\t\tqueue = History.queues[i];\n\t\t\t\t\t\t\tif ( queue.length === 0 ) continue;\n\t\t\t\t\t\t\titem = queue.shift();\n\t\t\t\t\t\t\tHistory.fireQueueItem(item);\n\t\t\t\t\t\t\tHistory.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tHistory.busy.timeout = setTimeout(fireNext,History.options.busyDelay);\n\t\t\t\t}\n\n\t\t\t\t// Return\n\t\t\t\treturn History.busy.flag;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.busy.flag\n\t\t\t */\n\t\t\tHistory.busy.flag = false;\n\n\t\t\t/**\n\t\t\t * History.fireQueueItem(item)\n\t\t\t * Fire a Queue Item\n\t\t\t * @param {Object} item\n\t\t\t * @return {Mixed} result\n\t\t\t */\n\t\t\tHistory.fireQueueItem = function(item){\n\t\t\t\treturn item.callback.apply(item.scope||History,item.args||[]);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.pushQueue(callback,args)\n\t\t\t * Add an item to the queue\n\t\t\t * @param {Object} item [scope,callback,args,queue]\n\t\t\t */\n\t\t\tHistory.pushQueue = function(item){\n\t\t\t\t// Prepare the queue\n\t\t\t\tHistory.queues[item.queue||0] = History.queues[item.queue||0]||[];\n\n\t\t\t\t// Add to the queue\n\t\t\t\tHistory.queues[item.queue||0].push(item);\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.queue (item,queue), (func,queue), (func), (item)\n\t\t\t * Either firs the item now if not busy, or adds it to the queue\n\t\t\t */\n\t\t\tHistory.queue = function(item,queue){\n\t\t\t\t// Prepare\n\t\t\t\tif ( typeof item === 'function' ) {\n\t\t\t\t\titem = {\n\t\t\t\t\t\tcallback: item\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t\tif ( typeof queue !== 'undefined' ) {\n\t\t\t\t\titem.queue = queue;\n\t\t\t\t}\n\n\t\t\t\t// Handle\n\t\t\t\tif ( History.busy() ) {\n\t\t\t\t\tHistory.pushQueue(item);\n\t\t\t\t} else {\n\t\t\t\t\tHistory.fireQueueItem(item);\n\t\t\t\t}\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.clearQueue()\n\t\t\t * Clears the Queue\n\t\t\t */\n\t\t\tHistory.clearQueue = function(){\n\t\t\t\tHistory.busy.flag = false;\n\t\t\t\tHistory.queues = [];\n\t\t\t\treturn History;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// IE Bug Fix\n\n\t\t\t/**\n\t\t\t * History.stateChanged\n\t\t\t * States whether or not the state has changed since the last double check was initialised\n\t\t\t */\n\t\t\tHistory.stateChanged = false;\n\n\t\t\t/**\n\t\t\t * History.doubleChecker\n\t\t\t * Contains the timeout used for the double checks\n\t\t\t */\n\t\t\tHistory.doubleChecker = false;\n\n\t\t\t/**\n\t\t\t * History.doubleCheckComplete()\n\t\t\t * Complete a double check\n\t\t\t * @return {History}\n\t\t\t */\n\t\t\tHistory.doubleCheckComplete = function(){\n\t\t\t\t// Update\n\t\t\t\tHistory.stateChanged = true;\n\n\t\t\t\t// Clear\n\t\t\t\tHistory.doubleCheckClear();\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.doubleCheckClear()\n\t\t\t * Clear a double check\n\t\t\t * @return {History}\n\t\t\t */\n\t\t\tHistory.doubleCheckClear = function(){\n\t\t\t\t// Clear\n\t\t\t\tif ( History.doubleChecker ) {\n\t\t\t\t\tclearTimeout(History.doubleChecker);\n\t\t\t\t\tHistory.doubleChecker = false;\n\t\t\t\t}\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.doubleCheck()\n\t\t\t * Create a double check\n\t\t\t * @return {History}\n\t\t\t */\n\t\t\tHistory.doubleCheck = function(tryAgain){\n\t\t\t\t// Reset\n\t\t\t\tHistory.stateChanged = false;\n\t\t\t\tHistory.doubleCheckClear();\n\n\t\t\t\t// Fix IE6,IE7 bug where calling history.back or history.forward does not actually change the hash (whereas doing it manually does)\n\t\t\t\t// Fix Safari 5 bug where sometimes the state does not change: https://bugs.webkit.org/show_bug.cgi?id=42940\n\t\t\t\tif ( History.bugs.ieDoubleCheck ) {\n\t\t\t\t\t// Apply Check\n\t\t\t\t\tHistory.doubleChecker = setTimeout(\n\t\t\t\t\t\tfunction(){\n\t\t\t\t\t\t\tHistory.doubleCheckClear();\n\t\t\t\t\t\t\tif ( !History.stateChanged ) {\n\t\t\t\t\t\t\t\t//History.debug('History.doubleCheck: State has not yet changed, trying again', arguments);\n\t\t\t\t\t\t\t\t// Re-Attempt\n\t\t\t\t\t\t\t\ttryAgain();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t},\n\t\t\t\t\t\tHistory.options.doubleCheckInterval\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// Safari Bug Fix\n\n\t\t\t/**\n\t\t\t * History.safariStatePoll()\n\t\t\t * Poll the current state\n\t\t\t * @return {History}\n\t\t\t */\n\t\t\tHistory.safariStatePoll = function(){\n\t\t\t\t// Poll the URL\n\n\t\t\t\t// Get the Last State which has the new URL\n\t\t\t\tvar\n\t\t\t\t\turlState = History.extractState(History.getLocationHref()),\n\t\t\t\t\tnewState;\n\n\t\t\t\t// Check for a difference\n\t\t\t\tif ( !History.isLastSavedState(urlState) ) {\n\t\t\t\t\tnewState = urlState;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Check if we have a state with that url\n\t\t\t\t// If not create it\n\t\t\t\tif ( !newState ) {\n\t\t\t\t\t//History.debug('History.safariStatePoll: new');\n\t\t\t\t\tnewState = History.createStateObject();\n\t\t\t\t}\n\n\t\t\t\t// Apply the New State\n\t\t\t\t//History.debug('History.safariStatePoll: trigger');\n\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// State Aliases\n\n\t\t\t/**\n\t\t\t * History.back(queue)\n\t\t\t * Send the browser history back one item\n\t\t\t * @param {Integer} queue [optional]\n\t\t\t */\n\t\t\tHistory.back = function(queue){\n\t\t\t\t//History.debug('History.back: called', arguments);\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.back: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.back,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Fix certain browser bugs that prevent the state from changing\n\t\t\t\tHistory.doubleCheck(function(){\n\t\t\t\t\tHistory.back(false);\n\t\t\t\t});\n\n\t\t\t\t// Go back\n\t\t\t\thistory.go(-1);\n\n\t\t\t\t// End back closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.forward(queue)\n\t\t\t * Send the browser history forward one item\n\t\t\t * @param {Integer} queue [optional]\n\t\t\t */\n\t\t\tHistory.forward = function(queue){\n\t\t\t\t//History.debug('History.forward: called', arguments);\n\n\t\t\t\t// Handle Queueing\n\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t//History.debug('History.forward: we must wait', arguments);\n\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\tcallback: History.forward,\n\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t});\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Make Busy + Continue\n\t\t\t\tHistory.busy(true);\n\n\t\t\t\t// Fix certain browser bugs that prevent the state from changing\n\t\t\t\tHistory.doubleCheck(function(){\n\t\t\t\t\tHistory.forward(false);\n\t\t\t\t});\n\n\t\t\t\t// Go forward\n\t\t\t\thistory.go(1);\n\n\t\t\t\t// End forward closure\n\t\t\t\treturn true;\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * History.go(index,queue)\n\t\t\t * Send the browser history back or forward index times\n\t\t\t * @param {Integer} queue [optional]\n\t\t\t */\n\t\t\tHistory.go = function(index,queue){\n\t\t\t\t//History.debug('History.go: called', arguments);\n\n\t\t\t\t// Prepare\n\t\t\t\tvar i;\n\n\t\t\t\t// Handle\n\t\t\t\tif ( index > 0 ) {\n\t\t\t\t\t// Forward\n\t\t\t\t\tfor ( i=1; i<=index; ++i ) {\n\t\t\t\t\t\tHistory.forward(queue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if ( index < 0 ) {\n\t\t\t\t\t// Backward\n\t\t\t\t\tfor ( i=-1; i>=index; --i ) {\n\t\t\t\t\t\tHistory.back(queue);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthrow new Error('History.go: History.go requires a positive or negative integer passed.');\n\t\t\t\t}\n\n\t\t\t\t// Chain\n\t\t\t\treturn History;\n\t\t\t};\n\n\n\t\t\t// ====================================================================\n\t\t\t// HTML5 State Support\n\n\t\t\t// Non-Native pushState Implementation\n\t\t\tif ( History.emulated.pushState ) {\n\t\t\t\t/*\n\t\t\t\t * Provide Skeleton for HTML4 Browsers\n\t\t\t\t */\n\n\t\t\t\t// Prepare\n\t\t\t\tvar emptyFunction = function(){};\n\t\t\t\tHistory.pushState = History.pushState||emptyFunction;\n\t\t\t\tHistory.replaceState = History.replaceState||emptyFunction;\n\t\t\t} // History.emulated.pushState\n\n\t\t\t// Native pushState Implementation\n\t\t\telse {\n\t\t\t\t/*\n\t\t\t\t * Use native HTML5 History API Implementation\n\t\t\t\t */\n\n\t\t\t\t/**\n\t\t\t\t * History.onPopState(event,extra)\n\t\t\t\t * Refresh the Current State\n\t\t\t\t */\n\t\t\t\tHistory.onPopState = function(event,extra){\n\t\t\t\t\t// Prepare\n\t\t\t\t\tvar stateId = false, newState = false, currentHash, currentState;\n\n\t\t\t\t\t// Reset the double check\n\t\t\t\t\tHistory.doubleCheckComplete();\n\n\t\t\t\t\t// Check for a Hash, and handle apporiatly\n\t\t\t\t\tcurrentHash = History.getHash();\n\t\t\t\t\tif ( currentHash ) {\n\t\t\t\t\t\t// Expand Hash\n\t\t\t\t\t\tcurrentState = History.extractState(currentHash||History.getLocationHref(),true);\n\t\t\t\t\t\tif ( currentState ) {\n\t\t\t\t\t\t\t// We were able to parse it, it must be a State!\n\t\t\t\t\t\t\t// Let's forward to replaceState\n\t\t\t\t\t\t\t//History.debug('History.onPopState: state anchor', currentHash, currentState);\n\t\t\t\t\t\t\tHistory.replaceState(currentState.data, currentState.title, currentState.url, false);\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// Traditional Anchor\n\t\t\t\t\t\t\t//History.debug('History.onPopState: traditional anchor', currentHash);\n\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'anchorchange');\n\t\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// We don't care for hashes\n\t\t\t\t\t\tHistory.expectedStateId = false;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Ensure\n\t\t\t\t\tstateId = History.Adapter.extractEventData('state',event,extra) || false;\n\n\t\t\t\t\t// Fetch State\n\t\t\t\t\tif ( stateId ) {\n\t\t\t\t\t\t// Vanilla: Back/forward button was used\n\t\t\t\t\t\tnewState = History.getStateById(stateId);\n\t\t\t\t\t}\n\t\t\t\t\telse if ( History.expectedStateId ) {\n\t\t\t\t\t\t// Vanilla: A new state was pushed, and popstate was called manually\n\t\t\t\t\t\tnewState = History.getStateById(History.expectedStateId);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Initial State\n\t\t\t\t\t\tnewState = History.extractState(History.getLocationHref());\n\t\t\t\t\t}\n\n\t\t\t\t\t// The State did not exist in our store\n\t\t\t\t\tif ( !newState ) {\n\t\t\t\t\t\t// Regenerate the State\n\t\t\t\t\t\tnewState = History.createStateObject(null,null,History.getLocationHref());\n\t\t\t\t\t}\n\n\t\t\t\t\t// Clean\n\t\t\t\t\tHistory.expectedStateId = false;\n\n\t\t\t\t\t// Check if we are the same state\n\t\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t\t// There has been no change (just the page's hash has finally propagated)\n\t\t\t\t\t\t//History.debug('History.onPopState: no change', newState, History.savedStates);\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Store the State\n\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\tHistory.saveState(newState);\n\n\t\t\t\t\t// Force update of the title\n\t\t\t\t\tHistory.setTitle(newState);\n\n\t\t\t\t\t// Fire Our Event\n\t\t\t\t\tHistory.Adapter.trigger(window,'statechange');\n\t\t\t\t\tHistory.busy(false);\n\n\t\t\t\t\t// Return true\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\t\t\t\tHistory.Adapter.bind(window,'popstate',History.onPopState);\n\n\t\t\t\t/**\n\t\t\t\t * History.pushState(data,title,url)\n\t\t\t\t * Add a new State to the history object, become it, and trigger onpopstate\n\t\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t\t * @param {object} data\n\t\t\t\t * @param {string} title\n\t\t\t\t * @param {string} url\n\t\t\t\t * @return {true}\n\t\t\t\t */\n\t\t\t\tHistory.pushState = function(data,title,url,queue){\n\t\t\t\t\t//History.debug('History.pushState: called', arguments);\n\n\t\t\t\t\t// Check the State\n\t\t\t\t\tif ( History.getHashByUrl(url) && History.emulated.pushState ) {\n\t\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle Queueing\n\t\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t\t//History.debug('History.pushState: we must wait', arguments);\n\t\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\t\tcallback: History.pushState,\n\t\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make Busy + Continue\n\t\t\t\t\tHistory.busy(true);\n\n\t\t\t\t\t// Create the newState\n\t\t\t\t\tvar newState = History.createStateObject(data,title,url);\n\n\t\t\t\t\t// Check it\n\t\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t\t// Won't be a change\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Store the newState\n\t\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t\t// Push the newState\n\t\t\t\t\t\thistory.pushState(newState.id,newState.title,newState.url);\n\n\t\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t\t}\n\n\t\t\t\t\t// End pushState closure\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t\t/**\n\t\t\t\t * History.replaceState(data,title,url)\n\t\t\t\t * Replace the State and trigger onpopstate\n\t\t\t\t * We have to trigger for HTML4 compatibility\n\t\t\t\t * @param {object} data\n\t\t\t\t * @param {string} title\n\t\t\t\t * @param {string} url\n\t\t\t\t * @return {true}\n\t\t\t\t */\n\t\t\t\tHistory.replaceState = function(data,title,url,queue){\n\t\t\t\t\t//History.debug('History.replaceState: called', arguments);\n\n\t\t\t\t\t// Check the State\n\t\t\t\t\tif ( History.getHashByUrl(url) && History.emulated.pushState ) {\n\t\t\t\t\t\tthrow new Error('History.js does not support states with fragement-identifiers (hashes/anchors).');\n\t\t\t\t\t}\n\n\t\t\t\t\t// Handle Queueing\n\t\t\t\t\tif ( queue !== false && History.busy() ) {\n\t\t\t\t\t\t// Wait + Push to Queue\n\t\t\t\t\t\t//History.debug('History.replaceState: we must wait', arguments);\n\t\t\t\t\t\tHistory.pushQueue({\n\t\t\t\t\t\t\tscope: History,\n\t\t\t\t\t\t\tcallback: History.replaceState,\n\t\t\t\t\t\t\targs: arguments,\n\t\t\t\t\t\t\tqueue: queue\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Make Busy + Continue\n\t\t\t\t\tHistory.busy(true);\n\n\t\t\t\t\t// Create the newState\n\t\t\t\t\tvar newState = History.createStateObject(data,title,url);\n\n\t\t\t\t\t// Check it\n\t\t\t\t\tif ( History.isLastSavedState(newState) ) {\n\t\t\t\t\t\t// Won't be a change\n\t\t\t\t\t\tHistory.busy(false);\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\t// Store the newState\n\t\t\t\t\t\tHistory.storeState(newState);\n\t\t\t\t\t\tHistory.expectedStateId = newState.id;\n\n\t\t\t\t\t\t// Push the newState\n\t\t\t\t\t\thistory.replaceState(newState.id,newState.title,newState.url);\n\n\t\t\t\t\t\t// Fire HTML5 Event\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t\t}\n\n\t\t\t\t\t// End replaceState closure\n\t\t\t\t\treturn true;\n\t\t\t\t};\n\n\t\t\t} // !History.emulated.pushState\n\n\n\t\t\t// ====================================================================\n\t\t\t// Initialise\n\n\t\t\t/**\n\t\t\t * Load the Store\n\t\t\t */\n\t\t\tif ( sessionStorage ) {\n\t\t\t\t// Fetch\n\t\t\t\ttry {\n\t\t\t\t\tHistory.store = JSON.parse(sessionStorage.getItem('History.store'))||{};\n\t\t\t\t}\n\t\t\t\tcatch ( err ) {\n\t\t\t\t\tHistory.store = {};\n\t\t\t\t}\n\n\t\t\t\t// Normalize\n\t\t\t\tHistory.normalizeStore();\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Default Load\n\t\t\t\tHistory.store = {};\n\t\t\t\tHistory.normalizeStore();\n\t\t\t}\n\n\t\t\t/**\n\t\t\t * Clear Intervals on exit to prevent memory leaks\n\t\t\t */\n\t\t\tHistory.Adapter.bind(window,\"unload\",History.clearAllIntervals);\n\n\t\t\t/**\n\t\t\t * Create the initial State\n\t\t\t */\n\t\t\tHistory.saveState(History.storeState(History.extractState(History.getLocationHref(),true)));\n\n\t\t\t/**\n\t\t\t * Bind for Saving Store\n\t\t\t */\n\t\t\tif ( sessionStorage ) {\n\t\t\t\t// When the page is closed\n\t\t\t\tHistory.onUnload = function(){\n\t\t\t\t\t// Prepare\n\t\t\t\t\tvar\tcurrentStore, item, currentStoreString;\n\n\t\t\t\t\t// Fetch\n\t\t\t\t\ttry {\n\t\t\t\t\t\tcurrentStore = JSON.parse(sessionStorage.getItem('History.store'))||{};\n\t\t\t\t\t}\n\t\t\t\t\tcatch ( err ) {\n\t\t\t\t\t\tcurrentStore = {};\n\t\t\t\t\t}\n\n\t\t\t\t\t// Ensure\n\t\t\t\t\tcurrentStore.idToState = currentStore.idToState || {};\n\t\t\t\t\tcurrentStore.urlToId = currentStore.urlToId || {};\n\t\t\t\t\tcurrentStore.stateToId = currentStore.stateToId || {};\n\n\t\t\t\t\t// Sync\n\t\t\t\t\tfor ( item in History.idToState ) {\n\t\t\t\t\t\tif ( !History.idToState.hasOwnProperty(item) ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentStore.idToState[item] = History.idToState[item];\n\t\t\t\t\t}\n\t\t\t\t\tfor ( item in History.urlToId ) {\n\t\t\t\t\t\tif ( !History.urlToId.hasOwnProperty(item) ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentStore.urlToId[item] = History.urlToId[item];\n\t\t\t\t\t}\n\t\t\t\t\tfor ( item in History.stateToId ) {\n\t\t\t\t\t\tif ( !History.stateToId.hasOwnProperty(item) ) {\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcurrentStore.stateToId[item] = History.stateToId[item];\n\t\t\t\t\t}\n\n\t\t\t\t\t// Update\n\t\t\t\t\tHistory.store = currentStore;\n\t\t\t\t\tHistory.normalizeStore();\n\n\t\t\t\t\t// In Safari, going into Private Browsing mode causes the\n\t\t\t\t\t// Session Storage object to still exist but if you try and use\n\t\t\t\t\t// or set any property/function of it it throws the exception\n\t\t\t\t\t// \"QUOTA_EXCEEDED_ERR: DOM Exception 22: An attempt was made to\n\t\t\t\t\t// add something to storage that exceeded the quota.\" infinitely\n\t\t\t\t\t// every second.\n\t\t\t\t\tcurrentStoreString = JSON.stringify(currentStore);\n\t\t\t\t\ttry {\n\t\t\t\t\t\t// Store\n\t\t\t\t\t\tsessionStorage.setItem('History.store', currentStoreString);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e) {\n\t\t\t\t\t\tif (e.code === DOMException.QUOTA_EXCEEDED_ERR) {\n\t\t\t\t\t\t\tif (sessionStorage.length) {\n\t\t\t\t\t\t\t\t// Workaround for a bug seen on iPads. Sometimes the quota exceeded error comes up and simply\n\t\t\t\t\t\t\t\t// removing/resetting the storage can work.\n\t\t\t\t\t\t\t\tsessionStorage.removeItem('History.store');\n\t\t\t\t\t\t\t\tsessionStorage.setItem('History.store', currentStoreString);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow e;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\t// For Internet Explorer\n\t\t\t\tHistory.intervalList.push(setInterval(History.onUnload,History.options.storeInterval));\n\n\t\t\t\t// For Other Browsers\n\t\t\t\tHistory.Adapter.bind(window,'beforeunload',History.onUnload);\n\t\t\t\tHistory.Adapter.bind(window,'unload',History.onUnload);\n\n\t\t\t\t// Both are enabled for consistency\n\t\t\t}\n\n\t\t\t// Non-Native pushState Implementation\n\t\t\tif ( !History.emulated.pushState ) {\n\t\t\t\t// Be aware, the following is only for native pushState implementations\n\t\t\t\t// If you are wanting to include something for all browsers\n\t\t\t\t// Then include it above this if block\n\n\t\t\t\t/**\n\t\t\t\t * Setup Safari Fix\n\t\t\t\t */\n\t\t\t\tif ( History.bugs.safariPoll ) {\n\t\t\t\t\tHistory.intervalList.push(setInterval(History.safariStatePoll, History.options.safariPollInterval));\n\t\t\t\t}\n\n\t\t\t\t/**\n\t\t\t\t * Ensure Cross Browser Compatibility\n\t\t\t\t */\n\t\t\t\tif ( navigator.vendor === 'Apple Computer, Inc.' || (navigator.appCodeName||'') === 'Mozilla' ) {\n\t\t\t\t\t/**\n\t\t\t\t\t * Fix Safari HashChange Issue\n\t\t\t\t\t */\n\n\t\t\t\t\t// Setup Alias\n\t\t\t\t\tHistory.Adapter.bind(window,'hashchange',function(){\n\t\t\t\t\t\tHistory.Adapter.trigger(window,'popstate');\n\t\t\t\t\t});\n\n\t\t\t\t\t// Initialise Alias\n\t\t\t\t\tif ( History.getHash() ) {\n\t\t\t\t\t\tHistory.Adapter.onDomLoad(function(){\n\t\t\t\t\t\t\tHistory.Adapter.trigger(window,'hashchange');\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} // !History.emulated.pushState\n\n\n\t\t}; // History.initCore\n\n\t\t// Try to Initialise History\n\t\tif (!History.options || !History.options.delayInit) {\n\t\t\tHistory.init();\n\t\t}\n\n\t})(window);\n\n\tfunction GetGuacamole() {\n\t/*\n\t * Copyright (C) 2014 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * The Guacamole display. The display does not deal with the Guacamole\n\t * protocol, and instead implements a set of graphical operations which\n\t * embody the set of operations present in the protocol. The order operations\n\t * are executed is guaranteed to be in the same order as their corresponding\n\t * functions are called.\n\t * \n\t * @constructor\n\t */\n\tGuacamole.Display = function() {\n\n\t    /**\n\t     * Reference to this Guacamole.Display.\n\t     * @private\n\t     */\n\t    var guac_display = this;\n\n\t    var displayWidth = 0;\n\t    var displayHeight = 0;\n\t    var displayScale = 1;\n\n\t    // Create display\n\t    var display = document.createElement(\"div\");\n\t    display.style.position = \"relative\";\n\t    display.style.width = displayWidth + \"px\";\n\t    display.style.height = displayHeight + \"px\";\n\n\t    // Ensure transformations on display originate at 0,0\n\t    display.style.transformOrigin =\n\t    display.style.webkitTransformOrigin =\n\t    display.style.MozTransformOrigin =\n\t    display.style.OTransformOrigin =\n\t    display.style.msTransformOrigin =\n\t        \"0 0\";\n\n\t    // Create default layer\n\t    var default_layer = new Guacamole.Display.VisibleLayer(displayWidth, displayHeight);\n\n\t    // Create cursor layer\n\t    var cursor = new Guacamole.Display.VisibleLayer(0, 0);\n\t    cursor.setChannelMask(Guacamole.Layer.SRC);\n\n\t    // Add default layer and cursor to display\n\t    display.appendChild(default_layer.getElement());\n\t    display.appendChild(cursor.getElement());\n\n\t    // Create bounding div \n\t    var bounds = document.createElement(\"div\");\n\t    bounds.style.position = \"relative\";\n\t    bounds.style.width = (displayWidth*displayScale) + \"px\";\n\t    bounds.style.height = (displayHeight*displayScale) + \"px\";\n\n\t    // Add display to bounds\n\t    bounds.appendChild(display);\n\n\t    /**\n\t     * The X coordinate of the hotspot of the mouse cursor. The hotspot is\n\t     * the relative location within the image of the mouse cursor at which\n\t     * each click occurs.\n\t     * \n\t     * @type Number\n\t     */\n\t    this.cursorHotspotX = 0;\n\n\t    /**\n\t     * The Y coordinate of the hotspot of the mouse cursor. The hotspot is\n\t     * the relative location within the image of the mouse cursor at which\n\t     * each click occurs.\n\t     * \n\t     * @type Number\n\t     */\n\t    this.cursorHotspotY = 0;\n\n\t    /**\n\t     * The current X coordinate of the local mouse cursor. This is not\n\t     * necessarily the location of the actual mouse - it refers only to\n\t     * the location of the cursor image within the Guacamole display, as\n\t     * last set by moveCursor().\n\t     * \n\t     * @type Number\n\t     */\n\t    this.cursorX = 0;\n\n\t    /**\n\t     * The current X coordinate of the local mouse cursor. This is not\n\t     * necessarily the location of the actual mouse - it refers only to\n\t     * the location of the cursor image within the Guacamole display, as\n\t     * last set by moveCursor().\n\t     * \n\t     * @type Number\n\t     */\n\t    this.cursorY = 0;\n\n\t    /**\n\t     * Fired when the default layer (and thus the entire Guacamole display)\n\t     * is resized.\n\t     * \n\t     * @event\n\t     * @param {Number} width The new width of the Guacamole display.\n\t     * @param {Number} height The new height of the Guacamole display.\n\t     */\n\t    this.onresize = null;\n\n\t    /**\n\t     * Fired whenever the local cursor image is changed. This can be used to\n\t     * implement special handling of the client-side cursor, or to override\n\t     * the default use of a software cursor layer.\n\t     * \n\t     * @event\n\t     * @param {HTMLCanvasElement} canvas The cursor image.\n\t     * @param {Number} x The X-coordinate of the cursor hotspot.\n\t     * @param {Number} y The Y-coordinate of the cursor hotspot.\n\t     */\n\t    this.oncursor = null;\n\n\t    /**\n\t     * The queue of all pending Tasks. Tasks will be run in order, with new\n\t     * tasks added at the end of the queue and old tasks removed from the\n\t     * front of the queue (FIFO). These tasks will eventually be grouped\n\t     * into a Frame.\n\t     * @private\n\t     * @type Task[]\n\t     */\n\t    var tasks = [];\n\n\t    /**\n\t     * The queue of all frames. Each frame is a pairing of an array of tasks\n\t     * and a callback which must be called when the frame is rendered.\n\t     * @private\n\t     * @type Frame[]\n\t     */\n\t    var frames = [];\n\n\t    /**\n\t     * Flushes all pending frames.\n\t     * @private\n\t     */\n\t    function __flush_frames() {\n\n\t        var rendered_frames = 0;\n\n\t        // Draw all pending frames, if ready\n\t        while (rendered_frames < frames.length) {\n\n\t            var frame = frames[rendered_frames];\n\t            if (!frame.isReady())\n\t                break;\n\n\t            frame.flush();\n\t            rendered_frames++;\n\n\t        } \n\n\t        // Remove rendered frames from array\n\t        frames.splice(0, rendered_frames);\n\n\t    }\n\n\t    /**\n\t     * An ordered list of tasks which must be executed atomically. Once\n\t     * executed, an associated (and optional) callback will be called.\n\t     *\n\t     * @private\n\t     * @constructor\n\t     * @param {function} callback The function to call when this frame is\n\t     *                            rendered.\n\t     * @param {Task[]} tasks The set of tasks which must be executed to render\n\t     *                       this frame.\n\t     */\n\t    function Frame(callback, tasks) {\n\n\t        /**\n\t         * Returns whether this frame is ready to be rendered. This function\n\t         * returns true if and only if ALL underlying tasks are unblocked.\n\t         * \n\t         * @returns {Boolean} true if all underlying tasks are unblocked,\n\t         *                    false otherwise.\n\t         */\n\t        this.isReady = function() {\n\n\t            // Search for blocked tasks\n\t            for (var i=0; i < tasks.length; i++) {\n\t                if (tasks[i].blocked)\n\t                    return false;\n\t            }\n\n\t            // If no blocked tasks, the frame is ready\n\t            return true;\n\n\t        };\n\n\t        /**\n\t         * Renders this frame, calling the associated callback, if any, after\n\t         * the frame is complete. This function MUST only be called when no\n\t         * blocked tasks exist. Calling this function with blocked tasks\n\t         * will result in undefined behavior.\n\t         */\n\t        this.flush = function() {\n\n\t            // Draw all pending tasks.\n\t            for (var i=0; i < tasks.length; i++)\n\t                tasks[i].execute();\n\n\t            // Call callback\n\t            if (callback) callback();\n\n\t        };\n\n\t    }\n\n\t    /**\n\t     * A container for an task handler. Each operation which must be ordered\n\t     * is associated with a Task that goes into a task queue. Tasks in this\n\t     * queue are executed in order once their handlers are set, while Tasks \n\t     * without handlers block themselves and any following Tasks from running.\n\t     *\n\t     * @constructor\n\t     * @private\n\t     * @param {function} taskHandler The function to call when this task \n\t     *                               runs, if any.\n\t     * @param {boolean} blocked Whether this task should start blocked.\n\t     */\n\t    function Task(taskHandler, blocked) {\n\t       \n\t        var task = this;\n\t       \n\t        /**\n\t         * Whether this Task is blocked.\n\t         * \n\t         * @type boolean\n\t         */\n\t        this.blocked = blocked;\n\n\t        /**\n\t         * Unblocks this Task, allowing it to run.\n\t         */\n\t        this.unblock = function() {\n\t            if (task.blocked) {\n\t                task.blocked = false;\n\t                __flush_frames();\n\t            }\n\t        };\n\n\t        /**\n\t         * Calls the handler associated with this task IMMEDIATELY. This\n\t         * function does not track whether this task is marked as blocked.\n\t         * Enforcing the blocked status of tasks is up to the caller.\n\t         */\n\t        this.execute = function() {\n\t            if (taskHandler) taskHandler();\n\t        };\n\n\t    }\n\n\t    /**\n\t     * Schedules a task for future execution. The given handler will execute\n\t     * immediately after all previous tasks upon frame flush, unless this\n\t     * task is blocked. If any tasks is blocked, the entire frame will not\n\t     * render (and no tasks within will execute) until all tasks are unblocked.\n\t     * \n\t     * @private\n\t     * @param {function} handler The function to call when possible, if any.\n\t     * @param {boolean} blocked Whether the task should start blocked.\n\t     * @returns {Task} The Task created and added to the queue for future\n\t     *                 running.\n\t     */\n\t    function scheduleTask(handler, blocked) {\n\t        var task = new Task(handler, blocked);\n\t        tasks.push(task);\n\t        return task;\n\t    }\n\n\t    /**\n\t     * Returns the element which contains the Guacamole display.\n\t     * \n\t     * @return {Element} The element containing the Guacamole display.\n\t     */\n\t    this.getElement = function() {\n\t        return bounds;\n\t    };\n\n\t    /**\n\t     * Returns the width of this display.\n\t     * \n\t     * @return {Number} The width of this display;\n\t     */\n\t    this.getWidth = function() {\n\t        return displayWidth;\n\t    };\n\n\t    /**\n\t     * Returns the height of this display.\n\t     * \n\t     * @return {Number} The height of this display;\n\t     */\n\t    this.getHeight = function() {\n\t        return displayHeight;\n\t    };\n\n\t    /**\n\t     * Returns the default layer of this display. Each Guacamole display always\n\t     * has at least one layer. Other layers can optionally be created within\n\t     * this layer, but the default layer cannot be removed and is the absolute\n\t     * ancestor of all other layers.\n\t     * \n\t     * @return {Guacamole.Display.VisibleLayer} The default layer.\n\t     */\n\t    this.getDefaultLayer = function() {\n\t        return default_layer;\n\t    };\n\n\t    /**\n\t     * Returns the cursor layer of this display. Each Guacamole display contains\n\t     * a layer for the image of the mouse cursor. This layer is a special case\n\t     * and exists above all other layers, similar to the hardware mouse cursor.\n\t     * \n\t     * @return {Guacamole.Display.VisibleLayer} The cursor layer.\n\t     */\n\t    this.getCursorLayer = function() {\n\t        return cursor;\n\t    };\n\n\t    /**\n\t     * Creates a new layer. The new layer will be a direct child of the default\n\t     * layer, but can be moved to be a child of any other layer. Layers returned\n\t     * by this function are visible.\n\t     * \n\t     * @return {Guacamole.Display.VisibleLayer} The newly-created layer.\n\t     */\n\t    this.createLayer = function() {\n\t        var layer = new Guacamole.Display.VisibleLayer(displayWidth, displayHeight);\n\t        layer.move(default_layer, 0, 0, 0);\n\t        return layer;\n\t    };\n\n\t    /**\n\t     * Creates a new buffer. Buffers are invisible, off-screen surfaces. They\n\t     * are implemented in the same manner as layers, but do not provide the\n\t     * same nesting semantics.\n\t     * \n\t     * @return {Guacamole.Layer} The newly-created buffer.\n\t     */\n\t    this.createBuffer = function() {\n\t        var buffer = new Guacamole.Layer(0, 0);\n\t        buffer.autosize = 1;\n\t        return buffer;\n\t    };\n\n\t    /**\n\t     * Flush all pending draw tasks, if possible, as a new frame. If the entire\n\t     * frame is not ready, the flush will wait until all required tasks are\n\t     * unblocked.\n\t     * \n\t     * @param {function} callback The function to call when this frame is\n\t     *                            flushed. This may happen immediately, or\n\t     *                            later when blocked tasks become unblocked.\n\t     */\n\t    this.flush = function(callback) {\n\n\t        // Add frame, reset tasks\n\t        frames.push(new Frame(callback, tasks));\n\t        tasks = [];\n\n\t        // Attempt flush\n\t        __flush_frames();\n\n\t    };\n\n\t    /**\n\t     * Sets the hotspot and image of the mouse cursor displayed within the\n\t     * Guacamole display.\n\t     * \n\t     * @param {Number} hotspotX The X coordinate of the cursor hotspot.\n\t     * @param {Number} hotspotY The Y coordinate of the cursor hotspot.\n\t     * @param {Guacamole.Layer} layer The source layer containing the data which\n\t     *                                should be used as the mouse cursor image.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      layer's coordinate space to copy data from.\n\n\t     */\n\t    this.setCursor = function(hotspotX, hotspotY, layer, srcx, srcy, srcw, srch) {\n\t        scheduleTask(function __display_set_cursor() {\n\n\t            // Set hotspot\n\t            guac_display.cursorHotspotX = hotspotX;\n\t            guac_display.cursorHotspotY = hotspotY;\n\n\t            // Reset cursor size\n\t            cursor.resize(srcw, srch);\n\n\t            // Draw cursor to cursor layer\n\t            cursor.copy(layer, srcx, srcy, srcw, srch, 0, 0);\n\t            guac_display.moveCursor(guac_display.cursorX, guac_display.cursorY);\n\n\t            // Fire cursor change event\n\t            if (guac_display.oncursor)\n\t                guac_display.oncursor(cursor.getCanvas(), hotspotX, hotspotY);\n\n\t        });\n\t    };\n\n\t    /**\n\t     * Sets whether the software-rendered cursor is shown. This cursor differs\n\t     * from the hardware cursor in that it is built into the Guacamole.Display,\n\t     * and relies on its own Guacamole layer to render.\n\t     *\n\t     * @param {Boolean} [shown=true] Whether to show the software cursor.\n\t     */\n\t    this.showCursor = function(shown) {\n\n\t        var element = cursor.getElement();\n\t        var parent = element.parentNode;\n\n\t        // Remove from DOM if hidden\n\t        if (shown === false) {\n\t            if (parent)\n\t                parent.removeChild(element);\n\t        }\n\n\t        // Otherwise, ensure cursor is child of display\n\t        else if (parent !== display)\n\t            display.appendChild(element);\n\n\t    };\n\n\t    /**\n\t     * Sets the location of the local cursor to the given coordinates. For the\n\t     * sake of responsiveness, this function performs its action immediately.\n\t     * Cursor motion is not maintained within atomic frames.\n\t     * \n\t     * @param {Number} x The X coordinate to move the cursor to.\n\t     * @param {Number} y The Y coordinate to move the cursor to.\n\t     */\n\t    this.moveCursor = function(x, y) {\n\n\t        // Move cursor layer\n\t        cursor.translate(x - guac_display.cursorHotspotX,\n\t                         y - guac_display.cursorHotspotY);\n\n\t        // Update stored position\n\t        guac_display.cursorX = x;\n\t        guac_display.cursorY = y;\n\n\t    };\n\n\t    /**\n\t     * Changes the size of the given Layer to the given width and height.\n\t     * Resizing is only attempted if the new size provided is actually different\n\t     * from the current size.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to resize.\n\t     * @param {Number} width The new width.\n\t     * @param {Number} height The new height.\n\t     */\n\t    this.resize = function(layer, width, height) {\n\t        scheduleTask(function __display_resize() {\n\n\t            layer.resize(width, height);\n\n\t            // Resize display if default layer is resized\n\t            if (layer === default_layer) {\n\n\t                // Update (set) display size\n\t                displayWidth = width;\n\t                displayHeight = height;\n\t                display.style.width = displayWidth + \"px\";\n\t                display.style.height = displayHeight + \"px\";\n\n\t                // Update bounds size\n\t                bounds.style.width = (displayWidth*displayScale) + \"px\";\n\t                bounds.style.height = (displayHeight*displayScale) + \"px\";\n\n\t                // Notify of resize\n\t                if (guac_display.onresize)\n\t                    guac_display.onresize(width, height);\n\n\t            }\n\n\t        });\n\t    };\n\n\t    /**\n\t     * Draws the specified image at the given coordinates. The image specified\n\t     * must already be loaded.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     * @param {Image} image The image to draw. Note that this is an Image\n\t     *                      object - not a URL.\n\t     */\n\t    this.drawImage = function(layer, x, y, image) {\n\t        scheduleTask(function __display_drawImage() {\n\t            layer.drawImage(x, y, image);\n\t        });\n\t    };\n\n\t    /**\n\t     * Draws the image at the specified URL at the given coordinates. The image\n\t     * will be loaded automatically, and this and any future operations will\n\t     * wait for the image to finish loading.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     * @param {String} url The URL of the image to draw.\n\t     */\n\t    this.draw = function(layer, x, y, url) {\n\n\t        var task = scheduleTask(function __display_draw() {\n\t            layer.drawImage(x, y, image);\n\t        }, true);\n\n\t        var image = new Image();\n\t        image.onload = task.unblock;\n\t        image.src = url;\n\n\t    };\n\n\t    /**\n\t     * Plays the video at the specified URL within this layer. The video\n\t     * will be loaded automatically, and this and any future operations will\n\t     * wait for the video to finish loading. Future operations will not be\n\t     * executed until the video finishes playing.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {String} mimetype The mimetype of the video to play.\n\t     * @param {Number} duration The duration of the video in milliseconds.\n\t     * @param {String} url The URL of the video to play.\n\t     */\n\t    this.play = function(layer, mimetype, duration, url) {\n\n\t        // Start loading the video\n\t        var video = document.createElement(\"video\");\n\t        video.type = mimetype;\n\t        video.src = url;\n\n\t        // Start copying frames when playing\n\t        video.addEventListener(\"play\", function() {\n\t            \n\t            function render_callback() {\n\t                layer.drawImage(0, 0, video);\n\t                if (!video.ended)\n\t                    window.setTimeout(render_callback, 20);\n\t            }\n\t            \n\t            render_callback();\n\t            \n\t        }, false);\n\n\t        scheduleTask(video.play);\n\n\t    };\n\n\t    /**\n\t     * Transfer a rectangle of image data from one Layer to this Layer using the\n\t     * specified transfer function.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The Layer to copy image data from.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source Layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      Layer's coordinate space to copy data from.\n\t     * @param {Guacamole.Layer} dstLayer The layer to draw upon.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     * @param {Function} transferFunction The transfer function to use to\n\t     *                                    transfer data from source to\n\t     *                                    destination.\n\t     */\n\t    this.transfer = function(srcLayer, srcx, srcy, srcw, srch, dstLayer, x, y, transferFunction) {\n\t        scheduleTask(function __display_transfer() {\n\t            dstLayer.transfer(srcLayer, srcx, srcy, srcw, srch, x, y, transferFunction);\n\t        });\n\t    };\n\n\t    /**\n\t     * Put a rectangle of image data from one Layer to this Layer directly\n\t     * without performing any alpha blending. Simply copy the data.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The Layer to copy image data from.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source Layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      Layer's coordinate space to copy data from.\n\t     * @param {Guacamole.Layer} dstLayer The layer to draw upon.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     */\n\t    this.put = function(srcLayer, srcx, srcy, srcw, srch, dstLayer, x, y) {\n\t        scheduleTask(function __display_put() {\n\t            dstLayer.put(srcLayer, srcx, srcy, srcw, srch, x, y);\n\t        });\n\t    };\n\n\t    /**\n\t     * Copy a rectangle of image data from one Layer to this Layer. This\n\t     * operation will copy exactly the image data that will be drawn once all\n\t     * operations of the source Layer that were pending at the time this\n\t     * function was called are complete. This operation will not alter the\n\t     * size of the source Layer even if its autosize property is set to true.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The Layer to copy image data from.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source Layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      Layer's coordinate space to copy data from.\n\t     * @param {Guacamole.Layer} dstLayer The layer to draw upon.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     */\n\t    this.copy = function(srcLayer, srcx, srcy, srcw, srch, dstLayer, x, y) {\n\t        scheduleTask(function __display_copy() {\n\t            dstLayer.copy(srcLayer, srcx, srcy, srcw, srch, x, y);\n\t        });\n\t    };\n\n\t    /**\n\t     * Starts a new path at the specified point.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} x The X coordinate of the point to draw.\n\t     * @param {Number} y The Y coordinate of the point to draw.\n\t     */\n\t    this.moveTo = function(layer, x, y) {\n\t        scheduleTask(function __display_moveTo() {\n\t            layer.moveTo(x, y);\n\t        });\n\t    };\n\n\t    /**\n\t     * Add the specified line to the current path.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} x The X coordinate of the endpoint of the line to draw.\n\t     * @param {Number} y The Y coordinate of the endpoint of the line to draw.\n\t     */\n\t    this.lineTo = function(layer, x, y) {\n\t        scheduleTask(function __display_lineTo() {\n\t            layer.lineTo(x, y);\n\t        });\n\t    };\n\n\t    /**\n\t     * Add the specified arc to the current path.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} x The X coordinate of the center of the circle which\n\t     *                   will contain the arc.\n\t     * @param {Number} y The Y coordinate of the center of the circle which\n\t     *                   will contain the arc.\n\t     * @param {Number} radius The radius of the circle.\n\t     * @param {Number} startAngle The starting angle of the arc, in radians.\n\t     * @param {Number} endAngle The ending angle of the arc, in radians.\n\t     * @param {Boolean} negative Whether the arc should be drawn in order of\n\t     *                           decreasing angle.\n\t     */\n\t    this.arc = function(layer, x, y, radius, startAngle, endAngle, negative) {\n\t        scheduleTask(function __display_arc() {\n\t            layer.arc(x, y, radius, startAngle, endAngle, negative);\n\t        });\n\t    };\n\n\t    /**\n\t     * Starts a new path at the specified point.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} cp1x The X coordinate of the first control point.\n\t     * @param {Number} cp1y The Y coordinate of the first control point.\n\t     * @param {Number} cp2x The X coordinate of the second control point.\n\t     * @param {Number} cp2y The Y coordinate of the second control point.\n\t     * @param {Number} x The X coordinate of the endpoint of the curve.\n\t     * @param {Number} y The Y coordinate of the endpoint of the curve.\n\t     */\n\t    this.curveTo = function(layer, cp1x, cp1y, cp2x, cp2y, x, y) {\n\t        scheduleTask(function __display_curveTo() {\n\t            layer.curveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n\t        });\n\t    };\n\n\t    /**\n\t     * Closes the current path by connecting the end point with the start\n\t     * point (if any) with a straight line.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     */\n\t    this.close = function(layer) {\n\t        scheduleTask(function __display_close() {\n\t            layer.close();\n\t        });\n\t    };\n\n\t    /**\n\t     * Add the specified rectangle to the current path.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} x The X coordinate of the upper-left corner of the\n\t     *                   rectangle to draw.\n\t     * @param {Number} y The Y coordinate of the upper-left corner of the\n\t     *                   rectangle to draw.\n\t     * @param {Number} w The width of the rectangle to draw.\n\t     * @param {Number} h The height of the rectangle to draw.\n\t     */\n\t    this.rect = function(layer, x, y, w, h) {\n\t        scheduleTask(function __display_rect() {\n\t            layer.rect(x, y, w, h);\n\t        });\n\t    };\n\n\t    /**\n\t     * Clip all future drawing operations by the current path. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as fillColor()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to affect.\n\t     */\n\t    this.clip = function(layer) {\n\t        scheduleTask(function __display_clip() {\n\t            layer.clip();\n\t        });\n\t    };\n\n\t    /**\n\t     * Stroke the current path with the specified color. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {String} cap The line cap style. Can be \"round\", \"square\",\n\t     *                     or \"butt\".\n\t     * @param {String} join The line join style. Can be \"round\", \"bevel\",\n\t     *                      or \"miter\".\n\t     * @param {Number} thickness The line thickness in pixels.\n\t     * @param {Number} r The red component of the color to fill.\n\t     * @param {Number} g The green component of the color to fill.\n\t     * @param {Number} b The blue component of the color to fill.\n\t     * @param {Number} a The alpha component of the color to fill.\n\t     */\n\t    this.strokeColor = function(layer, cap, join, thickness, r, g, b, a) {\n\t        scheduleTask(function __display_strokeColor() {\n\t            layer.strokeColor(cap, join, thickness, r, g, b, a);\n\t        });\n\t    };\n\n\t    /**\n\t     * Fills the current path with the specified color. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Number} r The red component of the color to fill.\n\t     * @param {Number} g The green component of the color to fill.\n\t     * @param {Number} b The blue component of the color to fill.\n\t     * @param {Number} a The alpha component of the color to fill.\n\t     */\n\t    this.fillColor = function(layer, r, g, b, a) {\n\t        scheduleTask(function __display_fillColor() {\n\t            layer.fillColor(r, g, b, a);\n\t        });\n\t    };\n\n\t    /**\n\t     * Stroke the current path with the image within the specified layer. The\n\t     * image data will be tiled infinitely within the stroke. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {String} cap The line cap style. Can be \"round\", \"square\",\n\t     *                     or \"butt\".\n\t     * @param {String} join The line join style. Can be \"round\", \"bevel\",\n\t     *                      or \"miter\".\n\t     * @param {Number} thickness The line thickness in pixels.\n\t     * @param {Guacamole.Layer} srcLayer The layer to use as a repeating pattern\n\t     *                                   within the stroke.\n\t     */\n\t    this.strokeLayer = function(layer, cap, join, thickness, srcLayer) {\n\t        scheduleTask(function __display_strokeLayer() {\n\t            layer.strokeLayer(cap, join, thickness, srcLayer);\n\t        });\n\t    };\n\n\t    /**\n\t     * Fills the current path with the image within the specified layer. The\n\t     * image data will be tiled infinitely within the stroke. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     * @param {Guacamole.Layer} srcLayer The layer to use as a repeating pattern\n\t     *                                   within the fill.\n\t     */\n\t    this.fillLayer = function(layer, srcLayer) {\n\t        scheduleTask(function __display_fillLayer() {\n\t            layer.fillLayer(srcLayer);\n\t        });\n\t    };\n\n\t    /**\n\t     * Push current layer state onto stack.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     */\n\t    this.push = function(layer) {\n\t        scheduleTask(function __display_push() {\n\t            layer.push();\n\t        });\n\t    };\n\n\t    /**\n\t     * Pop layer state off stack.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     */\n\t    this.pop = function(layer) {\n\t        scheduleTask(function __display_pop() {\n\t            layer.pop();\n\t        });\n\t    };\n\n\t    /**\n\t     * Reset the layer, clearing the stack, the current path, and any transform\n\t     * matrix.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to draw upon.\n\t     */\n\t    this.reset = function(layer) {\n\t        scheduleTask(function __display_reset() {\n\t            layer.reset();\n\t        });\n\t    };\n\n\t    /**\n\t     * Sets the given affine transform (defined with six values from the\n\t     * transform's matrix).\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to modify.\n\t     * @param {Number} a The first value in the affine transform's matrix.\n\t     * @param {Number} b The second value in the affine transform's matrix.\n\t     * @param {Number} c The third value in the affine transform's matrix.\n\t     * @param {Number} d The fourth value in the affine transform's matrix.\n\t     * @param {Number} e The fifth value in the affine transform's matrix.\n\t     * @param {Number} f The sixth value in the affine transform's matrix.\n\t     */\n\t    this.setTransform = function(layer, a, b, c, d, e, f) {\n\t        scheduleTask(function __display_setTransform() {\n\t            layer.setTransform(a, b, c, d, e, f);\n\t        });\n\t    };\n\n\t    /**\n\t     * Applies the given affine transform (defined with six values from the\n\t     * transform's matrix).\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to modify.\n\t     * @param {Number} a The first value in the affine transform's matrix.\n\t     * @param {Number} b The second value in the affine transform's matrix.\n\t     * @param {Number} c The third value in the affine transform's matrix.\n\t     * @param {Number} d The fourth value in the affine transform's matrix.\n\t     * @param {Number} e The fifth value in the affine transform's matrix.\n\t     * @param {Number} f The sixth value in the affine transform's matrix.\n\t     */\n\t    this.transform = function(layer, a, b, c, d, e, f) {\n\t        scheduleTask(function __display_transform() {\n\t            layer.transform(a, b, c, d, e, f);\n\t        });\n\t    };\n\n\t    /**\n\t     * Sets the channel mask for future operations on this Layer.\n\t     * \n\t     * The channel mask is a Guacamole-specific compositing operation identifier\n\t     * with a single bit representing each of four channels (in order): source\n\t     * image where destination transparent, source where destination opaque,\n\t     * destination where source transparent, and destination where source\n\t     * opaque.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to modify.\n\t     * @param {Number} mask The channel mask for future operations on this\n\t     *                      Layer.\n\t     */\n\t    this.setChannelMask = function(layer, mask) {\n\t        scheduleTask(function __display_setChannelMask() {\n\t            layer.setChannelMask(mask);\n\t        });\n\t    };\n\n\t    /**\n\t     * Sets the miter limit for stroke operations using the miter join. This\n\t     * limit is the maximum ratio of the size of the miter join to the stroke\n\t     * width. If this ratio is exceeded, the miter will not be drawn for that\n\t     * joint of the path.\n\t     * \n\t     * @param {Guacamole.Layer} layer The layer to modify.\n\t     * @param {Number} limit The miter limit for stroke operations using the\n\t     *                       miter join.\n\t     */\n\t    this.setMiterLimit = function(layer, limit) {\n\t        scheduleTask(function __display_setMiterLimit() {\n\t            layer.setMiterLimit(limit);\n\t        });\n\t    };\n\n\t    /**\n\t     * Sets the scale of the client display element such that it renders at\n\t     * a relatively smaller or larger size, without affecting the true\n\t     * resolution of the display.\n\t     *\n\t     * @param {Number} scale The scale to resize to, where 1.0 is normal\n\t     *                       size (1:1 scale).\n\t     */\n\t    this.scale = function(scale) {\n\n\t        display.style.transform =\n\t        display.style.WebkitTransform =\n\t        display.style.MozTransform =\n\t        display.style.OTransform =\n\t        display.style.msTransform =\n\n\t            \"scale(\" + scale + \",\" + scale + \")\";\n\n\t        displayScale = scale;\n\n\t        // Update bounds size\n\t        bounds.style.width = (displayWidth*displayScale) + \"px\";\n\t        bounds.style.height = (displayHeight*displayScale) + \"px\";\n\n\t    };\n\n\t    /**\n\t     * Returns the scale of the display.\n\t     *\n\t     * @return {Number} The scale of the display.\n\t     */\n\t    this.getScale = function() {\n\t        return displayScale;\n\t    };\n\n\t    /**\n\t     * Returns a canvas element containing the entire display, with all child\n\t     * layers composited within.\n\t     *\n\t     * @return {HTMLCanvasElement} A new canvas element containing a copy of\n\t     *                             the display.\n\t     */\n\t    this.flatten = function() {\n\t       \n\t        // Get destination canvas\n\t        var canvas = document.createElement(\"canvas\");\n\t        canvas.width = default_layer.width;\n\t        canvas.height = default_layer.height;\n\n\t        var context = canvas.getContext(\"2d\");\n\n\t        // Returns sorted array of children\n\t        function get_children(layer) {\n\n\t            // Build array of children\n\t            var children = [];\n\t            for (var index in layer.children)\n\t                children.push(layer.children[index]);\n\n\t            // Sort\n\t            children.sort(function children_comparator(a, b) {\n\n\t                // Compare based on Z order\n\t                var diff = a.z - b.z;\n\t                if (diff !== 0)\n\t                    return diff;\n\n\t                // If Z order identical, use document order\n\t                var a_element = a.getElement();\n\t                var b_element = b.getElement();\n\t                var position = b_element.compareDocumentPosition(a_element);\n\n\t                if (position & Node.DOCUMENT_POSITION_PRECEDING) return -1;\n\t                if (position & Node.DOCUMENT_POSITION_FOLLOWING) return  1;\n\n\t                // Otherwise, assume same\n\t                return 0;\n\n\t            });\n\n\t            // Done\n\t            return children;\n\n\t        }\n\n\t        // Draws the contents of the given layer at the given coordinates\n\t        function draw_layer(layer, x, y) {\n\n\t            // Draw layer\n\t            if (layer.width > 0 && layer.height > 0) {\n\n\t                // Save and update alpha\n\t                var initial_alpha = context.globalAlpha;\n\t                context.globalAlpha *= layer.alpha / 255.0;\n\n\t                // Copy data\n\t                context.drawImage(layer.getCanvas(), x, y);\n\n\t                // Draw all children\n\t                var children = get_children(layer);\n\t                for (var i=0; i<children.length; i++) {\n\t                    var child = children[i];\n\t                    draw_layer(child, x + child.x, y + child.y);\n\t                }\n\n\t                // Restore alpha\n\t                context.globalAlpha = initial_alpha;\n\n\t            }\n\n\t        }\n\n\t        // Draw default layer and all children\n\t        draw_layer(default_layer, 0, 0);\n\n\t        // Return new canvas copy\n\t        return canvas;\n\t        \n\t    };\n\n\t};\n\n\t/**\n\t * Simple container for Guacamole.Layer, allowing layers to be easily\n\t * repositioned and nested. This allows certain operations to be accelerated\n\t * through DOM manipulation, rather than raster operations.\n\t * \n\t * @constructor\n\t * @augments Guacamole.Layer\n\t * @param {Number} width The width of the Layer, in pixels. The canvas element\n\t *                       backing this Layer will be given this width.\n\t * @param {Number} height The height of the Layer, in pixels. The canvas element\n\t *                        backing this Layer will be given this height.\n\t */\n\tGuacamole.Display.VisibleLayer = function(width, height) {\n\n\t    Guacamole.Layer.apply(this, [width, height]);\n\n\t    /**\n\t     * Reference to this layer.\n\t     * @private\n\t     */\n\t    var layer = this;\n\n\t    /**\n\t     * Identifier which uniquely identifies this layer. This is COMPLETELY\n\t     * UNRELATED to the index of the underlying layer, which is specific\n\t     * to the Guacamole protocol, and not relevant at this level.\n\t     * \n\t     * @private\n\t     * @type Number\n\t     */\n\t    this.__unique_id = Guacamole.Display.VisibleLayer.__next_id++;\n\n\t    /**\n\t     * The opacity of the layer container, where 255 is fully opaque and 0 is\n\t     * fully transparent.\n\t     */\n\t    this.alpha = 0xFF;\n\n\t    /**\n\t     * X coordinate of the upper-left corner of this layer container within\n\t     * its parent, in pixels.\n\t     * @type Number\n\t     */\n\t    this.x = 0;\n\n\t    /**\n\t     * Y coordinate of the upper-left corner of this layer container within\n\t     * its parent, in pixels.\n\t     * @type Number\n\t     */\n\t    this.y = 0;\n\n\t    /**\n\t     * Z stacking order of this layer relative to other sibling layers.\n\t     * @type Number\n\t     */\n\t    this.z = 0;\n\n\t    /**\n\t     * The affine transformation applied to this layer container. Each element\n\t     * corresponds to a value from the transformation matrix, with the first\n\t     * three values being the first row, and the last three values being the\n\t     * second row. There are six values total.\n\t     * \n\t     * @type Number[]\n\t     */\n\t    this.matrix = [1, 0, 0, 1, 0, 0];\n\n\t    /**\n\t     * The parent layer container of this layer, if any.\n\t     * @type Guacamole.Display.LayerContainer\n\t     */\n\t    this.parent = null;\n\n\t    /**\n\t     * Set of all children of this layer, indexed by layer index. This object\n\t     * will have one property per child.\n\t     */\n\t    this.children = {};\n\n\t    // Set layer position\n\t    var canvas = layer.getCanvas();\n\t    canvas.style.position = \"absolute\";\n\t    canvas.style.left = \"0px\";\n\t    canvas.style.top = \"0px\";\n\n\t    // Create div with given size\n\t    var div = document.createElement(\"div\");\n\t    div.appendChild(canvas);\n\t    div.style.width = width + \"px\";\n\t    div.style.height = height + \"px\";\n\t    div.style.position = \"absolute\";\n\t    div.style.left = \"0px\";\n\t    div.style.top = \"0px\";\n\t    div.style.overflow = \"hidden\";\n\n\t    /**\n\t     * Superclass resize() function.\n\t     * @private\n\t     */\n\t    var __super_resize = this.resize;\n\n\t    this.resize = function(width, height) {\n\n\t        // Resize containing div\n\t        div.style.width = width + \"px\";\n\t        div.style.height = height + \"px\";\n\n\t        __super_resize(width, height);\n\n\t    };\n\t  \n\t    /**\n\t     * Returns the element containing the canvas and any other elements\n\t     * associated with this layer.\n\t     * @returns {Element} The element containing this layer's canvas.\n\t     */\n\t    this.getElement = function() {\n\t        return div;\n\t    };\n\n\t    /**\n\t     * The translation component of this layer's transform.\n\t     * @private\n\t     */\n\t    var translate = \"translate(0px, 0px)\"; // (0, 0)\n\n\t    /**\n\t     * The arbitrary matrix component of this layer's transform.\n\t     * @private\n\t     */\n\t    var matrix = \"matrix(1, 0, 0, 1, 0, 0)\"; // Identity\n\n\t    /**\n\t     * Moves the upper-left corner of this layer to the given X and Y\n\t     * coordinate.\n\t     * \n\t     * @param {Number} x The X coordinate to move to.\n\t     * @param {Number} y The Y coordinate to move to.\n\t     */\n\t    this.translate = function(x, y) {\n\n\t        layer.x = x;\n\t        layer.y = y;\n\n\t        // Generate translation\n\t        translate = \"translate(\"\n\t                        + x + \"px,\"\n\t                        + y + \"px)\";\n\n\t        // Set layer transform \n\t        div.style.transform =\n\t        div.style.WebkitTransform =\n\t        div.style.MozTransform =\n\t        div.style.OTransform =\n\t        div.style.msTransform =\n\n\t            translate + \" \" + matrix;\n\n\t    };\n\n\t    /**\n\t     * Moves the upper-left corner of this LayerContainer to the given X and Y\n\t     * coordinate, sets the Z stacking order, and reparents this LayerContainer\n\t     * to the given LayerContainer.\n\t     * \n\t     * @param {Guacamole.Display.LayerContainer} parent The parent to set.\n\t     * @param {Number} x The X coordinate to move to.\n\t     * @param {Number} y The Y coordinate to move to.\n\t     * @param {Number} z The Z coordinate to move to.\n\t     */\n\t    this.move = function(parent, x, y, z) {\n\n\t        // Set parent if necessary\n\t        if (layer.parent !== parent) {\n\n\t            // Maintain relationship\n\t            if (layer.parent)\n\t                delete layer.parent.children[layer.__unique_id];\n\t            layer.parent = parent;\n\t            parent.children[layer.__unique_id] = layer;\n\n\t            // Reparent element\n\t            var parent_element = parent.getElement();\n\t            parent_element.appendChild(div);\n\n\t        }\n\n\t        // Set location\n\t        layer.translate(x, y);\n\t        layer.z = z;\n\t        div.style.zIndex = z;\n\n\t    };\n\n\t    /**\n\t     * Sets the opacity of this layer to the given value, where 255 is fully\n\t     * opaque and 0 is fully transparent.\n\t     * \n\t     * @param {Number} a The opacity to set.\n\t     */\n\t    this.shade = function(a) {\n\t        layer.alpha = a;\n\t        div.style.opacity = a/255.0;\n\t    };\n\n\t    /**\n\t     * Removes this layer container entirely, such that it is no longer\n\t     * contained within its parent layer, if any.\n\t     */\n\t    this.dispose = function() {\n\n\t        // Remove from parent container\n\t        if (layer.parent) {\n\t            delete layer.parent.children[layer.__unique_id];\n\t            layer.parent = null;\n\t        }\n\n\t        // Remove from parent element\n\t        if (div.parentNode)\n\t            div.parentNode.removeChild(div);\n\t        \n\t    };\n\n\t    /**\n\t     * Applies the given affine transform (defined with six values from the\n\t     * transform's matrix).\n\t     * \n\t     * @param {Number} a The first value in the affine transform's matrix.\n\t     * @param {Number} b The second value in the affine transform's matrix.\n\t     * @param {Number} c The third value in the affine transform's matrix.\n\t     * @param {Number} d The fourth value in the affine transform's matrix.\n\t     * @param {Number} e The fifth value in the affine transform's matrix.\n\t     * @param {Number} f The sixth value in the affine transform's matrix.\n\t     */\n\t    this.distort = function(a, b, c, d, e, f) {\n\n\t        // Store matrix\n\t        layer.matrix = [a, b, c, d, e, f];\n\n\t        // Generate matrix transformation\n\t        matrix =\n\n\t            /* a c e\n\t             * b d f\n\t             * 0 0 1\n\t             */\n\t    \n\t            \"matrix(\" + a + \",\" + b + \",\" + c + \",\" + d + \",\" + e + \",\" + f + \")\";\n\n\t        // Set layer transform \n\t        div.style.transform =\n\t        div.style.WebkitTransform =\n\t        div.style.MozTransform =\n\t        div.style.OTransform =\n\t        div.style.msTransform =\n\n\t            translate + \" \" + matrix;\n\n\t    };\n\n\t};\n\n\t/**\n\t * The next identifier to be assigned to the layer container. This identifier\n\t * uniquely identifies each LayerContainer, but is unrelated to the index of\n\t * the layer, which exists at the protocol/client level only.\n\t * \n\t * @private\n\t * @type Number\n\t */\n\tGuacamole.Display.VisibleLayer.__next_id = 0;\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Simple Guacamole protocol parser that invokes an oninstruction event when\n\t * full instructions are available from data received via receive().\n\t * \n\t * @constructor\n\t */\n\tGuacamole.Parser = function() {\n\n\t    /**\n\t     * Reference to this parser.\n\t     * @private\n\t     */\n\t    var parser = this;\n\n\t    /**\n\t     * Current buffer of received data. This buffer grows until a full\n\t     * element is available. After a full element is available, that element\n\t     * is flushed into the element buffer.\n\t     * \n\t     * @private\n\t     */\n\t    var buffer = \"\";\n\n\t    /**\n\t     * Buffer of all received, complete elements. After an entire instruction\n\t     * is read, this buffer is flushed, and a new instruction begins.\n\t     * \n\t     * @private\n\t     */\n\t    var element_buffer = [];\n\n\t    // The location of the last element's terminator\n\t    var element_end = -1;\n\n\t    // Where to start the next length search or the next element\n\t    var start_index = 0;\n\n\t    /**\n\t     * Appends the given instruction data packet to the internal buffer of\n\t     * this Guacamole.Parser, executing all completed instructions at\n\t     * the beginning of this buffer, if any.\n\t     *\n\t     * @param {String} packet The instruction data to receive.\n\t     */\n\t    this.receive = function(packet) {\n\n\t        // Truncate buffer as necessary\n\t        if (start_index > 4096 && element_end >= start_index) {\n\n\t            buffer = buffer.substring(start_index);\n\n\t            // Reset parse relative to truncation\n\t            element_end -= start_index;\n\t            start_index = 0;\n\n\t        }\n\n\t        // Append data to buffer\n\t        buffer += packet;\n\n\t        // While search is within currently received data\n\t        while (element_end < buffer.length) {\n\n\t            // If we are waiting for element data\n\t            if (element_end >= start_index) {\n\n\t                // We now have enough data for the element. Parse.\n\t                var element = buffer.substring(start_index, element_end);\n\t                var terminator = buffer.substring(element_end, element_end+1);\n\n\t                // Add element to array\n\t                element_buffer.push(element);\n\n\t                // If last element, handle instruction\n\t                if (terminator == \";\") {\n\n\t                    // Get opcode\n\t                    var opcode = element_buffer.shift();\n\n\t                    // Call instruction handler.\n\t                    if (parser.oninstruction != null)\n\t                        parser.oninstruction(opcode, element_buffer);\n\n\t                    // Clear elements\n\t                    element_buffer.length = 0;\n\n\t                }\n\t                else if (terminator != ',')\n\t                    throw new Error(\"Illegal terminator.\");\n\n\t                // Start searching for length at character after\n\t                // element terminator\n\t                start_index = element_end + 1;\n\n\t            }\n\n\t            // Search for end of length\n\t            var length_end = buffer.indexOf(\".\", start_index);\n\t            if (length_end != -1) {\n\n\t                // Parse length\n\t                var length = parseInt(buffer.substring(element_end+1, length_end));\n\t                if (isNaN(length))\n\t                    throw new Error(\"Non-numeric character in element length.\");\n\n\t                // Calculate start of element\n\t                start_index = length_end + 1;\n\n\t                // Calculate location of element terminator\n\t                element_end = start_index + length;\n\n\t            }\n\t            \n\t            // If no period yet, continue search when more data\n\t            // is received\n\t            else {\n\t                start_index = buffer.length;\n\t                break;\n\t            }\n\n\t        } // end parse loop\n\n\t    };\n\n\t    /**\n\t     * Fired once for every complete Guacamole instruction received, in order.\n\t     * \n\t     * @event\n\t     * @param {String} opcode The Guacamole instruction opcode.\n\t     * @param {Array} parameters The parameters provided for the instruction,\n\t     *                           if any.\n\t     */\n\t    this.oninstruction = null;\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Guacamole protocol client. Given a {@link Guacamole.Tunnel},\n\t * automatically handles incoming and outgoing Guacamole instructions via the\n\t * provided tunnel, updating its display using one or more canvas elements.\n\t * \n\t * @constructor\n\t * @param {Guacamole.Tunnel} tunnel The tunnel to use to send and receive\n\t *                                  Guacamole instructions.\n\t */\n\tGuacamole.Client = function(tunnel) {\n\n\t    var guac_client = this;\n\n\t    var STATE_IDLE          = 0;\n\t    var STATE_CONNECTING    = 1;\n\t    var STATE_WAITING       = 2;\n\t    var STATE_CONNECTED     = 3;\n\t    var STATE_DISCONNECTING = 4;\n\t    var STATE_DISCONNECTED  = 5;\n\n\t    var currentState = STATE_IDLE;\n\n\t    /**\n\t     * Translation from Guacamole protocol line caps to Layer line caps.\n\t     * @private\n\t     */\n\t    var lineCap = {\n\t        0: \"butt\",\n\t        1: \"round\",\n\t        2: \"square\"\n\t    };\n\n\t    /**\n\t     * Translation from Guacamole protocol line caps to Layer line caps.\n\t     * @private\n\t     */\n\t    var lineJoin = {\n\t        0: \"bevel\",\n\t        1: \"miter\",\n\t        2: \"round\"\n\t    };\n\n\t    /**\n\t     * The underlying Guacamole display.\n\t     */\n\t    var display = new Guacamole.Display();\n\n\t    /**\n\t     * All available layers and buffers\n\t     */\n\t    var layers = {};\n\t    \n\t    // No initial parsers\n\t    var parsers = [];\n\n\t    // No initial audio channels \n\t    var audio_channels = [];\n\n\t    // No initial streams \n\t    var streams = [];\n\n\t    // Pool of available stream indices\n\t    var stream_indices = new Guacamole.IntegerPool();\n\n\t    // Array of allocated output streams by index\n\t    var output_streams = [];\n\n\t    function setState(state) {\n\t        if (state != currentState) {\n\t            currentState = state;\n\t            if (guac_client.onstatechange)\n\t                guac_client.onstatechange(currentState);\n\t        }\n\t    }\n\n\t    function isConnected() {\n\t        return currentState == STATE_CONNECTED\n\t            || currentState == STATE_WAITING;\n\t    }\n\n\t    /**\n\t     * Returns the underlying display of this Guacamole.Client. The display\n\t     * contains an Element which can be added to the DOM, causing the\n\t     * display to become visible.\n\t     * \n\t     * @return {Guacamole.Display} The underlying display of this\n\t     *                             Guacamole.Client.\n\t     */\n\t    this.getDisplay = function() {\n\t        return display;\n\t    };\n\n\t    /**\n\t     * Sends the current size of the screen.\n\t     * \n\t     * @param {Number} width The width of the screen.\n\t     * @param {Number} height The height of the screen.\n\t     */\n\t    this.sendSize = function(width, height) {\n\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        tunnel.sendMessage(\"size\", width, height);\n\n\t    };\n\n\t    /**\n\t     * Sends a key event having the given properties as if the user\n\t     * pressed or released a key.\n\t     * \n\t     * @param {Boolean} pressed Whether the key is pressed (true) or released\n\t     *                          (false).\n\t     * @param {Number} keysym The keysym of the key being pressed or released.\n\t     */\n\t    this.sendKeyEvent = function(pressed, keysym) {\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        tunnel.sendMessage(\"key\", keysym, pressed);\n\t    };\n\n\t    /**\n\t     * Sends a mouse event having the properties provided by the given mouse\n\t     * state.\n\t     * \n\t     * @param {Guacamole.Mouse.State} mouseState The state of the mouse to send\n\t     *                                           in the mouse event.\n\t     */\n\t    this.sendMouseState = function(mouseState) {\n\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        // Update client-side cursor\n\t        display.moveCursor(\n\t            Math.floor(mouseState.x),\n\t            Math.floor(mouseState.y)\n\t        );\n\n\t        // Build mask\n\t        var buttonMask = 0;\n\t        if (mouseState.left)   buttonMask |= 1;\n\t        if (mouseState.middle) buttonMask |= 2;\n\t        if (mouseState.right)  buttonMask |= 4;\n\t        if (mouseState.up)     buttonMask |= 8;\n\t        if (mouseState.down)   buttonMask |= 16;\n\n\t        // Send message\n\t        tunnel.sendMessage(\"mouse\", Math.floor(mouseState.x), Math.floor(mouseState.y), buttonMask);\n\t    };\n\n\t    /**\n\t     * Sets the clipboard of the remote client to the given text data.\n\t     *\n\t     * @deprecated Use createClipboardStream() instead. \n\t     * @param {String} data The data to send as the clipboard contents.\n\t     */\n\t    this.setClipboard = function(data) {\n\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        // Open stream\n\t        var stream = guac_client.createClipboardStream(\"text/plain\");\n\t        var writer = new Guacamole.StringWriter(stream);\n\n\t        // Send text chunks\n\t        for (var i=0; i<data.length; i += 4096)\n\t            writer.sendText(data.substring(i, i+4096));\n\n\t        // Close stream\n\t        writer.sendEnd();\n\n\t    };\n\n\t    /**\n\t     * Opens a new file for writing, having the given index, mimetype and\n\t     * filename.\n\t     * \n\t     * @param {String} mimetype The mimetype of the file being sent.\n\t     * @param {String} filename The filename of the file being sent.\n\t     * @return {Guacamole.OutputStream} The created file stream.\n\t     */\n\t    this.createFileStream = function(mimetype, filename) {\n\n\t        // Allocate index\n\t        var index = stream_indices.next();\n\n\t        // Create new stream\n\t        tunnel.sendMessage(\"file\", index, mimetype, filename);\n\t        var stream = output_streams[index] = new Guacamole.OutputStream(guac_client, index);\n\n\t        // Override sendEnd() of stream to automatically free index\n\t        var old_end = stream.sendEnd;\n\t        stream.sendEnd = function() {\n\t            old_end();\n\t            stream_indices.free(index);\n\t            delete output_streams[index];\n\t        };\n\n\t        // Return new, overridden stream\n\t        return stream;\n\n\t    };\n\n\t    /**\n\t     * Opens a new pipe for writing, having the given name and mimetype. \n\t     * \n\t     * @param {String} mimetype The mimetype of the data being sent.\n\t     * @param {String} name The name of the pipe.\n\t     * @return {Guacamole.OutputStream} The created file stream.\n\t     */\n\t    this.createPipeStream = function(mimetype, name) {\n\n\t        // Allocate index\n\t        var index = stream_indices.next();\n\n\t        // Create new stream\n\t        tunnel.sendMessage(\"pipe\", index, mimetype, name);\n\t        var stream = output_streams[index] = new Guacamole.OutputStream(guac_client, index);\n\n\t        // Override sendEnd() of stream to automatically free index\n\t        var old_end = stream.sendEnd;\n\t        stream.sendEnd = function() {\n\t            old_end();\n\t            stream_indices.free(index);\n\t            delete output_streams[index];\n\t        };\n\n\t        // Return new, overridden stream\n\t        return stream;\n\n\t    };\n\n\t    /**\n\t     * Opens a new clipboard object for writing, having the given mimetype.\n\t     * \n\t     * @param {String} mimetype The mimetype of the data being sent.\n\t     * @param {String} name The name of the pipe.\n\t     * @return {Guacamole.OutputStream} The created file stream.\n\t     */\n\t    this.createClipboardStream = function(mimetype) {\n\n\t        // Allocate index\n\t        var index = stream_indices.next();\n\n\t        // Create new stream\n\t        tunnel.sendMessage(\"clipboard\", index, mimetype);\n\t        var stream = output_streams[index] = new Guacamole.OutputStream(guac_client, index);\n\n\t        // Override sendEnd() of stream to automatically free index\n\t        var old_end = stream.sendEnd;\n\t        stream.sendEnd = function() {\n\t            old_end();\n\t            stream_indices.free(index);\n\t            delete output_streams[index];\n\t        };\n\n\t        // Return new, overridden stream\n\t        return stream;\n\n\t    };\n\n\t    /**\n\t     * Acknowledge receipt of a blob on the stream with the given index.\n\t     * \n\t     * @param {Number} index The index of the stream associated with the\n\t     *                       received blob.\n\t     * @param {String} message A human-readable message describing the error\n\t     *                         or status.\n\t     * @param {Number} code The error code, if any, or 0 for success.\n\t     */\n\t    this.sendAck = function(index, message, code) {\n\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        tunnel.sendMessage(\"ack\", index, message, code);\n\t    };\n\n\t    /**\n\t     * Given the index of a file, writes a blob of data to that file.\n\t     * \n\t     * @param {Number} index The index of the file to write to.\n\t     * @param {String} data Base64-encoded data to write to the file.\n\t     */\n\t    this.sendBlob = function(index, data) {\n\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        tunnel.sendMessage(\"blob\", index, data);\n\t    };\n\n\t    /**\n\t     * Marks a currently-open stream as complete.\n\t     * \n\t     * @param {Number} index The index of the stream to end.\n\t     */\n\t    this.endStream = function(index) {\n\n\t        // Do not send requests if not connected\n\t        if (!isConnected())\n\t            return;\n\n\t        tunnel.sendMessage(\"end\", index);\n\t    };\n\n\t    /**\n\t     * Fired whenever the state of this Guacamole.Client changes.\n\t     * \n\t     * @event\n\t     * @param {Number} state The new state of the client.\n\t     */\n\t    this.onstatechange = null;\n\n\t    /**\n\t     * Fired when the remote client sends a name update.\n\t     * \n\t     * @event\n\t     * @param {String} name The new name of this client.\n\t     */\n\t    this.onname = null;\n\n\t    /**\n\t     * Fired when an error is reported by the remote client, and the connection\n\t     * is being closed.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Status} status A status object which describes the\n\t     *                                  error.\n\t     */\n\t    this.onerror = null;\n\n\t    /**\n\t     * Fired when the clipboard of the remote client is changing.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.InputStream} stream The stream that will receive\n\t     *                                       clipboard data from the server.\n\t     * @param {String} mimetype The mimetype of the data which will be received.\n\t     */\n\t    this.onclipboard = null;\n\n\t    /**\n\t     * Fired when a file stream is created. The stream provided to this event\n\t     * handler will contain its own event handlers for received data.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.InputStream} stream The stream that will receive data\n\t     *                                       from the server.\n\t     * @param {String} mimetype The mimetype of the file received.\n\t     * @param {String} filename The name of the file received.\n\t     */\n\t    this.onfile = null;\n\n\t    /**\n\t     * Fired when a pipe stream is created. The stream provided to this event\n\t     * handler will contain its own event handlers for received data;\n\t     * \n\t     * @event\n\t     * @param {Guacamole.InputStream} stream The stream that will receive data\n\t     *                                       from the server.\n\t     * @param {String} mimetype The mimetype of the data which will be received.\n\t     * @param {String} name The name of the pipe.\n\t     */\n\t    this.onpipe = null;\n\n\t    /**\n\t     * Fired whenever a sync instruction is received from the server, indicating\n\t     * that the server is finished processing any input from the client and\n\t     * has sent any results.\n\t     * \n\t     * @event\n\t     * @param {Number} timestamp The timestamp associated with the sync\n\t     *                           instruction.\n\t     */\n\t    this.onsync = null;\n\t\t\n\t\t/**\n\t\t * Fired when a turn instruction is received.\n\t\t */\n\t\tthis.onturn = null;\n\t\t/**\n\t\t * Fired when a chat message is received.\n\t\t */\n\t\tthis.onchat = null;\n\t\t/**\n\t\t * Fired in response to a login or rename instruction.\n\t\t */\n\t\tthis.onrename = null;\n\t\t/**\n\t\t * Fired when one or more users should be added to\n\t\t * the users list.\n\t\t */\n\t\tthis.onadduser = null;\n\t\t/**\n\t\t * Fired when one or more users should be removed from\n\t\t * the users list.\n\t\t */\n\t\tthis.onremuser = null;\n\t\t/**\n\t\t * Fired in response to a connect instruction.\n\t\t */\n\t\tthis.onconnect = null;\n\t\t/**\n\t\t * Fired in response to a list instruction.\n\t\t */\n\t\tthis.onlist = null;\n\t\t/**\n\t\t * Fired in response to a vote instruction.\n\t\t */\n\t\tthis.onvote = null;\n\t\t/**\n\t\t * Fired in response to an action instruction.\n\t\t */\n\t\tthis.onaction = null;\n\t\t\n\t    /**\n\t     * Returns the layer with the given index, creating it if necessary.\n\t     * Positive indices refer to visible layers, an index of zero refers to\n\t     * the default layer, and negative indices refer to buffers.\n\t     * \n\t     * @param {Number} index The index of the layer to retrieve.\n\t     * @return {Guacamole.Display.VisibleLayer|Guacamole.Layer} The layer having the given index.\n\t     */\n\t    function getLayer(index) {\n\n\t        // Get layer, create if necessary\n\t        var layer = layers[index];\n\t        if (!layer) {\n\n\t            // Create layer based on index\n\t            if (index === 0)\n\t                layer = display.getDefaultLayer();\n\t            else if (index > 0)\n\t                layer = display.createLayer();\n\t            else\n\t                layer = display.createBuffer();\n\t                \n\t            // Add new layer\n\t            layers[index] = layer;\n\n\t        }\n\n\t        return layer;\n\n\t    }\n\n\t    function getParser(index) {\n\n\t        var parser = parsers[index];\n\n\t        // If parser not yet created, create it, and tie to the\n\t        // oninstruction handler of the tunnel.\n\t        if (parser == null) {\n\t            parser = parsers[index] = new Guacamole.Parser();\n\t            parser.oninstruction = tunnel.oninstruction;\n\t        }\n\n\t        return parser;\n\n\t    }\n\n\t    function getAudioChannel(index) {\n\n\t        var audio_channel = audio_channels[index];\n\n\t        // If audio channel not yet created, create it\n\t        if (audio_channel == null)\n\t            audio_channel = audio_channels[index] = new Guacamole.AudioChannel();\n\n\t        return audio_channel;\n\n\t    }\n\n\t    /**\n\t     * Handlers for all defined layer properties.\n\t     * @private\n\t     */\n\t    var layerPropertyHandlers = {\n\n\t        \"miter-limit\": function(layer, value) {\n\t            display.setMiterLimit(layer, parseFloat(value));\n\t        }\n\n\t    };\n\t    \n\t    /**\n\t     * Handlers for all instruction opcodes receivable by a Guacamole protocol\n\t     * client.\n\t     * @private\n\t     */\n\t    var instructionHandlers = {\n\n\t\t\t\"turn\": function(parameters) {\n\t\t\t\tif (guac_client.onturn)\n\t                guac_client.onturn(parameters);\n\t\t\t},\n\t\t\t\"rename\": function(parameters) {\n\t\t\t\tif (guac_client.onrename)\n\t                guac_client.onrename(parameters);\n\t\t\t},\n\t\t\t\"chat\": function(parameters) {\n\t\t\t\tif (guac_client.onchat)\n\t                guac_client.onchat(parameters);\n\t\t\t},\n\t\t\t\"admin\": function(parameters) {\n\t\t\t\tif (guac_client.onadmin)\n\t                guac_client.onadmin(parameters);\n\t\t\t},\n\t\t\t\"adduser\": function(parameters) {\n\t\t\t\tif (guac_client.onadduser)\n\t                guac_client.onadduser(parameters);\n\t\t\t},\n\t\t\t\"remuser\": function(parameters) {\n\t\t\t\tif (guac_client.onremuser)\n\t                guac_client.onremuser(parameters);\n\t\t\t},\n\t\t\t\"connect\": function(parameters) {\n\t\t\t\tif (guac_client.onconnect)\n\t                guac_client.onconnect(parameters);\n\t\t\t},\n\t\t\t\"list\": function(parameters) {\n\t\t\t\tif (guac_client.onlist)\n\t                guac_client.onlist(parameters);\n\t\t\t},\n\t\t\t\"vote\": function(parameters) {\n\t\t\t\tif (guac_client.onvote)\n\t                guac_client.onvote(parameters);\n\t\t\t},\n\t\t\t\"action\": function(parameters) {\n\t\t\t\tif (guac_client.onaction)\n\t                guac_client.onaction(parameters);\n\t\t\t},\n\t\t\t\"file\": function(parameters) {\n\t\t\t\tif (guac_client.onfile)\n\t                guac_client.onfile(parameters);\n\t\t\t},\n\t\t\t\"nop\": function() {\n\t\t\t\t// Keep-alive\n\t\t\t\ttunnel.sendMessage(\"nop\");\n\t\t\t},\n\t        \"ack\": function(parameters) {\n\n\t            var stream_index = parseInt(parameters[0]);\n\t            var reason = parameters[1];\n\t            var code = parseInt(parameters[2]);\n\n\t            // Get stream\n\t            var stream = output_streams[stream_index];\n\t            if (stream) {\n\n\t                // Signal ack if handler defined\n\t                if (stream.onack)\n\t                    stream.onack(new Guacamole.Status(code, reason));\n\n\t                // If code is an error, invalidate stream\n\t                if (code >= 0x0100) {\n\t                    stream_indices.free(stream_index);\n\t                    delete output_streams[stream_index];\n\t                }\n\n\t            }\n\n\t        },\n\n\t        \"arc\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var x = parseInt(parameters[1]);\n\t            var y = parseInt(parameters[2]);\n\t            var radius = parseInt(parameters[3]);\n\t            var startAngle = parseFloat(parameters[4]);\n\t            var endAngle = parseFloat(parameters[5]);\n\t            var negative = parseInt(parameters[6]);\n\n\t            display.arc(layer, x, y, radius, startAngle, endAngle, negative != 0);\n\n\t        },\n\n\t        \"audio\": function(parameters) {\n\n\t            var stream_index = parseInt(parameters[0]);\n\t            var channel = getAudioChannel(parseInt(parameters[1]));\n\t            var mimetype = parameters[2];\n\t            var duration = parseFloat(parameters[3]);\n\n\t            // Create stream \n\t            var stream = streams[stream_index] =\n\t                    new Guacamole.InputStream(guac_client, stream_index);\n\n\t            // Assemble entire stream as a blob\n\t            var blob_reader = new Guacamole.BlobReader(stream, mimetype);\n\n\t            // Play blob as audio\n\t            blob_reader.onend = function() {\n\t                channel.play(mimetype, duration, blob_reader.getBlob());\n\t            };\n\n\t            // Send success response\n\t            guac_client.sendAck(stream_index, \"OK\", 0x0000);\n\n\t        },\n\n\t        \"blob\": function(parameters) {\n\n\t            // Get stream \n\t            var stream_index = parseInt(parameters[0]);\n\t            var data = parameters[1];\n\t            var stream = streams[stream_index];\n\n\t            // Write data\n\t            stream.onblob(data);\n\n\t        },\n\n\t        \"cfill\": function(parameters) {\n\n\t            var channelMask = parseInt(parameters[0]);\n\t            var layer = getLayer(parseInt(parameters[1]));\n\t            var r = parseInt(parameters[2]);\n\t            var g = parseInt(parameters[3]);\n\t            var b = parseInt(parameters[4]);\n\t            var a = parseInt(parameters[5]);\n\n\t            display.setChannelMask(layer, channelMask);\n\t            display.fillColor(layer, r, g, b, a);\n\n\t        },\n\n\t        \"clip\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\n\t            display.clip(layer);\n\n\t        },\n\n\t        \"clipboard\": function(parameters) {\n\n\t            var stream_index = parseInt(parameters[0]);\n\t            var mimetype = parameters[1];\n\n\t            // Create stream \n\t            if (guac_client.onclipboard) {\n\t                var stream = streams[stream_index] = new Guacamole.InputStream(guac_client, stream_index);\n\t                guac_client.onclipboard(stream, mimetype);\n\t            }\n\n\t            // Otherwise, unsupported\n\t            else\n\t                guac_client.sendAck(stream_index, \"Clipboard unsupported\", 0x0100);\n\n\t        },\n\n\t        \"close\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\n\t            display.close(layer);\n\n\t        },\n\n\t        \"copy\": function(parameters) {\n\n\t            var srcL = getLayer(parseInt(parameters[0]));\n\t            var srcX = parseInt(parameters[1]);\n\t            var srcY = parseInt(parameters[2]);\n\t            var srcWidth = parseInt(parameters[3]);\n\t            var srcHeight = parseInt(parameters[4]);\n\t            var channelMask = parseInt(parameters[5]);\n\t            var dstL = getLayer(parseInt(parameters[6]));\n\t            var dstX = parseInt(parameters[7]);\n\t            var dstY = parseInt(parameters[8]);\n\n\t            display.setChannelMask(dstL, channelMask);\n\t            display.copy(srcL, srcX, srcY, srcWidth, srcHeight, \n\t                         dstL, dstX, dstY);\n\n\t        },\n\n\t        \"cstroke\": function(parameters) {\n\n\t            var channelMask = parseInt(parameters[0]);\n\t            var layer = getLayer(parseInt(parameters[1]));\n\t            var cap = lineCap[parseInt(parameters[2])];\n\t            var join = lineJoin[parseInt(parameters[3])];\n\t            var thickness = parseInt(parameters[4]);\n\t            var r = parseInt(parameters[5]);\n\t            var g = parseInt(parameters[6]);\n\t            var b = parseInt(parameters[7]);\n\t            var a = parseInt(parameters[8]);\n\n\t            display.setChannelMask(layer, channelMask);\n\t            display.strokeColor(layer, cap, join, thickness, r, g, b, a);\n\n\t        },\n\n\t        \"cursor\": function(parameters) {\n\n\t            var cursorHotspotX = parseInt(parameters[0]);\n\t            var cursorHotspotY = parseInt(parameters[1]);\n\t            var srcL = getLayer(parseInt(parameters[2]));\n\t            var srcX = parseInt(parameters[3]);\n\t            var srcY = parseInt(parameters[4]);\n\t            var srcWidth = parseInt(parameters[5]);\n\t            var srcHeight = parseInt(parameters[6]);\n\n\t            display.setCursor(cursorHotspotX, cursorHotspotY,\n\t                              srcL, srcX, srcY, srcWidth, srcHeight);\n\n\t        },\n\n\t        \"curve\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var cp1x = parseInt(parameters[1]);\n\t            var cp1y = parseInt(parameters[2]);\n\t            var cp2x = parseInt(parameters[3]);\n\t            var cp2y = parseInt(parameters[4]);\n\t            var x = parseInt(parameters[5]);\n\t            var y = parseInt(parameters[6]);\n\n\t            display.curveTo(layer, cp1x, cp1y, cp2x, cp2y, x, y);\n\n\t        },\n\n\t        \"dispose\": function(parameters) {\n\t            \n\t            var layer_index = parseInt(parameters[0]);\n\n\t            // If visible layer, remove from parent\n\t            if (layer_index > 0) {\n\n\t                // Remove from parent\n\t                var layer = getLayer(layer_index);\n\t                layer.dispose();\n\n\t                // Delete reference\n\t                delete layers[layer_index];\n\n\t            }\n\n\t            // If buffer, just delete reference\n\t            else if (layer_index < 0)\n\t                delete layers[layer_index];\n\n\t            // Attempting to dispose the root layer currently has no effect.\n\n\t        },\n\n\t        \"distort\": function(parameters) {\n\n\t            var layer_index = parseInt(parameters[0]);\n\t            var a = parseFloat(parameters[1]);\n\t            var b = parseFloat(parameters[2]);\n\t            var c = parseFloat(parameters[3]);\n\t            var d = parseFloat(parameters[4]);\n\t            var e = parseFloat(parameters[5]);\n\t            var f = parseFloat(parameters[6]);\n\n\t            // Only valid for visible layers (not buffers)\n\t            if (layer_index >= 0) {\n\t                var layer = getLayer(layer_index);\n\t                layer.distort(a, b, c, d, e, f);\n\t            }\n\n\t        },\n\t \n\t        \"error\": function(parameters) {\n\n\t            var reason = parameters[0];\n\t            var code = parseInt(parameters[1]);\n\n\t            // Call handler if defined\n\t            if (guac_client.onerror)\n\t                guac_client.onerror(new Guacamole.Status(code, reason));\n\n\t            guac_client.disconnect();\n\n\t        },\n\n\t        \"end\": function(parameters) {\n\n\t            // Get stream\n\t            var stream_index = parseInt(parameters[0]);\n\t            var stream = streams[stream_index];\n\n\t            // Signal end of stream\n\t            if (stream.onend)\n\t                stream.onend();\n\n\t        },\n\n\t        /*\"file\": function(parameters) {\n\n\t            var stream_index = parseInt(parameters[0]);\n\t            var mimetype = parameters[1];\n\t            var filename = parameters[2];\n\n\t            // Create stream \n\t            if (guac_client.onfile) {\n\t                var stream = streams[stream_index] = new Guacamole.InputStream(guac_client, stream_index);\n\t                guac_client.onfile(stream, mimetype, filename);\n\t            }\n\n\t            // Otherwise, unsupported\n\t            else\n\t                guac_client.sendAck(stream_index, \"File transfer unsupported\", 0x0100);\n\n\t        },*/\n\n\t        \"identity\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\n\t            display.setTransform(layer, 1, 0, 0, 1, 0, 0);\n\n\t        },\n\n\t        \"lfill\": function(parameters) {\n\n\t            var channelMask = parseInt(parameters[0]);\n\t            var layer = getLayer(parseInt(parameters[1]));\n\t            var srcLayer = getLayer(parseInt(parameters[2]));\n\n\t            display.setChannelMask(layer, channelMask);\n\t            display.fillLayer(layer, srcLayer);\n\n\t        },\n\n\t        \"line\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var x = parseInt(parameters[1]);\n\t            var y = parseInt(parameters[2]);\n\n\t            display.lineTo(layer, x, y);\n\n\t        },\n\n\t        \"lstroke\": function(parameters) {\n\n\t            var channelMask = parseInt(parameters[0]);\n\t            var layer = getLayer(parseInt(parameters[1]));\n\t            var srcLayer = getLayer(parseInt(parameters[2]));\n\n\t            display.setChannelMask(layer, channelMask);\n\t            display.strokeLayer(layer, srcLayer);\n\n\t        },\n\n\t        \"move\": function(parameters) {\n\t            \n\t            var layer_index = parseInt(parameters[0]);\n\t            var parent_index = parseInt(parameters[1]);\n\t            var x = parseInt(parameters[2]);\n\t            var y = parseInt(parameters[3]);\n\t            var z = parseInt(parameters[4]);\n\n\t            // Only valid for non-default layers\n\t            if (layer_index > 0 && parent_index >= 0) {\n\t                var layer = getLayer(layer_index);\n\t                var parent = getLayer(parent_index);\n\t                layer.move(parent, x, y, z);\n\t            }\n\n\t        },\n\n\t        \"name\": function(parameters) {\n\t            if (guac_client.onname) guac_client.onname(parameters[0]);\n\t        },\n\n\t        \"nest\": function(parameters) {\n\t            var parser = getParser(parseInt(parameters[0]));\n\t            parser.receive(parameters[1]);\n\t        },\n\n\t        \"pipe\": function(parameters) {\n\n\t            var stream_index = parseInt(parameters[0]);\n\t            var mimetype = parameters[1];\n\t            var name = parameters[2];\n\n\t            // Create stream \n\t            if (guac_client.onpipe) {\n\t                var stream = streams[stream_index] = new Guacamole.InputStream(guac_client, stream_index);\n\t                guac_client.onpipe(stream, mimetype, name);\n\t            }\n\n\t            // Otherwise, unsupported\n\t            else\n\t                guac_client.sendAck(stream_index, \"Named pipes unsupported\", 0x0100);\n\n\t        },\n\n\t        \"png\": function(parameters) {\n\n\t            var channelMask = parseInt(parameters[0]);\n\t            var layer = getLayer(parseInt(parameters[1]));\n\t            var x = parseInt(parameters[2]);\n\t            var y = parseInt(parameters[3]);\n\t            var data = parameters[4];\n\n\t            display.setChannelMask(layer, channelMask);\n\t            display.draw(layer, x, y, \"data:image/png;base64,\" + data);\n\n\t        },\n\n\t        \"pop\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\n\t            display.pop(layer);\n\n\t        },\n\n\t        \"push\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\n\t            display.push(layer);\n\n\t        },\n\t \n\t        \"rect\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var x = parseInt(parameters[1]);\n\t            var y = parseInt(parameters[2]);\n\t            var w = parseInt(parameters[3]);\n\t            var h = parseInt(parameters[4]);\n\n\t            display.rect(layer, x, y, w, h);\n\n\t        },\n\t        \n\t        \"reset\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\n\t            display.reset(layer);\n\n\t        },\n\t        \n\t        \"set\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var name = parameters[1];\n\t            var value = parameters[2];\n\n\t            // Call property handler if defined\n\t            var handler = layerPropertyHandlers[name];\n\t            if (handler)\n\t                handler(layer, value);\n\n\t        },\n\n\t        \"shade\": function(parameters) {\n\t            \n\t            var layer_index = parseInt(parameters[0]);\n\t            var a = parseInt(parameters[1]);\n\n\t            // Only valid for visible layers (not buffers)\n\t            if (layer_index >= 0) {\n\t                var layer = getLayer(layer_index);\n\t                layer.shade(a);\n\t            }\n\n\t        },\n\n\t        \"size\": function(parameters) {\n\n\t            var layer_index = parseInt(parameters[0]);\n\t            var layer = getLayer(layer_index);\n\t            var width = parseInt(parameters[1]);\n\t            var height = parseInt(parameters[2]);\n\n\t            display.resize(layer, width, height);\n\n\t        },\n\t        \n\t        \"start\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var x = parseInt(parameters[1]);\n\t            var y = parseInt(parameters[2]);\n\n\t            display.moveTo(layer, x, y);\n\n\t        },\n\n\t        \"sync\": function(parameters) {\n\n\t            var timestamp = parseInt(parameters[0]);\n\n\t            // Flush display, send sync when done\n\t            display.flush(/*function __send_sync_response() {\n\t                if (timestamp !== currentTimestamp) {\n\t                    tunnel.sendMessage(\"sync\", timestamp);\n\t                    currentTimestamp = timestamp;\n\t                }\n\t            }*/ null);\n\n\t            // If received first update, no longer waiting.\n\t            /*if (currentState === STATE_WAITING)\n\t                setState(STATE_CONNECTED);*/\n\n\t            // Call sync handler if defined\n\t            if (guac_client.onsync)\n\t                guac_client.onsync(timestamp);\n\n\t        },\n\n\t        \"transfer\": function(parameters) {\n\n\t            var srcL = getLayer(parseInt(parameters[0]));\n\t            var srcX = parseInt(parameters[1]);\n\t            var srcY = parseInt(parameters[2]);\n\t            var srcWidth = parseInt(parameters[3]);\n\t            var srcHeight = parseInt(parameters[4]);\n\t            var function_index = parseInt(parameters[5]);\n\t            var dstL = getLayer(parseInt(parameters[6]));\n\t            var dstX = parseInt(parameters[7]);\n\t            var dstY = parseInt(parameters[8]);\n\n\t            /* SRC */\n\t            if (function_index === 0x3)\n\t                display.put(srcL, srcX, srcY, srcWidth, srcHeight, \n\t                    dstL, dstX, dstY);\n\n\t            /* Anything else that isn't a NO-OP */\n\t            else if (function_index !== 0x5)\n\t                display.transfer(srcL, srcX, srcY, srcWidth, srcHeight, \n\t                    dstL, dstX, dstY, Guacamole.Client.DefaultTransferFunction[function_index]);\n\n\t        },\n\n\t        \"transform\": function(parameters) {\n\n\t            var layer = getLayer(parseInt(parameters[0]));\n\t            var a = parseFloat(parameters[1]);\n\t            var b = parseFloat(parameters[2]);\n\t            var c = parseFloat(parameters[3]);\n\t            var d = parseFloat(parameters[4]);\n\t            var e = parseFloat(parameters[5]);\n\t            var f = parseFloat(parameters[6]);\n\n\t            display.transform(layer, a, b, c, d, e, f);\n\n\t        },\n\n\t        \"video\": function(parameters) {\n\n\t            var stream_index = parseInt(parameters[0]);\n\t            var layer = getLayer(parseInt(parameters[1]));\n\t            var mimetype = parameters[2];\n\t            var duration = parseFloat(parameters[3]);\n\n\t            // Create stream \n\t            var stream = streams[stream_index] =\n\t                    new Guacamole.InputStream(guac_client, stream_index);\n\n\t            // Assemble entire stream as a blob\n\t            var blob_reader = new Guacamole.BlobReader(stream, mimetype);\n\n\t            // Play video once finished \n\t            blob_reader.onend = function() {\n\n\t                // Read data from blob from stream\n\t                var reader = new FileReader();\n\t                reader.onload = function() {\n\n\t                    var binary = \"\";\n\t                    var bytes = new Uint8Array(reader.result);\n\n\t                    // Produce binary string from bytes in buffer\n\t                    for (var i=0; i<bytes.byteLength; i++)\n\t                        binary += String.fromCharCode(bytes[i]);\n\n\t                    // Play video\n\t                    layer.play(mimetype, duration, \"data:\" + mimetype + \";base64,\" + window.btoa(binary));\n\n\t                };\n\t                reader.readAsArrayBuffer(blob_reader.getBlob());\n\n\t            };\n\n\t            // Send success response\n\t            tunnel.sendMessage(\"ack\", stream_index, \"OK\", 0x0000);\n\n\t        }\n\n\t    };\n\n\t    tunnel.oninstruction = function(opcode, parameters) {\n\n\t        var handler = instructionHandlers[opcode];\n\t        if (handler)\n\t            handler(parameters);\n\n\t    };\n\n\t    /**\n\t     * Sends a disconnect instruction to the server and closes the tunnel.\n\t     */\n\t    this.disconnect = function() {\n\n\t        // Only attempt disconnection not disconnected.\n\t        if (currentState != STATE_DISCONNECTED\n\t                && currentState != STATE_DISCONNECTING) {\n\n\t            setState(STATE_DISCONNECTING);\n\n\t            // Send disconnect message and disconnect\n\t            tunnel.sendMessage(\"disconnect\");\n\t            tunnel.disconnect();\n\t            setState(STATE_DISCONNECTED);\n\n\t        }\n\n\t    };\n\t    \n\t    /**\n\t     * Connects the underlying tunnel of this Guacamole.Client, passing the\n\t     * given arbitrary data to the tunnel during the connection process.\n\t     *\n\t     * @param data Arbitrary connection data to be sent to the underlying\n\t     *             tunnel during the connection process.\n\t     * @throws {Guacamole.Status} If an error occurs during connection.\n\t     */\n\t    this.connect = function(data) {\n\n\t        setState(STATE_CONNECTING);\n\n\t        try {\n\t            tunnel.connect(data);\n\t        }\n\t        catch (status) {\n\t            setState(STATE_IDLE);\n\t            throw status;\n\t        }\n\n\t        // Ping every 5 seconds (ensure connection alive)\n\t        /*pingInterval = window.setInterval(function() {\n\t            tunnel.sendMessage(\"sync\", currentTimestamp);\n\t        }, 5000);*/\n\n\t        setState(STATE_WAITING);\n\t    };\n\n\t};\n\n\t/**\n\t * Map of all Guacamole binary raster operations to transfer functions.\n\t * @private\n\t */\n\tGuacamole.Client.DefaultTransferFunction = {\n\n\t    /* BLACK */\n\t    0x0: function (src, dst) {\n\t        dst.red = dst.green = dst.blue = 0x00;\n\t    },\n\n\t    /* WHITE */\n\t    0xF: function (src, dst) {\n\t        dst.red = dst.green = dst.blue = 0xFF;\n\t    },\n\n\t    /* SRC */\n\t    0x3: function (src, dst) {\n\t        dst.red   = src.red;\n\t        dst.green = src.green;\n\t        dst.blue  = src.blue;\n\t        dst.alpha = src.alpha;\n\t    },\n\n\t    /* DEST (no-op) */\n\t    0x5: function (src, dst) {\n\t        // Do nothing\n\t    },\n\n\t    /* Invert SRC */\n\t    0xC: function (src, dst) {\n\t        dst.red   = 0xFF & ~src.red;\n\t        dst.green = 0xFF & ~src.green;\n\t        dst.blue  = 0xFF & ~src.blue;\n\t        dst.alpha =  src.alpha;\n\t    },\n\t    \n\t    /* Invert DEST */\n\t    0xA: function (src, dst) {\n\t        dst.red   = 0xFF & ~dst.red;\n\t        dst.green = 0xFF & ~dst.green;\n\t        dst.blue  = 0xFF & ~dst.blue;\n\t    },\n\n\t    /* AND */\n\t    0x1: function (src, dst) {\n\t        dst.red   =  ( src.red   &  dst.red);\n\t        dst.green =  ( src.green &  dst.green);\n\t        dst.blue  =  ( src.blue  &  dst.blue);\n\t    },\n\n\t    /* NAND */\n\t    0xE: function (src, dst) {\n\t        dst.red   = 0xFF & ~( src.red   &  dst.red);\n\t        dst.green = 0xFF & ~( src.green &  dst.green);\n\t        dst.blue  = 0xFF & ~( src.blue  &  dst.blue);\n\t    },\n\n\t    /* OR */\n\t    0x7: function (src, dst) {\n\t        dst.red   =  ( src.red   |  dst.red);\n\t        dst.green =  ( src.green |  dst.green);\n\t        dst.blue  =  ( src.blue  |  dst.blue);\n\t    },\n\n\t    /* NOR */\n\t    0x8: function (src, dst) {\n\t        dst.red   = 0xFF & ~( src.red   |  dst.red);\n\t        dst.green = 0xFF & ~( src.green |  dst.green);\n\t        dst.blue  = 0xFF & ~( src.blue  |  dst.blue);\n\t    },\n\n\t    /* XOR */\n\t    0x6: function (src, dst) {\n\t        dst.red   =  ( src.red   ^  dst.red);\n\t        dst.green =  ( src.green ^  dst.green);\n\t        dst.blue  =  ( src.blue  ^  dst.blue);\n\t    },\n\n\t    /* XNOR */\n\t    0x9: function (src, dst) {\n\t        dst.red   = 0xFF & ~( src.red   ^  dst.red);\n\t        dst.green = 0xFF & ~( src.green ^  dst.green);\n\t        dst.blue  = 0xFF & ~( src.blue  ^  dst.blue);\n\t    },\n\n\t    /* AND inverted source */\n\t    0x4: function (src, dst) {\n\t        dst.red   =  0xFF & (~src.red   &  dst.red);\n\t        dst.green =  0xFF & (~src.green &  dst.green);\n\t        dst.blue  =  0xFF & (~src.blue  &  dst.blue);\n\t    },\n\n\t    /* OR inverted source */\n\t    0xD: function (src, dst) {\n\t        dst.red   =  0xFF & (~src.red   |  dst.red);\n\t        dst.green =  0xFF & (~src.green |  dst.green);\n\t        dst.blue  =  0xFF & (~src.blue  |  dst.blue);\n\t    },\n\n\t    /* AND inverted destination */\n\t    0x2: function (src, dst) {\n\t        dst.red   =  0xFF & ( src.red   & ~dst.red);\n\t        dst.green =  0xFF & ( src.green & ~dst.green);\n\t        dst.blue  =  0xFF & ( src.blue  & ~dst.blue);\n\t    },\n\n\t    /* OR inverted destination */\n\t    0xB: function (src, dst) {\n\t        dst.red   =  0xFF & ( src.red   | ~dst.red);\n\t        dst.green =  0xFF & ( src.green | ~dst.green);\n\t        dst.blue  =  0xFF & ( src.blue  | ~dst.blue);\n\t    }\n\n\t};\n\n\t/*\n\t * Copyright (C) 2015 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Dynamic on-screen keyboard. Given the layout object for an on-screen\n\t * keyboard, this object will construct a clickable on-screen keyboard with its\n\t * own key events.\n\t *\n\t * @constructor\n\t * @param {Guacamole.OnScreenKeyboard.Layout} layout\n\t *     The layout of the on-screen keyboard to display.\n\t */\n\tGuacamole.OnScreenKeyboard = function(layout) {\n\n\t    /**\n\t     * Reference to this Guacamole.OnScreenKeyboard.\n\t     *\n\t     * @type Guacamole.OnScreenKeyboard\n\t     */\n\t    var osk = this;\n\n\t    /**\n\t     * Map of currently-set modifiers to the keysym associated with their\n\t     * original press. When the modifier is cleared, this keysym must be\n\t     * released.\n\t     *\n\t     * @private\n\t     * @type Object.<String, Number>\n\t     */\n\t    var modifierKeysyms = {};\n\n\t    /**\n\t     * Map of all key names to their current pressed states. If a key is not\n\t     * pressed, it may not be in this map at all, but all pressed keys will\n\t     * have a corresponding mapping to true.\n\t     *\n\t     * @type Object.<String, Boolean>\n\t     */\n\t    var pressed = {};\n\n\t    /**\n\t     * All scalable elements which are part of the on-screen keyboard. Each\n\t     * scalable element is carefully controlled to ensure the interface layout\n\t     * and sizing remains constant, even on browsers that would otherwise\n\t     * experience rounding error due to unit conversions.\n\t     *\n\t     * @private\n\t     * @type ScaledElement[]\n\t     */\n\t    var scaledElements = [];\n\n\t    /**\n\t     * Adds a CSS class to an element.\n\t     * \n\t     * @private\n\t     * @function\n\t     * @param {Element} element\n\t     *     The element to add a class to.\n\t     *\n\t     * @param {String} classname\n\t     *     The name of the class to add.\n\t     */\n\t    var addClass = function addClass(element, classname) {\n\n\t        // If classList supported, use that\n\t        if (element.classList)\n\t            element.classList.add(classname);\n\n\t        // Otherwise, simply append the class\n\t        else\n\t            element.className += \" \" + classname;\n\n\t    };\n\n\t    /**\n\t     * Removes a CSS class from an element.\n\t     * \n\t     * @private\n\t     * @function\n\t     * @param {Element} element\n\t     *     The element to remove a class from.\n\t     *\n\t     * @param {String} classname\n\t     *     The name of the class to remove.\n\t     */\n\t    var removeClass = function removeClass(element, classname) {\n\n\t        // If classList supported, use that\n\t        if (element.classList)\n\t            element.classList.remove(classname);\n\n\t        // Otherwise, manually filter out classes with given name\n\t        else {\n\t            element.className = element.className.replace(/([^ ]+)[ ]*/g,\n\t                function removeMatchingClasses(match, testClassname) {\n\n\t                    // If same class, remove\n\t                    if (testClassname === classname)\n\t                        return \"\";\n\n\t                    // Otherwise, allow\n\t                    return match;\n\t                    \n\t                }\n\t            );\n\t        }\n\n\t    };\n\n\t    /**\n\t     * Counter of mouse events to ignore. This decremented by mousemove, and\n\t     * while non-zero, mouse events will have no effect.\n\t     *\n\t     * @private\n\t     * @type Number\n\t     */\n\t    var ignoreMouse = 0;\n\n\t    /**\n\t     * An element whose dimensions are maintained according to an arbitrary\n\t     * scale. The conversion factor for these arbitrary units to pixels is\n\t     * provided later via a call to scale().\n\t     *\n\t     * @private\n\t     * @constructor\n\t     * @param {Element} element\n\t     *     The element whose scale should be maintained.\n\t     *\n\t     * @param {Number} width\n\t     *     The width of the element, in arbitrary units, relative to other\n\t     *     ScaledElements.\n\t     *\n\t     * @param {Number} height\n\t     *     The height of the element, in arbitrary units, relative to other\n\t     *     ScaledElements.\n\t     *     \n\t     * @param {Boolean} [scaleFont=false]\n\t     *     Whether the line height and font size should be scaled as well.\n\t     */\n\t    var ScaledElement = function ScaledElement(element, width, height, scaleFont) {\n\n\t        /**\n\t         * The width of this ScaledElement, in arbitrary units, relative to\n\t         * other ScaledElements.\n\t         *\n\t         * @type Number\n\t         */\n\t         this.width = width;\n\n\t        /**\n\t         * The height of this ScaledElement, in arbitrary units, relative to\n\t         * other ScaledElements.\n\t         *\n\t         * @type Number\n\t         */\n\t         this.height = height;\n\t \n\t        /**\n\t         * Resizes the associated element, updating its dimensions according to\n\t         * the given pixels per unit.\n\t         *\n\t         * @param {Number} pixels\n\t         *     The number of pixels to assign per arbitrary unit.\n\t         */\n\t        this.scale = function(pixels) {\n\n\t            // Scale element width/height\n\t            element.style.width  = (width  * pixels) + \"px\";\n\t            element.style.height = (height * pixels) + \"px\";\n\n\t            // Scale font, if requested\n\t            if (scaleFont) {\n\t                element.style.lineHeight = (height * pixels) + \"px\";\n\t                element.style.fontSize   = pixels + \"px\";\n\t            }\n\n\t        };\n\n\t    };\n\n\t    /**\n\t     * Returns whether all modifiers having the given names are currently\n\t     * active.\n\t     *\n\t     * @param {String[]} names\n\t     *     The names of all modifiers to test.\n\t     *\n\t     * @returns {Boolean}\n\t     *     true if all specified modifiers are pressed, false otherwise.\n\t     */\n\t    var modifiersPressed = function modifiersPressed(names) {\n\n\t        // If any required modifiers are not pressed, return false\n\t        for (var i=0; i < names.length; i++) {\n\n\t            // Test whether current modifier is pressed\n\t            var name = names[i];\n\t            if (!(name in modifierKeysyms))\n\t                return false;\n\n\t        }\n\n\t        // Otherwise, all required modifiers are pressed\n\t        return true;\n\n\t    };\n\n\t    /**\n\t     * Returns the single matching Key object associated with the key of the\n\t     * given name, where that Key object's requirements (such as pressed\n\t     * modifiers) are all currently satisfied.\n\t     *\n\t     * @param {String} keyName\n\t     *     The name of the key to retrieve.\n\t     *\n\t     * @returns {Guacamole.OnScreenKeyboard.Key}\n\t     *     The Key object associated with the given name, where that object's\n\t     *     requirements are all currently satisfied, or null if no such Key\n\t     *     can be found.\n\t     */\n\t    var getActiveKey = function getActiveKey(keyName) {\n\n\t        // Get key array for given name\n\t        var keys = osk.keys[keyName];\n\t        if (!keys)\n\t            return null;\n\n\t        // Find last matching key\n\t        for (var i = keys.length - 1; i >= 0; i--) {\n\n\t            // Get candidate key\n\t            var candidate = keys[i];\n\n\t            // If all required modifiers are pressed, use that key\n\t            if (modifiersPressed(candidate.requires))\n\t                return candidate;\n\n\t        }\n\n\t        // No valid key\n\t        return null;\n\n\t    };\n\n\t    /**\n\t     * Presses the key having the given name, updating the associated key\n\t     * element with the \"guac-keyboard-pressed\" CSS class. If the key is\n\t     * already pressed, this function has no effect.\n\t     *\n\t     * @param {String} keyName\n\t     *     The name of the key to press.\n\t     *\n\t     * @param {String} keyElement\n\t     *     The element associated with the given key.\n\t     */\n\t    var press = function press(keyName, keyElement) {\n\t\t\t\n\t\t\tif (osk.disabled)\n\t\t\t\treturn;\n\t\t\t\n\t        // Press key if not yet pressed\n\t        if (!pressed[keyName]) {\n\n\t            addClass(keyElement, \"guac-keyboard-pressed\");\n\n\t            // Get current key based on modifier state\n\t            var key = getActiveKey(keyName);\n\n\t            // Update modifier state\n\t            if (key.modifier) {\n\n\t                // Construct classname for modifier\n\t                var modifierClass = \"guac-keyboard-modifier-\" + getCSSName(key.modifier);\n\n\t                // Retrieve originally-pressed keysym, if modifier was already pressed\n\t                var originalKeysym = modifierKeysyms[key.modifier];\n\n\t                // Activate modifier if not pressed\n\t                if (!originalKeysym) {\n\t                    \n\t                    addClass(keyboard, modifierClass);\n\t                    modifierKeysyms[key.modifier] = key.keysym;\n\t                    \n\t                    // Send key event\n\t                    if (osk.onkeydown)\n\t                        osk.onkeydown(key.keysym);\n\n\t                }\n\n\t                // Deactivate if not pressed\n\t                else {\n\n\t                    removeClass(keyboard, modifierClass);\n\t                    delete modifierKeysyms[key.modifier];\n\t                    \n\t                    // Send key event\n\t                    if (osk.onkeyup)\n\t                        osk.onkeyup(originalKeysym);\n\n\t                }\n\n\t            }\n\n\t            // If not modifier, send key event now\n\t            else if (osk.onkeydown)\n\t                osk.onkeydown(key.keysym);\n\n\t            // Mark key as pressed\n\t            pressed[keyName] = true;\n\n\t        }\n\n\t    };\n\n\t    /**\n\t     * Releases the key having the given name, removing the\n\t     * \"guac-keyboard-pressed\" CSS class from the associated element. If the\n\t     * key is already released, this function has no effect.\n\t     *\n\t     * @param {String} keyName\n\t     *     The name of the key to release.\n\t     *\n\t     * @param {String} keyElement\n\t     *     The element associated with the given key.\n\t     */\n\t    var release = function release(keyName, keyElement) {\n\n\t\t\tif (osk.disabled)\n\t\t\t\treturn;\n\t\t\t\n\t        // Release key if currently pressed\n\t        if (pressed[keyName]) {\n\n\t            removeClass(keyElement, \"guac-keyboard-pressed\");\n\n\t            // Get current key based on modifier state\n\t            var key = getActiveKey(keyName);\n\n\t            // Send key event if not a modifier key\n\t            if (!key.modifier && osk.onkeyup)\n\t                osk.onkeyup(key.keysym);\n\n\t            // Mark key as released\n\t            pressed[keyName] = false;\n\n\t        }\n\n\t    };\n\n\t    // Create keyboard\n\t    var keyboard = document.createElement(\"div\");\n\t    keyboard.className = \"guac-keyboard\";\n\n\t    // Do not allow selection or mouse movement to propagate/register.\n\t    keyboard.onselectstart =\n\t    keyboard.onmousemove   =\n\t    keyboard.onmouseup     =\n\t    keyboard.onmousedown   = function handleMouseEvents(e) {\n\n\t        // If ignoring events, decrement counter\n\t        if (ignoreMouse)\n\t            ignoreMouse--;\n\n\t        e.stopPropagation();\n\t        return false;\n\n\t    };\n\n\t    /**\n\t     * The number of mousemove events to require before re-enabling mouse\n\t     * event handling after receiving a touch event.\n\t     *\n\t     * @type Number\n\t     */\n\t    this.touchMouseThreshold = 3;\n\n\t    /**\n\t     * Fired whenever the user presses a key on this Guacamole.OnScreenKeyboard.\n\t     * \n\t     * @event\n\t     * @param {Number} keysym The keysym of the key being pressed.\n\t     */\n\t    this.onkeydown = null;\n\n\t    /**\n\t     * Fired whenever the user releases a key on this Guacamole.OnScreenKeyboard.\n\t     * \n\t     * @event\n\t     * @param {Number} keysym The keysym of the key being released.\n\t     */\n\t    this.onkeyup = null;\n\n\t    /**\n\t     * The keyboard layout provided at time of construction.\n\t     *\n\t     * @type Guacamole.OnScreenKeyboard.Layout\n\t     */\n\t    this.layout = new Guacamole.OnScreenKeyboard.Layout(layout);\n\n\t    /**\n\t     * Returns the element containing the entire on-screen keyboard.\n\t     * @returns {Element} The element containing the entire on-screen keyboard.\n\t     */\n\t    this.getElement = function() {\n\t        return keyboard;\n\t    };\n\n\t    /**\n\t     * Resizes all elements within this Guacamole.OnScreenKeyboard such that\n\t     * the width is close to but does not exceed the specified width. The\n\t     * height of the keyboard is determined based on the width.\n\t     * \n\t     * @param {Number} width The width to resize this Guacamole.OnScreenKeyboard\n\t     *                       to, in pixels.\n\t     */\n\t    this.resize = function(width) {\n\n\t        // Get pixel size of a unit\n\t        var unit = Math.floor(width * 10 / osk.layout.width) / 10;\n\n\t        // Resize all scaled elements\n\t        for (var i=0; i<scaledElements.length; i++) {\n\t            var scaledElement = scaledElements[i];\n\t            scaledElement.scale(unit);\n\t        }\n\n\t    };\n\n\t    /**\n\t     * Given the name of a key and its corresponding definition, which may be\n\t     * an array of keys objects, a number (keysym), a string (key title), or a\n\t     * single key object, returns an array of key objects, deriving any missing\n\t     * properties as needed, and ensuring the key name is defined.\n\t     *\n\t     * @private\n\t     * @param {String} name\n\t     *     The name of the key being coerced into an array of Key objects.\n\t     *\n\t     * @param {Number|String|Guacamole.OnScreenKeyboard.Key|Guacamole.OnScreenKeyboard.Key[]} object\n\t     *     The object defining the behavior of the key having the given name,\n\t     *     which may be the title of the key (a string), the keysym (a number),\n\t     *     a single Key object, or an array of Key objects.\n\t     *     \n\t     * @returns {Guacamole.OnScreenKeyboard.Key[]}\n\t     *     An array of all keys associated with the given name.\n\t     */\n\t    var asKeyArray = function asKeyArray(name, object) {\n\n\t        // If already an array, just coerce into a true Key[] \n\t        if (object instanceof Array) {\n\t            var keys = [];\n\t            for (var i=0; i < object.length; i++) {\n\t                keys.push(new Guacamole.OnScreenKeyboard.Key(object[i], name));\n\t            }\n\t            return keys;\n\t        }\n\n\t        // Derive key object from keysym if that's all we have\n\t        if (typeof object === 'number') {\n\t            return [new Guacamole.OnScreenKeyboard.Key({\n\t                name   : name,\n\t                keysym : object\n\t            })];\n\t        }\n\n\t        // Derive key object from title if that's all we have\n\t        if (typeof object === 'string') {\n\t            return [new Guacamole.OnScreenKeyboard.Key({\n\t                name  : name,\n\t                title : object\n\t            })];\n\t        }\n\n\t        // Otherwise, assume it's already a key object, just not an array\n\t        return [new Guacamole.OnScreenKeyboard.Key(object, name)];\n\n\t    };\n\n\t    /**\n\t     * Converts the rather forgiving key mapping allowed by\n\t     * Guacamole.OnScreenKeyboard.Layout into a rigorous mapping of key name\n\t     * to key definition, where the key definition is always an array of Key\n\t     * objects.\n\t     *\n\t     * @private\n\t     * @param {Object.<String, Number|String|Guacamole.OnScreenKeyboard.Key|Guacamole.OnScreenKeyboard.Key[]>} keys\n\t     *     A mapping of key name to key definition, where the key definition is\n\t     *     the title of the key (a string), the keysym (a number), a single\n\t     *     Key object, or an array of Key objects.\n\t     *\n\t     * @returns {Object.<String, Guacamole.OnScreenKeyboard.Key[]>}\n\t     *     A more-predictable mapping of key name to key definition, where the\n\t     *     key definition is always simply an array of Key objects.\n\t     */\n\t    var getKeys = function getKeys(keys) {\n\n\t        var keyArrays = {};\n\n\t        // Coerce all keys into individual key arrays\n\t        for (var name in layout.keys) {\n\t            keyArrays[name] = asKeyArray(name, keys[name]);\n\t        }\n\n\t        return keyArrays;\n\n\t    };\n\n\t    /**\n\t     * Map of all key names to their corresponding set of keys. Each key name\n\t     * may correspond to multiple keys due to the effect of modifiers.\n\t     *\n\t     * @type Object.<String, Guacamole.OnScreenKeyboard.Key[]>\n\t     */\n\t    this.keys = getKeys(layout.keys);\n\n\t    /**\n\t     * Given an arbitrary string representing the name of some component of the\n\t     * on-screen keyboard, returns a string formatted for use as a CSS class\n\t     * name. The result will be lowercase. Word boundaries previously denoted\n\t     * by CamelCase will be replaced by individual hyphens, as will all\n\t     * contiguous non-alphanumeric characters.\n\t     *\n\t     * @private\n\t     * @param {String} name\n\t     *     An arbitrary string representing the name of some component of the\n\t     *     on-screen keyboard.\n\t     *\n\t     * @returns {String}\n\t     *     A string formatted for use as a CSS class name.\n\t     */\n\t    var getCSSName = function getCSSName(name) {\n\n\t        // Convert name from possibly-CamelCase to hyphenated lowercase\n\t        var cssName = name\n\t               .replace(/([a-z])([A-Z])/g, '$1-$2')\n\t               .replace(/[^A-Za-z0-9]+/g, '-')\n\t               .toLowerCase();\n\n\t        return cssName;\n\n\t    };\n\n\t    /**\n\t     * Appends DOM elements to the given element as dictated by the layout\n\t     * structure object provided. If a name is provided, an additional CSS\n\t     * class, prepended with \"guac-keyboard-\", will be added to the top-level\n\t     * element.\n\t     * \n\t     * If the layout structure object is an array, all elements within that\n\t     * array will be recursively appended as children of a group, and the\n\t     * top-level element will be given the CSS class \"guac-keyboard-group\".\n\t     *\n\t     * If the layout structure object is an object, all properties within that\n\t     * object will be recursively appended as children of a group, and the\n\t     * top-level element will be given the CSS class \"guac-keyboard-group\". The\n\t     * name of each property will be applied as the name of each child object\n\t     * for the sake of CSS. Each property will be added in sorted order.\n\t     *\n\t     * If the layout structure object is a string, the key having that name\n\t     * will be appended. The key will be given the CSS class\n\t     * \"guac-keyboard-key\" and \"guac-keyboard-key-NAME\", where NAME is the name\n\t     * of the key. If the name of the key is a single character, this will\n\t     * first be transformed into the C-style hexadecimal literal for the\n\t     * Unicode codepoint of that character. For example, the key \"A\" would\n\t     * become \"guac-keyboard-key-0x41\".\n\t     * \n\t     * If the layout structure object is a number, a gap of that size will be\n\t     * inserted. The gap will be given the CSS class \"guac-keyboard-gap\", and\n\t     * will be scaled according to the same size units as each key.\n\t     *\n\t     * @private\n\t     * @param {Element} element\n\t     *     The element to append elements to.\n\t     *\n\t     * @param {Array|Object|String|Number} object\n\t     *     The layout structure object to use when constructing the elements to\n\t     *     append.\n\t     *\n\t     * @param {String} [name]\n\t     *     The name of the top-level element being appended, if any.\n\t     */\n\t    var appendElements = function appendElements(element, object, name) {\n\n\t        var i;\n\n\t        // Create div which will become the group or key\n\t        var div = document.createElement('div');\n\n\t        // Add class based on name, if name given\n\t        if (name)\n\t            addClass(div, 'guac-keyboard-' + getCSSName(name));\n\n\t        // If an array, append each element\n\t        if (object instanceof Array) {\n\n\t            // Add group class\n\t            addClass(div, 'guac-keyboard-group');\n\n\t            // Append all elements of array\n\t            for (i=0; i < object.length; i++)\n\t                appendElements(div, object[i]);\n\n\t        }\n\n\t        // If an object, append each property value\n\t        else if (object instanceof Object) {\n\n\t            // Add group class\n\t            addClass(div, 'guac-keyboard-group');\n\n\t            // Append all children, sorted by name\n\t            var names = Object.keys(object).sort();\n\t            for (i=0; i < names.length; i++) {\n\t                var name = names[i];\n\t                appendElements(div, object[name], name);\n\t            }\n\n\t        }\n\n\t        // If a number, create as a gap \n\t        else if (typeof object === 'number') {\n\n\t            // Add gap class\n\t            addClass(div, 'guac-keyboard-gap');\n\n\t            // Maintain scale\n\t            scaledElements.push(new ScaledElement(div, object, object));\n\n\t        }\n\n\t        // If a string, create as a key\n\t        else if (typeof object === 'string') {\n\n\t            // If key name is only one character, use codepoint for name\n\t            var keyName = object;\n\t            if (keyName.length === 1)\n\t                keyName = '0x' + keyName.charCodeAt(0).toString(16);\n\n\t            // Add key container class\n\t            addClass(div, 'guac-keyboard-key-container');\n\n\t            // Create key element which will contain all possible caps\n\t            var keyElement = document.createElement('div');\n\t            keyElement.className = 'guac-keyboard-key '\n\t                                 + 'guac-keyboard-key-' + getCSSName(keyName);\n\n\t            // Add all associated keys as caps within DOM\n\t            var keys = osk.keys[object];\n\t            if (keys) {\n\t                for (i=0; i < keys.length; i++) {\n\n\t                    // Get current key\n\t                    var key = keys[i];\n\n\t                    // Create cap element for key\n\t                    var capElement = document.createElement('div');\n\t                    capElement.className   = 'guac-keyboard-cap';\n\t                    capElement.textContent = key.title;\n\n\t                    // Add classes for any requirements\n\t                    for (var j=0; j < key.requires.length; j++) {\n\t                        var requirement = key.requires[j];\n\t                        addClass(capElement, 'guac-keyboard-requires-' + getCSSName(requirement));\n\t                        addClass(keyElement, 'guac-keyboard-uses-'     + getCSSName(requirement));\n\t                    }\n\n\t                    // Add cap to key within DOM\n\t                    keyElement.appendChild(capElement);\n\n\t                }\n\t            }\n\n\t            // Add key to DOM, maintain scale\n\t            div.appendChild(keyElement);\n\t            scaledElements.push(new ScaledElement(div, osk.layout.keyWidths[object] || 1, 1, true));\n\n\t            /**\n\t             * Handles a touch event which results in the pressing of an OSK\n\t             * key. Touch events will result in mouse events being ignored for\n\t             * touchMouseThreshold events.\n\t             *\n\t             * @param {TouchEvent} e\n\t             *     The touch event being handled.\n\t             */\n\t            var touchPress = function touchPress(e) {\n\t                e.preventDefault();\n\t                ignoreMouse = osk.touchMouseThreshold;\n\t                press(object, keyElement);\n\t            };\n\n\t            /**\n\t             * Handles a touch event which results in the release of an OSK\n\t             * key. Touch events will result in mouse events being ignored for\n\t             * touchMouseThreshold events.\n\t             *\n\t             * @param {TouchEvent} e\n\t             *     The touch event being handled.\n\t             */\n\t            var touchRelease = function touchRelease(e) {\n\t                e.preventDefault();\n\t                ignoreMouse = osk.touchMouseThreshold;\n\t                release(object, keyElement);\n\t            };\n\n\t            /**\n\t             * Handles a mouse event which results in the pressing of an OSK\n\t             * key. If mouse events are currently being ignored, this handler\n\t             * does nothing.\n\t             *\n\t             * @param {MouseEvent} e\n\t             *     The touch event being handled.\n\t             */\n\t            var mousePress = function mousePress(e) {\n\t                e.preventDefault();\n\t                if (ignoreMouse === 0)\n\t                    press(object, keyElement);\n\t            };\n\n\t            /**\n\t             * Handles a mouse event which results in the release of an OSK\n\t             * key. If mouse events are currently being ignored, this handler\n\t             * does nothing.\n\t             *\n\t             * @param {MouseEvent} e\n\t             *     The touch event being handled.\n\t             */\n\t            var mouseRelease = function mouseRelease(e) {\n\t                e.preventDefault();\n\t                if (ignoreMouse === 0)\n\t                    release(object, keyElement);\n\t            };\n\n\t            // Handle touch events on key\n\t            keyElement.addEventListener(\"touchstart\", touchPress,   true);\n\t            keyElement.addEventListener(\"touchend\",   touchRelease, true);\n\n\t            // Handle mouse events on key\n\t            keyElement.addEventListener(\"mousedown\", mousePress,   true);\n\t            keyElement.addEventListener(\"mouseup\",   mouseRelease, true);\n\t            keyElement.addEventListener(\"mouseout\",  mouseRelease, true);\n\n\t        } // end if object is key name\n\n\t        // Add newly-created group/key\n\t        element.appendChild(div);\n\n\t    };\n\n\t    // Create keyboard layout in DOM\n\t    appendElements(keyboard, layout.layout);\n\n\t};\n\n\t/**\n\t * Represents an entire on-screen keyboard layout, including all available\n\t * keys, their behaviors, and their relative position and sizing.\n\t *\n\t * @constructor\n\t * @param {Guacamole.OnScreenKeyboard.Layout|Object} template\n\t *     The object whose identically-named properties will be used to initialize\n\t *     the properties of this layout.\n\t */\n\tGuacamole.OnScreenKeyboard.Layout = function(template) {\n\n\t    /**\n\t     * The language of keyboard layout, such as \"en_US\". This property is for\n\t     * informational purposes only, but it is recommend to conform to the\n\t     * [language code]_[country code] format.\n\t     *\n\t     * @type String\n\t     */\n\t    this.language = template.language;\n\n\t    /**\n\t     * The type of keyboard layout, such as \"qwerty\". This property is for\n\t     * informational purposes only, and does not conform to any standard.\n\t     *\n\t     * @type String\n\t     */\n\t    this.type = template.type;\n\n\t    /**\n\t     * Map of key name to corresponding keysym, title, or key object. If only\n\t     * the keysym or title is provided, the key object will be created\n\t     * implicitly. In all cases, the name property of the key object will be\n\t     * taken from the name given in the mapping.\n\t     *\n\t     * @type Object.<String, Number|String|Guacamole.OnScreenKeyboard.Key|Guacamole.OnScreenKeyboard.Key[]>\n\t     */\n\t    this.keys = template.keys;\n\n\t    /**\n\t     * Arbitrarily nested, arbitrarily grouped key names. The contents of the\n\t     * layout will be traversed to produce an identically-nested grouping of\n\t     * keys in the DOM tree. All strings will be transformed into their\n\t     * corresponding sets of keys, while all objects and arrays will be\n\t     * transformed into named groups and anonymous groups respectively. Any\n\t     * numbers present will be transformed into gaps of that size, scaled\n\t     * according to the same units as each key.\n\t     *\n\t     * @type Object\n\t     */\n\t    this.layout = template.layout;\n\n\t    /**\n\t     * The width of the entire keyboard, in arbitrary units. The width of each\n\t     * key is relative to this width, as both width values are assumed to be in\n\t     * the same units. The conversion factor between these units and pixels is\n\t     * derived later via a call to resize() on the Guacamole.OnScreenKeyboard.\n\t     *\n\t     * @type Number\n\t     */\n\t    this.width = template.width;\n\n\t    /**\n\t     * The width of each key, in arbitrary units, relative to other keys in\n\t     * this layout. The true pixel size of each key will be determined by the\n\t     * overall size of the keyboard. If not defined here, the width of each\n\t     * key will default to 1.\n\t     *\n\t     * @type Object.<String, Number>\n\t     */\n\t    this.keyWidths = template.keyWidths || {};\n\n\t};\n\n\t/**\n\t * Represents a single key, or a single possible behavior of a key. Each key\n\t * on the on-screen keyboard must have at least one associated\n\t * Guacamole.OnScreenKeyboard.Key, whether that key is explicitly defined or\n\t * implied, and may have multiple Guacamole.OnScreenKeyboard.Key if behavior\n\t * depends on modifier states.\n\t *\n\t * @constructor\n\t * @param {Guacamole.OnScreenKeyboard.Key|Object} template\n\t *     The object whose identically-named properties will be used to initialize\n\t *     the properties of this key.\n\t *     \n\t * @param {String} [name]\n\t *     The name to use instead of any name provided within the template, if\n\t *     any. If omitted, the name within the template will be used, assuming the\n\t *     template contains a name.\n\t */\n\tGuacamole.OnScreenKeyboard.Key = function(template, name) {\n\n\t    /**\n\t     * The unique name identifying this key within the keyboard layout.\n\t     *\n\t     * @type String\n\t     */\n\t    this.name = name || template.name;\n\n\t    /**\n\t     * The human-readable title that will be displayed to the user within the\n\t     * key. If not provided, this will be derived from the key name.\n\t     *\n\t     * @type String\n\t     */\n\t    this.title = template.title || this.name;\n\n\t    /**\n\t     * The keysym to be pressed/released when this key is pressed/released. If\n\t     * not provided, this will be derived from the title if the title is a\n\t     * single character.\n\t     *\n\t     * @type Number\n\t     */\n\t    this.keysym = template.keysym || (function deriveKeysym(title) {\n\n\t        // Do not derive keysym if title is not exactly one character\n\t        if (!title || title.length !== 1)\n\t            return null;\n\n\t        // For characters between U+0000 and U+00FF, the keysym is the codepoint\n\t        var charCode = title.charCodeAt(0);\n\t        if (charCode >= 0x0000 && charCode <= 0x00FF)\n\t            return charCode;\n\n\t        // For characters between U+0100 and U+10FFFF, the keysym is the codepoint or'd with 0x01000000\n\t        if (charCode >= 0x0100 && charCode <= 0x10FFFF)\n\t            return 0x01000000 | charCode;\n\n\t        // Unable to derive keysym\n\t        return null;\n\n\t    })(this.title);\n\n\t    /**\n\t     * The name of the modifier set when the key is pressed and cleared when\n\t     * this key is released, if any. The names of modifiers are distinct from\n\t     * the names of keys; both the \"RightShift\" and \"LeftShift\" keys may set\n\t     * the \"shift\" modifier, for example. By default, the key will affect no\n\t     * modifiers.\n\t     * \n\t     * @type String\n\t     */\n\t    this.modifier = template.modifier;\n\n\t    /**\n\t     * An array containing the names of each modifier required for this key to\n\t     * have an effect. For example, a lowercase letter may require nothing,\n\t     * while an uppercase letter would require \"shift\", assuming the Shift key\n\t     * is named \"shift\" within the layout. By default, the key will require\n\t     * no modifiers.\n\t     *\n\t     * @type String[]\n\t     */\n\t    this.requires = template.requires || [];\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * A reader which automatically handles the given input stream, returning\n\t * strictly received packets as array buffers. Note that this object will\n\t * overwrite any installed event handlers on the given Guacamole.InputStream.\n\t * \n\t * @constructor\n\t * @param {Guacamole.InputStream} stream The stream that data will be read\n\t *                                       from.\n\t */\n\tGuacamole.ArrayBufferReader = function(stream) {\n\n\t    /**\n\t     * Reference to this Guacamole.InputStream.\n\t     * @private\n\t     */\n\t    var guac_reader = this;\n\n\t    // Receive blobs as array buffers\n\t    stream.onblob = function(data) {\n\n\t        // Convert to ArrayBuffer\n\t        var binary = window.atob(data);\n\t        var arrayBuffer = new ArrayBuffer(binary.length);\n\t        var bufferView = new Uint8Array(arrayBuffer);\n\n\t        for (var i=0; i<binary.length; i++)\n\t            bufferView[i] = binary.charCodeAt(i);\n\n\t        // Call handler, if present\n\t        if (guac_reader.ondata)\n\t            guac_reader.ondata(arrayBuffer);\n\n\t    };\n\n\t    // Simply call onend when end received\n\t    stream.onend = function() {\n\t        if (guac_reader.onend)\n\t            guac_reader.onend();\n\t    };\n\n\t    /**\n\t     * Fired once for every blob of data received.\n\t     * \n\t     * @event\n\t     * @param {ArrayBuffer} buffer The data packet received.\n\t     */\n\t    this.ondata = null;\n\n\t    /**\n\t     * Fired once this stream is finished and no further data will be written.\n\t     * @event\n\t     */\n\t    this.onend = null;\n\n\t};\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Abstract stream which can receive data.\n\t * \n\t * @constructor\n\t * @param {Guacamole.Client} client The client owning this stream.\n\t * @param {Number} index The index of this stream.\n\t */\n\tGuacamole.OutputStream = function(client, index) {\n\n\t    /**\n\t     * Reference to this stream.\n\t     * @private\n\t     */\n\t    var guac_stream = this;\n\n\t    /**\n\t     * The index of this stream.\n\t     * @type Number\n\t     */\n\t    this.index = index;\n\n\t    /**\n\t     * Fired whenever an acknowledgement is received from the server, indicating\n\t     * that a stream operation has completed, or an error has occurred.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Status} status The status of the operation.\n\t     */\n\t    this.onack = null;\n\n\t    /**\n\t     * Writes the given base64-encoded data to this stream as a blob.\n\t     * \n\t     * @param {String} data The base64-encoded data to send.\n\t     */\n\t    this.sendBlob = function(data) {\n\t        client.sendBlob(guac_stream.index, data);\n\t    };\n\n\t    /**\n\t     * Closes this stream.\n\t     */\n\t    this.sendEnd = function() {\n\t        client.endStream(guac_stream.index);\n\t    };\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * A reader which automatically handles the given input stream, assembling all\n\t * received blobs into a single blob by appending them to each other in order.\n\t * Note that this object will overwrite any installed event handlers on the\n\t * given Guacamole.InputStream.\n\t * \n\t * @constructor\n\t * @param {Guacamole.InputStream} stream The stream that data will be read\n\t *                                       from.\n\t * @param {String} mimetype The mimetype of the blob being built.\n\t */\n\tGuacamole.BlobReader = function(stream, mimetype) {\n\n\t    /**\n\t     * Reference to this Guacamole.InputStream.\n\t     * @private\n\t     */\n\t    var guac_reader = this;\n\n\t    /**\n\t     * The length of this Guacamole.InputStream in bytes.\n\t     * @private\n\t     */\n\t    var length = 0;\n\n\t    // Get blob builder\n\t    var blob_builder;\n\t    if      (window.BlobBuilder)       blob_builder = new BlobBuilder();\n\t    else if (window.WebKitBlobBuilder) blob_builder = new WebKitBlobBuilder();\n\t    else if (window.MozBlobBuilder)    blob_builder = new MozBlobBuilder();\n\t    else\n\t        blob_builder = new (function() {\n\n\t            var blobs = [];\n\n\t            /** @ignore */\n\t            this.append = function(data) {\n\t                blobs.push(new Blob([data], {\"type\": mimetype}));\n\t            };\n\n\t            /** @ignore */\n\t            this.getBlob = function() {\n\t                return new Blob(blobs, {\"type\": mimetype});\n\t            };\n\n\t        })();\n\n\t    // Append received blobs\n\t    stream.onblob = function(data) {\n\n\t        // Convert to ArrayBuffer\n\t        var binary = window.atob(data);\n\t        var arrayBuffer = new ArrayBuffer(binary.length);\n\t        var bufferView = new Uint8Array(arrayBuffer);\n\n\t        for (var i=0; i<binary.length; i++)\n\t            bufferView[i] = binary.charCodeAt(i);\n\n\t        blob_builder.append(arrayBuffer);\n\t        length += arrayBuffer.byteLength;\n\n\t        // Call handler, if present\n\t        if (guac_reader.onprogress)\n\t            guac_reader.onprogress(arrayBuffer.byteLength);\n\n\t        // Send success response\n\t        stream.sendAck(\"OK\", 0x0000);\n\n\t    };\n\n\t    // Simply call onend when end received\n\t    stream.onend = function() {\n\t        if (guac_reader.onend)\n\t            guac_reader.onend();\n\t    };\n\n\t    /**\n\t     * Returns the current length of this Guacamole.InputStream, in bytes.\n\t     * @return {Number} The current length of this Guacamole.InputStream.\n\t     */\n\t    this.getLength = function() {\n\t        return length;\n\t    };\n\n\t    /**\n\t     * Returns the contents of this Guacamole.BlobReader as a Blob.\n\t     * @return {Blob} The contents of this Guacamole.BlobReader.\n\t     */\n\t    this.getBlob = function() {\n\t        return blob_builder.getBlob();\n\t    };\n\n\t    /**\n\t     * Fired once for every blob of data received.\n\t     * \n\t     * @event\n\t     * @param {Number} length The number of bytes received.\n\t     */\n\t    this.onprogress = null;\n\n\t    /**\n\t     * Fired once this stream is finished and no further data will be written.\n\t     * @event\n\t     */\n\t    this.onend = null;\n\n\t};\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * A reader which automatically handles the given input stream, returning\n\t * strictly text data. Note that this object will overwrite any installed event\n\t * handlers on the given Guacamole.InputStream.\n\t * \n\t * @constructor\n\t * @param {Guacamole.InputStream} stream The stream that data will be read\n\t *                                       from.\n\t */\n\tGuacamole.StringReader = function(stream) {\n\n\t    /**\n\t     * Reference to this Guacamole.InputStream.\n\t     * @private\n\t     */\n\t    var guac_reader = this;\n\n\t    /**\n\t     * Wrapped Guacamole.ArrayBufferReader.\n\t     * @private\n\t     * @type Guacamole.ArrayBufferReader\n\t     */\n\t    var array_reader = new Guacamole.ArrayBufferReader(stream);\n\n\t    /**\n\t     * The number of bytes remaining for the current codepoint.\n\t     * \n\t     * @type Number\n\t     */\n\t    var bytes_remaining = 0;\n\n\t    /**\n\t     * The current codepoint value, as calculated from bytes read so far.\n\t     * @type Number\n\t     */\n\t    var codepoint = 0;\n\n\t    /**\n\t     * Decodes the given UTF-8 data into a Unicode string. The data may end in\n\t     * the middle of a multibyte character.\n\t     * \n\t     * @private\n\t     * @param {ArrayBuffer} buffer Arbitrary UTF-8 data.\n\t     * @return {String} A decoded Unicode string.\n\t     */\n\t    function __decode_utf8(buffer) {\n\n\t        var text = \"\";\n\n\t        var bytes = new Uint8Array(buffer);\n\t        for (var i=0; i<bytes.length; i++) {\n\n\t            // Get current byte\n\t            var value = bytes[i];\n\n\t            // Start new codepoint if nothing yet read\n\t            if (bytes_remaining === 0) {\n\n\t                // 1 byte (0xxxxxxx)\n\t                if ((value | 0x7F) === 0x7F)\n\t                    text += String.fromCharCode(value);\n\n\t                // 2 byte (110xxxxx)\n\t                else if ((value | 0x1F) === 0xDF) {\n\t                    codepoint = value & 0x1F;\n\t                    bytes_remaining = 1;\n\t                }\n\n\t                // 3 byte (1110xxxx)\n\t                else if ((value | 0x0F )=== 0xEF) {\n\t                    codepoint = value & 0x0F;\n\t                    bytes_remaining = 2;\n\t                }\n\n\t                // 4 byte (11110xxx)\n\t                else if ((value | 0x07) === 0xF7) {\n\t                    codepoint = value & 0x07;\n\t                    bytes_remaining = 3;\n\t                }\n\n\t                // Invalid byte\n\t                else\n\t                    text += \"\\uFFFD\";\n\n\t            }\n\n\t            // Continue existing codepoint (10xxxxxx)\n\t            else if ((value | 0x3F) === 0xBF) {\n\n\t                codepoint = (codepoint << 6) | (value & 0x3F);\n\t                bytes_remaining--;\n\n\t                // Write codepoint if finished\n\t                if (bytes_remaining === 0)\n\t                    text += String.fromCharCode(codepoint);\n\n\t            }\n\n\t            // Invalid byte\n\t            else {\n\t                bytes_remaining = 0;\n\t                text += \"\\uFFFD\";\n\t            }\n\n\t        }\n\n\t        return text;\n\n\t    }\n\n\t    // Receive blobs as strings\n\t    array_reader.ondata = function(buffer) {\n\n\t        // Decode UTF-8\n\t        var text = __decode_utf8(buffer);\n\n\t        // Call handler, if present\n\t        if (guac_reader.ontext)\n\t            guac_reader.ontext(text);\n\n\t    };\n\n\t    // Simply call onend when end received\n\t    array_reader.onend = function() {\n\t        if (guac_reader.onend)\n\t            guac_reader.onend();\n\t    };\n\n\t    /**\n\t     * Fired once for every blob of text data received.\n\t     * \n\t     * @event\n\t     * @param {String} text The data packet received.\n\t     */\n\t    this.ontext = null;\n\n\t    /**\n\t     * Fired once this stream is finished and no further data will be written.\n\t     * @event\n\t     */\n\t    this.onend = null;\n\n\t};\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Provides cross-browser mouse events for a given element. The events of\n\t * the given element are automatically populated with handlers that translate\n\t * mouse events into a non-browser-specific event provided by the\n\t * Guacamole.Mouse instance.\n\t * \n\t * @constructor\n\t * @param {Element} element The Element to use to provide mouse events.\n\t */\n\tGuacamole.Mouse = function(element) {\n\n\t    /**\n\t     * Reference to this Guacamole.Mouse.\n\t     * @private\n\t     */\n\t    var guac_mouse = this;\n\n\t    /**\n\t     * The number of mousemove events to require before re-enabling mouse\n\t     * event handling after receiving a touch event.\n\t     */\n\t    this.touchMouseThreshold = 3;\n\n\t    /**\n\t     * The minimum amount of pixels scrolled required for a single scroll button\n\t     * click.\n\t     */\n\t    this.scrollThreshold = 120;\n\n\t    /**\n\t     * The number of pixels to scroll per line.\n\t     */\n\t    this.PIXELS_PER_LINE = 40;\n\n\t    /**\n\t     * The number of pixels to scroll per page.\n\t     */\n\t    this.PIXELS_PER_PAGE = 640;\n\n\t    /**\n\t     * The current mouse state. The properties of this state are updated when\n\t     * mouse events fire. This state object is also passed in as a parameter to\n\t     * the handler of any mouse events.\n\t     * \n\t     * @type Guacamole.Mouse.State\n\t     */\n\t    this.currentState = new Guacamole.Mouse.State(\n\t        0, 0, \n\t        false, false, false, false, false\n\t    );\n\n\t    /**\n\t     * Fired whenever the user presses a mouse button down over the element\n\t     * associated with this Guacamole.Mouse.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmousedown = null;\n\n\t    /**\n\t     * Fired whenever the user releases a mouse button down over the element\n\t     * associated with this Guacamole.Mouse.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmouseup = null;\n\n\t    /**\n\t     * Fired whenever the user moves the mouse over the element associated with\n\t     * this Guacamole.Mouse.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmousemove = null;\n\n\t    /**\n\t     * Fired whenever the mouse leaves the boundaries of the element associated\n\t     * with this Guacamole.Mouse.\n\t     * \n\t     * @event\n\t     */\n\t\tthis.onmouseout = null;\n\n\t    /**\n\t     * Counter of mouse events to ignore. This decremented by mousemove, and\n\t     * while non-zero, mouse events will have no effect.\n\t     * @private\n\t     */\n\t    var ignore_mouse = 0;\n\n\t    /**\n\t     * Cumulative scroll delta amount. This value is accumulated through scroll\n\t     * events and results in scroll button clicks if it exceeds a certain\n\t     * threshold.\n\t     */\n\t    var scroll_delta = 0;\n\n\t    function cancelEvent(e) {\n\t        e.stopPropagation();\n\t        if (e.preventDefault) e.preventDefault();\n\t        e.returnValue = false;\n\t    }\n\n\t    // Block context menu so right-click gets sent properly\n\t    element.addEventListener(\"contextmenu\", function(e) {\n\t        cancelEvent(e);\n\t    }, false);\n\n\t    element.addEventListener(\"mousemove\", function(e) {\n\n\t        cancelEvent(e);\n\n\t        // If ignoring events, decrement counter\n\t        if (ignore_mouse) {\n\t            ignore_mouse--;\n\t            return;\n\t        }\n\n\t        guac_mouse.currentState.fromClientPosition(element, e.clientX, e.clientY);\n\n\t        if (guac_mouse.onmousemove)\n\t            guac_mouse.onmousemove(guac_mouse.currentState);\n\n\t    }, false);\n\n\t    element.addEventListener(\"mousedown\", function(e) {\n\n\t        cancelEvent(e);\n\n\t        // Do not handle if ignoring events\n\t        if (ignore_mouse)\n\t            return;\n\n\t        switch (e.button) {\n\t            case 0:\n\t                guac_mouse.currentState.left = true;\n\t                break;\n\t            case 1:\n\t                guac_mouse.currentState.middle = true;\n\t                break;\n\t            case 2:\n\t                guac_mouse.currentState.right = true;\n\t                break;\n\t        }\n\n\t        if (guac_mouse.onmousedown)\n\t            guac_mouse.onmousedown(guac_mouse.currentState);\n\n\t    }, false);\n\n\t    element.addEventListener(\"mouseup\", function(e) {\n\n\t        cancelEvent(e);\n\n\t        // Do not handle if ignoring events\n\t        if (ignore_mouse)\n\t            return;\n\n\t        switch (e.button) {\n\t            case 0:\n\t                guac_mouse.currentState.left = false;\n\t                break;\n\t            case 1:\n\t                guac_mouse.currentState.middle = false;\n\t                break;\n\t            case 2:\n\t                guac_mouse.currentState.right = false;\n\t                break;\n\t        }\n\n\t        if (guac_mouse.onmouseup)\n\t            guac_mouse.onmouseup(guac_mouse.currentState);\n\n\t    }, false);\n\n\t    element.addEventListener(\"mouseout\", function(e) {\n\n\t        // Get parent of the element the mouse pointer is leaving\n\t       \tif (!e) e = window.event;\n\n\t        // Check that mouseout is due to actually LEAVING the element\n\t        var target = e.relatedTarget || e.toElement;\n\t        while (target) {\n\t            if (target === element)\n\t                return;\n\t            target = target.parentNode;\n\t        }\n\n\t        cancelEvent(e);\n\n\t        // Release all buttons\n\t        if (guac_mouse.currentState.left\n\t            || guac_mouse.currentState.middle\n\t            || guac_mouse.currentState.right) {\n\n\t            guac_mouse.currentState.left = false;\n\t            guac_mouse.currentState.middle = false;\n\t            guac_mouse.currentState.right = false;\n\n\t            if (guac_mouse.onmouseup)\n\t                guac_mouse.onmouseup(guac_mouse.currentState);\n\t        }\n\n\t        // Fire onmouseout event\n\t        if (guac_mouse.onmouseout)\n\t            guac_mouse.onmouseout();\n\n\t    }, false);\n\n\t    // Override selection on mouse event element.\n\t    element.addEventListener(\"selectstart\", function(e) {\n\t        cancelEvent(e);\n\t    }, false);\n\n\t    // Ignore all pending mouse events when touch events are the apparent source\n\t    function ignorePendingMouseEvents() { ignore_mouse = guac_mouse.touchMouseThreshold; }\n\n\t    element.addEventListener(\"touchmove\",  ignorePendingMouseEvents, false);\n\t    element.addEventListener(\"touchstart\", ignorePendingMouseEvents, false);\n\t    element.addEventListener(\"touchend\",   ignorePendingMouseEvents, false);\n\n\t    // Scroll wheel support\n\t    function mousewheel_handler(e) {\n\n\t        // Determine approximate scroll amount (in pixels)\n\t        var delta = e.deltaY || -e.wheelDeltaY || -e.wheelDelta;\n\n\t        // If successfully retrieved scroll amount, convert to pixels if not\n\t        // already in pixels\n\t        if (delta) {\n\n\t            // Convert to pixels if delta was lines\n\t            if (e.deltaMode === 1)\n\t                delta = e.deltaY * guac_mouse.PIXELS_PER_LINE;\n\n\t            // Convert to pixels if delta was pages\n\t            else if (e.deltaMode === 2)\n\t                delta = e.deltaY * guac_mouse.PIXELS_PER_PAGE;\n\n\t        }\n\n\t        // Otherwise, assume legacy mousewheel event and line scrolling\n\t        else\n\t            delta = e.detail * guac_mouse.PIXELS_PER_LINE;\n\t        \n\t        // Update overall delta\n\t        scroll_delta += delta;\n\n\t        // Up\n\t        while (scroll_delta <= -guac_mouse.scrollThreshold) {\n\n\t            if (guac_mouse.onmousedown) {\n\t                guac_mouse.currentState.up = true;\n\t                guac_mouse.onmousedown(guac_mouse.currentState);\n\t            }\n\n\t            if (guac_mouse.onmouseup) {\n\t                guac_mouse.currentState.up = false;\n\t                guac_mouse.onmouseup(guac_mouse.currentState);\n\t            }\n\n\t            scroll_delta += guac_mouse.scrollThreshold;\n\n\t        }\n\n\t        // Down\n\t        while (scroll_delta >= guac_mouse.scrollThreshold) {\n\n\t            if (guac_mouse.onmousedown) {\n\t                guac_mouse.currentState.down = true;\n\t                guac_mouse.onmousedown(guac_mouse.currentState);\n\t            }\n\n\t            if (guac_mouse.onmouseup) {\n\t                guac_mouse.currentState.down = false;\n\t                guac_mouse.onmouseup(guac_mouse.currentState);\n\t            }\n\n\t            scroll_delta -= guac_mouse.scrollThreshold;\n\n\t        }\n\n\t        cancelEvent(e);\n\n\t    }\n\n\t    element.addEventListener('DOMMouseScroll', mousewheel_handler, false);\n\t    element.addEventListener('mousewheel',     mousewheel_handler, false);\n\t    element.addEventListener('wheel',          mousewheel_handler, false);\n\n\t    /**\n\t     * Whether the browser supports CSS3 cursor styling, including hotspot\n\t     * coordinates.\n\t     *\n\t     * @private\n\t     * @type Boolean\n\t     */\n\t    var CSS3_CURSOR_SUPPORTED = (function() {\n\n\t        var div = document.createElement(\"div\");\n\n\t        // If no cursor property at all, then no support\n\t        if (!(\"cursor\" in div.style))\n\t            return false;\n\n\t        try {\n\t            // Apply simple 1x1 PNG\n\t            div.style.cursor = \"url(data:image/png;base64,\"\n\t                             + \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAAB\"\n\t                             + \"AQMAAAAl21bKAAAAA1BMVEX///+nxBvI\"\n\t                             + \"AAAACklEQVQI12NgAAAAAgAB4iG8MwAA\"\n\t                             + \"AABJRU5ErkJggg==) 0 0, auto\";\n\t        }\n\t        catch (e) {\n\t            return false;\n\t        }\n\n\t        // Verify cursor property is set to URL with hotspot\n\t        return /\\burl\\([^()]*\\)\\s+0\\s+0\\b/.test(div.style.cursor || \"\");\n\n\t    })();\n\n\t    /**\n\t     * Changes the local mouse cursor to the given canvas, having the given\n\t     * hotspot coordinates. This affects styling of the element backing this\n\t     * Guacamole.Mouse only, and may fail depending on browser support for\n\t     * setting the mouse cursor.\n\t     * \n\t     * If setting the local cursor is desired, it is up to the implementation\n\t     * to do something else, such as use the software cursor built into\n\t     * Guacamole.Display, if the local cursor cannot be set.\n\t     *\n\t     * @param {HTMLCanvasElement} canvas The cursor image.\n\t     * @param {Number} x The X-coordinate of the cursor hotspot.\n\t     * @param {Number} y The Y-coordinate of the cursor hotspot.\n\t     * @return {Boolean} true if the cursor was successfully set, false if the\n\t     *                   cursor could not be set for any reason.\n\t     */\n\t    this.setCursor = function(canvas, x, y) {\n\n\t        // Attempt to set via CSS3 cursor styling\n\t        if (CSS3_CURSOR_SUPPORTED) {\n\t            var dataURL = canvas.toDataURL('image/png');\n\t            element.style.cursor = \"url(\" + dataURL + \") \" + x + \" \" + y + \", auto\";\n\t            return true;\n\t        }\n\n\t        // Otherwise, setting cursor failed\n\t        return false;\n\n\t    };\n\n\t};\n\n\t/**\n\t * Simple container for properties describing the state of a mouse.\n\t * \n\t * @constructor\n\t * @param {Number} x The X position of the mouse pointer in pixels.\n\t * @param {Number} y The Y position of the mouse pointer in pixels.\n\t * @param {Boolean} left Whether the left mouse button is pressed. \n\t * @param {Boolean} middle Whether the middle mouse button is pressed. \n\t * @param {Boolean} right Whether the right mouse button is pressed. \n\t * @param {Boolean} up Whether the up mouse button is pressed (the fourth\n\t *                     button, usually part of a scroll wheel). \n\t * @param {Boolean} down Whether the down mouse button is pressed (the fifth\n\t *                       button, usually part of a scroll wheel). \n\t */\n\tGuacamole.Mouse.State = function(x, y, left, middle, right, up, down) {\n\n\t    /**\n\t     * Reference to this Guacamole.Mouse.State.\n\t     * @private\n\t     */\n\t    var guac_state = this;\n\n\t    /**\n\t     * The current X position of the mouse pointer.\n\t     * @type Number\n\t     */\n\t    this.x = x;\n\n\t    /**\n\t     * The current Y position of the mouse pointer.\n\t     * @type Number\n\t     */\n\t    this.y = y;\n\n\t    /**\n\t     * Whether the left mouse button is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.left = left;\n\n\t    /**\n\t     * Whether the middle mouse button is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.middle = middle;\n\n\t    /**\n\t     * Whether the right mouse button is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.right = right;\n\n\t    /**\n\t     * Whether the up mouse button is currently pressed. This is the fourth\n\t     * mouse button, associated with upward scrolling of the mouse scroll\n\t     * wheel.\n\t     * @type Boolean\n\t     */\n\t    this.up = up;\n\n\t    /**\n\t     * Whether the down mouse button is currently pressed. This is the fifth \n\t     * mouse button, associated with downward scrolling of the mouse scroll\n\t     * wheel.\n\t     * @type Boolean\n\t     */\n\t    this.down = down;\n\n\t    /**\n\t     * Updates the position represented within this state object by the given\n\t     * element and clientX/clientY coordinates (commonly available within event\n\t     * objects). Position is translated from clientX/clientY (relative to\n\t     * viewport) to element-relative coordinates.\n\t     * \n\t     * @param {Element} element The element the coordinates should be relative\n\t     *                          to.\n\t     * @param {Number} clientX The X coordinate to translate, viewport-relative.\n\t     * @param {Number} clientY The Y coordinate to translate, viewport-relative.\n\t     */\n\t    this.fromClientPosition = function(element, clientX, clientY) {\n\t    \n\t        guac_state.x = clientX - element.offsetLeft;\n\t        guac_state.y = clientY - element.offsetTop;\n\n\t        // This is all JUST so we can get the mouse position within the element\n\t        var parent = element.offsetParent;\n\t        while (parent && !(parent === document.body)) {\n\t            guac_state.x -= parent.offsetLeft - parent.scrollLeft;\n\t            guac_state.y -= parent.offsetTop  - parent.scrollTop;\n\n\t            parent = parent.offsetParent;\n\t        }\n\n\t        // Element ultimately depends on positioning within document body,\n\t        // take document scroll into account. \n\t        if (parent) {\n\t            var documentScrollLeft = document.body.scrollLeft || document.documentElement.scrollLeft;\n\t            var documentScrollTop = document.body.scrollTop || document.documentElement.scrollTop;\n\n\t            guac_state.x -= parent.offsetLeft - documentScrollLeft;\n\t            guac_state.y -= parent.offsetTop  - documentScrollTop;\n\t        }\n\n\t    };\n\n\t};\n\n\t/**\n\t * Provides cross-browser relative touch event translation for a given element.\n\t * \n\t * Touch events are translated into mouse events as if the touches occurred\n\t * on a touchpad (drag to push the mouse pointer, tap to click).\n\t * \n\t * @constructor\n\t * @param {Element} element The Element to use to provide touch events.\n\t */\n\tGuacamole.Mouse.Touchpad = function(element) {\n\n\t    /**\n\t     * Reference to this Guacamole.Mouse.Touchpad.\n\t     * @private\n\t     */\n\t    var guac_touchpad = this;\n\n\t    /**\n\t     * The distance a two-finger touch must move per scrollwheel event, in\n\t     * pixels.\n\t     */\n\t    this.scrollThreshold = 20 * (window.devicePixelRatio || 1);\n\n\t    /**\n\t     * The maximum number of milliseconds to wait for a touch to end for the\n\t     * gesture to be considered a click.\n\t     */\n\t    this.clickTimingThreshold = 250;\n\n\t    /**\n\t     * The maximum number of pixels to allow a touch to move for the gesture to\n\t     * be considered a click.\n\t     */\n\t    this.clickMoveThreshold = 10 * (window.devicePixelRatio || 1);\n\n\t    /**\n\t     * The current mouse state. The properties of this state are updated when\n\t     * mouse events fire. This state object is also passed in as a parameter to\n\t     * the handler of any mouse events.\n\t     * \n\t     * @type Guacamole.Mouse.State\n\t     */\n\t    this.currentState = new Guacamole.Mouse.State(\n\t        0, 0, \n\t        false, false, false, false, false\n\t    );\n\n\t    /**\n\t     * Fired whenever a mouse button is effectively pressed. This can happen\n\t     * as part of a \"click\" gesture initiated by the user by tapping one\n\t     * or more fingers over the touchpad element, as part of a \"scroll\"\n\t     * gesture initiated by dragging two fingers up or down, etc.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmousedown = null;\n\n\t    /**\n\t     * Fired whenever a mouse button is effectively released. This can happen\n\t     * as part of a \"click\" gesture initiated by the user by tapping one\n\t     * or more fingers over the touchpad element, as part of a \"scroll\"\n\t     * gesture initiated by dragging two fingers up or down, etc.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmouseup = null;\n\n\t    /**\n\t     * Fired whenever the user moves the mouse by dragging their finger over\n\t     * the touchpad element.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmousemove = null;\n\n\t    var touch_count = 0;\n\t    var last_touch_x = 0;\n\t    var last_touch_y = 0;\n\t    var last_touch_time = 0;\n\t    var pixels_moved = 0;\n\n\t    var touch_buttons = {\n\t        1: \"left\",\n\t        2: \"right\",\n\t        3: \"middle\"\n\t    };\n\n\t    var gesture_in_progress = false;\n\t    var click_release_timeout = null;\n\n\t    element.addEventListener(\"touchend\", function(e) {\n\t        \n\t        e.preventDefault();\n\t            \n\t        // If we're handling a gesture AND this is the last touch\n\t        if (gesture_in_progress && e.touches.length === 0) {\n\t            \n\t            var time = new Date().getTime();\n\n\t            // Get corresponding mouse button\n\t            var button = touch_buttons[touch_count];\n\n\t            // If mouse already down, release anad clear timeout\n\t            if (guac_touchpad.currentState[button]) {\n\n\t                // Fire button up event\n\t                guac_touchpad.currentState[button] = false;\n\t                if (guac_touchpad.onmouseup)\n\t                    guac_touchpad.onmouseup(guac_touchpad.currentState);\n\n\t                // Clear timeout, if set\n\t                if (click_release_timeout) {\n\t                    window.clearTimeout(click_release_timeout);\n\t                    click_release_timeout = null;\n\t                }\n\n\t            }\n\n\t            // If single tap detected (based on time and distance)\n\t            if (time - last_touch_time <= guac_touchpad.clickTimingThreshold\n\t                    && pixels_moved < guac_touchpad.clickMoveThreshold) {\n\n\t                // Fire button down event\n\t                guac_touchpad.currentState[button] = true;\n\t                if (guac_touchpad.onmousedown)\n\t                    guac_touchpad.onmousedown(guac_touchpad.currentState);\n\n\t                // Delay mouse up - mouse up should be canceled if\n\t                // touchstart within timeout.\n\t                click_release_timeout = window.setTimeout(function() {\n\t                    \n\t                    // Fire button up event\n\t                    guac_touchpad.currentState[button] = false;\n\t                    if (guac_touchpad.onmouseup)\n\t                        guac_touchpad.onmouseup(guac_touchpad.currentState);\n\t                    \n\t                    // Gesture now over\n\t                    gesture_in_progress = false;\n\n\t                }, guac_touchpad.clickTimingThreshold);\n\n\t            }\n\n\t            // If we're not waiting to see if this is a click, stop gesture\n\t            if (!click_release_timeout)\n\t                gesture_in_progress = false;\n\n\t        }\n\n\t    }, false);\n\n\t    element.addEventListener(\"touchstart\", function(e) {\n\n\t        e.preventDefault();\n\n\t        // Track number of touches, but no more than three\n\t        touch_count = Math.min(e.touches.length, 3);\n\n\t        // Clear timeout, if set\n\t        if (click_release_timeout) {\n\t            window.clearTimeout(click_release_timeout);\n\t            click_release_timeout = null;\n\t        }\n\n\t        // Record initial touch location and time for touch movement\n\t        // and tap gestures\n\t        if (!gesture_in_progress) {\n\n\t            // Stop mouse events while touching\n\t            gesture_in_progress = true;\n\n\t            // Record touch location and time\n\t            var starting_touch = e.touches[0];\n\t            last_touch_x = starting_touch.clientX;\n\t            last_touch_y = starting_touch.clientY;\n\t            last_touch_time = new Date().getTime();\n\t            pixels_moved = 0;\n\n\t        }\n\n\t    }, false);\n\n\t    element.addEventListener(\"touchmove\", function(e) {\n\n\t        e.preventDefault();\n\n\t        // Get change in touch location\n\t        var touch = e.touches[0];\n\t        var delta_x = touch.clientX - last_touch_x;\n\t        var delta_y = touch.clientY - last_touch_y;\n\n\t        // Track pixels moved\n\t        pixels_moved += Math.abs(delta_x) + Math.abs(delta_y);\n\n\t        // If only one touch involved, this is mouse move\n\t        if (touch_count === 1) {\n\n\t            // Calculate average velocity in Manhatten pixels per millisecond\n\t            var velocity = pixels_moved / (new Date().getTime() - last_touch_time);\n\n\t            // Scale mouse movement relative to velocity\n\t            var scale = 1 + velocity;\n\n\t            // Update mouse location\n\t            guac_touchpad.currentState.x += delta_x*scale;\n\t            guac_touchpad.currentState.y += delta_y*scale;\n\n\t            // Prevent mouse from leaving screen\n\n\t            if (guac_touchpad.currentState.x < 0)\n\t                guac_touchpad.currentState.x = 0;\n\t            else if (guac_touchpad.currentState.x >= element.offsetWidth)\n\t                guac_touchpad.currentState.x = element.offsetWidth - 1;\n\n\t            if (guac_touchpad.currentState.y < 0)\n\t                guac_touchpad.currentState.y = 0;\n\t            else if (guac_touchpad.currentState.y >= element.offsetHeight)\n\t                guac_touchpad.currentState.y = element.offsetHeight - 1;\n\n\t            // Fire movement event, if defined\n\t            if (guac_touchpad.onmousemove)\n\t                guac_touchpad.onmousemove(guac_touchpad.currentState);\n\n\t            // Update touch location\n\t            last_touch_x = touch.clientX;\n\t            last_touch_y = touch.clientY;\n\n\t        }\n\n\t        // Interpret two-finger swipe as scrollwheel\n\t        else if (touch_count === 2) {\n\n\t            // If change in location passes threshold for scroll\n\t            if (Math.abs(delta_y) >= guac_touchpad.scrollThreshold) {\n\n\t                // Decide button based on Y movement direction\n\t                var button;\n\t                if (delta_y > 0) button = \"down\";\n\t                else             button = \"up\";\n\n\t                // Fire button down event\n\t                guac_touchpad.currentState[button] = true;\n\t                if (guac_touchpad.onmousedown)\n\t                    guac_touchpad.onmousedown(guac_touchpad.currentState);\n\n\t                // Fire button up event\n\t                guac_touchpad.currentState[button] = false;\n\t                if (guac_touchpad.onmouseup)\n\t                    guac_touchpad.onmouseup(guac_touchpad.currentState);\n\n\t                // Only update touch location after a scroll has been\n\t                // detected\n\t                last_touch_x = touch.clientX;\n\t                last_touch_y = touch.clientY;\n\n\t            }\n\n\t        }\n\n\t    }, false);\n\n\t};\n\n\t/**\n\t * Provides cross-browser absolute touch event translation for a given element.\n\t *\n\t * Touch events are translated into mouse events as if the touches occurred\n\t * on a touchscreen (tapping anywhere on the screen clicks at that point,\n\t * long-press to right-click).\n\t *\n\t * @constructor\n\t * @param {Element} element The Element to use to provide touch events.\n\t */\n\tGuacamole.Mouse.Touchscreen = function(element) {\n\n\t    /**\n\t     * Reference to this Guacamole.Mouse.Touchscreen.\n\t     * @private\n\t     */\n\t    var guac_touchscreen = this;\n\n\t    /**\n\t     * Whether a gesture is known to be in progress. If false, touch events\n\t     * will be ignored.\n\t     */\n\t    var gesture_in_progress = false;\n\n\t    /**\n\t     * The start X location of a gesture.\n\t     * @private\n\t     */\n\t    var gesture_start_x = null;\n\n\t    /**\n\t     * The start Y location of a gesture.\n\t     * @private\n\t     */\n\t    var gesture_start_y = null;\n\n\t    /**\n\t     * The timeout associated with the delayed, cancellable click release.\n\t     */\n\t    var click_release_timeout = null;\n\n\t    /**\n\t     * The timeout associated with long-press for right click.\n\t     */\n\t    var long_press_timeout = null;\n\n\t    /**\n\t     * The distance a two-finger touch must move per scrollwheel event, in\n\t     * pixels.\n\t     */\n\t    this.scrollThreshold = 20 * (window.devicePixelRatio || 1);\n\n\t    /**\n\t     * The maximum number of milliseconds to wait for a touch to end for the\n\t     * gesture to be considered a click.\n\t     */\n\t    this.clickTimingThreshold = 250;\n\n\t    /**\n\t     * The maximum number of pixels to allow a touch to move for the gesture to\n\t     * be considered a click.\n\t     */\n\t    this.clickMoveThreshold = 16 * (window.devicePixelRatio || 1);\n\n\t    /**\n\t     * The amount of time a press must be held for long press to be\n\t     * detected.\n\t     */\n\t    this.longPressThreshold = 500;\n\n\t    /**\n\t     * The current mouse state. The properties of this state are updated when\n\t     * mouse events fire. This state object is also passed in as a parameter to\n\t     * the handler of any mouse events.\n\t     *\n\t     * @type Guacamole.Mouse.State\n\t     */\n\t    this.currentState = new Guacamole.Mouse.State(\n\t        0, 0,\n\t        false, false, false, false, false\n\t    );\n\n\t    /**\n\t     * Fired whenever a mouse button is effectively pressed. This can happen\n\t     * as part of a \"mousedown\" gesture initiated by the user by pressing one\n\t     * finger over the touchscreen element, as part of a \"scroll\" gesture\n\t     * initiated by dragging two fingers up or down, etc.\n\t     *\n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmousedown = null;\n\n\t    /**\n\t     * Fired whenever a mouse button is effectively released. This can happen\n\t     * as part of a \"mouseup\" gesture initiated by the user by removing the\n\t     * finger pressed against the touchscreen element, or as part of a \"scroll\"\n\t     * gesture initiated by dragging two fingers up or down, etc.\n\t     *\n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmouseup = null;\n\n\t    /**\n\t     * Fired whenever the user moves the mouse by dragging their finger over\n\t     * the touchscreen element. Note that unlike Guacamole.Mouse.Touchpad,\n\t     * dragging a finger over the touchscreen element will always cause\n\t     * the mouse button to be effectively down, as if clicking-and-dragging.\n\t     *\n\t     * @event\n\t     * @param {Guacamole.Mouse.State} state The current mouse state.\n\t     */\n\t\tthis.onmousemove = null;\n\n\t    /**\n\t     * Presses the given mouse button, if it isn't already pressed. Valid\n\t     * button values are \"left\", \"middle\", \"right\", \"up\", and \"down\".\n\t     *\n\t     * @private\n\t     * @param {String} button The mouse button to press.\n\t     */\n\t    function press_button(button) {\n\t        if (!guac_touchscreen.currentState[button]) {\n\t            guac_touchscreen.currentState[button] = true;\n\t            if (guac_touchscreen.onmousedown)\n\t                guac_touchscreen.onmousedown(guac_touchscreen.currentState);\n\t        }\n\t    }\n\n\t    /**\n\t     * Releases the given mouse button, if it isn't already released. Valid\n\t     * button values are \"left\", \"middle\", \"right\", \"up\", and \"down\".\n\t     *\n\t     * @private\n\t     * @param {String} button The mouse button to release.\n\t     */\n\t    function release_button(button) {\n\t        if (guac_touchscreen.currentState[button]) {\n\t            guac_touchscreen.currentState[button] = false;\n\t            if (guac_touchscreen.onmouseup)\n\t                guac_touchscreen.onmouseup(guac_touchscreen.currentState);\n\t        }\n\t    }\n\n\t    /**\n\t     * Clicks (presses and releases) the given mouse button. Valid button\n\t     * values are \"left\", \"middle\", \"right\", \"up\", and \"down\".\n\t     *\n\t     * @private\n\t     * @param {String} button The mouse button to click.\n\t     */\n\t    function click_button(button) {\n\t        press_button(button);\n\t        release_button(button);\n\t    }\n\n\t    /**\n\t     * Moves the mouse to the given coordinates. These coordinates must be\n\t     * relative to the browser window, as they will be translated based on\n\t     * the touch event target's location within the browser window.\n\t     *\n\t     * @private\n\t     * @param {Number} x The X coordinate of the mouse pointer.\n\t     * @param {Number} y The Y coordinate of the mouse pointer.\n\t     */\n\t    function move_mouse(x, y) {\n\t        guac_touchscreen.currentState.fromClientPosition(element, x, y);\n\t        if (guac_touchscreen.onmousemove)\n\t            guac_touchscreen.onmousemove(guac_touchscreen.currentState);\n\t    }\n\n\t    /**\n\t     * Returns whether the given touch event exceeds the movement threshold for\n\t     * clicking, based on where the touch gesture began.\n\t     *\n\t     * @private\n\t     * @param {TouchEvent} e The touch event to check.\n\t     * @return {Boolean} true if the movement threshold is exceeded, false\n\t     *                   otherwise.\n\t     */\n\t    function finger_moved(e) {\n\t        var touch = e.touches[0] || e.changedTouches[0];\n\t        var delta_x = touch.clientX - gesture_start_x;\n\t        var delta_y = touch.clientY - gesture_start_y;\n\t        return Math.sqrt(delta_x*delta_x + delta_y*delta_y) >= guac_touchscreen.clickMoveThreshold;\n\t    }\n\n\t    /**\n\t     * Begins a new gesture at the location of the first touch in the given\n\t     * touch event.\n\t     * \n\t     * @private\n\t     * @param {TouchEvent} e The touch event beginning this new gesture.\n\t     */\n\t    function begin_gesture(e) {\n\t        var touch = e.touches[0];\n\t        gesture_in_progress = true;\n\t        gesture_start_x = touch.clientX;\n\t        gesture_start_y = touch.clientY;\n\t    }\n\n\t    /**\n\t     * End the current gesture entirely. Wait for all touches to be done before\n\t     * resuming gesture detection.\n\t     * \n\t     * @private\n\t     */\n\t    function end_gesture() {\n\t        window.clearTimeout(click_release_timeout);\n\t        window.clearTimeout(long_press_timeout);\n\t        gesture_in_progress = false;\n\t    }\n\n\t    element.addEventListener(\"touchend\", function(e) {\n\n\t        // Do not handle if no gesture\n\t        if (!gesture_in_progress)\n\t            return;\n\n\t        // Ignore if more than one touch\n\t        if (e.touches.length !== 0 || e.changedTouches.length !== 1) {\n\t            end_gesture();\n\t            return;\n\t        }\n\n\t        // Long-press, if any, is over\n\t        window.clearTimeout(long_press_timeout);\n\n\t        // Always release mouse button if pressed\n\t        release_button(\"left\");\n\n\t        // If finger hasn't moved enough to cancel the click\n\t        if (!finger_moved(e)) {\n\n\t            e.preventDefault();\n\n\t            // If not yet pressed, press and start delay release\n\t            if (!guac_touchscreen.currentState.left) {\n\n\t                var touch = e.changedTouches[0];\n\t                move_mouse(touch.clientX, touch.clientY);\n\t                press_button(\"left\");\n\n\t                // Release button after a delay, if not canceled\n\t                click_release_timeout = window.setTimeout(function() {\n\t                    release_button(\"left\");\n\t                    end_gesture();\n\t                }, guac_touchscreen.clickTimingThreshold);\n\n\t            }\n\n\t        } // end if finger not moved\n\n\t    }, false);\n\n\t    element.addEventListener(\"touchstart\", function(e) {\n\n\t        // Ignore if more than one touch\n\t        if (e.touches.length !== 1) {\n\t            end_gesture();\n\t            return;\n\t        }\n\n\t        e.preventDefault();\n\n\t        // New touch begins a new gesture\n\t        begin_gesture(e);\n\n\t        // Keep button pressed if tap after left click\n\t        window.clearTimeout(click_release_timeout);\n\n\t        // Click right button if this turns into a long-press\n\t        long_press_timeout = window.setTimeout(function() {\n\t            var touch = e.touches[0];\n\t            move_mouse(touch.clientX, touch.clientY);\n\t            click_button(\"right\");\n\t            end_gesture();\n\t        }, guac_touchscreen.longPressThreshold);\n\n\t    }, false);\n\n\t    element.addEventListener(\"touchmove\", function(e) {\n\n\t        // Do not handle if no gesture\n\t        if (!gesture_in_progress)\n\t            return;\n\n\t        // Cancel long press if finger moved\n\t        if (finger_moved(e))\n\t            window.clearTimeout(long_press_timeout);\n\n\t        // Ignore if more than one touch\n\t        if (e.touches.length !== 1) {\n\t            end_gesture();\n\t            return;\n\t        }\n\n\t        // Update mouse position if dragging\n\t        if (guac_touchscreen.currentState.left) {\n\n\t            e.preventDefault();\n\n\t            // Update state\n\t            var touch = e.touches[0];\n\t            move_mouse(touch.clientX, touch.clientY);\n\n\t        }\n\n\t    }, false);\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Core object providing abstract communication for Guacamole. This object\n\t * is a null implementation whose functions do nothing. Guacamole applications\n\t * should use {@link Guacamole.HTTPTunnel} instead, or implement their own tunnel based\n\t * on this one.\n\t * \n\t * @constructor\n\t * @see Guacamole.HTTPTunnel\n\t */\n\tGuacamole.Tunnel = function() {\n\n\t    /**\n\t     * Connect to the tunnel with the given optional data. This data is\n\t     * typically used for authentication. The format of data accepted is\n\t     * up to the tunnel implementation.\n\t     * \n\t     * @param {String} data The data to send to the tunnel when connecting.\n\t     */\n\t    this.connect = function(data) {};\n\t    \n\t    /**\n\t     * Disconnect from the tunnel.\n\t     */\n\t    this.disconnect = function() {};\n\t    \n\t    /**\n\t     * Send the given message through the tunnel to the service on the other\n\t     * side. All messages are guaranteed to be received in the order sent.\n\t     * \n\t     * @param {...} elements The elements of the message to send to the\n\t     *                       service on the other side of the tunnel.\n\t     */\n\t    this.sendMessage = function(elements) {};\n\n\t    /**\n\t     * The current state of this tunnel.\n\t     * \n\t     * @type Number\n\t     */\n\t    this.state = Guacamole.Tunnel.State.CONNECTING;\n\n\t    /**\n\t     * The maximum amount of time to wait for data to be received, in\n\t     * milliseconds. If data is not received within this amount of time,\n\t     * the tunnel is closed with an error. The default value is 15000.\n\t\t * Set to zero for no timeout.\n\t     * \n\t     * @type Number\n\t     */\n\t    this.receiveTimeout = 15000;\n\n\t    /**\n\t     * Fired whenever an error is encountered by the tunnel.\n\t     * \n\t     * @event\n\t     * @param {Guacamole.Status} status A status object which describes the\n\t     *                                  error.\n\t     */\n\t    this.onerror = null;\n\n\t    /**\n\t     * Fired whenever the state of the tunnel changes.\n\t     * \n\t     * @event\n\t     * @param {Number} state The new state of the client.\n\t     */\n\t    this.onstatechange = null;\n\n\t    /**\n\t     * Fired once for every complete Guacamole instruction received, in order.\n\t     * \n\t     * @event\n\t     * @param {String} opcode The Guacamole instruction opcode.\n\t     * @param {Array} parameters The parameters provided for the instruction,\n\t     *                           if any.\n\t     */\n\t    this.oninstruction = null;\n\n\t};\n\n\t/**\n\t * All possible tunnel states.\n\t */\n\tGuacamole.Tunnel.State = {\n\n\t    /**\n\t     * A connection is in pending. It is not yet known whether connection was\n\t     * successful.\n\t     * \n\t     * @type Number\n\t     */\n\t    \"CONNECTING\": 0,\n\n\t    /**\n\t     * Connection was successful, and data is being received.\n\t     * \n\t     * @type Number\n\t     */\n\t    \"OPEN\": 1,\n\n\t    /**\n\t     * The connection is closed. Connection may not have been successful, the\n\t     * tunnel may have been explicitly closed by either side, or an error may\n\t     * have occurred.\n\t     * \n\t     * @type Number\n\t     */\n\t    \"CLOSED\": 2\n\n\t};\n\n\t/**\n\t * Guacamole Tunnel implemented over HTTP via XMLHttpRequest.\n\t * \n\t * @constructor\n\t * @augments Guacamole.Tunnel\n\t * @param {String} tunnelURL The URL of the HTTP tunneling service.\n\t */\n\tGuacamole.HTTPTunnel = function(tunnelURL) {\n\n\t    /**\n\t     * Reference to this HTTP tunnel.\n\t     * @private\n\t     */\n\t    var tunnel = this;\n\n\t    var tunnel_uuid;\n\n\t    var TUNNEL_CONNECT = tunnelURL + \"?connect\";\n\t    var TUNNEL_READ    = tunnelURL + \"?read:\";\n\t    var TUNNEL_WRITE   = tunnelURL + \"?write:\";\n\n\t    var POLLING_ENABLED     = 1;\n\t    var POLLING_DISABLED    = 0;\n\n\t    // Default to polling - will be turned off automatically if not needed\n\t    var pollingMode = POLLING_ENABLED;\n\n\t    var sendingMessages = false;\n\t    var outputMessageBuffer = \"\";\n\n\t    /**\n\t     * Closes this tunnel, signaling the given status and corresponding\n\t     * message, which will be sent to the onerror handler if the status is\n\t     * an error status.\n\t     * \n\t     * @private\n\t     * @param {Guacamole.Status} status The status causing the connection to\n\t     *                                  close;\n\t     */\n\t    function close_tunnel(status) {\n\n\t        // Ignore if already closed\n\t        if (tunnel.state === Guacamole.Tunnel.State.CLOSED)\n\t            return;\n\n\t        // If connection closed abnormally, signal error.\n\t        if (status.code !== Guacamole.Status.Code.SUCCESS && tunnel.onerror) {\n\n\t            // Ignore RESOURCE_NOT_FOUND if we've already connected, as that\n\t            // only signals end-of-stream for the HTTP tunnel.\n\t            if (tunnel.state === Guacamole.Tunnel.State.CONNECTING\n\t                    || status.code !== Guacamole.Status.Code.RESOURCE_NOT_FOUND)\n\t                tunnel.onerror(status);\n\n\t        }\n\n\t        // Mark as closed\n\t        tunnel.state = Guacamole.Tunnel.State.CLOSED;\n\n\t        // Reset output message buffer\n\t        sendingMessages = false;\n\n\t        if (tunnel.onstatechange)\n\t            tunnel.onstatechange(tunnel.state);\n\n\t    }\n\n\n\t    this.sendMessage = function() {\n\n\t        // Do not attempt to send messages if not connected\n\t        if (tunnel.state !== Guacamole.Tunnel.State.OPEN)\n\t            return;\n\n\t        // Do not attempt to send empty messages\n\t        if (arguments.length === 0)\n\t            return;\n\n\t        /**\n\t         * Converts the given value to a length/string pair for use as an\n\t         * element in a Guacamole instruction.\n\t         * \n\t         * @private\n\t         * @param value The value to convert.\n\t         * @return {String} The converted value. \n\t         */\n\t        function getElement(value) {\n\t            var string = new String(value);\n\t            return string.length + \".\" + string; \n\t        }\n\n\t        // Initialized message with first element\n\t        var message = getElement(arguments[0]);\n\n\t        // Append remaining elements\n\t        for (var i=1; i<arguments.length; i++)\n\t            message += \",\" + getElement(arguments[i]);\n\n\t        // Final terminator\n\t        message += \";\";\n\n\t        // Add message to buffer\n\t        outputMessageBuffer += message;\n\n\t        // Send if not currently sending\n\t        if (!sendingMessages)\n\t            sendPendingMessages();\n\n\t    };\n\n\t    function sendPendingMessages() {\n\n\t        // Do not attempt to send messages if not connected\n\t        if (tunnel.state !== Guacamole.Tunnel.State.OPEN)\n\t            return;\n\n\t        if (outputMessageBuffer.length > 0) {\n\n\t            sendingMessages = true;\n\n\t            var message_xmlhttprequest = new XMLHttpRequest();\n\t            message_xmlhttprequest.open(\"POST\", TUNNEL_WRITE + tunnel_uuid);\n\t            message_xmlhttprequest.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=UTF-8\");\n\n\t            // Once response received, send next queued event.\n\t            message_xmlhttprequest.onreadystatechange = function() {\n\t                if (message_xmlhttprequest.readyState === 4) {\n\n\t                    // If an error occurs during send, handle it\n\t                    if (message_xmlhttprequest.status !== 200)\n\t                        handleHTTPTunnelError(message_xmlhttprequest);\n\n\t                    // Otherwise, continue the send loop\n\t                    else\n\t                        sendPendingMessages();\n\n\t                }\n\t            };\n\n\t            message_xmlhttprequest.send(outputMessageBuffer);\n\t            outputMessageBuffer = \"\"; // Clear buffer\n\n\t        }\n\t        else\n\t            sendingMessages = false;\n\n\t    }\n\n\t    function handleHTTPTunnelError(xmlhttprequest) {\n\n\t        var code = parseInt(xmlhttprequest.getResponseHeader(\"Guacamole-Status-Code\"));\n\t        var message = xmlhttprequest.getResponseHeader(\"Guacamole-Error-Message\");\n\n\t        close_tunnel(new Guacamole.Status(code, message));\n\n\t    }\n\n\t    function handleResponse(xmlhttprequest) {\n\n\t        var interval = null;\n\t        var nextRequest = null;\n\n\t        var dataUpdateEvents = 0;\n\n\t        // The location of the last element's terminator\n\t        var elementEnd = -1;\n\n\t        // Where to start the next length search or the next element\n\t        var startIndex = 0;\n\n\t        // Parsed elements\n\t        var elements = new Array();\n\n\t        function parseResponse() {\n\n\t            // Do not handle responses if not connected\n\t            if (tunnel.state !== Guacamole.Tunnel.State.OPEN) {\n\t                \n\t                // Clean up interval if polling\n\t                if (interval !== null)\n\t                    clearInterval(interval);\n\t                \n\t                return;\n\t            }\n\n\t            // Do not parse response yet if not ready\n\t            if (xmlhttprequest.readyState < 2) return;\n\n\t            // Attempt to read status\n\t            var status;\n\t            try { status = xmlhttprequest.status; }\n\n\t            // If status could not be read, assume successful.\n\t            catch (e) { status = 200; }\n\n\t            // Start next request as soon as possible IF request was successful\n\t            if (!nextRequest && status === 200)\n\t                nextRequest = makeRequest();\n\n\t            // Parse stream when data is received and when complete.\n\t            if (xmlhttprequest.readyState === 3 ||\n\t                xmlhttprequest.readyState === 4) {\n\n\t                // Also poll every 30ms (some browsers don't repeatedly call onreadystatechange for new data)\n\t                if (pollingMode === POLLING_ENABLED) {\n\t                    if (xmlhttprequest.readyState === 3 && !interval)\n\t                        interval = setInterval(parseResponse, 30);\n\t                    else if (xmlhttprequest.readyState === 4 && !interval)\n\t                        clearInterval(interval);\n\t                }\n\n\t                // If canceled, stop transfer\n\t                if (xmlhttprequest.status === 0) {\n\t                    tunnel.disconnect();\n\t                    return;\n\t                }\n\n\t                // Halt on error during request\n\t                else if (xmlhttprequest.status !== 200) {\n\t                    handleHTTPTunnelError(xmlhttprequest);\n\t                    return;\n\t                }\n\n\t                // Attempt to read in-progress data\n\t                var current;\n\t                try { current = xmlhttprequest.responseText; }\n\n\t                // Do not attempt to parse if data could not be read\n\t                catch (e) { return; }\n\n\t                // While search is within currently received data\n\t                while (elementEnd < current.length) {\n\n\t                    // If we are waiting for element data\n\t                    if (elementEnd >= startIndex) {\n\n\t                        // We now have enough data for the element. Parse.\n\t                        var element = current.substring(startIndex, elementEnd);\n\t                        var terminator = current.substring(elementEnd, elementEnd+1);\n\n\t                        // Add element to array\n\t                        elements.push(element);\n\n\t                        // If last element, handle instruction\n\t                        if (terminator === \";\") {\n\n\t                            // Get opcode\n\t                            var opcode = elements.shift();\n\n\t                            // Call instruction handler.\n\t                            if (tunnel.oninstruction)\n\t                                tunnel.oninstruction(opcode, elements);\n\n\t                            // Clear elements\n\t                            elements.length = 0;\n\n\t                        }\n\n\t                        // Start searching for length at character after\n\t                        // element terminator\n\t                        startIndex = elementEnd + 1;\n\n\t                    }\n\n\t                    // Search for end of length\n\t                    var lengthEnd = current.indexOf(\".\", startIndex);\n\t                    if (lengthEnd !== -1) {\n\n\t                        // Parse length\n\t                        var length = parseInt(current.substring(elementEnd+1, lengthEnd));\n\n\t                        // If we're done parsing, handle the next response.\n\t                        if (length === 0) {\n\n\t                            // Clean up interval if polling\n\t                            if (!interval)\n\t                                clearInterval(interval);\n\t                           \n\t                            // Clean up object\n\t                            xmlhttprequest.onreadystatechange = null;\n\t                            xmlhttprequest.abort();\n\n\t                            // Start handling next request\n\t                            if (nextRequest)\n\t                                handleResponse(nextRequest);\n\n\t                            // Done parsing\n\t                            break;\n\n\t                        }\n\n\t                        // Calculate start of element\n\t                        startIndex = lengthEnd + 1;\n\n\t                        // Calculate location of element terminator\n\t                        elementEnd = startIndex + length;\n\n\t                    }\n\t                    \n\t                    // If no period yet, continue search when more data\n\t                    // is received\n\t                    else {\n\t                        startIndex = current.length;\n\t                        break;\n\t                    }\n\n\t                } // end parse loop\n\n\t            }\n\n\t        }\n\n\t        // If response polling enabled, attempt to detect if still\n\t        // necessary (via wrapping parseResponse())\n\t        if (pollingMode === POLLING_ENABLED) {\n\t            xmlhttprequest.onreadystatechange = function() {\n\n\t                // If we receive two or more readyState==3 events,\n\t                // there is no need to poll.\n\t                if (xmlhttprequest.readyState === 3) {\n\t                    dataUpdateEvents++;\n\t                    if (dataUpdateEvents >= 2) {\n\t                        pollingMode = POLLING_DISABLED;\n\t                        xmlhttprequest.onreadystatechange = parseResponse;\n\t                    }\n\t                }\n\n\t                parseResponse();\n\t            };\n\t        }\n\n\t        // Otherwise, just parse\n\t        else\n\t            xmlhttprequest.onreadystatechange = parseResponse;\n\n\t        parseResponse();\n\n\t    }\n\n\t    /**\n\t     * Arbitrary integer, unique for each tunnel read request.\n\t     * @private\n\t     */\n\t    var request_id = 0;\n\n\t    function makeRequest() {\n\n\t        // Make request, increment request ID\n\t        var xmlhttprequest = new XMLHttpRequest();\n\t        xmlhttprequest.open(\"GET\", TUNNEL_READ + tunnel_uuid + \":\" + (request_id++));\n\t        xmlhttprequest.send(null);\n\n\t        return xmlhttprequest;\n\n\t    }\n\n\t    this.connect = function(data) {\n\n\t        // Start tunnel and connect\n\t        var connect_xmlhttprequest = new XMLHttpRequest();\n\t        connect_xmlhttprequest.onreadystatechange = function() {\n\n\t            if (connect_xmlhttprequest.readyState !== 4)\n\t                return;\n\n\t            // If failure, throw error\n\t            if (connect_xmlhttprequest.status !== 200) {\n\t                handleHTTPTunnelError(connect_xmlhttprequest);\n\t                return;\n\t            }\n\n\t            // Get UUID from response\n\t            tunnel_uuid = connect_xmlhttprequest.responseText;\n\n\t            tunnel.state = Guacamole.Tunnel.State.OPEN;\n\t            if (tunnel.onstatechange)\n\t                tunnel.onstatechange(tunnel.state);\n\n\t            // Start reading data\n\t            handleResponse(makeRequest());\n\n\t        };\n\n\t        connect_xmlhttprequest.open(\"POST\", TUNNEL_CONNECT, true);\n\t        connect_xmlhttprequest.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded; charset=UTF-8\");\n\t        connect_xmlhttprequest.send(data);\n\n\t    };\n\n\t    this.disconnect = function() {\n\t        close_tunnel(new Guacamole.Status(Guacamole.Status.Code.SUCCESS, \"Manually closed.\"));\n\t    };\n\n\t};\n\n\tGuacamole.HTTPTunnel.prototype = new Guacamole.Tunnel();\n\n\t/**\n\t * Guacamole Tunnel implemented over WebSocket via XMLHttpRequest.\n\t * \n\t * @constructor\n\t * @augments Guacamole.Tunnel\n\t * @param {String} tunnelURL The URL of the WebSocket tunneling service.\n\t */\n\tGuacamole.WebSocketTunnel = function(tunnelURL) {\n\n\t    /**\n\t     * Reference to this WebSocket tunnel.\n\t     * @private\n\t     */\n\t    var tunnel = this;\n\n\t    /**\n\t     * The WebSocket used by this tunnel.\n\t     * @private\n\t     */\n\t    var socket = null;\n\n\t    /**\n\t     * The WebSocket protocol corresponding to the protocol used for the current\n\t     * location.\n\t     * @private\n\t     */\n\t    var ws_protocol = {\n\t        \"http:\":  \"ws:\",\n\t        \"https:\": \"wss:\"\n\t    };\n\n\t    // Transform current URL to WebSocket URL\n\n\t    // If not already a websocket URL\n\t    if (   tunnelURL.substring(0, 3) !== \"ws:\"\n\t        && tunnelURL.substring(0, 4) !== \"wss:\") {\n\n\t        var protocol = ws_protocol[window.location.protocol];\n\n\t        // If absolute URL, convert to absolute WS URL\n\t        if (tunnelURL.substring(0, 1) === \"/\")\n\t            tunnelURL =\n\t                protocol\n\t                + \"//\" + window.location.host\n\t                + tunnelURL;\n\n\t        // Otherwise, construct absolute from relative URL\n\t        else {\n\n\t            // Get path from pathname\n\t            var slash = window.location.pathname.lastIndexOf(\"/\");\n\t            var path  = window.location.pathname.substring(0, slash + 1);\n\n\t            // Construct absolute URL\n\t            tunnelURL =\n\t                protocol\n\t                + \"//\" + window.location.host\n\t                + path\n\t                + tunnelURL;\n\n\t        }\n\n\t    }\n\n\t    /**\n\t     * Closes this tunnel, signaling the given status and corresponding\n\t     * message, which will be sent to the onerror handler if the status is\n\t     * an error status.\n\t     * \n\t     * @private\n\t     * @param {Guacamole.Status} status The status causing the connection to\n\t     *                                  close;\n\t     */\n\t    function close_tunnel(status) {\n\n\t        // Ignore if already closed\n\t        if (tunnel.state === Guacamole.Tunnel.State.CLOSED)\n\t            return;\n\n\t        // If connection closed abnormally, signal error.\n\t        if (status.code !== Guacamole.Status.Code.SUCCESS && tunnel.onerror)\n\t            tunnel.onerror(status);\n\n\t        // Mark as closed\n\t        tunnel.state = Guacamole.Tunnel.State.CLOSED;\n\t        if (tunnel.onstatechange)\n\t            tunnel.onstatechange(tunnel.state);\n\n\t        socket.close();\n\n\t    }\n\t\t\n\t\tthis.sendRawMessage = function(message) {\n\t\t\tsocket.send(message);\n\t\t};\n\n\t    this.sendMessage = function(elements) {\n\n\t        // Do not attempt to send messages if not connected\n\t        if (tunnel.state !== Guacamole.Tunnel.State.OPEN)\n\t            return;\n\n\t        // Do not attempt to send empty messages\n\t        if (arguments.length === 0)\n\t            return;\n\n\t        /**\n\t         * Converts the given value to a length/string pair for use as an\n\t         * element in a Guacamole instruction.\n\t         * \n\t         * @private\n\t         * @param value The value to convert.\n\t         * @return {String} The converted value. \n\t         */\n\t        function getElement(value) {\n\t            var string = new String(value);\n\t            return string.length + \".\" + string; \n\t        }\n\n\t        // Initialized message with first element\n\t        var message = getElement(arguments[0]);\n\n\t        // Append remaining elements\n\t        for (var i=1; i<arguments.length; i++)\n\t            message += \",\" + getElement(arguments[i]);\n\n\t        // Final terminator\n\t        message += \";\";\n\n\t        socket.send(message);\n\n\t    };\n\n\t    this.connect = function(data) {\n\n\t        // Connect socket\n\t        socket = new WebSocket(data ? tunnelURL + \"?\" + data : tunnelURL, \"guacamole\");\n\n\t        socket.onopen = function(event) {\n\n\t            tunnel.state = Guacamole.Tunnel.State.OPEN;\n\t            if (tunnel.onstatechange)\n\t                tunnel.onstatechange(tunnel.state);\n\n\t        };\n\n\t        socket.onclose = function(event) {\n\t            close_tunnel(new Guacamole.Status(parseInt(event.reason), event.reason));\n\t        };\n\t        \n\t        socket.onerror = function(event) {\n\t            close_tunnel(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR, event.data));\n\t        };\n\n\t        socket.onmessage = function(event) {\n\n\t            var message = event.data;\n\t            var startIndex = 0;\n\t            var elementEnd;\n\n\t            var elements = [];\n\n\t            do {\n\n\t                // Search for end of length\n\t                var lengthEnd = message.indexOf(\".\", startIndex);\n\t                if (lengthEnd !== -1) {\n\n\t                    // Parse length\n\t                    var length = parseInt(message.substring(elementEnd+1, lengthEnd));\n\n\t                    // Calculate start of element\n\t                    startIndex = lengthEnd + 1;\n\n\t                    // Calculate location of element terminator\n\t                    elementEnd = startIndex + length;\n\n\t                }\n\t                \n\t                // If no period, incomplete instruction.\n\t                else\n\t                    close_tunnel(new Guacamole.Status(Guacamole.Status.Code.SERVER_ERROR, \"Incomplete instruction.\"));\n\n\t                // We now have enough data for the element. Parse.\n\t                var element = message.substring(startIndex, elementEnd);\n\t                var terminator = message.substring(elementEnd, elementEnd+1);\n\n\t                // Add element to array\n\t                elements.push(element);\n\n\t                // If last element, handle instruction\n\t                if (terminator === \";\") {\n\n\t                    // Get opcode\n\t                    var opcode = elements.shift();\n\n\t                    // Call instruction handler.\n\t                    if (tunnel.oninstruction)\n\t                        tunnel.oninstruction(opcode, elements);\n\n\t                    // Clear elements\n\t                    elements.length = 0;\n\n\t                }\n\n\t                // Start searching for length at character after\n\t                // element terminator\n\t                startIndex = elementEnd + 1;\n\n\t            } while (startIndex < message.length);\n\n\t        };\n\n\t    };\n\n\t    this.disconnect = function() {\n\t        close_tunnel(new Guacamole.Status(Guacamole.Status.Code.SUCCESS, \"Manually closed.\"));\n\t    };\n\n\t};\n\n\tGuacamole.WebSocketTunnel.prototype = new Guacamole.Tunnel();\n\n\t/**\n\t * Guacamole Tunnel which cycles between all specified tunnels until\n\t * no tunnels are left. Another tunnel is used if an error occurs but\n\t * no instructions have been received. If an instruction has been\n\t * received, or no tunnels remain, the error is passed directly out\n\t * through the onerror handler (if defined).\n\t * \n\t * @constructor\n\t * @augments Guacamole.Tunnel\n\t * @param {...} tunnel_chain The tunnels to use, in order of priority.\n\t */\n\tGuacamole.ChainedTunnel = function(tunnel_chain) {\n\n\t    /**\n\t     * Reference to this chained tunnel.\n\t     * @private\n\t     */\n\t    var chained_tunnel = this;\n\n\t    /**\n\t     * Data passed in via connect(), to be used for\n\t     * wrapped calls to other tunnels' connect() functions.\n\t     * @private\n\t     */\n\t    var connect_data;\n\n\t    /**\n\t     * Array of all tunnels passed to this ChainedTunnel through the\n\t     * constructor arguments.\n\t     * @private\n\t     */\n\t    var tunnels = [];\n\n\t    // Load all tunnels into array\n\t    for (var i=0; i<arguments.length; i++)\n\t        tunnels.push(arguments[i]);\n\n\t    /**\n\t     * Sets the current tunnel.\n\t     * \n\t     * @private\n\t     * @param {Guacamole.Tunnel} tunnel The tunnel to set as the current tunnel.\n\t     */\n\t    function attach(tunnel) {\n\n\t        // Set own functions to tunnel's functions\n\t        chained_tunnel.disconnect  = tunnel.disconnect;\n\t        chained_tunnel.sendMessage = tunnel.sendMessage;\n\n\t        /**\n\t         * Fails the currently-attached tunnel, attaching a new tunnel if\n\t         * possible.\n\t         * \n\t         * @private\n\t         * @return {Guacamole.Tunnel} The next tunnel, or null if there are no\n\t         *                            more tunnels to try.\n\t         */\n\t        function fail_tunnel() {\n\n\t            // Get next tunnel\n\t            var next_tunnel = tunnels.shift();\n\n\t            // If there IS a next tunnel, try using it.\n\t            if (next_tunnel) {\n\t                tunnel.onerror = null;\n\t                tunnel.oninstruction = null;\n\t                tunnel.onstatechange = null;\n\t                attach(next_tunnel);\n\t            }\n\n\t            return next_tunnel;\n\n\t        }\n\n\t        /**\n\t         * Use the current tunnel from this point forward. Do not try any more\n\t         * tunnels, even if the current tunnel fails.\n\t         * \n\t         * @private\n\t         */\n\t        function commit_tunnel() {\n\t            tunnel.onstatechange = chained_tunnel.onstatechange;\n\t            tunnel.oninstruction = chained_tunnel.oninstruction;\n\t            tunnel.onerror = chained_tunnel.onerror;\n\t        }\n\n\t        // Wrap own onstatechange within current tunnel\n\t        tunnel.onstatechange = function(state) {\n\n\t            switch (state) {\n\n\t                // If open, use this tunnel from this point forward.\n\t                case Guacamole.Tunnel.State.OPEN:\n\t                    commit_tunnel();\n\t                    if (chained_tunnel.onstatechange)\n\t                        chained_tunnel.onstatechange(state);\n\t                    break;\n\n\t                // If closed, mark failure, attempt next tunnel\n\t                case Guacamole.Tunnel.State.CLOSED:\n\t                    if (!fail_tunnel() && chained_tunnel.onstatechange)\n\t                        chained_tunnel.onstatechange(state);\n\t                    break;\n\t                \n\t            }\n\n\t        };\n\n\t        // Wrap own oninstruction within current tunnel\n\t        tunnel.oninstruction = function(opcode, elements) {\n\n\t            // Accept current tunnel\n\t            commit_tunnel();\n\n\t            // Invoke handler\n\t            if (chained_tunnel.oninstruction)\n\t                chained_tunnel.oninstruction(opcode, elements);\n\n\t        };\n\n\t        // Attach next tunnel on error\n\t        tunnel.onerror = function(status) {\n\n\t            // Mark failure, attempt next tunnel\n\t            if (!fail_tunnel() && chained_tunnel.onerror)\n\t                chained_tunnel.onerror(status);\n\n\t        };\n\n\t        // Attempt connection\n\t        tunnel.connect(connect_data);\n\t        \n\t    }\n\n\t    this.connect = function(data) {\n\t       \n\t        // Remember connect data\n\t        connect_data = data;\n\n\t        // Get first tunnel\n\t        var next_tunnel = tunnels.shift();\n\n\t        // Attach first tunnel\n\t        if (next_tunnel)\n\t            attach(next_tunnel);\n\n\t        // If there IS no first tunnel, error\n\t        else if (chained_tunnel.onerror)\n\t            chained_tunnel.onerror(Guacamole.Status.Code.SERVER_ERROR, \"No tunnels to try.\");\n\n\t    };\n\t    \n\t};\n\n\tGuacamole.ChainedTunnel.prototype = new Guacamole.Tunnel();\n\n\t/*\n\t * Copyright (C) 2015 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Abstract audio channel which queues and plays arbitrary audio data.\n\t * @constructor\n\t */\n\tGuacamole.AudioChannel = function() {\n\n\t    /**\n\t     * When the next packet should play.\n\t     * @private\n\t     */\n\t    var next_packet_time = 0;\n\n\t    /**\n\t     * Queues up the given data for playing by this channel once all previously\n\t     * queued data has been played. If no data has been queued, the data will\n\t     * play immediately.\n\t     * \n\t     * @param {String} mimetype The mimetype of the data provided.\n\t     * @param {Number} duration The duration of the data provided, in\n\t     *                          milliseconds.\n\t     * @param {Blob} data The blob data to play.\n\t     */\n\t    this.play = function(mimetype, duration, data) {\n\n\t        var packet =\n\t            new Guacamole.AudioChannel.Packet(mimetype, data);\n\n\t        var now = Guacamole.AudioChannel.getTimestamp();\n\n\t        // If underflow is detected, reschedule new packets relative to now.\n\t        if (next_packet_time < now)\n\t            next_packet_time = now;\n\n\t        // Schedule next packet\n\t        packet.play(next_packet_time);\n\t        next_packet_time += duration;\n\n\t    };\n\n\t};\n\n\t// Define context if available\n\tif (window.AudioContext) {\n\t    Guacamole.AudioChannel.context = new AudioContext();\n\t}\n\n\t// Fallback to Webkit-specific AudioContext implementation\n\telse if (window.webkitAudioContext) {\n\t    Guacamole.AudioChannel.context = new webkitAudioContext();\n\t}\n\n\t/**\n\t * Returns a base timestamp which can be used for scheduling future audio\n\t * playback. Scheduling playback for the value returned by this function plus\n\t * N will cause the associated audio to be played back N milliseconds after\n\t * the function is called.\n\t *\n\t * @return {Number} An arbitrary channel-relative timestamp, in milliseconds.\n\t */\n\tGuacamole.AudioChannel.getTimestamp = function() {\n\n\t    // If we have an audio context, use its timestamp\n\t    if (Guacamole.AudioChannel.context)\n\t        return Guacamole.AudioChannel.context.currentTime * 1000;\n\n\t    // If we have high-resolution timers, use those\n\t    if (window.performance) {\n\n\t        if (window.performance.now)\n\t            return window.performance.now();\n\n\t        if (window.performance.webkitNow)\n\t            return window.performance.webkitNow();\n\t        \n\t    }\n\n\t    // Fallback to millisecond-resolution system time\n\t    return new Date().getTime();\n\n\t};\n\n\t/**\n\t * Abstract representation of an audio packet.\n\t * \n\t * @constructor\n\t * \n\t * @param {String} mimetype The mimetype of the data contained by this packet.\n\t * @param {Blob} data The blob of sound data contained by this packet.\n\t */\n\tGuacamole.AudioChannel.Packet = function(mimetype, data) {\n\n\t    /**\n\t     * Schedules this packet for playback at the given time.\n\t     *\n\t     * @function\n\t     * @param {Number} when The time this packet should be played, in\n\t     *                      milliseconds.\n\t     */\n\t    this.play = function(when) { /* NOP */ }; // Defined conditionally depending on support\n\n\t    // If audio API available, use it.\n\t    if (Guacamole.AudioChannel.context) {\n\n\t        var readyBuffer = null;\n\n\t        // By default, when decoding finishes, store buffer for future\n\t        // playback\n\t        var handleReady = function(buffer) {\n\t            readyBuffer = buffer;\n\t        };\n\n\t        // Read data and start decoding\n\t        var reader = new FileReader();\n\t        reader.onload = function() {\n\t            Guacamole.AudioChannel.context.decodeAudioData(\n\t                reader.result,\n\t                function(buffer) { handleReady(buffer); }\n\t            );\n\t        };\n\t        reader.readAsArrayBuffer(data);\n\n\t        // Set up buffer source\n\t        var source = Guacamole.AudioChannel.context.createBufferSource();\n\t        source.connect(Guacamole.AudioChannel.context.destination);\n\n\t        // Use noteOn() instead of start() if necessary\n\t        if (!source.start)\n\t            source.start = source.noteOn;\n\n\t        var play_when;\n\n\t        function playDelayed(buffer) {\n\t            source.buffer = buffer;\n\t            source.start(play_when / 1000);\n\t        }\n\n\t        /** @ignore */\n\t        this.play = function(when) {\n\t            \n\t            play_when = when;\n\t            \n\t            // If buffer available, play it NOW\n\t            if (readyBuffer)\n\t                playDelayed(readyBuffer);\n\n\t            // Otherwise, play when decoded\n\t            else\n\t                handleReady = playDelayed;\n\n\t        };\n\n\t    }\n\n\t    else {\n\n\t        var play_on_load = false;\n\n\t        // Create audio element to house and play the data\n\t        var audio = null;\n\t        try { audio = new Audio(); }\n\t        catch (e) {}\n\n\t        if (audio) {\n\n\t            // Read data and start decoding\n\t            var reader = new FileReader();\n\t            reader.onload = function() {\n\n\t                var binary = \"\";\n\t                var bytes = new Uint8Array(reader.result);\n\n\t                // Produce binary string from bytes in buffer\n\t                for (var i=0; i<bytes.byteLength; i++)\n\t                    binary += String.fromCharCode(bytes[i]);\n\n\t                // Convert to data URI \n\t                audio.src = \"data:\" + mimetype + \";base64,\" + window.btoa(binary);\n\n\t                // Play if play was attempted but packet wasn't loaded yet\n\t                if (play_on_load)\n\t                    audio.play();\n\n\t            };\n\t            reader.readAsArrayBuffer(data);\n\t       \n\t            function play() {\n\n\t                // If audio data is ready, play now\n\t                if (audio.src)\n\t                    audio.play();\n\n\t                // Otherwise, play when loaded\n\t                else\n\t                    play_on_load = true;\n\n\t            }\n\t            \n\t            /** @ignore */\n\t            this.play = function(when) {\n\t                \n\t                // Calculate time until play\n\t                var now = Guacamole.AudioChannel.getTimestamp();\n\t                var delay = when - now;\n\t                \n\t                // Play now if too late\n\t                if (delay < 0)\n\t                    play();\n\n\t                // Otherwise, schedule later playback\n\t                else\n\t                    window.setTimeout(play, delay);\n\n\t            };\n\n\t        }\n\n\t    }\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * An input stream abstraction used by the Guacamole client to facilitate\n\t * transfer of files or other binary data.\n\t * \n\t * @constructor\n\t * @param {Guacamole.Client} client The client owning this stream.\n\t * @param {Number} index The index of this stream.\n\t */\n\tGuacamole.InputStream = function(client, index) {\n\n\t    /**\n\t     * Reference to this stream.\n\t     * @private\n\t     */\n\t    var guac_stream = this;\n\n\t    /**\n\t     * The index of this stream.\n\t     * @type Number\n\t     */\n\t    this.index = index;\n\n\t    /**\n\t     * Called when a blob of data is received.\n\t     * \n\t     * @event\n\t     * @param {String} data The received base64 data.\n\t     */\n\t    this.onblob = null;\n\n\t    /**\n\t     * Called when this stream is closed.\n\t     * \n\t     * @event\n\t     */\n\t    this.onend = null;\n\n\t    /**\n\t     * Acknowledges the receipt of a blob.\n\t     * \n\t     * @param {String} message A human-readable message describing the error\n\t     *                         or status.\n\t     * @param {Number} code The error code, if any, or 0 for success.\n\t     */\n\t    this.sendAck = function(message, code) {\n\t        client.sendAck(guac_stream.index, message, code);\n\t    };\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Integer pool which returns consistently increasing integers while integers\n\t * are in use, and previously-used integers when possible.\n\t * @constructor \n\t */\n\tGuacamole.IntegerPool = function() {\n\n\t    /**\n\t     * Reference to this integer pool.\n\t     */\n\t    var guac_pool = this;\n\n\t    /**\n\t     * Array of available integers.\n\t     * @type Number[]\n\t     */\n\t    var pool = [];\n\n\t    /**\n\t     * The next integer to return if no more integers remain.\n\t     * @type Number\n\t     */\n\t    this.next_int = 0;\n\n\t    /**\n\t     * Returns the next available integer in the pool. If possible, a previously\n\t     * used integer will be returned.\n\t     * \n\t     * @return {Number} The next available integer.\n\t     */\n\t    this.next = function() {\n\n\t        // If free'd integers exist, return one of those\n\t        if (pool.length > 0)\n\t            return pool.shift();\n\n\t        // Otherwise, return a new integer\n\t        return guac_pool.next_int++;\n\n\t    };\n\n\t    /**\n\t     * Frees the given integer, allowing it to be reused.\n\t     * \n\t     * @param {Number} integer The integer to free.\n\t     */\n\t    this.free = function(integer) {\n\t        pool.push(integer);\n\t    };\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Provides cross-browser and cross-keyboard keyboard for a specific element.\n\t * Browser and keyboard layout variation is abstracted away, providing events\n\t * which represent keys as their corresponding X11 keysym.\n\t * \n\t * @constructor\n\t * @param {Element} element The Element to use to provide keyboard events.\n\t */\n\tGuacamole.Keyboard = function(element) {\n\n\t    /**\n\t     * Reference to this Guacamole.Keyboard.\n\t     * @private\n\t     */\n\t    var guac_keyboard = this;\n\n\t    /**\n\t     * Fired whenever the user presses a key with the element associated\n\t     * with this Guacamole.Keyboard in focus.\n\t     * \n\t     * @event\n\t     * @param {Number} keysym The keysym of the key being pressed.\n\t     * @return {Boolean} true if the key event should be allowed through to the\n\t     *                   browser, false otherwise.\n\t     */\n\t    this.onkeydown = null;\n\n\t    /**\n\t     * Fired whenever the user releases a key with the element associated\n\t     * with this Guacamole.Keyboard in focus.\n\t     * \n\t     * @event\n\t     * @param {Number} keysym The keysym of the key being released.\n\t     */\n\t    this.onkeyup = null;\n\n\t    /**\n\t     * A key event having a corresponding timestamp. This event is non-specific.\n\t     * Its subclasses should be used instead when recording specific key\n\t     * events.\n\t     *\n\t     * @private\n\t     * @constructor\n\t     */\n\t    var KeyEvent = function() {\n\n\t        /**\n\t         * Reference to this key event.\n\t         */\n\t        var key_event = this;\n\n\t        /**\n\t         * An arbitrary timestamp in milliseconds, indicating this event's\n\t         * position in time relative to other events.\n\t         *\n\t         * @type Number\n\t         */\n\t        this.timestamp = new Date().getTime();\n\n\t        /**\n\t         * Whether the default action of this key event should be prevented.\n\t         *\n\t         * @type Boolean\n\t         */\n\t        this.defaultPrevented = false;\n\n\t        /**\n\t         * The keysym of the key associated with this key event, as determined\n\t         * by a best-effort guess using available event properties and keyboard\n\t         * state.\n\t         *\n\t         * @type Number\n\t         */\n\t        this.keysym = null;\n\n\t        /**\n\t         * Whether the keysym value of this key event is known to be reliable.\n\t         * If false, the keysym may still be valid, but it's only a best guess,\n\t         * and future key events may be a better source of information.\n\t         *\n\t         * @type Boolean\n\t         */\n\t        this.reliable = false;\n\n\t        /**\n\t         * Returns the number of milliseconds elapsed since this event was\n\t         * received.\n\t         *\n\t         * @return {Number} The number of milliseconds elapsed since this\n\t         *                  event was received.\n\t         */\n\t        this.getAge = function() {\n\t            return new Date().getTime() - key_event.timestamp;\n\t        };\n\n\t    };\n\n\t    /**\n\t     * Information related to the pressing of a key, which need not be a key\n\t     * associated with a printable character. The presence or absence of any\n\t     * information within this object is browser-dependent.\n\t     *\n\t     * @private\n\t     * @constructor\n\t     * @augments Guacamole.Keyboard.KeyEvent\n\t     * @param {Number} keyCode The JavaScript key code of the key pressed.\n\t     * @param {String} keyIdentifier The legacy DOM3 \"keyIdentifier\" of the key\n\t     *                               pressed, as defined at:\n\t     *                               http://www.w3.org/TR/2009/WD-DOM-Level-3-Events-20090908/#events-Events-KeyboardEvent\n\t     * @param {String} key The standard name of the key pressed, as defined at:\n\t     *                     http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t     * @param {Number} location The location on the keyboard corresponding to\n\t     *                          the key pressed, as defined at:\n\t     *                          http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t     */\n\t    var KeydownEvent = function(keyCode, keyIdentifier, key, location) {\n\n\t        // We extend KeyEvent\n\t        KeyEvent.apply(this);\n\n\t        /**\n\t         * The JavaScript key code of the key pressed.\n\t         *\n\t         * @type Number\n\t         */\n\t        this.keyCode = keyCode;\n\n\t        /**\n\t         * The legacy DOM3 \"keyIdentifier\" of the key pressed, as defined at:\n\t         * http://www.w3.org/TR/2009/WD-DOM-Level-3-Events-20090908/#events-Events-KeyboardEvent\n\t         *\n\t         * @type String\n\t         */\n\t        this.keyIdentifier = keyIdentifier;\n\n\t        /**\n\t         * The standard name of the key pressed, as defined at:\n\t         * http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t         * \n\t         * @type String\n\t         */\n\t        this.key = key;\n\n\t        /**\n\t         * The location on the keyboard corresponding to the key pressed, as\n\t         * defined at:\n\t         * http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t         * \n\t         * @type Number\n\t         */\n\t        this.location = location;\n\n\t        // If key is known from keyCode or DOM3 alone, use that\n\t        this.keysym =  keysym_from_key_identifier(key, location)\n\t                    || keysym_from_keycode(keyCode, location);\n\n\t        // DOM3 and keyCode are reliable sources\n\t        if (this.keysym)\n\t            this.reliable = true;\n\n\t        // Use legacy keyIdentifier as a last resort, if it looks sane\n\t        if (!this.keysym && key_identifier_sane(keyCode, keyIdentifier))\n\t            this.keysym = keysym_from_key_identifier(keyIdentifier, location, guac_keyboard.modifiers.shift);\n\n\t        // Determine whether default action for Alt+combinations must be prevented\n\t        var prevent_alt =  !guac_keyboard.modifiers.ctrl\n\t                        && !(navigator && navigator.platform && navigator.platform.match(/^mac/i));\n\n\t        // Determine whether default action for Ctrl+combinations must be prevented\n\t        var prevent_ctrl = !guac_keyboard.modifiers.alt;\n\n\t        // We must rely on the (potentially buggy) keyIdentifier if preventing\n\t        // the default action is important\n\t        if ((prevent_ctrl && guac_keyboard.modifiers.ctrl)\n\t         || (prevent_alt  && guac_keyboard.modifiers.alt)\n\t         || guac_keyboard.modifiers.meta\n\t         || guac_keyboard.modifiers.hyper)\n\t            this.reliable = true;\n\n\t        // Record most recently known keysym by associated key code\n\t        recentKeysym[keyCode] = this.keysym;\n\n\t    };\n\n\t    KeydownEvent.prototype = new KeyEvent();\n\n\t    /**\n\t     * Information related to the pressing of a key, which MUST be\n\t     * associated with a printable character. The presence or absence of any\n\t     * information within this object is browser-dependent.\n\t     *\n\t     * @private\n\t     * @constructor\n\t     * @augments Guacamole.Keyboard.KeyEvent\n\t     * @param {Number} charCode The Unicode codepoint of the character that\n\t     *                          would be typed by the key pressed.\n\t     */\n\t    var KeypressEvent = function(charCode) {\n\n\t        // We extend KeyEvent\n\t        KeyEvent.apply(this);\n\n\t        /**\n\t         * The Unicode codepoint of the character that would be typed by the\n\t         * key pressed.\n\t         *\n\t         * @type Number\n\t         */\n\t        this.charCode = charCode;\n\n\t        // Pull keysym from char code\n\t        this.keysym = keysym_from_charcode(charCode);\n\n\t        // Keypress is always reliable\n\t        this.reliable = true;\n\n\t    };\n\n\t    KeypressEvent.prototype = new KeyEvent();\n\n\t    /**\n\t     * Information related to the pressing of a key, which need not be a key\n\t     * associated with a printable character. The presence or absence of any\n\t     * information within this object is browser-dependent.\n\t     *\n\t     * @private\n\t     * @constructor\n\t     * @augments Guacamole.Keyboard.KeyEvent\n\t     * @param {Number} keyCode The JavaScript key code of the key released.\n\t     * @param {String} keyIdentifier The legacy DOM3 \"keyIdentifier\" of the key\n\t     *                               released, as defined at:\n\t     *                               http://www.w3.org/TR/2009/WD-DOM-Level-3-Events-20090908/#events-Events-KeyboardEvent\n\t     * @param {String} key The standard name of the key released, as defined at:\n\t     *                     http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t     * @param {Number} location The location on the keyboard corresponding to\n\t     *                          the key released, as defined at:\n\t     *                          http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t     */\n\t    var KeyupEvent = function(keyCode, keyIdentifier, key, location) {\n\n\t        // We extend KeyEvent\n\t        KeyEvent.apply(this);\n\n\t        /**\n\t         * The JavaScript key code of the key released.\n\t         *\n\t         * @type Number\n\t         */\n\t        this.keyCode = keyCode;\n\n\t        /**\n\t         * The legacy DOM3 \"keyIdentifier\" of the key released, as defined at:\n\t         * http://www.w3.org/TR/2009/WD-DOM-Level-3-Events-20090908/#events-Events-KeyboardEvent\n\t         *\n\t         * @type String\n\t         */\n\t        this.keyIdentifier = keyIdentifier;\n\n\t        /**\n\t         * The standard name of the key released, as defined at:\n\t         * http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t         * \n\t         * @type String\n\t         */\n\t        this.key = key;\n\n\t        /**\n\t         * The location on the keyboard corresponding to the key released, as\n\t         * defined at:\n\t         * http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t         * \n\t         * @type Number\n\t         */\n\t        this.location = location;\n\n\t        // If key is known from keyCode or DOM3 alone, use that\n\t        this.keysym =  recentKeysym[keyCode]\n\t                    || keysym_from_keycode(keyCode, location)\n\t                    || keysym_from_key_identifier(key, location); // keyCode is still more reliable for keyup when dead keys are in use\n\n\t        // Keyup is as reliable as it will ever be\n\t        this.reliable = true;\n\n\t    };\n\n\t    KeyupEvent.prototype = new KeyEvent();\n\n\t    /**\n\t     * An array of recorded events, which can be instances of the private\n\t     * KeydownEvent, KeypressEvent, and KeyupEvent classes.\n\t     *\n\t     * @type (KeydownEvent|KeypressEvent|KeyupEvent)[]\n\t     */\n\t    var eventLog = [];\n\n\t    /**\n\t     * Map of known JavaScript keycodes which do not map to typable characters\n\t     * to their X11 keysym equivalents.\n\t     * @private\n\t     */\n\t    var keycodeKeysyms = {\n\t        8:   [0xFF08], // backspace\n\t        9:   [0xFF09], // tab\n\t        13:  [0xFF0D], // enter\n\t        16:  [0xFFE1, 0xFFE1, 0xFFE2], // shift\n\t        17:  [0xFFE3, 0xFFE3, 0xFFE4], // ctrl\n\t        18:  [0xFFE9, 0xFFE9, 0xFE03], // alt\n\t        19:  [0xFF13], // pause/break\n\t        20:  [0xFFE5], // caps lock\n\t        27:  [0xFF1B], // escape\n\t        32:  [0x0020], // space\n\t        33:  [0xFF55], // page up\n\t        34:  [0xFF56], // page down\n\t        35:  [0xFF57], // end\n\t        36:  [0xFF50], // home\n\t        37:  [0xFF51], // left arrow\n\t        38:  [0xFF52], // up arrow\n\t        39:  [0xFF53], // right arrow\n\t        40:  [0xFF54], // down arrow\n\t        45:  [0xFF63], // insert\n\t        46:  [0xFFFF], // delete\n\t        91:  [0xFFEB], // left window key (hyper_l)\n\t        92:  [0xFF67], // right window key (menu key?)\n\t        93:  null,     // select key\n\t        112: [0xFFBE], // f1\n\t        113: [0xFFBF], // f2\n\t        114: [0xFFC0], // f3\n\t        115: [0xFFC1], // f4\n\t        116: [0xFFC2], // f5\n\t        117: [0xFFC3], // f6\n\t        118: [0xFFC4], // f7\n\t        119: [0xFFC5], // f8\n\t        120: [0xFFC6], // f9\n\t        121: [0xFFC7], // f10\n\t        122: [0xFFC8], // f11\n\t        123: [0xFFC9], // f12\n\t        144: [0xFF7F], // num lock\n\t        145: [0xFF14], // scroll lock\n\t        225: [0xFE03]  // altgraph (iso_level3_shift)\n\t    };\n\n\t    /**\n\t     * Map of known JavaScript keyidentifiers which do not map to typable\n\t     * characters to their unshifted X11 keysym equivalents.\n\t     * @private\n\t     */\n\t    var keyidentifier_keysym = {\n\t        \"Again\": [0xFF66],\n\t        \"AllCandidates\": [0xFF3D],\n\t        \"Alphanumeric\": [0xFF30],\n\t        \"Alt\": [0xFFE9, 0xFFE9, 0xFE03],\n\t        \"Attn\": [0xFD0E],\n\t        \"AltGraph\": [0xFE03],\n\t        \"ArrowDown\": [0xFF54],\n\t        \"ArrowLeft\": [0xFF51],\n\t        \"ArrowRight\": [0xFF53],\n\t        \"ArrowUp\": [0xFF52],\n\t        \"Backspace\": [0xFF08],\n\t        \"CapsLock\": [0xFFE5],\n\t        \"Cancel\": [0xFF69],\n\t        \"Clear\": [0xFF0B],\n\t        \"Convert\": [0xFF21],\n\t        \"Copy\": [0xFD15],\n\t        \"Crsel\": [0xFD1C],\n\t        \"CrSel\": [0xFD1C],\n\t        \"CodeInput\": [0xFF37],\n\t        \"Compose\": [0xFF20],\n\t        \"Control\": [0xFFE3, 0xFFE3, 0xFFE4],\n\t        \"ContextMenu\": [0xFF67],\n\t        \"DeadGrave\": [0xFE50],\n\t        \"DeadAcute\": [0xFE51],\n\t        \"DeadCircumflex\": [0xFE52],\n\t        \"DeadTilde\": [0xFE53],\n\t        \"DeadMacron\": [0xFE54],\n\t        \"DeadBreve\": [0xFE55],\n\t        \"DeadAboveDot\": [0xFE56],\n\t        \"DeadUmlaut\": [0xFE57],\n\t        \"DeadAboveRing\": [0xFE58],\n\t        \"DeadDoubleacute\": [0xFE59],\n\t        \"DeadCaron\": [0xFE5A],\n\t        \"DeadCedilla\": [0xFE5B],\n\t        \"DeadOgonek\": [0xFE5C],\n\t        \"DeadIota\": [0xFE5D],\n\t        \"DeadVoicedSound\": [0xFE5E],\n\t        \"DeadSemivoicedSound\": [0xFE5F],\n\t        \"Delete\": [0xFFFF],\n\t        \"Down\": [0xFF54],\n\t        \"End\": [0xFF57],\n\t        \"Enter\": [0xFF0D],\n\t        \"EraseEof\": [0xFD06],\n\t        \"Escape\": [0xFF1B],\n\t        \"Execute\": [0xFF62],\n\t        \"Exsel\": [0xFD1D],\n\t        \"ExSel\": [0xFD1D],\n\t        \"F1\": [0xFFBE],\n\t        \"F2\": [0xFFBF],\n\t        \"F3\": [0xFFC0],\n\t        \"F4\": [0xFFC1],\n\t        \"F5\": [0xFFC2],\n\t        \"F6\": [0xFFC3],\n\t        \"F7\": [0xFFC4],\n\t        \"F8\": [0xFFC5],\n\t        \"F9\": [0xFFC6],\n\t        \"F10\": [0xFFC7],\n\t        \"F11\": [0xFFC8],\n\t        \"F12\": [0xFFC9],\n\t        \"F13\": [0xFFCA],\n\t        \"F14\": [0xFFCB],\n\t        \"F15\": [0xFFCC],\n\t        \"F16\": [0xFFCD],\n\t        \"F17\": [0xFFCE],\n\t        \"F18\": [0xFFCF],\n\t        \"F19\": [0xFFD0],\n\t        \"F20\": [0xFFD1],\n\t        \"F21\": [0xFFD2],\n\t        \"F22\": [0xFFD3],\n\t        \"F23\": [0xFFD4],\n\t        \"F24\": [0xFFD5],\n\t        \"Find\": [0xFF68],\n\t        \"GroupFirst\": [0xFE0C],\n\t        \"GroupLast\": [0xFE0E],\n\t        \"GroupNext\": [0xFE08],\n\t        \"GroupPrevious\": [0xFE0A],\n\t        \"FullWidth\": null,\n\t        \"HalfWidth\": null,\n\t        \"HangulMode\": [0xFF31],\n\t        \"Hankaku\": [0xFF29],\n\t        \"HanjaMode\": [0xFF34],\n\t        \"Help\": [0xFF6A],\n\t        \"Hiragana\": [0xFF25],\n\t        \"HiraganaKatakana\": [0xFF27],\n\t        \"Home\": [0xFF50],\n\t        \"Hyper\": [0xFFED, 0xFFED, 0xFFEE],\n\t        \"Insert\": [0xFF63],\n\t        \"JapaneseHiragana\": [0xFF25],\n\t        \"JapaneseKatakana\": [0xFF26],\n\t        \"JapaneseRomaji\": [0xFF24],\n\t        \"JunjaMode\": [0xFF38],\n\t        \"KanaMode\": [0xFF2D],\n\t        \"KanjiMode\": [0xFF21],\n\t        \"Katakana\": [0xFF26],\n\t        \"Left\": [0xFF51],\n\t        \"Meta\": [0xFFE7, 0xFFE7, 0xFFE8],\n\t        \"ModeChange\": [0xFF7E],\n\t        \"NumLock\": [0xFF7F],\n\t        \"PageDown\": [0xFF56],\n\t        \"PageUp\": [0xFF55],\n\t        \"Pause\": [0xFF13],\n\t        \"Play\": [0xFD16],\n\t        \"PreviousCandidate\": [0xFF3E],\n\t        \"PrintScreen\": [0xFD1D],\n\t        \"Redo\": [0xFF66],\n\t        \"Right\": [0xFF53],\n\t        \"RomanCharacters\": null,\n\t        \"Scroll\": [0xFF14],\n\t        \"Select\": [0xFF60],\n\t        \"Separator\": [0xFFAC],\n\t        \"Shift\": [0xFFE1, 0xFFE1, 0xFFE2],\n\t        \"SingleCandidate\": [0xFF3C],\n\t        \"Super\": [0xFFEB, 0xFFEB, 0xFFEC],\n\t        \"Tab\": [0xFF09],\n\t        \"Up\": [0xFF52],\n\t        \"Undo\": [0xFF65],\n\t        \"Win\": [0xFFEB],\n\t        \"Zenkaku\": [0xFF28],\n\t        \"ZenkakuHankaku\": [0xFF2A]\n\t    };\n\n\t    /**\n\t     * All keysyms which should not repeat when held down.\n\t     * @private\n\t     */\n\t    var no_repeat = {\n\t        0xFE03: true, // ISO Level 3 Shift (AltGr)\n\t        0xFFE1: true, // Left shift\n\t        0xFFE2: true, // Right shift\n\t        0xFFE3: true, // Left ctrl \n\t        0xFFE4: true, // Right ctrl \n\t        0xFFE7: true, // Left meta \n\t        0xFFE8: true, // Right meta \n\t        0xFFE9: true, // Left alt\n\t        0xFFEA: true, // Right alt\n\t        0xFFEB: true, // Left hyper\n\t        0xFFEC: true  // Right hyper\n\t    };\n\n\t    /**\n\t     * All modifiers and their states.\n\t     */\n\t    this.modifiers = new Guacamole.Keyboard.ModifierState();\n\t        \n\t    /**\n\t     * The state of every key, indexed by keysym. If a particular key is\n\t     * pressed, the value of pressed for that keysym will be true. If a key\n\t     * is not currently pressed, it will not be defined. \n\t     */\n\t    this.pressed = {};\n\n\t    /**\n\t     * The last result of calling the onkeydown handler for each key, indexed\n\t     * by keysym. This is used to prevent/allow default actions for key events,\n\t     * even when the onkeydown handler cannot be called again because the key\n\t     * is (theoretically) still pressed.\n\t     */\n\t    var last_keydown_result = {};\n\n\t    /**\n\t     * The keysym most recently associated with a given keycode when keydown\n\t     * fired. This object maps keycodes to keysyms.\n\t     *\n\t     * @private\n\t     * @type Object.<Number, Number>\n\t     */\n\t    var recentKeysym = {};\n\n\t    /**\n\t     * Timeout before key repeat starts.\n\t     * @private\n\t     */\n\t    var key_repeat_timeout = null;\n\n\t    /**\n\t     * Interval which presses and releases the last key pressed while that\n\t     * key is still being held down.\n\t     * @private\n\t     */\n\t    var key_repeat_interval = null;\n\n\t    /**\n\t     * Given an array of keysyms indexed by location, returns the keysym\n\t     * for the given location, or the keysym for the standard location if\n\t     * undefined.\n\t     * \n\t     * @param {Array} keysyms An array of keysyms, where the index of the\n\t     *                        keysym in the array is the location value.\n\t     * @param {Number} location The location on the keyboard corresponding to\n\t     *                          the key pressed, as defined at:\n\t     *                          http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t     */\n\t    function get_keysym(keysyms, location) {\n\n\t        if (!keysyms)\n\t            return null;\n\n\t        return keysyms[location] || keysyms[0];\n\t    }\n\n\t    function keysym_from_key_identifier(identifier, location, shifted) {\n\n\t        if (!identifier)\n\t            return null;\n\n\t        var typedCharacter;\n\n\t        // If identifier is U+xxxx, decode Unicode character \n\t        var unicodePrefixLocation = identifier.indexOf(\"U+\");\n\t        if (unicodePrefixLocation >= 0) {\n\t            var hex = identifier.substring(unicodePrefixLocation+2);\n\t            typedCharacter = String.fromCharCode(parseInt(hex, 16));\n\t        }\n\n\t        // If single character, use that as typed character\n\t        else if (identifier.length === 1)\n\t            typedCharacter = identifier;\n\n\t        // Otherwise, look up corresponding keysym\n\t        else\n\t            return get_keysym(keyidentifier_keysym[identifier], location);\n\n\t        // Alter case if necessary\n\t        if (shifted === true)\n\t            typedCharacter = typedCharacter.toUpperCase();\n\t        else if (shifted === false)\n\t            typedCharacter = typedCharacter.toLowerCase();\n\n\t        // Get codepoint\n\t        var codepoint = typedCharacter.charCodeAt(0);\n\t        return keysym_from_charcode(codepoint);\n\n\t    }\n\n\t    function isControlCharacter(codepoint) {\n\t        return codepoint <= 0x1F || (codepoint >= 0x7F && codepoint <= 0x9F);\n\t    }\n\n\t    function keysym_from_charcode(codepoint) {\n\n\t        // Keysyms for control characters\n\t        if (isControlCharacter(codepoint)) return 0xFF00 | codepoint;\n\n\t        // Keysyms for ASCII chars\n\t        if (codepoint >= 0x0000 && codepoint <= 0x00FF)\n\t            return codepoint;\n\n\t        // Keysyms for Unicode\n\t        if (codepoint >= 0x0100 && codepoint <= 0x10FFFF)\n\t            return 0x01000000 | codepoint;\n\n\t        return null;\n\n\t    }\n\n\t    function keysym_from_keycode(keyCode, location) {\n\t        return get_keysym(keycodeKeysyms[keyCode], location);\n\t    }\n\n\t    /**\n\t     * Heuristically detects if the legacy keyIdentifier property of\n\t     * a keydown/keyup event looks incorrectly derived. Chrome, and\n\t     * presumably others, will produce the keyIdentifier by assuming\n\t     * the keyCode is the Unicode codepoint for that key. This is not\n\t     * correct in all cases.\n\t     *\n\t     * @param {Number} keyCode The keyCode from a browser keydown/keyup\n\t     *                         event.\n\t     * @param {String} keyIdentifier The legacy keyIdentifier from a\n\t     *                               browser keydown/keyup event.\n\t     * @returns {Boolean} true if the keyIdentifier looks sane, false if\n\t     *                    the keyIdentifier appears incorrectly derived or\n\t     *                    is missing entirely.\n\t     */\n\t    function key_identifier_sane(keyCode, keyIdentifier) {\n\n\t        // Missing identifier is not sane\n\t        if (!keyIdentifier)\n\t            return false;\n\n\t        // Assume non-Unicode keyIdentifier values are sane\n\t        var unicodePrefixLocation = keyIdentifier.indexOf(\"U+\");\n\t        if (unicodePrefixLocation === -1)\n\t            return true;\n\n\t        // If the Unicode codepoint isn't identical to the keyCode,\n\t        // then the identifier is likely correct\n\t        var codepoint = parseInt(keyIdentifier.substring(unicodePrefixLocation+2), 16);\n\t        if (keyCode !== codepoint)\n\t            return true;\n\n\t        // The keyCodes for A-Z and 0-9 are actually identical to their\n\t        // Unicode codepoints\n\t        if ((keyCode >= 65 && keyCode <= 90) || (keyCode >= 48 && keyCode <= 57))\n\t            return true;\n\n\t        // The keyIdentifier does NOT appear sane\n\t        return false;\n\n\t    }\n\n\t    /**\n\t     * Marks a key as pressed, firing the keydown event if registered. Key\n\t     * repeat for the pressed key will start after a delay if that key is\n\t     * not a modifier. The return value of this function depends on the\n\t     * return value of the keydown event handler, if any.\n\t     * \n\t     * @param {Number} keysym The keysym of the key to press.\n\t     * @return {Boolean} true if event should NOT be canceled, false otherwise.\n\t     */\n\t    this.press = function(keysym) {\n\n\t        // Don't bother with pressing the key if the key is unknown\n\t        if (keysym === null) return;\n\n\t        // Only press if released\n\t        if (!guac_keyboard.pressed[keysym]) {\n\n\t            // Mark key as pressed\n\t            guac_keyboard.pressed[keysym] = true;\n\n\t            // Send key event\n\t            if (guac_keyboard.onkeydown) {\n\t                var result = guac_keyboard.onkeydown(keysym);\n\t                last_keydown_result[keysym] = result;\n\n\t                // Stop any current repeat\n\t                window.clearTimeout(key_repeat_timeout);\n\t                window.clearInterval(key_repeat_interval);\n\n\t                // Repeat after a delay as long as pressed\n\t                if (!no_repeat[keysym])\n\t                    key_repeat_timeout = window.setTimeout(function() {\n\t                        key_repeat_interval = window.setInterval(function() {\n\t                            guac_keyboard.onkeyup(keysym);\n\t                            guac_keyboard.onkeydown(keysym);\n\t                        }, 50);\n\t                    }, 500);\n\n\t                return result;\n\t            }\n\t        }\n\n\t        // Return the last keydown result by default, resort to false if unknown\n\t        return last_keydown_result[keysym] || false;\n\n\t    };\n\n\t    /**\n\t     * Marks a key as released, firing the keyup event if registered.\n\t     * \n\t     * @param {Number} keysym The keysym of the key to release.\n\t     */\n\t    this.release = function(keysym) {\n\n\t        // Only release if pressed\n\t        if (guac_keyboard.pressed[keysym]) {\n\t            \n\t            // Mark key as released\n\t            delete guac_keyboard.pressed[keysym];\n\n\t            // Stop repeat\n\t            window.clearTimeout(key_repeat_timeout);\n\t            window.clearInterval(key_repeat_interval);\n\n\t            // Send key event\n\t            if (keysym !== null && guac_keyboard.onkeyup)\n\t                guac_keyboard.onkeyup(keysym);\n\n\t        }\n\n\t    };\n\n\t    /**\n\t     * Resets the state of this keyboard, releasing all keys, and firing keyup\n\t     * events for each released key.\n\t     */\n\t    this.reset = function() {\n\n\t        // Release all pressed keys\n\t        for (var keysym in guac_keyboard.pressed)\n\t            guac_keyboard.release(parseInt(keysym));\n\n\t        // Clear event log\n\t        eventLog = [];\n\n\t    };\n\n\t    /**\n\t     * Given a keyboard event, updates the local modifier state and remote\n\t     * key state based on the modifier flags within the event. This function\n\t     * pays no attention to keycodes.\n\t     * \n\t     * @param {KeyboardEvent} e The keyboard event containing the flags to update.\n\t     */\n\t    function update_modifier_state(e) {\n\n\t        // Get state\n\t        var state = Guacamole.Keyboard.ModifierState.fromKeyboardEvent(e);\n\n\t        // Release alt if implicitly released\n\t        if (guac_keyboard.modifiers.alt && state.alt === false) {\n\t            guac_keyboard.release(0xFFE9); // Left alt\n\t            guac_keyboard.release(0xFFEA); // Right alt\n\t            guac_keyboard.release(0xFE03); // AltGr\n\t        }\n\n\t        // Release shift if implicitly released\n\t        if (guac_keyboard.modifiers.shift && state.shift === false) {\n\t            guac_keyboard.release(0xFFE1); // Left shift\n\t            guac_keyboard.release(0xFFE2); // Right shift\n\t        }\n\n\t        // Release ctrl if implicitly released\n\t        if (guac_keyboard.modifiers.ctrl && state.ctrl === false) {\n\t            guac_keyboard.release(0xFFE3); // Left ctrl \n\t            guac_keyboard.release(0xFFE4); // Right ctrl \n\t        }\n\n\t        // Release meta if implicitly released\n\t        if (guac_keyboard.modifiers.meta && state.meta === false) {\n\t            guac_keyboard.release(0xFFE7); // Left meta \n\t            guac_keyboard.release(0xFFE8); // Right meta \n\t        }\n\n\t        // Release hyper if implicitly released\n\t        if (guac_keyboard.modifiers.hyper && state.hyper === false) {\n\t            guac_keyboard.release(0xFFEB); // Left hyper\n\t            guac_keyboard.release(0xFFEC); // Right hyper\n\t        }\n\n\t        // Update state\n\t        guac_keyboard.modifiers = state;\n\n\t    }\n\n\t    /**\n\t     * Reads through the event log, removing events from the head of the log\n\t     * when the corresponding true key presses are known (or as known as they\n\t     * can be).\n\t     * \n\t     * @return {Boolean} Whether the default action of the latest event should\n\t     *                   be prevented.\n\t     */\n\t    function interpret_events() {\n\n\t        // Do not prevent default if no event could be interpreted\n\t        var handled_event = interpret_event();\n\t        if (!handled_event)\n\t            return false;\n\n\t        // Interpret as much as possible\n\t        var last_event;\n\t        do {\n\t            last_event = handled_event;\n\t            handled_event = interpret_event();\n\t        } while (handled_event !== null);\n\n\t        return last_event.defaultPrevented;\n\n\t    }\n\n\t    /**\n\t     * Releases Ctrl+Alt, if both are currently pressed and the given keysym\n\t     * looks like a key that may require AltGr.\n\t     * \n\t     * @param {Number} keysym The key that was just pressed.\n\t     */\n\t    function release_simulated_altgr(keysym) {\n\n\t        // Both Ctrl+Alt must be pressed if simulated AltGr is in use\n\t        if (!guac_keyboard.modifiers.ctrl || !guac_keyboard.modifiers.alt)\n\t            return;\n\n\t        // Assume [A-Z] never require AltGr\n\t        if (keysym >= 0x0041 && keysym <= 0x005A)\n\t            return;\n\n\t        // Assume [a-z] never require AltGr\n\t        if (keysym >= 0x0061 && keysym <= 0x007A)\n\t            return;\n\n\t        // Release Ctrl+Alt if the keysym is printable\n\t        if (keysym <= 0xFF || (keysym & 0xFF000000) === 0x01000000) {\n\t            guac_keyboard.release(0xFFE3); // Left ctrl \n\t            guac_keyboard.release(0xFFE4); // Right ctrl \n\t            guac_keyboard.release(0xFFE9); // Left alt\n\t            guac_keyboard.release(0xFFEA); // Right alt\n\t        }\n\n\t    }\n\n\t    /**\n\t     * Reads through the event log, interpreting the first event, if possible,\n\t     * and returning that event. If no events can be interpreted, due to a\n\t     * total lack of events or the need for more events, null is returned. Any\n\t     * interpreted events are automatically removed from the log.\n\t     * \n\t     * @return {KeyEvent} The first key event in the log, if it can be\n\t     *                    interpreted, or null otherwise.\n\t     */\n\t    function interpret_event() {\n\n\t        // Peek at first event in log\n\t        var first = eventLog[0];\n\t        if (!first)\n\t            return null;\n\n\t        // Keydown event\n\t        if (first instanceof KeydownEvent) {\n\n\t            var keysym = null;\n\t            var accepted_events = [];\n\n\t            // If event itself is reliable, no need to wait for other events\n\t            if (first.reliable) {\n\t                keysym = first.keysym;\n\t                accepted_events = eventLog.splice(0, 1);\n\t            }\n\n\t            // If keydown is immediately followed by a keypress, use the indicated character\n\t            else if (eventLog[1] instanceof KeypressEvent) {\n\t                keysym = eventLog[1].keysym;\n\t                accepted_events = eventLog.splice(0, 2);\n\t            }\n\n\t            // If keydown is immediately followed by anything else, then no\n\t            // keypress can possibly occur to clarify this event, and we must\n\t            // handle it now\n\t            else if (eventLog[1]) {\n\t                keysym = first.keysym;\n\t                accepted_events = eventLog.splice(0, 1);\n\t            }\n\n\t            // Fire a key press if valid events were found\n\t            if (accepted_events.length > 0) {\n\n\t                if (keysym) {\n\n\t                    // Fire event\n\t                    release_simulated_altgr(keysym);\n\t                    var defaultPrevented = !guac_keyboard.press(keysym);\n\t                    recentKeysym[first.keyCode] = keysym;\n\n\t                    // If a key is pressed while meta is held down, the keyup will\n\t                    // never be sent in Chrome, so send it now. (bug #108404)\n\t                    if (guac_keyboard.modifiers.meta && keysym !== 0xFFE7 && keysym !== 0xFFE8)\n\t                        guac_keyboard.release(keysym);\n\n\t                    // Record whether default was prevented\n\t                    for (var i=0; i<accepted_events.length; i++)\n\t                        accepted_events[i].defaultPrevented = defaultPrevented;\n\n\t                }\n\n\t                return first;\n\n\t            }\n\n\t        } // end if keydown\n\n\t        // Keyup event\n\t        else if (first instanceof KeyupEvent) {\n\n\t            var keysym = first.keysym;\n\t            if (keysym) {\n\t                guac_keyboard.release(keysym);\n\t                first.defaultPrevented = true;\n\t            }\n\t            else\n\t                guac_keyboard.reset();\n\n\t            return eventLog.shift();\n\n\t        } // end if keyup\n\n\t        // Ignore any other type of event (keypress by itself is invalid)\n\t        else\n\t            return eventLog.shift();\n\n\t        // No event interpreted\n\t        return null;\n\n\t    }\n\n\t    /**\n\t     * Returns the keyboard location of the key associated with the given\n\t     * keyboard event. The location differentiates key events which otherwise\n\t     * have the same keycode, such as left shift vs. right shift.\n\t     *\n\t     * @param {KeyboardEvent} e\n\t     *     A JavaScript keyboard event, as received through the DOM via a\n\t     *     \"keydown\", \"keyup\", or \"keypress\" handler.\n\t     *\n\t     * @returns {Number}\n\t     *     The location of the key event on the keyboard, as defined at:\n\t     *     http://www.w3.org/TR/DOM-Level-3-Events/#events-KeyboardEvent\n\t     */\n\t    var getEventLocation = function getEventLocation(e) {\n\n\t        // Use standard location, if possible\n\t        if ('location' in e)\n\t            return e.location;\n\n\t        // Failing that, attempt to use deprecated keyLocation\n\t        if ('keyLocation' in e)\n\t            return e.keyLocation;\n\n\t        // If no location is available, assume left side\n\t        return 0;\n\n\t    };\n\n\t    // When key pressed\n\t    element.addEventListener(\"keydown\", function(e) {\n\n\t        // Only intercept if handler set\n\t        if (!guac_keyboard.onkeydown) return;\n\n\t        var keyCode;\n\t        if (window.event) keyCode = window.event.keyCode;\n\t        else if (e.which) keyCode = e.which;\n\n\t        // Fix modifier states\n\t        update_modifier_state(e);\n\n\t        // Ignore (but do not prevent) the \"composition\" keycode sent by some\n\t        // browsers when an IME is in use (see: http://lists.w3.org/Archives/Public/www-dom/2010JulSep/att-0182/keyCode-spec.html)\n\t        if (keyCode === 229)\n\t            return;\n\n\t        // Log event\n\t        var keydownEvent = new KeydownEvent(keyCode, e.keyIdentifier, e.key, getEventLocation(e));\n\t        eventLog.push(keydownEvent);\n\n\t        // Interpret as many events as possible, prevent default if indicated\n\t        if (interpret_events())\n\t            e.preventDefault();\n\n\t    }, true);\n\n\t    // When key pressed\n\t    element.addEventListener(\"keypress\", function(e) {\n\n\t        // Only intercept if handler set\n\t        if (!guac_keyboard.onkeydown && !guac_keyboard.onkeyup) return;\n\n\t        var charCode;\n\t        if (window.event) charCode = window.event.keyCode;\n\t        else if (e.which) charCode = e.which;\n\n\t        // Fix modifier states\n\t        update_modifier_state(e);\n\n\t        // Log event\n\t        var keypressEvent = new KeypressEvent(charCode);\n\t        eventLog.push(keypressEvent);\n\n\t        // Interpret as many events as possible, prevent default if indicated\n\t        if (interpret_events())\n\t            e.preventDefault();\n\n\t    }, true);\n\n\t    // When key released\n\t    element.addEventListener(\"keyup\", function(e) {\n\n\t        // Only intercept if handler set\n\t        if (!guac_keyboard.onkeyup) return;\n\n\t        e.preventDefault();\n\n\t        var keyCode;\n\t        if (window.event) keyCode = window.event.keyCode;\n\t        else if (e.which) keyCode = e.which;\n\t        \n\t        // Fix modifier states\n\t        update_modifier_state(e);\n\n\t        // Log event, call for interpretation\n\t        var keyupEvent = new KeyupEvent(keyCode, e.keyIdentifier, e.key, getEventLocation(e));\n\t        eventLog.push(keyupEvent);\n\t        interpret_events();\n\n\t    }, true);\n\n\t};\n\n\t/**\n\t * The state of all supported keyboard modifiers.\n\t * @constructor\n\t */\n\tGuacamole.Keyboard.ModifierState = function() {\n\t    \n\t    /**\n\t     * Whether shift is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.shift = false;\n\t    \n\t    /**\n\t     * Whether ctrl is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.ctrl = false;\n\t    \n\t    /**\n\t     * Whether alt is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.alt = false;\n\t    \n\t    /**\n\t     * Whether meta (apple key) is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.meta = false;\n\n\t    /**\n\t     * Whether hyper (windows key) is currently pressed.\n\t     * @type Boolean\n\t     */\n\t    this.hyper = false;\n\t    \n\t};\n\n\t/**\n\t * Returns the modifier state applicable to the keyboard event given.\n\t * \n\t * @param {KeyboardEvent} e The keyboard event to read.\n\t * @returns {Guacamole.Keyboard.ModifierState} The current state of keyboard\n\t *                                             modifiers.\n\t */\n\tGuacamole.Keyboard.ModifierState.fromKeyboardEvent = function(e) {\n\t    \n\t    var state = new Guacamole.Keyboard.ModifierState();\n\n\t    // Assign states from old flags\n\t    state.shift = e.shiftKey;\n\t    state.ctrl  = e.ctrlKey;\n\t    state.alt   = e.altKey;\n\t    state.meta  = e.metaKey;\n\n\t    // Use DOM3 getModifierState() for others\n\t    if (e.getModifierState) {\n\t        state.hyper = e.getModifierState(\"OS\")\n\t                   || e.getModifierState(\"Super\")\n\t                   || e.getModifierState(\"Hyper\")\n\t                   || e.getModifierState(\"Win\");\n\t    }\n\n\t    return state;\n\t    \n\t};\n\n\t/*\n\t * Copyright (C) 2014 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * A Guacamole status. Each Guacamole status consists of a status code, defined\n\t * by the protocol, and an optional human-readable message, usually only\n\t * included for debugging convenience.\n\t * \n\t * @param {Number} code The Guacamole status code, as defined by\n\t *                      Guacamole.Status.Code.\n\t * @param {String} [message] An optional human-readable message.\n\t */\n\tGuacamole.Status = function(code, message) {\n\n\t    /**\n\t     * Reference to this Guacamole.Status.\n\t     * @private\n\t     */\n\t    var guac_status = this;\n\n\t    /**\n\t     * The Guacamole status code.\n\t     * @see Guacamole.Status.Code\n\t     * @type Number \n\t     */\n\t    this.code = code;\n\n\t    /**\n\t     * An arbitrary human-readable message associated with this status, if any.\n\t     * The human-readable message is not required, and is generally provided\n\t     * for debugging purposes only. For user feedback, it is better to translate\n\t     * the Guacamole status code into a message.\n\t     * \n\t     * @type String\n\t     */\n\t    this.message = message;\n\n\t    /**\n\t     * Returns whether this status represents an error.\n\t     * @returns {Boolean} true if this status represents an error, false\n\t     *                    otherwise.\n\t     */\n\t    this.isError = function() {\n\t        return guac_status.code < 0 || guac_status.code > 0x00FF;\n\t    };\n\n\t};\n\n\t/**\n\t * Enumeration of all Guacamole status codes.\n\t */\n\tGuacamole.Status.Code = {\n\n\t    /**\n\t     * The operation succeeded.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"SUCCESS\": 0x0000,\n\n\t    /**\n\t     * The requested operation is unsupported.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"UNSUPPORTED\": 0x0100,\n\n\t    /**\n\t     * The operation could not be performed due to an internal failure.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"SERVER_ERROR\": 0x0200,\n\n\t    /**\n\t     * The operation could not be performed as the server is busy.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"SERVER_BUSY\": 0x0201,\n\n\t    /**\n\t     * The operation was unsuccessful due to an error or otherwise unexpected\n\t     * condition of the upstream server.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"UPSTREAM_TIMEOUT\": 0x0202,\n\n\t    /**\n\t     * The operation could not be performed because the upstream server is not\n\t     * responding.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"UPSTREAM_ERROR\": 0x0203,\n\n\t    /**\n\t     * The operation could not be performed as the requested resource does not\n\t     * exist.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"RESOURCE_NOT_FOUND\": 0x0204,\n\n\t    /**\n\t     * The operation could not be performed as the requested resource is\n\t     * already in use.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"RESOURCE_CONFLICT\": 0x0205,\n\n\t    /**\n\t     * The operation could not be performed because bad parameters were given.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_BAD_REQUEST\": 0x0300,\n\n\t    /**\n\t     * Permission was denied to perform the operation, as the user is not yet\n\t     * authorized (not yet logged in, for example).\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_UNAUTHORIZED\": 0x0301,\n\n\t    /**\n\t     * Permission was denied to perform the operation, and this permission will\n\t     * not be granted even if the user is authorized.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_FORBIDDEN\": 0x0303,\n\n\t    /**\n\t     * The client took too long to respond.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_TIMEOUT\": 0x0308,\n\n\t    /**\n\t     * The client sent too much data.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_OVERRUN\": 0x030D,\n\n\t    /**\n\t     * The client sent data of an unsupported or unexpected type.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_BAD_TYPE\": 0x030F,\n\n\t    /**\n\t     * The operation failed because the current client is already using too\n\t     * many resources.\n\t     *\n\t     * @type Number\n\t     */\n\t    \"CLIENT_TOO_MANY\": 0x031D\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * A writer which automatically writes to the given output stream with arbitrary\n\t * binary data, supplied as ArrayBuffers.\n\t * \n\t * @constructor\n\t * @param {Guacamole.OutputStream} stream The stream that data will be written\n\t *                                        to.\n\t */\n\tGuacamole.ArrayBufferWriter = function(stream) {\n\n\t    /**\n\t     * Reference to this Guacamole.StringWriter.\n\t     * @private\n\t     */\n\t    var guac_writer = this;\n\n\t    // Simply call onack for acknowledgements\n\t    stream.onack = function(status) {\n\t        if (guac_writer.onack)\n\t            guac_writer.onack(status);\n\t    };\n\n\t    /**\n\t     * Encodes the given data as base64, sending it as a blob. The data must\n\t     * be small enough to fit into a single blob instruction.\n\t     * \n\t     * @private\n\t     * @param {Uint8Array} bytes The data to send.\n\t     */\n\t    function __send_blob(bytes) {\n\n\t        var binary = \"\";\n\n\t        // Produce binary string from bytes in buffer\n\t        for (var i=0; i<bytes.byteLength; i++)\n\t            binary += String.fromCharCode(bytes[i]);\n\n\t        // Send as base64\n\t        stream.sendBlob(window.btoa(binary));\n\n\t    }\n\n\t    /**\n\t     * Sends the given data.\n\t     * \n\t     * @param {ArrayBuffer|TypedArray} data The data to send.\n\t     */\n\t    this.sendData = function(data) {\n\n\t        var bytes = new Uint8Array(data);\n\n\t        // If small enough to fit into single instruction, send as-is\n\t        if (bytes.length <= 8064)\n\t            __send_blob(bytes);\n\n\t        // Otherwise, send as multiple instructions\n\t        else {\n\t            for (var offset=0; offset<bytes.length; offset += 8064)\n\t                __send_blob(bytes.subarray(offset, offset + 8094));\n\t        }\n\n\t    };\n\n\t    /**\n\t     * Signals that no further text will be sent, effectively closing the\n\t     * stream.\n\t     */\n\t    this.sendEnd = function() {\n\t        stream.sendEnd();\n\t    };\n\n\t    /**\n\t     * Fired for received data, if acknowledged by the server.\n\t     * @event\n\t     * @param {Guacamole.Status} status The status of the operation.\n\t     */\n\t    this.onack = null;\n\n\t};\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * Abstract ordered drawing surface. Each Layer contains a canvas element and\n\t * provides simple drawing instructions for drawing to that canvas element,\n\t * however unlike the canvas element itself, drawing operations on a Layer are\n\t * guaranteed to run in order, even if such an operation must wait for an image\n\t * to load before completing.\n\t * \n\t * @constructor\n\t * \n\t * @param {Number} width The width of the Layer, in pixels. The canvas element\n\t *                       backing this Layer will be given this width.\n\t *                       \n\t * @param {Number} height The height of the Layer, in pixels. The canvas element\n\t *                        backing this Layer will be given this height.\n\t */\n\tGuacamole.Layer = function(width, height) {\n\n\t    /**\n\t     * Reference to this Layer.\n\t     * @private\n\t     */\n\t    var layer = this;\n\n\t    /**\n\t     * The canvas element backing this Layer.\n\t     * @private\n\t     */\n\t    var canvas = document.createElement(\"canvas\");\n\n\t    /**\n\t     * The 2D display context of the canvas element backing this Layer.\n\t     * @private\n\t     */\n\t    var context = canvas.getContext(\"2d\");\n\t    context.save();\n\n\t    /**\n\t     * Whether a new path should be started with the next path drawing\n\t     * operations.\n\t     * @private\n\t     */\n\t    var pathClosed = true;\n\n\t    /**\n\t     * The number of states on the state stack.\n\t     * \n\t     * Note that there will ALWAYS be one element on the stack, but that\n\t     * element is not exposed. It is only used to reset the layer to its\n\t     * initial state.\n\t     * \n\t     * @private\n\t     */\n\t    var stackSize = 0;\n\n\t    /**\n\t     * Map of all Guacamole channel masks to HTML5 canvas composite operation\n\t     * names. Not all channel mask combinations are currently implemented.\n\t     * @private\n\t     */\n\t    var compositeOperation = {\n\t     /* 0x0 NOT IMPLEMENTED */\n\t        0x1: \"destination-in\",\n\t        0x2: \"destination-out\",\n\t     /* 0x3 NOT IMPLEMENTED */\n\t        0x4: \"source-in\",\n\t     /* 0x5 NOT IMPLEMENTED */\n\t        0x6: \"source-atop\",\n\t     /* 0x7 NOT IMPLEMENTED */\n\t        0x8: \"source-out\",\n\t        0x9: \"destination-atop\",\n\t        0xA: \"xor\",\n\t        0xB: \"destination-over\",\n\t        0xC: \"copy\",\n\t     /* 0xD NOT IMPLEMENTED */\n\t        0xE: \"source-over\",\n\t        0xF: \"lighter\"\n\t    };\n\n\t    /**\n\t     * Resizes the canvas element backing this Layer without testing the\n\t     * new size. This function should only be used internally.\n\t     * \n\t     * @private\n\t     * @param {Number} newWidth The new width to assign to this Layer.\n\t     * @param {Number} newHeight The new height to assign to this Layer.\n\t     */\n\t    function resize(newWidth, newHeight) {\n\n\t        // Only preserve old data if width/height are both non-zero\n\t        var oldData = null;\n\t        if (layer.width !== 0 && layer.height !== 0) {\n\n\t            // Create canvas and context for holding old data\n\t            oldData = document.createElement(\"canvas\");\n\t            oldData.width = layer.width;\n\t            oldData.height = layer.height;\n\n\t            var oldDataContext = oldData.getContext(\"2d\");\n\n\t            // Copy image data from current\n\t            oldDataContext.drawImage(canvas,\n\t                    0, 0, layer.width, layer.height,\n\t                    0, 0, layer.width, layer.height);\n\n\t        }\n\n\t        // Preserve composite operation\n\t        var oldCompositeOperation = context.globalCompositeOperation;\n\n\t        // Resize canvas\n\t        canvas.width = newWidth;\n\t        canvas.height = newHeight;\n\n\t        // Redraw old data, if any\n\t        if (oldData)\n\t                context.drawImage(oldData, \n\t                    0, 0, layer.width, layer.height,\n\t                    0, 0, layer.width, layer.height);\n\n\t        // Restore composite operation\n\t        context.globalCompositeOperation = oldCompositeOperation;\n\n\t        layer.width = newWidth;\n\t        layer.height = newHeight;\n\n\t        // Acknowledge reset of stack (happens on resize of canvas)\n\t        stackSize = 0;\n\t        context.save();\n\n\t    }\n\n\t    /**\n\t     * Given the X and Y coordinates of the upper-left corner of a rectangle\n\t     * and the rectangle's width and height, resize the backing canvas element\n\t     * as necessary to ensure that the rectangle fits within the canvas\n\t     * element's coordinate space. This function will only make the canvas\n\t     * larger. If the rectangle already fits within the canvas element's\n\t     * coordinate space, the canvas is left unchanged.\n\t     * \n\t     * @private\n\t     * @param {Number} x The X coordinate of the upper-left corner of the\n\t     *                   rectangle to fit.\n\t     * @param {Number} y The Y coordinate of the upper-left corner of the\n\t     *                   rectangle to fit.\n\t     * @param {Number} w The width of the the rectangle to fit.\n\t     * @param {Number} h The height of the the rectangle to fit.\n\t     */\n\t    function fitRect(x, y, w, h) {\n\t        \n\t        // Calculate bounds\n\t        var opBoundX = w + x;\n\t        var opBoundY = h + y;\n\t        \n\t        // Determine max width\n\t        var resizeWidth;\n\t        if (opBoundX > layer.width)\n\t            resizeWidth = opBoundX;\n\t        else\n\t            resizeWidth = layer.width;\n\n\t        // Determine max height\n\t        var resizeHeight;\n\t        if (opBoundY > layer.height)\n\t            resizeHeight = opBoundY;\n\t        else\n\t            resizeHeight = layer.height;\n\n\t        // Resize if necessary\n\t        layer.resize(resizeWidth, resizeHeight);\n\n\t    }\n\n\t    /**\n\t     * Set to true if this Layer should resize itself to accomodate the\n\t     * dimensions of any drawing operation, and false (the default) otherwise.\n\t     * \n\t     * Note that setting this property takes effect immediately, and thus may\n\t     * take effect on operations that were started in the past but have not\n\t     * yet completed. If you wish the setting of this flag to only modify\n\t     * future operations, you will need to make the setting of this flag an\n\t     * operation with sync().\n\t     * \n\t     * @example\n\t     * // Set autosize to true for all future operations\n\t     * layer.sync(function() {\n\t     *     layer.autosize = true;\n\t     * });\n\t     * \n\t     * @type Boolean\n\t     * @default false\n\t     */\n\t    this.autosize = false;\n\n\t    /**\n\t     * The current width of this layer.\n\t     * @type Number\n\t     */\n\t    this.width = width;\n\n\t    /**\n\t     * The current height of this layer.\n\t     * @type Number\n\t     */\n\t    this.height = height;\n\n\t    /**\n\t     * Returns the canvas element backing this Layer.\n\t     * @returns {Element} The canvas element backing this Layer.\n\t     */\n\t    this.getCanvas = function() {\n\t        return canvas;\n\t    };\n\n\t    /**\n\t     * Changes the size of this Layer to the given width and height. Resizing\n\t     * is only attempted if the new size provided is actually different from\n\t     * the current size.\n\t     * \n\t     * @param {Number} newWidth The new width to assign to this Layer.\n\t     * @param {Number} newHeight The new height to assign to this Layer.\n\t     */\n\t    this.resize = function(newWidth, newHeight) {\n\t        if (newWidth !== layer.width || newHeight !== layer.height)\n\t            resize(newWidth, newHeight);\n\t    };\n\n\t    /**\n\t     * Draws the specified image at the given coordinates. The image specified\n\t     * must already be loaded.\n\t     * \n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     * @param {Image} image The image to draw. Note that this is an Image\n\t     *                      object - not a URL.\n\t     */\n\t    this.drawImage = function(x, y, image) {\n\t        if (layer.autosize) fitRect(x, y, image.width, image.height);\n\t        context.drawImage(image, x, y);\n\t    };\n\n\t    /**\n\t     * Transfer a rectangle of image data from one Layer to this Layer using the\n\t     * specified transfer function.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The Layer to copy image data from.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source Layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      Layer's coordinate space to copy data from.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     * @param {Function} transferFunction The transfer function to use to\n\t     *                                    transfer data from source to\n\t     *                                    destination.\n\t     */\n\t    this.transfer = function(srcLayer, srcx, srcy, srcw, srch, x, y, transferFunction) {\n\n\t        var srcCanvas = srcLayer.getCanvas();\n\n\t        // If entire rectangle outside source canvas, stop\n\t        if (srcx >= srcCanvas.width || srcy >= srcCanvas.height) return;\n\n\t        // Otherwise, clip rectangle to area\n\t        if (srcx + srcw > srcCanvas.width)\n\t            srcw = srcCanvas.width - srcx;\n\n\t        if (srcy + srch > srcCanvas.height)\n\t            srch = srcCanvas.height - srcy;\n\n\t        // Stop if nothing to draw.\n\t        if (srcw === 0 || srch === 0) return;\n\n\t        if (layer.autosize) fitRect(x, y, srcw, srch);\n\n\t        // Get image data from src and dst\n\t        var src = srcLayer.getCanvas().getContext(\"2d\").getImageData(srcx, srcy, srcw, srch);\n\t        var dst = context.getImageData(x , y, srcw, srch);\n\n\t        // Apply transfer for each pixel\n\t        for (var i=0; i<srcw*srch*4; i+=4) {\n\n\t            // Get source pixel environment\n\t            var src_pixel = new Guacamole.Layer.Pixel(\n\t                src.data[i],\n\t                src.data[i+1],\n\t                src.data[i+2],\n\t                src.data[i+3]\n\t            );\n\t                \n\t            // Get destination pixel environment\n\t            var dst_pixel = new Guacamole.Layer.Pixel(\n\t                dst.data[i],\n\t                dst.data[i+1],\n\t                dst.data[i+2],\n\t                dst.data[i+3]\n\t            );\n\n\t            // Apply transfer function\n\t            transferFunction(src_pixel, dst_pixel);\n\n\t            // Save pixel data\n\t            dst.data[i  ] = dst_pixel.red;\n\t            dst.data[i+1] = dst_pixel.green;\n\t            dst.data[i+2] = dst_pixel.blue;\n\t            dst.data[i+3] = dst_pixel.alpha;\n\n\t        }\n\n\t        // Draw image data\n\t        context.putImageData(dst, x, y);\n\n\t    };\n\n\t    /**\n\t     * Put a rectangle of image data from one Layer to this Layer directly\n\t     * without performing any alpha blending. Simply copy the data.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The Layer to copy image data from.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source Layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      Layer's coordinate space to copy data from.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     */\n\t    this.put = function(srcLayer, srcx, srcy, srcw, srch, x, y) {\n\n\t        var srcCanvas = srcLayer.getCanvas();\n\n\t        // If entire rectangle outside source canvas, stop\n\t        if (srcx >= srcCanvas.width || srcy >= srcCanvas.height) return;\n\n\t        // Otherwise, clip rectangle to area\n\t        if (srcx + srcw > srcCanvas.width)\n\t            srcw = srcCanvas.width - srcx;\n\n\t        if (srcy + srch > srcCanvas.height)\n\t            srch = srcCanvas.height - srcy;\n\n\t        // Stop if nothing to draw.\n\t        if (srcw === 0 || srch === 0) return;\n\n\t        if (layer.autosize) fitRect(x, y, srcw, srch);\n\n\t        // Get image data from src and dst\n\t        var src = srcLayer.getCanvas().getContext(\"2d\").getImageData(srcx, srcy, srcw, srch);\n\t        context.putImageData(src, x, y);\n\n\t    };\n\n\t    /**\n\t     * Copy a rectangle of image data from one Layer to this Layer. This\n\t     * operation will copy exactly the image data that will be drawn once all\n\t     * operations of the source Layer that were pending at the time this\n\t     * function was called are complete. This operation will not alter the\n\t     * size of the source Layer even if its autosize property is set to true.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The Layer to copy image data from.\n\t     * @param {Number} srcx The X coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcy The Y coordinate of the upper-left corner of the\n\t     *                      rectangle within the source Layer's coordinate\n\t     *                      space to copy data from.\n\t     * @param {Number} srcw The width of the rectangle within the source Layer's\n\t     *                      coordinate space to copy data from.\n\t     * @param {Number} srch The height of the rectangle within the source\n\t     *                      Layer's coordinate space to copy data from.\n\t     * @param {Number} x The destination X coordinate.\n\t     * @param {Number} y The destination Y coordinate.\n\t     */\n\t    this.copy = function(srcLayer, srcx, srcy, srcw, srch, x, y) {\n\n\t        var srcCanvas = srcLayer.getCanvas();\n\n\t        // If entire rectangle outside source canvas, stop\n\t        if (srcx >= srcCanvas.width || srcy >= srcCanvas.height) return;\n\n\t        // Otherwise, clip rectangle to area\n\t        if (srcx + srcw > srcCanvas.width)\n\t            srcw = srcCanvas.width - srcx;\n\n\t        if (srcy + srch > srcCanvas.height)\n\t            srch = srcCanvas.height - srcy;\n\n\t        // Stop if nothing to draw.\n\t        if (srcw === 0 || srch === 0) return;\n\n\t        if (layer.autosize) fitRect(x, y, srcw, srch);\n\t        context.drawImage(srcCanvas, srcx, srcy, srcw, srch, x, y, srcw, srch);\n\n\t    };\n\n\t    /**\n\t     * Starts a new path at the specified point.\n\t     * \n\t     * @param {Number} x The X coordinate of the point to draw.\n\t     * @param {Number} y The Y coordinate of the point to draw.\n\t     */\n\t    this.moveTo = function(x, y) {\n\t        \n\t        // Start a new path if current path is closed\n\t        if (pathClosed) {\n\t            context.beginPath();\n\t            pathClosed = false;\n\t        }\n\t        \n\t        if (layer.autosize) fitRect(x, y, 0, 0);\n\t        context.moveTo(x, y);\n\n\t    };\n\n\t    /**\n\t     * Add the specified line to the current path.\n\t     * \n\t     * @param {Number} x The X coordinate of the endpoint of the line to draw.\n\t     * @param {Number} y The Y coordinate of the endpoint of the line to draw.\n\t     */\n\t    this.lineTo = function(x, y) {\n\t        \n\t        // Start a new path if current path is closed\n\t        if (pathClosed) {\n\t            context.beginPath();\n\t            pathClosed = false;\n\t        }\n\t        \n\t        if (layer.autosize) fitRect(x, y, 0, 0);\n\t        context.lineTo(x, y);\n\t        \n\t    };\n\n\t    /**\n\t     * Add the specified arc to the current path.\n\t     * \n\t     * @param {Number} x The X coordinate of the center of the circle which\n\t     *                   will contain the arc.\n\t     * @param {Number} y The Y coordinate of the center of the circle which\n\t     *                   will contain the arc.\n\t     * @param {Number} radius The radius of the circle.\n\t     * @param {Number} startAngle The starting angle of the arc, in radians.\n\t     * @param {Number} endAngle The ending angle of the arc, in radians.\n\t     * @param {Boolean} negative Whether the arc should be drawn in order of\n\t     *                           decreasing angle.\n\t     */\n\t    this.arc = function(x, y, radius, startAngle, endAngle, negative) {\n\t        \n\t        // Start a new path if current path is closed\n\t        if (pathClosed) {\n\t            context.beginPath();\n\t            pathClosed = false;\n\t        }\n\t        \n\t        if (layer.autosize) fitRect(x, y, 0, 0);\n\t        context.arc(x, y, radius, startAngle, endAngle, negative);\n\t        \n\t    };\n\n\t    /**\n\t     * Starts a new path at the specified point.\n\t     * \n\t     * @param {Number} cp1x The X coordinate of the first control point.\n\t     * @param {Number} cp1y The Y coordinate of the first control point.\n\t     * @param {Number} cp2x The X coordinate of the second control point.\n\t     * @param {Number} cp2y The Y coordinate of the second control point.\n\t     * @param {Number} x The X coordinate of the endpoint of the curve.\n\t     * @param {Number} y The Y coordinate of the endpoint of the curve.\n\t     */\n\t    this.curveTo = function(cp1x, cp1y, cp2x, cp2y, x, y) {\n\t        \n\t        // Start a new path if current path is closed\n\t        if (pathClosed) {\n\t            context.beginPath();\n\t            pathClosed = false;\n\t        }\n\t        \n\t        if (layer.autosize) fitRect(x, y, 0, 0);\n\t        context.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x, y);\n\t        \n\t    };\n\n\t    /**\n\t     * Closes the current path by connecting the end point with the start\n\t     * point (if any) with a straight line.\n\t     */\n\t    this.close = function() {\n\t        context.closePath();\n\t        pathClosed = true;\n\t    };\n\n\t    /**\n\t     * Add the specified rectangle to the current path.\n\t     * \n\t     * @param {Number} x The X coordinate of the upper-left corner of the\n\t     *                   rectangle to draw.\n\t     * @param {Number} y The Y coordinate of the upper-left corner of the\n\t     *                   rectangle to draw.\n\t     * @param {Number} w The width of the rectangle to draw.\n\t     * @param {Number} h The height of the rectangle to draw.\n\t     */\n\t    this.rect = function(x, y, w, h) {\n\t            \n\t        // Start a new path if current path is closed\n\t        if (pathClosed) {\n\t            context.beginPath();\n\t            pathClosed = false;\n\t        }\n\t        \n\t        if (layer.autosize) fitRect(x, y, w, h);\n\t        context.rect(x, y, w, h);\n\t        \n\t    };\n\n\t    /**\n\t     * Clip all future drawing operations by the current path. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as fillColor()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     */\n\t    this.clip = function() {\n\n\t        // Set new clipping region\n\t        context.clip();\n\n\t        // Path now implicitly closed\n\t        pathClosed = true;\n\n\t    };\n\n\t    /**\n\t     * Stroke the current path with the specified color. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {String} cap The line cap style. Can be \"round\", \"square\",\n\t     *                     or \"butt\".\n\t     * @param {String} join The line join style. Can be \"round\", \"bevel\",\n\t     *                      or \"miter\".\n\t     * @param {Number} thickness The line thickness in pixels.\n\t     * @param {Number} r The red component of the color to fill.\n\t     * @param {Number} g The green component of the color to fill.\n\t     * @param {Number} b The blue component of the color to fill.\n\t     * @param {Number} a The alpha component of the color to fill.\n\t     */\n\t    this.strokeColor = function(cap, join, thickness, r, g, b, a) {\n\n\t        // Stroke with color\n\t        context.lineCap = cap;\n\t        context.lineJoin = join;\n\t        context.lineWidth = thickness;\n\t        context.strokeStyle = \"rgba(\" + r + \",\" + g + \",\" + b + \",\" + a/255.0 + \")\";\n\t        context.stroke();\n\n\t        // Path now implicitly closed\n\t        pathClosed = true;\n\n\t    };\n\n\t    /**\n\t     * Fills the current path with the specified color. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Number} r The red component of the color to fill.\n\t     * @param {Number} g The green component of the color to fill.\n\t     * @param {Number} b The blue component of the color to fill.\n\t     * @param {Number} a The alpha component of the color to fill.\n\t     */\n\t    this.fillColor = function(r, g, b, a) {\n\n\t        // Fill with color\n\t        context.fillStyle = \"rgba(\" + r + \",\" + g + \",\" + b + \",\" + a/255.0 + \")\";\n\t        context.fill();\n\n\t        // Path now implicitly closed\n\t        pathClosed = true;\n\n\t    };\n\n\t    /**\n\t     * Stroke the current path with the image within the specified layer. The\n\t     * image data will be tiled infinitely within the stroke. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {String} cap The line cap style. Can be \"round\", \"square\",\n\t     *                     or \"butt\".\n\t     * @param {String} join The line join style. Can be \"round\", \"bevel\",\n\t     *                      or \"miter\".\n\t     * @param {Number} thickness The line thickness in pixels.\n\t     * @param {Guacamole.Layer} srcLayer The layer to use as a repeating pattern\n\t     *                                   within the stroke.\n\t     */\n\t    this.strokeLayer = function(cap, join, thickness, srcLayer) {\n\n\t        // Stroke with image data\n\t        context.lineCap = cap;\n\t        context.lineJoin = join;\n\t        context.lineWidth = thickness;\n\t        context.strokeStyle = context.createPattern(\n\t            srcLayer.getCanvas(),\n\t            \"repeat\"\n\t        );\n\t        context.stroke();\n\n\t        // Path now implicitly closed\n\t        pathClosed = true;\n\n\t    };\n\n\t    /**\n\t     * Fills the current path with the image within the specified layer. The\n\t     * image data will be tiled infinitely within the stroke. The current path\n\t     * is implicitly closed. The current path can continue to be reused\n\t     * for other operations (such as clip()) but a new path will be started\n\t     * once a path drawing operation (path() or rect()) is used.\n\t     * \n\t     * @param {Guacamole.Layer} srcLayer The layer to use as a repeating pattern\n\t     *                                   within the fill.\n\t     */\n\t    this.fillLayer = function(srcLayer) {\n\n\t        // Fill with image data \n\t        context.fillStyle = context.createPattern(\n\t            srcLayer.getCanvas(),\n\t            \"repeat\"\n\t        );\n\t        context.fill();\n\n\t        // Path now implicitly closed\n\t        pathClosed = true;\n\n\t    };\n\n\t    /**\n\t     * Push current layer state onto stack.\n\t     */\n\t    this.push = function() {\n\n\t        // Save current state onto stack\n\t        context.save();\n\t        stackSize++;\n\n\t    };\n\n\t    /**\n\t     * Pop layer state off stack.\n\t     */\n\t    this.pop = function() {\n\n\t        // Restore current state from stack\n\t        if (stackSize > 0) {\n\t            context.restore();\n\t            stackSize--;\n\t        }\n\n\t    };\n\n\t    /**\n\t     * Reset the layer, clearing the stack, the current path, and any transform\n\t     * matrix.\n\t     */\n\t    this.reset = function() {\n\n\t        // Clear stack\n\t        while (stackSize > 0) {\n\t            context.restore();\n\t            stackSize--;\n\t        }\n\n\t        // Restore to initial state\n\t        context.restore();\n\t        context.save();\n\n\t        // Clear path\n\t        context.beginPath();\n\t        pathClosed = false;\n\n\t    };\n\n\t    /**\n\t     * Sets the given affine transform (defined with six values from the\n\t     * transform's matrix).\n\t     * \n\t     * @param {Number} a The first value in the affine transform's matrix.\n\t     * @param {Number} b The second value in the affine transform's matrix.\n\t     * @param {Number} c The third value in the affine transform's matrix.\n\t     * @param {Number} d The fourth value in the affine transform's matrix.\n\t     * @param {Number} e The fifth value in the affine transform's matrix.\n\t     * @param {Number} f The sixth value in the affine transform's matrix.\n\t     */\n\t    this.setTransform = function(a, b, c, d, e, f) {\n\t        context.setTransform(\n\t            a, b, c,\n\t            d, e, f\n\t          /*0, 0, 1*/\n\t        );\n\t    };\n\n\t    /**\n\t     * Applies the given affine transform (defined with six values from the\n\t     * transform's matrix).\n\t     * \n\t     * @param {Number} a The first value in the affine transform's matrix.\n\t     * @param {Number} b The second value in the affine transform's matrix.\n\t     * @param {Number} c The third value in the affine transform's matrix.\n\t     * @param {Number} d The fourth value in the affine transform's matrix.\n\t     * @param {Number} e The fifth value in the affine transform's matrix.\n\t     * @param {Number} f The sixth value in the affine transform's matrix.\n\t     */\n\t    this.transform = function(a, b, c, d, e, f) {\n\t        context.transform(\n\t            a, b, c,\n\t            d, e, f\n\t          /*0, 0, 1*/\n\t        );\n\t    };\n\n\t    /**\n\t     * Sets the channel mask for future operations on this Layer.\n\t     * \n\t     * The channel mask is a Guacamole-specific compositing operation identifier\n\t     * with a single bit representing each of four channels (in order): source\n\t     * image where destination transparent, source where destination opaque,\n\t     * destination where source transparent, and destination where source\n\t     * opaque.\n\t     * \n\t     * @param {Number} mask The channel mask for future operations on this\n\t     *                      Layer.\n\t     */\n\t    this.setChannelMask = function(mask) {\n\t        context.globalCompositeOperation = compositeOperation[mask];\n\t    };\n\n\t    /**\n\t     * Sets the miter limit for stroke operations using the miter join. This\n\t     * limit is the maximum ratio of the size of the miter join to the stroke\n\t     * width. If this ratio is exceeded, the miter will not be drawn for that\n\t     * joint of the path.\n\t     * \n\t     * @param {Number} limit The miter limit for stroke operations using the\n\t     *                       miter join.\n\t     */\n\t    this.setMiterLimit = function(limit) {\n\t        context.miterLimit = limit;\n\t    };\n\n\t    // Initialize canvas dimensions\n\t    canvas.width = width;\n\t    canvas.height = height;\n\n\t    // Explicitly render canvas below other elements in the layer (such as\n\t    // child layers). Chrome and others may fail to render layers properly\n\t    // without this.\n\t    canvas.style.zIndex = -1;\n\n\t};\n\n\t/**\n\t * Channel mask for the composite operation \"rout\".\n\t */\n\tGuacamole.Layer.ROUT  = 0x2;\n\n\t/**\n\t * Channel mask for the composite operation \"atop\".\n\t */\n\tGuacamole.Layer.ATOP  = 0x6;\n\n\t/**\n\t * Channel mask for the composite operation \"xor\".\n\t */\n\tGuacamole.Layer.XOR   = 0xA;\n\n\t/**\n\t * Channel mask for the composite operation \"rover\".\n\t */\n\tGuacamole.Layer.ROVER = 0xB;\n\n\t/**\n\t * Channel mask for the composite operation \"over\".\n\t */\n\tGuacamole.Layer.OVER  = 0xE;\n\n\t/**\n\t * Channel mask for the composite operation \"plus\".\n\t */\n\tGuacamole.Layer.PLUS  = 0xF;\n\n\t/**\n\t * Channel mask for the composite operation \"rin\".\n\t * Beware that WebKit-based browsers may leave the contents of the destionation\n\t * layer where the source layer is transparent, despite the definition of this\n\t * operation.\n\t */\n\tGuacamole.Layer.RIN   = 0x1;\n\n\t/**\n\t * Channel mask for the composite operation \"in\".\n\t * Beware that WebKit-based browsers may leave the contents of the destionation\n\t * layer where the source layer is transparent, despite the definition of this\n\t * operation.\n\t */\n\tGuacamole.Layer.IN    = 0x4;\n\n\t/**\n\t * Channel mask for the composite operation \"out\".\n\t * Beware that WebKit-based browsers may leave the contents of the destionation\n\t * layer where the source layer is transparent, despite the definition of this\n\t * operation.\n\t */\n\tGuacamole.Layer.OUT   = 0x8;\n\n\t/**\n\t * Channel mask for the composite operation \"ratop\".\n\t * Beware that WebKit-based browsers may leave the contents of the destionation\n\t * layer where the source layer is transparent, despite the definition of this\n\t * operation.\n\t */\n\tGuacamole.Layer.RATOP = 0x9;\n\n\t/**\n\t * Channel mask for the composite operation \"src\".\n\t * Beware that WebKit-based browsers may leave the contents of the destionation\n\t * layer where the source layer is transparent, despite the definition of this\n\t * operation.\n\t */\n\tGuacamole.Layer.SRC   = 0xC;\n\n\t/**\n\t * Represents a single pixel of image data. All components have a minimum value\n\t * of 0 and a maximum value of 255.\n\t * \n\t * @constructor\n\t * \n\t * @param {Number} r The red component of this pixel.\n\t * @param {Number} g The green component of this pixel.\n\t * @param {Number} b The blue component of this pixel.\n\t * @param {Number} a The alpha component of this pixel.\n\t */\n\tGuacamole.Layer.Pixel = function(r, g, b, a) {\n\n\t    /**\n\t     * The red component of this pixel, where 0 is the minimum value,\n\t     * and 255 is the maximum.\n\t     */\n\t    this.red   = r;\n\n\t    /**\n\t     * The green component of this pixel, where 0 is the minimum value,\n\t     * and 255 is the maximum.\n\t     */\n\t    this.green = g;\n\n\t    /**\n\t     * The blue component of this pixel, where 0 is the minimum value,\n\t     * and 255 is the maximum.\n\t     */\n\t    this.blue  = b;\n\n\t    /**\n\t     * The alpha component of this pixel, where 0 is the minimum value,\n\t     * and 255 is the maximum.\n\t     */\n\t    this.alpha = a;\n\n\t};\n\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * A writer which automatically writes to the given output stream with text\n\t * data.\n\t * \n\t * @constructor\n\t * @param {Guacamole.OutputStream} stream The stream that data will be written\n\t *                                        to.\n\t */\n\tGuacamole.StringWriter = function(stream) {\n\n\t    /**\n\t     * Reference to this Guacamole.StringWriter.\n\t     * @private\n\t     */\n\t    var guac_writer = this;\n\n\t    /**\n\t     * Wrapped Guacamole.ArrayBufferWriter.\n\t     * @private\n\t     * @type Guacamole.ArrayBufferWriter\n\t     */\n\t    var array_writer = new Guacamole.ArrayBufferWriter(stream);\n\n\t    /**\n\t     * Internal buffer for UTF-8 output.\n\t     * @private\n\t     */\n\t    var buffer = new Uint8Array(8192);\n\n\t    /**\n\t     * The number of bytes currently in the buffer.\n\t     * @private\n\t     */\n\t    var length = 0;\n\n\t    // Simply call onack for acknowledgements\n\t    array_writer.onack = function(status) {\n\t        if (guac_writer.onack)\n\t            guac_writer.onack(status);\n\t    };\n\n\t    /**\n\t     * Expands the size of the underlying buffer by the given number of bytes,\n\t     * updating the length appropriately.\n\t     * \n\t     * @private\n\t     * @param {Number} bytes The number of bytes to add to the underlying\n\t     *                       buffer.\n\t     */\n\t    function __expand(bytes) {\n\n\t        // Resize buffer if more space needed\n\t        if (length+bytes >= buffer.length) {\n\t            var new_buffer = new Uint8Array((length+bytes)*2);\n\t            new_buffer.set(buffer);\n\t            buffer = new_buffer;\n\t        }\n\n\t        length += bytes;\n\n\t    }\n\n\t    /**\n\t     * Appends a single Unicode character to the current buffer, resizing the\n\t     * buffer if necessary. The character will be encoded as UTF-8.\n\t     * \n\t     * @private\n\t     * @param {Number} codepoint The codepoint of the Unicode character to\n\t     *                           append.\n\t     */\n\t    function __append_utf8(codepoint) {\n\n\t        var mask;\n\t        var bytes;\n\n\t        // 1 byte\n\t        if (codepoint <= 0x7F) {\n\t            mask = 0x00;\n\t            bytes = 1;\n\t        }\n\n\t        // 2 byte\n\t        else if (codepoint <= 0x7FF) {\n\t            mask = 0xC0;\n\t            bytes = 2;\n\t        }\n\n\t        // 3 byte\n\t        else if (codepoint <= 0xFFFF) {\n\t            mask = 0xE0;\n\t            bytes = 3;\n\t        }\n\n\t        // 4 byte\n\t        else if (codepoint <= 0x1FFFFF) {\n\t            mask = 0xF0;\n\t            bytes = 4;\n\t        }\n\n\t        // If invalid codepoint, append replacement character\n\t        else {\n\t            __append_utf8(0xFFFD);\n\t            return;\n\t        }\n\n\t        // Offset buffer by size\n\t        __expand(bytes);\n\t        var offset = length - 1;\n\n\t        // Add trailing bytes, if any\n\t        for (var i=1; i<bytes; i++) {\n\t            buffer[offset--] = 0x80 | (codepoint & 0x3F);\n\t            codepoint >>= 6;\n\t        }\n\n\t        // Set initial byte\n\t        buffer[offset] = mask | codepoint;\n\n\t    }\n\n\t    /**\n\t     * Encodes the given string as UTF-8, returning an ArrayBuffer containing\n\t     * the resulting bytes.\n\t     * \n\t     * @private\n\t     * @param {String} text The string to encode as UTF-8.\n\t     * @return {Uint8Array} The encoded UTF-8 data.\n\t     */\n\t    function __encode_utf8(text) {\n\n\t        // Fill buffer with UTF-8\n\t        for (var i=0; i<text.length; i++) {\n\t            var codepoint = text.charCodeAt(i);\n\t            __append_utf8(codepoint);\n\t        }\n\n\t        // Flush buffer\n\t        if (length > 0) {\n\t            var out_buffer = buffer.subarray(0, length);\n\t            length = 0;\n\t            return out_buffer;\n\t        }\n\n\t    }\n\n\t    /**\n\t     * Sends the given text.\n\t     * \n\t     * @param {String} text The text to send.\n\t     */\n\t    this.sendText = function(text) {\n\t        array_writer.sendData(__encode_utf8(text));\n\t    };\n\n\t    /**\n\t     * Signals that no further text will be sent, effectively closing the\n\t     * stream.\n\t     */\n\t    this.sendEnd = function() {\n\t        array_writer.sendEnd();\n\t    };\n\n\t    /**\n\t     * Fired for received data, if acknowledged by the server.\n\t     * @event\n\t     * @param {Guacamole.Status} status The status of the operation.\n\t     */\n\t    this.onack = null;\n\n\t};\n\t/*\n\t * Copyright (C) 2013 Glyptodon LLC\n\t *\n\t * Permission is hereby granted, free of charge, to any person obtaining a copy\n\t * of this software and associated documentation files (the \"Software\"), to deal\n\t * in the Software without restriction, including without limitation the rights\n\t * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n\t * copies of the Software, and to permit persons to whom the Software is\n\t * furnished to do so, subject to the following conditions:\n\t *\n\t * The above copyright notice and this permission notice shall be included in\n\t * all copies or substantial portions of the Software.\n\t *\n\t * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n\t * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n\t * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n\t * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n\t * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n\t * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n\t * THE SOFTWARE.\n\t */\n\n\tvar Guacamole = Guacamole || {};\n\n\t/**\n\t * The unique ID of this version of the Guacamole JavaScript API. This ID will\n\t * be the version string of the guacamole-common-js Maven project, and can be\n\t * used in downstream applications as a sanity check that the proper version\n\t * of the APIs is being used (in case an older version is cached, for example).\n\t *\n\t * @type String\n\t */\n\tGuacamole.API_VERSION = \"0.9.5\";\n\n\treturn Guacamole; }\n\n\tconst Guacamole = GetGuacamole();\n\n\t/** @const\n\t * Max number of characters in a chat message.\n\t */\n\twindow.maxChatMsgLen = 100;\n\n\t/** @const\n\t * Max number of chat messages to store.\n\t */\n\twindow.maxChatMsgHistory = 100;\n\n\t/**\n\t * Whether the user has control over the VM or not.\n\t * @type {boolean}\n\t */\n\tvar hasTurn = false;\n\tvar modPerms = 0;\n\tvar turnInterval = null;\n\tvar voteInterval = null;\n\tvar uploadInterval = null;\n\t/**\n\t * Whether the user has voted or not.\n\t * @type {boolean}\n\t */\n\tvar hasVoted;\n\tvar focused = false;\n\tvar display;\n\tvar tunnel;\n\tvar guac;\n\tvar mouse;\n\tvar keyboard;\n\tvar audioSupported;\n\tvar fileApisSupported;\n\tvar blurSupported;\n\tvar chatSoundOn = true;\n\tvar maxUploadSize = 4096;\n\tvar maxUploadNameLen = 100;\n\n\t/**\n\t * The current on-screen keyboard, if any.\n\t * @type Guacamole.OnScreenKeyboard\n\t */\n\tvar osk = null;\n\t/** Whether the NSFW warning is currently visible.\n\t * @type {boolean}\n\t */\n\tvar nsfwWarn = true;\n\t// WaitingIndex = 0, Not waiting\n\t// 1 = HasTurn\n\t// >1 = Index in line\n\tvar users = [];\n\t// Number of users in queue plus one\n\tvar usersWaiting = 0;\n\t// Name: [UserRank, WaitingIndex]\n\t/** {dict} */\n\tvar usersData = {};\n\t/** @type {string} */\n\twindow.username = null;\n\n\t/**\n\t * The name of the VM that the user is currently viewing \n\t * or trying to view.\n\t * @type {string}\n\t */\n\twindow.vmName = null;\n\n\t/**\n\t * Whether the client is connecting to a VM and viewing it.\n\t * @type {boolean}\n\t */\n\tvar connected = false;\n\n\t/**\n\t * List of the nodes this instance of the webapp knows about.\n\t */\n\tvar nodeList = [];\n\n\t/**\n\t * File upload operation.\n\t * @enum {number}\n\t */\n\tvar fileOp = {\n\t\tBEGIN: 0,\n\t\tMIDDLE: 1,\n\t\tEND: 2,\n\t\tSTOP: 3\n\t};\n\n\t/**\n\t * File upload response from server.\n\t * @enum {number}\n\t */\n\tvar fileResponse = {\n\t\tBEGIN: 0,\n\t\tACK: 1,\n\t\tFINISHED: 2,\n\t\tSTOP: 3,\n\t\tWAIT_TIME: 4,\n\t\tFAILED: 5,\n\t\tUPLOAD_IN_PROGRESS: 6,\n\t\tTIMED_OUT: 7\n\t};\n\n\t/**\n\t * Gets the CSS class associated with a user rank.\n\t * @param {number} rank\n\t * @return {string}\n\t */\n\tfunction getRankClass(rank) {\n\t\tswitch (rank) {\n\t\t\tdefault:\n\t\t\tcase 0: // Guest\n\t\t\t\treturn \"\";\n\t\t\tcase 1: // Registered user\n\t\t\t\treturn \"user\";\n\t\t\tcase 2: // Admin\n\t\t\t\treturn \"admin\";\n\t\t\tcase 3: // Moderator\n\t\t\t\treturn \"moderator\";\n\t\t}\n\t}\n\n\t/**\n\t * Define a PIP entity incase supported.\n\t */\n\t//var pictureInPictureVideo;\n\n\tvar admin = {\n\t\tloginTimesPressed: 0,\n\t\t\n\t\t// I HATE THIS\n\t\tcopyIP: function(name, ip){},\n\n\t\tgetIP: function(user) {\n\t\t\ttunnel.sendMessage(\"admin\", 19, user);\n\t\t\t// why is this assigned at runtime?\n\t\t\tthis.copyIP = (name, ip) => {\n\t\t\t\tif (navigator.clipboard.writeText) {\n\t\t\t\t\tnavigator.clipboard.writeText(`${name} - ${ip}`);\n\t\t\t\t} else {\n\t\t\t\t\t// If the browser doesn't support writing text to the clipboard, send the IP to chat instead.\n\t\t\t\t\tchatMessage(\"\",`${name} - ${ip}`);\n\t\t\t\t}\n\t\t\t};\n\t\t},\n\n\t\t// I've named this \"VM Monitor\" instead of \"QEMU Monitor\" in the case that more hypervisors are supported in the future.\n\t\tvmMonitor: {\n\t\t\toutput: function(output) {\n\t\t\t\tvar outputBox = $(\"#vm-monitor-output\");\n\t\t\t\toutputBox.append(output);\n\t\t\t\toutputBox.scrollTop(outputBox[0].scrollHeight);\n\t\t\t},\n\t\t\tinput: function(input) {\n\t\t\t\tif (tunnel.state == Guacamole.Tunnel.State.OPEN && input != \"\") {\n\t\t\t\t\ttunnel.sendMessage(\"admin\", 5, vmName, input);\n\t\t\t\t\tthis.output(\"> \" + input + \"\\n\");\n\t\t\t\t}\t\t},\n\t\t\tsendFromDialog: function() {\n\t\t\t\tvar inputBox = $(\"#vm-monitor-input\");\n\t\t\t\tthis.input(inputBox.val().trim());\n\t\t\t\tinputBox.val(\"\");\n\t\t\t}\n\t\t},\n\t\trenameUser: function(oldName) {\n\t\t\tvar newName = prompt(\"Change name from \" + oldName + \" to? (Leave blank to reset)\", oldName);\n\t\t\tif (newName != null) {\n\t\t\t\tif (newName == \"\") {\n\t\t\t\t\ttunnel.sendMessage(\"admin\", 18, oldName);\n\t\t\t\t} else {\n\t\t\t\t\ttunnel.sendMessage(\"admin\", 18, oldName, newName);\n\t\t\t\t}\t\t}\t},\n\n\t\t// This is the ONLY exposed way to send a \"arbitrary\" tunnel instruction\n\t\tadminInstruction: function() {\n\t\t\t// This only looks ugly because we need to use ES5 syntax\n\t\t\tvar args = Array.prototype.slice.call(arguments, 0); args.unshift(\"admin\");\n\t\t\ttunnel.sendMessage.apply(null, args); // (\"admin\", ...)\n\t\t}\n\t};\n\n\tfunction addTableRow(table, user, userData) {\n\t\tvar data = document.createElement(\"LI\");\n\t\tdata.className = \"list-group-item\";\n\n\t\tvar userHTML;\n\t\tif ((usersData[username][0] == 2 || usersData[username][0] == 3) && user !== username) {\n\t\t\t// Maybe eventually I should somehow categorise these, this is getting crowded\n\t\t\tuserHTML = `<div class='dropdown-toggle' data-toggle='dropdown' role='button' aria-haspopup='true' aria-expanded='false'>${user}<span class='caret'></span></div><ul class='dropdown-menu'>`;\n\t\t\tif (modPerms & 64) userHTML += `<li><a href='#' onclick='GetAdmin().adminInstruction(16,\"${user}\");return false;'>End Turn</a></li>`;\n\t\t\tif (modPerms & 4) userHTML += `<li><a href='#' onclick='GetAdmin().adminInstruction(12,\"${user}\");return false;'>Ban</a></li>`;\n\t\t\tif (modPerms & 32) userHTML += `<li><a href='#' onclick='GetAdmin().adminInstruction(15,\"${user}\");return false;'>Kick</a></li>`;\n\t\t\tif (modPerms & 128) userHTML += `<li><a href='#' onclick='GetAdmin().renameUser(\"${user}\");return false;'>Change Name</a></li>`; // Maybe eventually I should move this to a HTML prompt instead\n\t\t\tif (modPerms & 16) {\n\t\t\t\tuserHTML += `<li><a href='#' onclick='GetAdmin().adminInstruction(14,\"${user}\",0);return false;'>Temporary Mute</a></li>`;\n\t\t\t\tuserHTML += `<li><a href='#' onclick='GetAdmin().adminInstruction(14,\"${user}\",1);return false;'>Indefinite Mute</a></li>`;\n\t\t\t\tuserHTML += `<li><a href='#' onclick='GetAdmin().adminInstruction(14,\"${user}\",2);return false;'>Unmute</a></li>`;\n\t\t\t}\t\tif (modPerms & 256) userHTML += `<li><a href='#' onclick='GetAdmin().getIP(\"${user}\");return false;'>Copy IP</a></li>`;\n\t\t\tuserHTML += \"</ul>\";\n\t\t} else {\n\t\t\tuserHTML = user;\n\t\t}\n\t\tdata.innerHTML = userHTML;\n\t\t\n\t\tvar rank = getRankClass(userData[0]);\n\t\tif (rank)\n\t\t\tdata.className += \" \" + rank;\n\t\tif (userData[1] === 1) {\n\t\t\tdata.className += \" has-turn\";\n\t\t} else if (userData[1] > 1) {\n\t\t\tdata.className += \" waiting-turn\";\n\t\t}\n\t\tif (user == username)\n\t\t\tdata.className += \" current-user\";\n\t\ttable.appendChild(data);\n\t}\n\n\tfunction displayTable() {\n\t\t$(\"#users-online\").html(users.length);\n\t\tvar table = $(\"#online-users\").empty().get(0);\n\t\t\n\t\tif (usersWaiting > 0) {\n\t\t\tfor (var x = 1; x < usersWaiting+1; x++) {\n\t\t\t\tfor (var i = 0; i < users.length; i++) {\n\t\t\t\t\tvar user = users[i];\n\t\t\t\t\tvar userData = usersData[user];\n\t\t\t\t\tif (userData[1] === x)\n\t\t\t\t\t\taddTableRow(table, user, userData);\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i = 0; i < users.length; i++) {\n\t\t\t\tvar user = users[i];\n\t\t\t\tvar userData = usersData[user];\n\t\t\t\tif (userData[1] === 0)\n\t\t\t\t\taddTableRow(table, user, userData);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var i = 0; i < users.length; i++) {\n\t\t\t\tvar user = users[i];\n\t\t\t\tvar userData = usersData[user];\n\t\t\t\taddTableRow(table, user, userData);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction chatMessage(username, message) {\n\t\tvar chatPanel = $(\"#chat-panel\").get(0);\n\t\tvar atBottom = chatPanel.offsetHeight + chatPanel.scrollTop >= chatPanel.scrollHeight;\n\t\tvar chatElement = $('<li><div></div></li>');\n\t\tif (username)\n\t\t\tchatElement.children().first().html(message).prepend($('<span class=\"username\"></span>').addClass(usersData[username] ? getRankClass(usersData[username][0]) : \"\").text(username), '<span class=\"spacer\">\\u25B8</span>');\n\t\telse\n\t\t\tchatElement.children().first().addClass(\"server-message\").html(message);\n\t\tvar chatBox = $(\"#chat-box\");\n\t\tvar children = chatBox.children();\n\t\tif (children.length >= maxChatMsgHistory)\n\t\t\tchildren.first().remove();\n\t\tchatBox.append(chatElement);\n\t\tif (atBottom)\n\t\t\tchatPanel.scrollTop = chatPanel.scrollHeight;\n\t\tplaySound();\n\t}\n\n\tfunction getCookie(cname) {\n\t\tvar name = cname + \"=\";\n\t\tvar ca = document.cookie.split(';');\n\t\tfor(var i=0; i<ca.length; i++) {\n\t\t\tvar c = ca[i];\n\t\t\twhile (c.charAt(0)==' ') c = c.substring(1);\n\t\t\tif (c.indexOf(name) == 0) return c.substring(name.length,c.length);\n\t\t}\n\t\treturn \"\";\n\t}\n\n\tfunction setCookie(cname, cvalue, exdays) {\n\t\tvar d = new Date();\n\t\td.setTime(d.getTime() + (exdays*24*60*60*1000));\n\t\tvar expires = \"expires=\"+d.toUTCString();\n\t\tdocument.cookie = cname + \"=\" + cvalue + \"; \" + expires;\n\t}\n\n\tfunction initSound() {\n\t\tif (!!document.createElement('audio').canPlayType) {\n\t\t\tvar a = document.createElement('audio');\n\t\t\tif (!!(a.canPlayType('audio/mpeg;').replace(/no/, \"\"))) {\n\t\t\t\taudioSupported = new Audio(common.chatSound + \".mp3\");\n\t\t\t} else if (!!(a.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/no/, \"\"))) {\n\t\t\t\taudioSupported = new Audio(common.chatSound + \".ogg\");\n\t\t\t} else if (!!(a.canPlayType('audio/mp4; codecs=\"mp4a.40.2\"').replace(/no/, \"\"))) {\n\t\t\t\taudioSupported = new Audio(common.chatSound + \".m4a\");\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setChatSoundOn(on) {\n\t\tchatSoundOn = on;\n\t\tif (chatSoundOn) {\n\t\t\t$(\"#chat-sound-btn\").children().first().removeClass(\"glyphicon-volume-off\").addClass(\"glyphicon-volume-up\");\n\t\t} else {\n\t\t\t$(\"#chat-sound-btn\").children().first().removeClass(\"glyphicon-volume-up\").addClass(\"glyphicon-volume-off\");\n\t\t}\n\t}\n\n\tfunction playSound() {\n\t\tif (chatSoundOn) {\n\t\t\tif (audioSupported !== null) {\n\t\t\t\taudioSupported.play();\n\t\t\t} else {\n\t\t\t\t$(\"#chat-sound bgsound\").remove();\n\t\t\t\t$(\"<bgsound/>\").attr({ src: \"notify.mp3\", loop: 1, autostart: true }).appendTo(\"#chat-sound\");\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * Create a timer that calls the callback every second.\n\t * @param callback The function that is called every second with the following declaration:\n\t *\t\t\t\tfunction(seconds, dots)\n\t *\t\t\t\t@param seconds The number of seconds remaining or null if the timer has expired\n\t *\t\t\t\t@param dots A string with 0 to 4 dots to indicate progress\n\t * @param ms The number of milliseconds the timer should start with.\n\t * @return The intervalID from setInterval()\n\t */\n\tfunction waitingTimer(callback, ms, completion) {\n\t\tvar interval;\n\t\tvar dots = '';\n\t\tvar timerCallback = function() {\n\t\t\t\tvar seconds = Math.floor(ms / 1000);\n\t\t\t\tif (seconds <= 0) {\n\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\tcallback(null);\n\t\t\t\t} else {\n\t\t\t\t\tif (dots.length < 3)\n\t\t\t\t\t\tdots += '.';\n\t\t\t\t\telse\n\t\t\t\t\t\tdots = '';\n\t\t\t\t\tcallback(seconds, dots);\n\t\t\t\t}\n\t\t\t};\n\t\ttimerCallback();\n\t\treturn interval = setInterval(function() { ms -= 1000; timerCallback(); }, 1000);\n\t}\n\n\tfunction setFocus(focus) {\n\t\tfocused = focus;\n\t\tif (focus) {\n\t\t\tkeyboard.onkeydown = function (keysym) {\n\t\t\t\tif (hasTurn)\n\t\t\t\t\tguac.sendKeyEvent(1, keysym);\n\t\t\t\t};\n\n\t\t\tkeyboard.onkeyup = function (keysym) {\n\t\t\t\tif (hasTurn)\n\t\t\t\t\tguac.sendKeyEvent(0, keysym);\n\t\t\t\t};\n\n\t\t} else {\n\t\t\tkeyboard.onkeydown = keyboard.onkeyup = null;\n\t\t}\n\t}\n\n\t/**\n\t * Enables or disables the on-screen keyboard.\n\t * @param {boolean} enabled\n\t */\n\tfunction activateOSK(enabled) {\n\t\tosk.disabled = !enabled;\n\t\tvar keys = $(osk.getElement()).find(\"div.guac-keyboard-key\");\n\t\tif (enabled)\n\t\t\tkeys.removeClass(\"guac-keyboard-disabled\");\n\t\telse\n\t\t\tkeys.addClass(\"guac-keyboard-disabled\");\n\t}\n\n\t/**\n\t * Shows or hides the NSFW warning message.\n\t * @param {boolean=} show False if the NSFW warning message should be hidden. Defaults to true.\n\t */\n\tfunction displayNsfwWarn(show) {\n\t\tif (show === false) {\n\t\t\t$(\"#display\").removeClass(\"censor\").removeClass(\"censor-fallback\");\n\t\t\t$(\"#vm-list img\").removeClass(\"censor\").removeClass(\"censor-fallback\");\n\t\t\t$(\"#warning\").hide();\n\t\t\tnsfwWarn = false;\n\t\t} else {\n\t\t\t// First try to use the blur filter to the display\n\t\t\tvar el = $(\"#display\");\n\t\t\t// Add the filter-blur property to the element\n\t\t\tel.addClass(\"censor\");\n\t\t\t// Check whether the style is computed or ignored\n\t\t\tblurSupported = el.css(\"filter\") || el.css(\"-webkit-filter\");\n\t\t\tif (blurSupported) {\n\t\t\t\t//checking for false positives of IE\n\t\t\t\tblurSupported = (document.documentMode === undefined //non-IE browsers, including ancient IEs\n\t\t\t\t\t|| document.documentMode > 9 //IE compatibility mode\n\t\t\t\t\t);\n\t\t\t}\n\t\t\t// Cover it with white if blur is not supported\n\t\t\tif (!blurSupported)\n\t\t\t\tel.addClass(\"censor-fallback\");\n\t\t\t$(\"#warning\").show();\n\t\t\t// TODO: Apply blur to any existing thumbnails in the VM list?\n\t\t\tnsfwWarn = true;\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the loading animation.\n\t * @param {boolean=} show False if the loading animation should be hidden. Defaults to true.\n\t */\n\tfunction displayLoading(show) {\n\t\tif (show === false) {\n\t\t\t$(\"#loading\").hide();\n\t\t\t$(\"#status\").html(\"\");\n\t\t} else {\n\t\t\t$(\"#loading\").show();\n\t\t\t$(\"#status\").html(\"Loading...\");\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the VM list.\n\t * @param {boolean=} show False if the VM list should be hidden. Defaults to true.\n\t */\n\tfunction displayVMList(show) {\n\t\tif (show === false) {\n\t\t\t$(\"#vm-list\").empty().hide();\n\t\t} else {\n\t\t\t$(\"#vm-view\").hide();\n\t\t\t$(\"#vm-list\").empty().show();\n\t\t}\n\t}\n\n\t/**\n\t * Shows or hides the VM viewer.\n\t * @param {boolean=} show False if the VM viewer should be hidden. Defaults to true.\n\t */\n\tfunction displayVMView(show) {\n\t\tif (show === false) {\n\t\t\t$(\"#vm-view\").hide();\n\t\t} else {\n\t\t\t$(\"#vm-list\").hide();\n\t\t\t$(\"#vm-view\").show();\n\t\t\tosk.resize($(\"#kbd-container\").width());\n\t\t}\n\t}\n\n\t/**\n\t * Displays a list of VMs along with their thumbnails and names.\n\t * @param {Array<string>} list An array consisting of 3 values for each VM:\n\t * the short name, the display name, and the base64-encoded thumbnail.\n\t */\n\tfunction updateVMList(list) {\n\t\tvar vmList = $(\"#vm-list\");\n\t\tif (list.length) {\n\t\t\tfor (var i = 0; i < list.length; i += 3) {\n\t\t\t\tvar e = $('<div class=\"col-sm-6 col-md-4\"><a class=\"thumbnail\" href=\"#' + common.rootDir + \"/\" + list[i] + '\">' +\n\t\t\t\t\t(list[i+2] ? '<img src=\"data:image/png;base64,' + list[i+2] + '\"/>' : \"\") +\n\t\t\t\t\t'<div class=\"caption\"><h4>' + list[i+1] + '</h4></div></a></div>');\n\t\t\t\t// Add click handler to anchor tag for history\n\t\t\t\te.children().first().click(function(e) {\n\t\t\t\t\t// Check that the link was clicked with the left mouse button\n\t\t\t\t\tif (e.which === 1) {\n\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\tvar name =  this.getAttribute(\"href\").substr(this.getAttribute(\"href\").lastIndexOf('/')+1);\n\t\t\t\t\t\tcommon.debugLog(\"connect \" + name);\n\t\t\t\t\t\tvmName = name;\n\t\t\t\t\t\ttunnel.sendMessage(\"connect\", vmName);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// If there is an image and the NSFW warning is visible, it should be censored\n\t\t\t\tif (nsfwWarn && list[i+2])\n\t\t\t\t\te.children().first().children().first().addClass(blurSupported ? \"censor\" : \"censor-fallback\");\n\t\t\t\tvmList.append(e);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\t// Prevent the bogus display of \"No VMs online\" if there are list entries\n\t\t\tif(![...document.getElementById(\"vm-list\").children].length || !nodeList.length)\n\t\t\t\tvmList.html(\"No VMs online\");\n\t\t\n\t\t}\n\t}\n\n\tfunction getVMList() {\n\t\tdisplayLoading();\n\t\tdisplayVMList();\n\t\tif (tunnel && tunnel.state === Guacamole.Tunnel.State.OPEN) {\n\t\t\t// Disconnect if we are connected\n\t\t\tif (connected)\n\t\t\t\ttunnel.sendMessage(\"connect\");\n\t\t\ttunnel.sendMessage(\"list\");\n\t\t}\n\t}\n\n\t/**\n\t * Update vote stats.\n\t */\n\tfunction setVoteStats(parameters) {\n\t\tcommon.debugLog(parameters);\n\t\t$(\"#vote-label-yes\").html(parameters[2]);\n\t\t$(\"#vote-label-no\").html(parameters[3]);\n\t\tif (voteInterval)\n\t\t\tclearInterval(voteInterval);\n\t\tvar ms = parseInt(parameters[1]);\n\t\tvar voteStatus = function() {\n\t\t\tms -= 1000;\n\t\t\tvar seconds = Math.floor(ms / 1000);\n\t\t\tif (seconds <= 0) {\n\t\t\t\tclearInterval(voteInterval);\n\t\t\t} else {\n\t\t\t\t$(\"#vote-time\").html(seconds);\n\t\t\t}\n\t\t};\n\t\tvoteStatus();\n\t\t$(\"#vote-stats\").show();\n\t\t\n\t\tvoteInterval = setInterval(voteStatus, 1000);\n\n\t\tif (!hasVoted) {\n\t\t\t$(\"#vote-alert\").show();\n\t\t}\n\n\t\tif (usersData[username][0] == 2 || (usersData[username][0] == 3 && modPerms & 8))\n\t\t{\n\t\t\t$(\"#vote-cancel\").show();\n\t\t} else {\n\t\t\t$(\"#vote-cancel\").hide();\n\t\t}\n\t\t\n\t\tif (usersData[username][0] == 2 || (usersData[username][0] == 3 && (modPerms & 8 && modPerms & 1)))\n\t\t{\n\t\t\t$(\"#vote-pass\").show();\n\t\t} else {\n\t\t\t$(\"#vote-pass\").hide();\n\t\t}\n\t}\n\n\t/**\n\t * Update the actions available to the user.\n\t */\n\tfunction updateActions(parameters) {\n\t\t// Turns enabled\n\t\t// if (parameters[0] === \"1\")\n\t\t\n\t\t// Voting enabled\n\t\tif (parameters[1] === \"1\")\n\t\t\t$(\"#vote-btn\").show();\n\t\telse\n\t\t\t$(\"#vote-btn\").hide();\n\t\t\n\t\t// Uploads enabled\n\t\tif (parameters[2] === \"1\") {\n\t\t\t$(\"#upload-options-btn\").show();\n\t\t\tmaxUploadSize = parseInt(parameters[3]);\n\t\t\tmaxUploadNameLen = parseInt(parameters[4]);\n\t\t\tif (uploadInterval === null && $(\"#upload-input\")[0].files.length)\n\t\t\t\t$(\"#upload-btn, #upload-input\").prop(\"disabled\", false);\n\t\t} else {\n\t\t\t$(\"#upload-options-btn\").hide();\n\t\t\t$(\"#file-upload\").hide(\"fast\");\n\t\t}\n\t}\n\n\tfunction startFileUpload(uploadId) {\n\t\tvar files = $(\"#upload-input\")[0].files;\n\t\tif (files.length !== 1)\n\t\t\treturn;\n\t\tvar file = files[0];\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.open(\"POST\", \"http://\" + common.serverAddress + \"/upload?\" + uploadId, true);\n\t\txhr.responseType = \"text\";\n\t\txhr.setRequestHeader(\"Content-Type\", \"application/octet-stream\");\n\t\t//xhr.onload = function(e) { console.log(xhr.response); };\n\t\tvar progressBar = document.getElementById(\"upload-progress\");\n\t\txhr.upload.onprogress = function(e) {\n\t\t\tif (e.lengthComputable) {\n\t\t\t\tvar progress = (e.loaded / e.total) * 100;\n\t\t\t\t$(\"#upload-wait-time\").html(\"Uploading... (\" + Math.round(progress) + \"%)\");\n\t\t\t}\n\t\t  };\n\t\txhr.send(file);\n\t}\n\n\tfunction displayUploadWaitTime(waitTime) {\n\t\tif (waitTime > 0) {\n\t\t\t$(\"#upload-btn\").prop(\"disabled\", true);\n\t\t\tif (uploadInterval !== null)\n\t\t\t\tclearInterval(uploadInterval);\n\t\t\tuploadInterval = waitingTimer(function(seconds) {\n\t\t\t\t\tif (seconds !== null) {\n\t\t\t\t\t\t$(\"#upload-wait-time\").html(\"Please wait \" + seconds + \" seconds before uploading another file.\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuploadInterval = null;\n\t\t\t\t\t\t$(\"#upload-wait-time\").html(\"\");\n\t\t\t\t\t\t$(\"#upload-input\").prop(\"disabled\", false);\n\t\t\t\t\t\tif ($(\"#upload-input\")[0].files.length)\n\t\t\t\t\t\t\t$(\"#upload-btn\").prop(\"disabled\", false);\n\t\t\t\t\t}\n\t\t\t\t}, waitTime);\n\t\t} else {\n\t\t\t$(\"#upload-wait-time\").html(\"\");\n\t\t\t$(\"#upload-btn, #upload-input\").prop(\"disabled\", false);\n\t\t}\n\t}\n\n\t// long live DartzCodingTM\n\tfunction InitalizeGuacamoleClient() {\n\t\tcommon.debugLog(\"InitalizeGuacamoleClient called\");\n\t\t\n\t\t// Get display div from document\n\t\tdisplay = document.getElementById(\"display\");\n\t\t\n\t\tguac = new Guacamole.Client(tunnel);\n\t\t\n\t\tguac.getDisplay().getElement().addEventListener(\"click\", function() {\n\t\t\tif (!hasTurn && !nsfwWarn)\n\t\t\t\ttunnel.sendMessage(\"turn\");\n\t\t});\n\n\t\t// pip code moved to button due to performance reasons just dont ask ok\n\t\t// and to fix performance issues even more just disable this completely for now\n\t\t// document.pictureInPictureEnabled ? $(\"#pip-btn\").show() : $(\"#pip-btn\").hide();\n\n\t\t$(\"#vm-monitor-send\").click(function() {\n\t\t\tadmin.vmMonitor.sendFromDialog();\n\t\t});\n\n\t\t$(\"#vm-monitor-input\").keypress(function(key) {\n\t\t\tif (key.which === 13) {\n\t\t\t\tadmin.vmMonitor.sendFromDialog();\n\t\t\t}\n\t\t});\n\n\t\t$(\"#chat-user\").click(() => {\n\t\t\t++admin.loginTimesPressed;\n\n\t\t\tif (admin.loginTimesPressed == 4) {\n\t\t\t\tvar passwd = prompt(\"\"); // move this to bootstrap's dialogs?\n\t\t\t\tif (passwd != null) tunnel.sendMessage(\"admin\", 2, passwd);\n\t\t\t}\n\n\t\t\t// it works I don't care\n\t\t\tsetTimeout(()=>{\n\t\t\t\tadmin.loginTimesPressed = 0;\n\t\t\t}, 1500);\n\t\t});\n\t\t\n\t\t// Error handler\n\t\tguac.onerror = function(error) {\n\t\t\tcommon.debugLog(error);\n\t\t};\n\t\t\n\t\ttunnel.onstatechange = function(state) {\n\t\t\tif (state == Guacamole.Tunnel.State.CLOSED) {\n\t\t\t\tdisplayLoading();\n\t\t\t\tdisplayVMList(false);\n\t\t\t\t$(\"#username-btn\").prop(\"disabled\", true);\n\t\t\t\tactivateOSK(false);\n\t\t\t\t// Remove display element\n\t\t\t\tvar e = guac.getDisplay().getElement();\n\t\t\t\tif (e.parentNode == display)\n\t\t\t\t\tdisplay.removeChild(e);\n\t\t\t\t// Clear VM list\n\t\t\t\t$(\"#vm-list\").empty();\n\t\t\t\t// Reset variables\n\t\t\t\tconnected = false;\n\t\t\t\tusers = [];\n\t\t\t\tusersWaiting = 0;\n\t\t\t\tusersData = {};\n\t\t\t\twindow.username = null;\n\t\t\t\tsetFocus(false);\n\t\t\t\thasTurn = false;\n\t\t\t\t$(\"#turn-btn\").show();\n\t\t\t\t$(\"#end-turn-btn\").hide();\n\t\t\t\t$(\"#vote-cancel\").hide();\n\t\t\t\t$(\"#vote-pass\").hide();\n\t\t\t\t$(\"#admin-btns\").hide();\n\t\t\t\tif (turnInterval !== null) {\n\t\t\t\t\tclearInterval(turnInterval);\n\t\t\t\t\tturnInterval = null;\n\t\t\t\t\t$(\"#status\").html(\"\");\n\t\t\t\t}\n\t\t\t\tif (voteInterval !== null) {\n\t\t\t\t\tclearInterval(voteInterval);\n\t\t\t\t\tvoteInterval = null;\n\t\t\t\t}\n\t\t\t\tdisplay.className = \"\";\n\t\t\t\tdisplayTable();\n\t\t\t\t$(\"#chat-send-btn\").prop(\"disabled\", true);\n\t\t\t\t$(\"#chat-input\").prop(\"disabled\", true);\n\t\t\t\t$(\"#chat-user\").hide().html(\"\");\n\t\t\t\t// Attempt to reconnect in 10 seconds\n\t\t\t\tsetTimeout(function (){tunnel.state = Guacamole.Tunnel.State.CONNECTING; guac.connect();}, 10000);\n\t\t\t} else if (state == Guacamole.Tunnel.State.OPEN) {\n\t\t\t\thasVoted = false;\n\t\t\t\tdisplayLoading();\n\t\t\t\t\n\t\t\t\t// Request a username\n\t\t\t\twindow.username = getCookie(\"username\");\n\t\t\t\tif (username)\n\t\t\t\t\ttunnel.sendMessage(\"rename\", username);\n\t\t\t\telse\n\t\t\t\t\ttunnel.sendMessage(\"rename\");\n\t\t\t\t\n\t\t\t\tif (vmName) {\n\t\t\t\t\ttunnel.sendMessage(\"connect\", vmName);\n\t\t\t\t} else {\n\t\t\t\t\tdisplayVMList();\n\t\t\t\t\ttunnel.sendMessage(\"list\");\n\t\t\t\t}\n\t\t\t\t// Add display element\n\t\t\t\tdisplay.appendChild(guac.getDisplay().getElement());\n\t\t\t\t\n\t\t\t\t$(\"#chat-send-btn\").prop(\"disabled\", false);\n\t\t\t\t$(\"#chat-input\").prop(\"disabled\", false);\n\t\t\t\t$(\"#chat-user\").show();\n\n\t\t\t}\n\t\t};\n\t\t\n\t\t// VM List handler\n\t\tguac.onlist = function(parameters) {\n\t\t\tupdateVMList(parameters);\n\t\t\tdisplayLoading(false);\n\t\t};\n\t\t\n\t\t// Turn handler\n\t\tguac.onturn = function(parameters) {\n\t\t\tcommon.debugLog(\"Turn: \");\n\t\t\tcommon.debugLog(parameters);\n\t\t\t// Clear all user data\n\t\t\tfor (var i = 0; i < users.length; i++)\n\t\t\t\tusersData[users[i]][1] = 0;\n\n\t\t\tusersWaiting = parseInt(parameters[1]);\n\t\t\tvar num = usersWaiting + 2;\n\t\t\tfor (var i = 2; i < num; i++) {\n\t\t\t\tusersData[parameters[i]][1] = i-1;\n\t\t\t}\n\t\t\tif (num > 2 && parameters[2] == username) {\n\t\t\t\t// The user has control\n\t\t\t\thasTurn = true;\n\t\t\t\t$(\"#turn-btn\").hide();\n\t\t\t\t$(\"#end-turn-btn\").show();\n\t\t\t\t\n\t\t\t\tdisplay.className = \"focused\";\n\t\t\t\tif (turnInterval !== null)\n\t\t\t\t\tclearInterval(turnInterval);\n\t\t\t\t// Round the turn time up to the nearest second\n\t\t\t\tturnInterval = waitingTimer(function(seconds) {\n\t\t\t\t\t\tif (seconds !== null) {\n\t\t\t\t\t\t\t$(\"#status\").html(\"Your turn expires \" + \"in ~\" + seconds + \" seconds\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tturnInterval = null;\n\t\t\t\t\t\t\t$(\"#status\").html(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}, Math.round(parseInt(parameters[0])/1000)*1000);\n\t\t\t} else if (parameters.length > num) {\n\t\t\t\t// The user is waiting for control\n\t\t\t\thasTurn = false;\n\t\t\t\t$(\"#turn-btn\").hide();\n\t\t\t\t$(\"#end-turn-btn\").show();\n\t\t\t\tdisplay.className = \"waiting\";\n\t\t\t\tif (turnInterval !== null)\n\t\t\t\t\tclearInterval(turnInterval);\n\t\t\t\tturnInterval = waitingTimer(function(seconds, dots) {\n\t\t\t\t\t\tif (seconds !== null) {\n\t\t\t\t\t\t\t$(\"#status\").html(\"Waiting for turn \" + \"in ~\" + seconds + \" seconds\" + dots);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tturnInterval = null;\n\t\t\t\t\t\t\t$(\"#status\").html(\"\");\n\t\t\t\t\t\t}\n\t\t\t\t\t}, Math.round(parseInt(parameters[parameters.length-1])/1000)*1000);\n\t\t\t} else {\n\t\t\t\tif (turnInterval !== null || hasTurn) {\n\t\t\t\t\thasTurn = false;\n\t\t\t\t\t$(\"#status\").html(\"\");\n\t\t\t\t\t$(\"#turn-btn\").show();\n\t\t\t\t\t$(\"#end-turn-btn\").hide();\n\t\t\t\t\tdisplay.className = \"\";\n\t\t\t\t\tif (turnInterval !== null) {\n\t\t\t\t\t\tclearInterval(turnInterval);\n\t\t\t\t\t\tturnInterval = null;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tactivateOSK(hasTurn);\n\t\t\tdisplayTable();\n\t\t};\n\t\t\n\t\t// Rename Handler\n\t\tguac.onrename = function(parameters) {\n\t\t\tif (parameters[0] === \"0\") {\n\t\t\t\t// Change this user's username\n\t\t\t\tvar newUsername = username === null;\n\t\t\t\t// Remove old username if it's in the list\n\t\t\t\tif (!newUsername) {\n\t\t\t\t\tfor (var x = 0; x < users.length; x++) {\n\t\t\t\t\t\tif (users[x] == username) {\n\t\t\t\t\t\t\tusers.splice(x, 1);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\twindow.username = parameters[2];\n\t\t\t\t$(\"#username-btn\").prop(\"disabled\", false);\n\t\t\t\t$(\"#chat-user\").html(username);\n\t\t\t\t// Add the username to the users array if it's not\n\t\t\t\t// already in it\n\t\t\t\tif ($.inArray(username, users) == -1)\n\t\t\t\t\tusers.push(username);\n\t\t\t\tusersData[username] = [0, 0];\n\t\t\t\tsetCookie(\"username\", username, 365);\n\n\t\t\t\t// Check status\n\t\t\t\tif (parameters[1] === \"1\") {\n\t\t\t\t\t// Username taken\n\t\t\t\t\talert(\"That username is already taken.\");\n\t\t\t\t} else if (parameters[1] === \"2\") {\n\t\t\t\t\talert(\"Usernames can contain only numbers, letters, spaces, dashes, underscores, and dots, and it must be between 3 and 20 characters.\");\n\t\t\t\t} else if (parameters[1] === \"3\") {\n\t\t\t\t\talert(\"That username has been blacklisted.\");\n\t\t\t\t}\n\t\t\t} else if (parameters[0] === \"1\") {\n\t\t\t\tvar oldUsername = parameters[1];\n\t\t\t\t// Change another user's username\n\t\t\t\tfor (var i = 0; i < users.length; i++) {\n\t\t\t\t\tif (users[i] == oldUsername) {\n\t\t\t\t\t\tusers[i] = parameters[2];\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tusersData[parameters[2]] = usersData[oldUsername];\n\t\t\t\tdelete usersData[oldUsername];\n\t\t\t}\n\t\t\tdisplayTable();\n\t\t};\n\t\t\n\t\tguac.onconnect = function(parameters) {\n\t\t\tswitch (parseInt(parameters[0])) {\n\t\t\t\tcase 0: // Failed to connect\n\t\t\t\t\talert(\"Failed to connect to VM.\");\n\t\t\t\t\tbreak;\n\t\t\t\tcase 1: // Connected\n\t\t\t\t\tupdateActions(parameters.slice(1));\n\t\t\t\t\t$(\"#chat-box\").empty();\n\t\t\t\t\t$(\"#vote-alert\").hide();\n\t\t\t\t\t$(\"#vote-stats\").hide();\n\t\t\t\t\tdisplayVMView();\n\t\t\t\t\t// Request the username that was stored in the cookie\n\t\t\t\t\t// or send an empty username for the server to generate\n\t\t\t\t\t// a new one\n\t\t\t\t\tif (username === null) {\n\t\t\t\t\t\ttunnel.sendMessage(\"rename\", getCookie(\"username\"));\n\t\t\t\t\t}\n\t\t\t\t\t// Successfully connected to VM\n\t\t\t\t\tconnected = true;\n\t\t\t\t\tdisplayLoading(false);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 2: // Disconnected\n\t\t\t\t\tconnected = false;\n\t\t\t\t\t//cancelUpload = true;\n\t\t\t\t\thasTurn = false;\n\t\t\t\t\t$(\"#turn-btn\").show();\n\t\t\t\t\t$(\"#end-turn-btn\").hide();\n\t\t\t\t\tif (turnInterval !== null)\n\t\t\t\t\t\tclearInterval(turnInterval);\n\t\t\t\t\tif (voteInterval !== null)\n\t\t\t\t\t\tclearInterval(voteInterval);\n\t\t\t\t\tif (uploadInterval !== null)\n\t\t\t\t\t\tclearInterval(uploadInterval);\n\n\t\t\t\t\t// Redirect to VM list\n\t\t\t\t\tHistory.pushState(null, null, common.rootDir);\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t\t\n\t\tguac.onadmin = function(parameters) {\n\t\t\tif (parameters[0] === \"0\") {\n\t\t\t\tvar rank = 0;\n\t\t\t\t$(\"#vm-monitor-btn\").hide();\n\t\t\t\tif (parameters[1] === \"1\") {\n\t\t\t\t\trank = 2;\n\t\t\t\t\tmodPerms = 65535;\n\t\t\t\t\t$(\"#vm-monitor-btn\").show();\n\t\t\t\t} else if (parameters[1] === \"3\") {\n\t\t\t\t\trank = 3;\n\t\t\t\t\tmodPerms = parseInt(parameters[2]);\n\t\t\t\t}\n\t\t\t\tif (rank == 2 || (rank == 3 && modPerms & 3))\n\t\t\t\t\t$(\"#admin-btns\").show();\n\t\t\t\telse\n\t\t\t\t\t$(\"#admin-btns\").hide();\n\t\t\t\tif (rank == 2 || (rank == 3 && modPerms & 1))\n\t\t\t\t\t$(\"#restore-btn\").show();\n\t\t\t\telse\n\t\t\t\t\t$(\"#restore-btn\").hide();\n\t\t\t\tif (rank == 2 || (rank == 3 && modPerms & 2))\n\t\t\t\t\t$(\"#reboot-btn\").show();\n\t\t\t\telse\n\t\t\t\t\t$(\"#reboot-btn\").hide();\n\t\t\t\tif (rank == 2 || (rank == 3 && modPerms & 8))\n\t\t\t\t\t$(\"#vote-cancel\").show();\n\t\t\t\telse\n\t\t\t\t\t$(\"#vote-cancel\").hide();\n\t\t\t\tif (rank == 2 || (rank == 3 && (modPerms & 8 && modPerms & 1)))\n\t\t\t\t\t$(\"#vote-pass\").show();\n\t\t\t\telse\n\t\t\t\t\t$(\"#vote-pass\").hide();\n\t\t\t\tif (rank == 2 || (rank == 3 && modPerms & 64)) {\n\t\t\t\t\t$(\"#clear-turn-queue-btn\").show();\n\t\t\t\t\t$(\"#end-current-turn-btn\").show();\n\t\t\t\t\t$(\"#bypass-turn-btn\").show();\n\t\t\t\t} else {\n\t\t\t\t\t$(\"#clear-turn-queue-btn\").hide();\n\t\t\t\t\t$(\"#end-current-turn-btn\").hide();\n\t\t\t\t\t$(\"#bypass-turn-btn\").hide();\n\t\t\t\t}\n\t\t\t} else if (parameters[0] === \"2\") {\n\t\t\t\tadmin.vmMonitor.output(parameters[1] + \"\\n\");\n\t\t\t} else if (parameters[0] === \"18\") {\n\t\t\t\tif (parameters[1] === \"1\") {\n\t\t\t\t\talert(\"That username is already taken.\");\n\t\t\t\t} else if (parameters[1] === \"2\") {\n\t\t\t\t\talert(\"Usernames can contain only numbers, letters, spaces, dashes, underscores, and dots, and it must be between 3 and 20 characters.\");\n\t\t\t\t}\t\t} else if (parameters[0] === \"19\") {\n\t\t\t\tadmin.copyIP(parameters[1], parameters[2]);\n\t\t\t\tconsole.log(`${parameters[1]} - ${parameters[2]}`); // Log it in case this shitty copy method fails\n\t\t\t}\t};\n\t\t\n\t\tguac.onadduser = function(parameters) {\n\t\t\tcommon.debugLog(\"Add user: \");\n\t\t\tcommon.debugLog(parameters);\n\t\t\tvar num = parseInt(parameters[0])*2 + 1;\n\t\t\tfor (var i = 1; i < num; i += 2) {\n\t\t\t\tif(parameters[i] !== username || usersData[parameters[i]][0] != parameters[i+1]) {\n\t\t\t\t\t// add user to the user list if they don't exist at all,\n\t\t\t\t\t// otherwise only update the user's rank from the server\n\t\t\t\t\tif(users.find((u)=> u == parameters[i]) == undefined)\n\t\t\t\t\t\tusers.push(parameters[i]);\n\n\t\t\t\t\tvar rank = parseInt(parameters[i+1]);\n\t\t\t\t\tusersData[parameters[i]] = [rank, 0];\n\t\t\t\t}\n\t\t\t}\n\t\t\tdisplayTable();\n\t\t};\n\t\t\n\t\tguac.onremuser = function(parameters) {\n\t\t\tcommon.debugLog(\"Remove user: \");\n\t\t\tcommon.debugLog(parameters);\n\t\t\tvar num = parseInt(parameters[0]) + 1;\n\t\t\tfor (var i = 1; i < num; i++) {\n\t\t\t\tvar user = parameters[i];\n\t\t\t\tfor (var x = 0; x < users.length; x++) {\n\t\t\t\t\tif (users[x] == user) {\n\t\t\t\t\t\tusers.splice(x, 1);\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tdelete usersData[user];\n\t\t\t}\n\t\t\tdisplayTable();\n\t\t};\n\t\t\n\t\tguac.onchat = function(parameters) {\n\t\t\tfor (var i = 0; i < parameters.length; i += 2)\n\t\t\t\tchatMessage(parameters[i], parameters[i+1]);\n\t\t};\n\t\t\n\t\tguac.onvote = function(parameters) {\n\t\t\tswitch (parseInt(parameters[0])) {\n\t\t\t\tcase 0:\n\t\t\t\t\tcommon.debugLog(\"Vote started\");\n\t\t\t\t// Fall-through\n\t\t\t\tcase 1:\n\t\t\t\t\t// Update vote stats\n\t\t\t\t\tcommon.debugLog(\"Update vote stats\");\n\t\t\t\t\tsetVoteStats(parameters);\n\t\t\t\tbreak;\n\t\t\t\tcase 2:\n\t\t\t\t\tcommon.debugLog(\"Voting ended\");\n\t\t\t\t\t$(\"#vote-alert\").hide();\n\t\t\t\t\t$(\"#vote-stats\").hide();\n\t\t\t\t\thasVoted = false;\n\t\t\t\tbreak;\n\t\t\t\tcase 3:\n\t\t\t\t\talert(\"Please wait \" + parameters[1] + \" seconds before starting another vote.\");\n\t\t\t\t\thasVoted = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t\t\n\t\tguac.onfile = function(parameters) {\n\t\t\tswitch (parseInt(parameters[0])) {\n\t\t\tcase fileResponse.BEGIN:\n\t\t\t\t/*common.debugLog(\"File upload started\");\n\t\t\t\tcommon.debugLog(\"Upload ID: \" + parameters[1]);*/\n\t\t\t\tstartFileUpload(parameters[1]);\n\t\t\t\tbreak;\n\t\t\tcase fileResponse.FINISHED:\n\t\t\t\t$(\"#upload-input\").val(null).prop(\"disabled\", false);\n\t\t\t\tdisplayUploadWaitTime(parameters.length === 2 ? parseInt(parameters[1]) : 0);\n\t\t\t\tbreak;\n\t\t\tcase fileResponse.WAIT_TIME:\n\t\t\t\tdisplayUploadWaitTime(parseInt(parameters[1]));\n\t\t\t\tbreak;\n\t\t\tcase fileResponse.FAILED:\n\t\t\t\t$(\"#upload-input\").val(null).prop(\"disabled\", false);\n\t\t\t\tdisplayUploadWaitTime(parameters.length === 2 ? parseInt(parameters[1]) : 0);\n\t\t\t\talert(\"File upload failed\");\n\t\t\t\tbreak;\n\t\t\tcase fileResponse.TIMED_OUT:\n\t\t\t\t$(\"#upload-input\").val(null).prop(\"disabled\", false);\n\t\t\t\tdisplayUploadWaitTime(parameters.length === 2 ? parseInt(parameters[1]) : 0);\n\t\t\t\talert(\"File upload timed out\");\n\t\t\t\tbreak;\n\t\t\tcase fileResponse.UPLOAD_IN_PROGRESS:\n\t\t\t\t$(\"#upload-btn, #upload-input\").prop(\"disabled\", true);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t};\n\t\t\n\t\tguac.onaction = function(parameters) {\n\t\t\tupdateActions(parameters);\n\t\t};\n\n\t\tdocument.addEventListener(\"mousedown\", function() {\n\t\t\tif (focused)\n\t\t\t\tsetFocus(false);\n\t\t});\n\t\t\n\t\t// Mouse\n\t\tmouse = new (\"ontouchstart\" in document ? Guacamole.Mouse.Touchscreen : Guacamole.Mouse)(guac.getDisplay().getElement());\n\t\tmouse.onmousedown = function(mouseState) {\n\t\t\tif (!focused)\n\t\t\t\tsetFocus(true);\n\t\t\tif (hasTurn)\n\t\t\t\tguac.sendMouseState(mouseState);\n\t\t};\n\t\tmouse.onmouseup =\n\t\tmouse.onmousemove = function(mouseState) {\n\t\t\tif (hasTurn)\n\t\t\t\tguac.sendMouseState(mouseState);\n\t\t};\n\t\t\n\t\t// Keyboard\n\t\tkeyboard = new Guacamole.Keyboard(document);\n\t}\n\n\twindow.multicollab = function(ip) {\n\t\tvar connTunnel = new Guacamole.WebSocketTunnel('ws://' + ip + '/');\n\t\t\n\t\tconnTunnel.onstatechange = function(code) {\n\t\t\tif (code == 2) {\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tlistGuac.connect();\n\t\t\t\t}, 1000);\n\t\t\t} else if (code == 1) {\n\t\t\t\tconnTunnel.sendMessage('connect');\n\t\t\t\tconnTunnel.sendMessage('list');\n\t\t\t}\n\t\t};\n\t\t\n\t\tvar listGuac = new Guacamole.Client(connTunnel);\n\t\t\n\t\tlistGuac.onlist = function(e) {\n\t\t\tconnTunnel.onstatechange = null;\n\t\t\tlistGuac.disconnect();\n\t\t\t\n\t\t\tfor (var i = 0; i < e.length; i += 3) {\n\t\t\t\t\tnodeList.push({\n\t\t\t\t\t\tip: ip,\n\t\t\t\t\t\turl: e[i],\n\t\t\t\t\t\tname: e[i + 1],\n\t\t\t\t\t\timage: e[i + 2]\n\t\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tnodeList.sort(function(a, b) {\n\t\t\t\treturn a.url > b.url ? 1 : -1;\n\t\t\t});\n\t\t\t\t\n\t\t\tvar vmlist = document.getElementById('vm-list');\n\t\t\tvmlist.innerHTML = \"\";\n\t\t\t\n\t\t\tfor(var i in nodeList) {\n\t\t\t\tvar thisnode = nodeList[i];\n\t\t\t\t\n\t\t\t\tvar div = document.createElement('div');\n\t\t\t\tdiv.className = 'col-sm-5 col-md-3';\n\t\t\t\tvar link = document.createElement('a');\n\t\t\t\tlink.className = 'thumbnail';\n\t\t\t\tlink.href = '#' + thisnode.url;\n\n\t\t\t\t// this one makes me actually want to fucking set up a jslint thing\n\t\t\t\tvar checkforcnewbss = \"\";\n\n\t\t\t\t// If the image is empty, then this is a VM that uses\n\t\t\t\t// computernewb screenshots. Otherwise, we should use the base64\n\t\t\t\t// payload the server sends.\n\t\t\t\tif (thisnode.image === \"\") {\n\t\t\t\t\tcheckforcnewbss = '<img src=\"http://computernewb.com/screenshots/' + thisnode.url + '.jpg\"/><div class=\"caption\"><h4>' + thisnode.name + \"</h4></div>\";\n\t\t\t\t} else {\n\t\t\t\t\tcheckforcnewbss = (thisnode.image ? '<img src=\"data:image/png;base64,' + thisnode.image + '\"/>' : \"\") + '<div class=\"caption\"><h4>' + thisnode.name + \"</h4></div>\";\n\t\t\t\t}\n\n\t\t\t\tlink.innerHTML=checkforcnewbss;\n\t\t\t\tlink.onclick = function(event) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\ttunnel.onstatechange = null;\n\t\t\t\t\t\tguac.disconnect(); // kill existing connection\n\n\t\t\t\t\t\t// can't use thisnode because that's incredibly broken\n\t\t\t\t\t\t// so we have to do this cursed being to get the node information\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar elem = event.srcElement;\n\t\t\t\t\t\twhile(elem.hash == undefined)\n\t\t\t\t\t\t\telem = elem.parentElement;\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar hash = elem.hash;\n\t\t\t\t\t\t\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar node = nodeList.find(node => node.url == hash.substring(1));\n\t\t\t\t\t\tif(node == undefined) {\n\t\t\t\t\t\t\tcommon.debugLog(\"Node not found?\");\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar display = document.getElementById('display');\n\t\t\t\t\t\tif(display.firstChild)\n\t\t\t\t\t\t\t\tdisplay.removeChild(display.firstChild);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t// set up the tunnel for InitalizeGuacamoleClient\n\t\t\t\t\t\ttunnel = new Guacamole.WebSocketTunnel('ws://' + node.ip + '/');\n\t\t\t\t\t\tvmName = node.url;\n\t\t\t\t\t\tcommon.serverAddress = node.ip;\n\t\t\t\t\t\t\n\t\t\t\t\t\t// connect to server\n\t\t\t\t\t\tcommon.debugLog(\"Connect to multicollab VM \" + node.ip);\n\t\t\t\t\t\tInitalizeGuacamoleClient();\n\t\t\t\t\t\tguac.connect();\n\t\t\t\t};\n\t\t\t\tdiv.appendChild(link);\n\t\t\t\tvmlist.appendChild(div);\n\t\t\t\t\n\t\t\t\t// Manually apply the nsfw blur if we have to\n\t\t\t\tif(nsfwWarn)\n\t\t\t\t\t$(\"#vm-list img\").addClass(\"censor\");\n\t\t\t}\n\t\t};\n\t\t\n\t\tlistGuac.connect();\n\t};\n\n\t$(window).on(\"statechange\", function() {\n\t\tcommon.debugLog(\"statechange callled\");\n\t});\n\t\t\n\t$(function() {\n\t\t// Try to set the text shadow property for the NSFW warning so it can\n\t\t// be seen on dark backgrounds\n\t\tvar warnText = $(\"#warn-text\");\n\t\tif (!warnText.css(\"text-shadow\", \"2px 2px #fff\").css(\"text-shadow\")) {\n\t\t\t// If the property is not supported, set the background color to white\n\t\t\twarnText.css(\"background-color\", \"white\");\n\t\t}\n\t\t\n\t\t$(\"#nsfw-cont-btn\").click(function() {\n\t\t\tdisplayNsfwWarn(false);\n\t\t\tif ($(\"#no-warn-chkbox\").prop(\"checked\")) {\n\t\t\t\tsetCookie(\"no-nsfw-warn-v2\", \"1\", 365);\n\t\t\t}\n\t\t});\n\t\t\n\t\tosk = new Guacamole.OnScreenKeyboard(en_us_qwerty_keyboard);\n\t\tactivateOSK(false);\n\t\t$(\"#kbd-keys\").append(osk.getElement());\n\t\t\n\t\tosk.onkeydown = function(keysym) {\n\t\t\tif (hasTurn)\n\t\t\t\tguac.sendKeyEvent(1, keysym);\n\t\t};\n\t\t\n\t\tosk.onkeyup = function(keysym) {\n\t\t\tif (hasTurn)\n\t\t\t\tguac.sendKeyEvent(0, keysym);\n\t\t};\n\t\t\n\t\t$(\"#osk-btn\").click(function() {\n\t\t\tvar kbd = $(\"#kbd-outer\");\n\t\t\tif (kbd.is(\":visible\"))\n\t\t\t\tkbd.hide(\"fast\");\n\t\t\telse\n\t\t\t\tkbd.show(\"fast\");\n\t\t});\n\t\t\n\t\t$(\"#turn-btn\").click(function() {\n\t\t\tif(tunnel.state == Guacamole.Tunnel.State.OPEN)\n\t\t\t\ttunnel.sendMessage(\"turn\");\n\t\t});\n\n\t\t$(\"#end-turn-btn\").click(function() {\n\t\t\tif(tunnel.state == Guacamole.Tunnel.State.OPEN)\n\t\t\t\ttunnel.sendMessage(\"turn\",\"0\");\n\t\t});\n\n\t\t$(window).resize(function() {\n\t\t\tif (osk)\n\t\t\t\tosk.resize($(\"#kbd-container\").width());\n\t\t});\n\t\t\n\t\t$(\"#vote-btn\").click(function() {\n\t\t\thasVoted = true;\n\t\t\ttunnel.sendMessage(\"vote\", \"1\");\n\t\t});\n\t\t\n\t\t$(\"#vote-yes\").click(function() {\n\t\t\tif (!hasVoted) {\n\t\t\t\thasVoted = true;\n\t\t\t\ttunnel.sendMessage(\"vote\", \"1\");\n\t\t\t\t$(\"#vote-alert\").hide();\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(\"#vote-no\").click(function() {\n\t\t\tif (!hasVoted) {\n\t\t\t\thasVoted = true;\n\t\t\t\ttunnel.sendMessage(\"vote\", \"0\");\n\t\t\t\t$(\"#vote-alert\").hide();\n\t\t\t}\n\t\t});\n\n\t\t$(\"#vote-cancel\").click(function() {\n\t\t\ttunnel.sendMessage(\"admin\", \"13\", 0);\n\t\t});\n\n\t\t$(\"#vote-pass\").click(function() {\n\t\t\ttunnel.sendMessage(\"admin\", \"13\", 1);\n\t\t});\n\t\t\n\t\t$(\"#vote-dismiss\").click(function() {\n\t\t\t$(\"#vote-alert\").hide();\n\t\t});\n\t\t\n\t\t$('#username-modal').on('show.bs.modal', function (event) {\n\t\t\t$(\"#username-box\").val(username);\n\t\t});\n\n\t\t$(\"#username-ok-btn\").click(function() {\n\t\t\tvar newUsername = $(\"#username-box\").val().trim();\n\t\t\tif (newUsername) {\n\t\t\t\t$('#username-modal').modal(\"hide\");\n\t\t\t\tcommon.debugLog(\"New Username: \" + newUsername);\n\t\t\t\t// TODO: close modal when WebSocket disconnects\n\t\t\t\tif (tunnel.state == Guacamole.Tunnel.State.OPEN) {\n\t\t\t\t\ttunnel.sendMessage(\"rename\", newUsername);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(\"#username-box\").keydown(function(e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\t// Enter key\n\t\t\t\te.preventDefault();\n\t\t\t\t$(\"#username-ok-btn\").trigger(\"click\");\n\t\t\t}\n\t\t});\n\n\t\t$(\"#autotype-ok-btn\").click(function() {\n\t\t\tvar Text = $(\"#autotype-box\").val();\n\t\t\tif (Text) {\n\t\t\t\t$('#autotype-modal').modal(\"hide\");\n\t\t\t\tcommon.debugLog(\"Autotype: \" + Text);\n\t\t\t\t// TODO: close modal when WebSocket disconnects\n\t\t\t\tif (tunnel.state == Guacamole.Tunnel.State.OPEN) {\n\t\t\t\t\ttunnel.sendMessage(\"autotype\", Text);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(\"#autotype-box\").keydown(function(e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\t// Enter key\n\t\t\t\te.preventDefault();\n\t\t\t\t$(\"#autotype-ok-btn\").trigger(\"click\");\n\t\t\t}\n\t\t});\n\t\t\n\t\t// TODO: Add drag and drop support for file uploads\n\t\t/*$(\"#display\").on(\"dragenter\", function(e) {\n\t\t\t$(this).addClass(\"drag\");\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t});\n\t\t\n\t\t$(\"#display\").on(\"dragover\", function(e) {\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t});\n\t\t\n\t\t$(\"#display\").on(\"dragleave\", function(e) {\n\t\t\t$(this).removeClass(\"drag\");\n\t\t\te.stopPropagation();\n\t\t\te.preventDefault();\n\t\t});*/\n\t\t\n\t\tfileApisSupported = !!(window.File && window.FileReader && window.FileList && window.Blob && window.ArrayBuffer && window.Uint8Array);\n\t\t\n\t\t$(\"#upload-options-btn\").click(fileApisSupported ? function() {\n\t\t\tvar fileUpload = $(\"#file-upload\");\n\t\t\tif (fileUpload.is(\":visible\"))\n\t\t\t\tfileUpload.hide(\"fast\");\n\t\t\telse\n\t\t\t\tfileUpload.show(\"fast\");\n\t\t} : function() { alert(\"File uploads are not fully supported by your browser.\"); });\n\t\t\n\t\tif (fileApisSupported) {\n\t\t\t$(\"#upload-input\").change(function(e) {\n\t\t\t\tvar files = e.target.files;\n\t\t\t\tif (files.length === 1) {\n\t\t\t\t\tvar file = files[0];\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tif (file.size > maxUploadSize) {\n\t\t\t\t\t\t\talert(\"File is too big. Max file size is \" + maxUploadSize + \" bytes.\");\n\t\t\t\t\t\t} else if (file.name.length > maxUploadNameLen) {\n\t\t\t\t\t\t\talert(\"Filename is too long. Max filename is \" + maxUploadNameLen + \".\");\n\t\t\t\t\t\t} else if (/[^\\x20-\\x7E]|[<>:\"/\\\\\\|\\?\\*]/.test(file.name)) {\n\t\t\t\t\t\t\talert(\"Filename contains characters that are not allowed.\");\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t//$(\"#filename-box\").val(file.name);\n\t\t\t\t\t\t\tif (uploadInterval === null) {\n\t\t\t\t\t\t\t\t$(\"#upload-btn\").prop(\"disabled\", false);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthis.value = null;\n\t\t\t\t$(\"#upload-btn\").prop(\"disabled\", true);\n\t\t\t});\n\t\t\t\n\t\t\t$(\"#upload-btn\").click(function() {\n\t\t\t\tvar files = $(\"#upload-input\")[0].files;\n\t\t\t\tif (files.length !== 1)\n\t\t\t\t\treturn;\n\t\t\t\tvar file = files[0];\n\t\t\t\ttunnel.sendMessage(\"file\", fileOp.BEGIN, file.name, file.size, $(\"#upload-run-chkbox\").prop(\"checked\") ? 1 : 0);\n\t\t\t\t$(this).prop(\"disabled\", true);\n\t\t\t\t$(\"#upload-input\").prop(\"disabled\", true);\n\t\t\t\t$(\"#upload-wait-time\").html(\"Uploading...\");\n\t\t\t});\n\t\t}\n\t\t\n\t\t$(\"#restore-btn\").click(function() {\n\t\t\ttunnel.sendMessage(\"admin\", \"8\", vmName);\n\t\t});\n\t\t\n\t\t$(\"#reboot-btn\").click(function() {\n\t\t\ttunnel.sendMessage(\"admin\", \"10\", vmName);\n\t\t});\n\t\t\n\t\t$(\"#clear-turn-queue-btn\").click(function() {\n\t\t\ttunnel.sendMessage(\"admin\", \"17\", vmName);\n\t\t});\n\t\t\n\t\t$(\"#end-current-turn-btn\").click(function() {\n\t\t\tfor (var user in usersData) {\n\t\t\t\tif (usersData[user][1] == 1) {\n\t\t\t\t\ttunnel.sendMessage(\"admin\", \"16\", user);\n\t\t\t\t\tbreak;\n\t\t\t\t}\t\t}\t});\n\n\t\t$(\"#bypass-turn-btn\").click(function() {\n\t\t\ttunnel.sendMessage(\"admin\", \"20\");\n\t\t});\n\t\t\n\t\t$(\"#home-btn\").attr(\"href\", common.rootDir).click(function(e) {\n\t\t\t// Check that the link was clicked with the left mouse button\n\t\t\tif (e.which === 1) {\n\t\t\t\te.preventDefault();\n\t\t\t\tif ($(\"#vm-list\").is(\":visible\")) {\n\t\t\t\t\tgetVMList();\n\t\t\t\t} else {\n\t\t\t\t\tHistory.pushState(null, null, this.getAttribute(\"href\"));\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(\"#chat-input\").keypress(function(e) {\n\t\t\tif (e.which === 13) {\n\t\t\t\t// Enter key sends chat message\n\t\t\t\te.preventDefault();\n\t\t\t\t$(\"#chat-send-btn\").trigger(\"click\");\n\t\t\t} else if (this.value.length >= maxChatMsgLen) {\n\t\t\t\te.preventDefault();\n\t\t\t}\n\t\t}).on(\"input\", function() {\n\t\t\t// Truncate chat messages that are too long\n\t\t\tif (this.value.length > maxChatMsgLen)\n\t\t\t\tthis.value = this.value.substr(0, maxChatMsgLen);\n\t\t});\n\t\t\n\t\t$(\"#chat-send-btn\").click(function() {\n\t\t\tvar chat = $(\"#chat-input\");\n\t\t\tvar msg = chat.val().trim();\n\t\t\tif (guac.currentState === Guacamole.Client.CONNECTED && msg) {\n\t\t\t\ttunnel.sendMessage(\"chat\", msg);\n\t\t\t\tchat.val(\"\");\n\t\t\t}\n\t\t});\n\t\t\n\t\t$(\"#chat-sound-btn\").click(function() {\n\t\t\tsetChatSoundOn(!chatSoundOn);\n\t\t\tsetCookie(\"chat-sound\", chatSoundOn ? \"1\" : \"0\", 365);\n\t\t});\n\t\t\n\t\tinitSound();\n\t\t\n\t\tsetChatSoundOn(getCookie(\"chat-sound\") != \"0\");\n\n\t\tdisplayNsfwWarn(getCookie(\"no-nsfw-warn-v2\") != \"1\");\n\t\t\n\t\t// Instantiate client, using a websocket tunnel for communications.\n\t\ttunnel = new Guacamole.WebSocketTunnel(\"ws://\" + common.serverAddress + \"/\");\n\t\t\n\t\tcommon.debugLog(\"Initalize guacamole client\");\n\t\t\n\t\tInitalizeGuacamoleClient();\n\t\tguac.connect();\n\t\t\n\t\t// Add the nodes in the configuration\n\t\tcommon.additionalNodes.forEach((node) => {\n\t\t\tcommon.debugLog(\"Add additional node \" + node);\n\t\t\tmulticollab(node);\n\t\t});\n\t});\n\n\t// Browser exports\n\n\t// get the admin utils if needed\n\t// this is dumb but Whatever(TM)\n\twindow.GetAdmin = function() {\n\t\treturn admin;\n\t};\n\n\t// Disconnect on close\n\twindow.onunload = function() {\n\t\tguac.disconnect();\n\t};\n\n}());\n\n//# sourceMappingURL=all.js.map\n"]}